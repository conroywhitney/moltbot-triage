---
number: 4389
title: "fix: handle string thread_ts from Slack properly"
author: Chloe-VP
created: 2026-01-30T05:14:54Z
updated: 2026-01-30T05:14:54Z
labels: []
additions: 3
deletions: 3
changed_files: 1
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4389
fixes_issues: [4380]
related_prs: [4380]
duplicate_of: null
---

## Description

## Summary
Fixes #4380 - Slack thread_ts messages were being dropped because the queue drain logic used `typeof === 'number'` to check for thread IDs.

## Problem
Slack thread_ts values are strings (e.g., `'1737766124.329349'`), not numbers. The original code:
```typescript
if (typeof threadId !== 'number') // This fails for Slack string thread IDs
```

This caused valid Slack thread messages to be filtered out incorrectly.

## Solution
Changed three occurrences in `src/auto-reply/reply/queue/drain.ts`:
- Line 43: `typeof threadId !== 'number'` → `threadId == null`
- Line 49: `typeof threadId === 'number'` → `threadId != null`
- Line 75: `typeof originatingThreadId === 'number'` → `originatingThreadId != null`

## Testing
- TypeScript compiles without errors
- Existing queue tests pass (8 tests total)
- Change allows string thread IDs while still filtering undefined/null values

## Notes
This is a straightforward type check fix - no behavioral changes for existing numeric thread IDs.

## Reviews


## Comments


## Stats

- **Size:** tiny (3+, 3-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #4380
