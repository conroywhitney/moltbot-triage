---
number: 7106
title: "fix: openclaw update includes external npm-installed plugins"
author: dial481
created: 2026-02-02T11:49:35Z
updated: 2026-02-02T11:55:08Z
labels: ["cli"]
additions: 8
deletions: 0
changed_files: 1
size: tiny
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 4
reactions_total: 1
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/7106
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

**AI Assisted**
**Tested**

## Summary                                                                                                                           
                                                                                                                                       
  `openclaw update` now properly updates externally installed npm plugins.                                                             
                                                                                                                                       
  ## Problem                                                                                                                           
                                                                                                                                       
Running `openclaw update` would not update plugins installed via `openclaw plugins install <npm-package>`. Only bundled plugins were  being updated.                                                                                                                       
                                                                                                                                       
  **Steps to reproduce:**                                                                                                              
  1. Install an external npm plugin: `openclaw plugins install openclaw-penfield`                                                      
  2. A new version is published to npm                                                                                                 
  3. Run `openclaw update`                                                                                                             
  4. Plugin is NOT updated (stays on old version)                                                                                      
                                                                                                                                       
  ## Root Cause                                                                                                                        
                                                                                                                                       
  `syncPluginsForUpdateChannel()` only processes bundled plugins. When `updateNpmInstalledPlugins()` was called without explicit plugin
   IDs, it iterated over the post-sync config which doesn't include external npm plugins.                                              
                                                                                                                                       
  ## Solution                                                                                                                          
                                                                                                                                       
  Capture npm plugin IDs from config BEFORE sync runs, then pass them explicitly to `updateNpmInstalledPlugins()`.                     
                                                                                                                                       
  ## Tests                                                                                                                     
                                                                                                                                       
  - [x] Tested with openclaw-penfield plugin installed from npm                                                                        
  - [x] Verified `openclaw update` now attempts to fetch new version                                                                   
  - [ ] Existing unit tests pass                                                                                                       
                                                                                  

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-02)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @dial481 (2026-02-02)

@greptile-apps

No action needed. Here's why:                                                                                                        
                                                                                                                                       
  1. The warning is benign - "No install record" just results in status: "skipped", not an error                                       
  2. The edge case is rare - syncPluginsForUpdateChannel only processes BUNDLED plugins. It shouldn't remove external npm install records. The warning would only appear if:                                                                                           
    - User manually removed the plugin during sync (unlikely)                                                                          
    - A bundled plugin has the same ID as an npm plugin (collision - different bug)                                                    
  3. The fix solves the real problem - External npm plugins were NOT being updated at all. Now they are.                               
  4. The suggested fix adds complexity for cosmetics - Filtering post-sync would require:                                              

```
const npmPluginIds = Object.keys(originalInstalls).filter(                                                                           
    (id) => originalInstalls[id]?.source === "npm" &&                                                                                  
            pluginConfig.plugins?.installs?.[id]?.source === "npm",                                                                    
  );     
```                                                                                                                            
  
  5. More code, more potential bugs, for a warning that rarely appears.                  

### @greptile-apps (2026-02-02)

You're absolutely correct - no action is needed on the warning. Here's why your reasoning is sound:

## The Warning is Benign
The "No install record" warning results in `status: "skipped"`, not an error. The function continues normally and the update process succeeds.

## Edge Case is Extremely Rare  
Looking at the code, `syncPluginsForUpdateChannel` only processes **bundled** plugins with npm specs. It should never remove external npm install records. The warning would only occur if:
- A user manually removed a plugin during the sync (unlikely)
- There's a plugin ID collision between bundled and npm plugins (separate bug)

## Core Problem is Fixed
Your solution addresses the real issue: external npm plugins weren't being updated at all because `updateNpmInstalledPlugins()` was iterating over the post-sync config which excludes external plugins.

## Filtering Adds Unnecessary Complexity
The suggested post-sync filtering would require additional logic to verify both pre-sync and post-sync install records exist with npm source - more code, more potential bugs, for a cosmetic improvement on a warning that rarely appears.

Your fix is clean, targeted, and solves the actual problem. The warning is a minor cosmetic issue that doesn't warrant the added complexity.

### @greptile-apps (2026-02-02)

Your reasoning is solid. The fix correctly prioritizes the functional issue over a cosmetic warning.

You're right that:

1. **The core problem is solved** - External npm plugins now get updated by capturing their IDs before sync
2. **The warning is harmless** - "No install record" just results in `status: "skipped"`, not an error
3. **The edge case is rare** - `syncPluginsForUpdateChannel()` only processes bundled plugins, so external npm records should rarely be removed
4. **Additional filtering adds complexity** - The suggested post-sync filtering would require checking both configs and add more code for minimal benefit

The current fix is clean and focused. It ensures external npm plugins get updated regardless of sync behavior, which solves the real user problem. A rare cosmetic warning isn't worth the added complexity.

### @greptile-apps (2026-02-02)

You make a solid practical argument. The warning is indeed cosmetic and the rare edge cases don't justify the added complexity. Your fix solves the actual problem - external npm plugins weren't being updated at all.

The "No install record" warning would only appear in unusual scenarios (manual plugin removal during sync or ID collisions), and adding intersection logic would complicate the code for minimal benefit. The current fix is clean and focused on the core issue.

Good call on keeping it simple.


## Stats

- **Size:** tiny (8+, 0-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
