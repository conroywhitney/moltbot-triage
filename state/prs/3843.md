---
number: 3843
title: "fix(telegram): treat exec exit code errors as internal"
author: ai-fanatic
created: 2026-01-29T07:32:50Z
updated: 2026-01-29T07:32:59Z
labels: ["agents"]
additions: 26
deletions: 6
changed_files: 2
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/3843
fixes_issues: [3765]
related_prs: [3765]
duplicate_of: null
---

## Description

## Summary
- Treat command exit code errors as internal/recoverable instead of forwarding to users
- Add test cases for the new behavior

## Problem
When using Telegram (or other channels), exec tool errors like "Command exited with code 1" were being forwarded to users:

```
‚ö†Ô∏è üõ†Ô∏è Exec: clawdbot status | grep -A5 "..." failed: Command exited with code 1
```

This is problematic because:
1. Exit code 1 from `grep` just means "no matches found" - not a real error
2. These technical messages clutter the chat and confuse users
3. The model already sees these errors in its context and can decide how to proceed

## Solution
Add "exited with code", "exit code", and "aborted" to the list of recoverable/internal error patterns in `buildEmbeddedRunPayloads()`. These errors will:
- Stay in the agent's internal context
- Not be shown to end users
- Still appear in gateway logs for debugging

## Files changed
- `src/agents/pi-embedded-runner/run/payloads.ts` - Add new patterns to `isRecoverableError` check
- `src/agents/pi-embedded-runner/run/payloads.test.ts` - Update tests for new behavior

## Test plan
- [x] Updated existing test to expect exit code errors to be suppressed
- [x] Added test case for "aborted" command errors
- [ ] Manual test: Run a command that returns exit code 1 (e.g., `grep` with no matches) and verify error is not shown to user

## Notes
Non-recoverable errors like "connection timeout" are still shown to users, as these indicate real problems that users should be aware of.

Fixes #3765

---

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** small (26+, 6-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: #3765
