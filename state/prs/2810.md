---
number: 2810
title: "fix(voice-call): skip stale calls on load to prevent stuck concurrent limit"
author: steve-rodri
created: 2026-01-27T15:04:15Z
updated: 2026-02-03T03:55:51Z
labels: ["channel: voice-call"]
additions: 25
deletions: 11
changed_files: 1
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/2810
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

When the gateway restarts, `loadActiveCalls()` reloads non-terminal calls from `calls.jsonl`. However, these calls may have already ended (e.g., Twilio timed them out) and are now stale. This causes the concurrent call limit to be reached with phantom calls that can never be cleared.

## Solution

Skip loading calls that are older than `maxDurationSeconds`, as they cannot possibly still be active.

## Testing

1. Initiate a call
2. Kill the gateway before the call ends  
3. Restart the gateway
4. Verify that stale calls are logged as skipped
5. Verify that new calls can be initiated

Fixes calls getting stuck in 'initiated' state after gateway restarts.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the voice-call `CallManager`’s crash-recovery path to avoid reloading “phantom” active calls from `calls.jsonl` after a gateway restart. Specifically, `loadActiveCalls()` now skips non-terminal calls whose `startedAt` timestamp is older than `config.maxDurationSeconds`, preventing the concurrent-call limit from being consumed by calls that have almost certainly already ended upstream (e.g., timed out by Twilio).

<h3>Confidence Score: 4/5</h3>

- This PR is reasonably safe to merge with low risk of regressions.
- Change is narrowly scoped to `loadActiveCalls()` and only affects crash-recovery behavior, but the staleness heuristic is based on `startedAt` which could drop still-active calls in some edge cases (long ring/queue times or config changes).
- extensions/voice-call/src/manager.ts (staleness cutoff logic in loadActiveCalls)

<!-- greptile_other_comments_section -->

<sub>(4/5) You can add custom instructions or style guidelines for the agent [here](https://app.greptile.com/review/github)!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** small (25+, 11-, 1 files)
- **Age:** 6 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
