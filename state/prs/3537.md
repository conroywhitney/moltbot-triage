---
number: 3537
title: "feat: add Kimi Code OAuth support (import from Kimi CLI)"
author: spanishflu-est1918
created: 2026-01-28T19:50:56Z
updated: 2026-01-28T23:25:08Z
labels: ["docs", "cli", "commands", "agents"]
additions: 562
deletions: 3
changed_files: 8
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3537
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Add native Kimi Code OAuth support, allowing users to authenticate with their Kimi subscription (via Kimi CLI) instead of requiring a static API key.

Built together with Hermes (Claude agent) and a Kimi K2.5 sub-agent assist on initial implementation.

## Changes

- **`src/providers/kimi-code-oauth.ts`** (new) — Token refresh function via `auth.kimi.com/api/oauth/token`. Follows the `qwen-portal-oauth.ts` pattern.
- **`src/agents/auth-profiles/oauth.ts`** — Add `kimi-code` to the OAuth refresh dispatch chain (after chutes + qwen-portal, before pi-ai fallback).
- **`src/commands/onboard-types.ts`** — Add `"kimi-code-oauth"` to `AuthChoice` union.
- **`src/commands/auth-choice-options.ts`** — Add option to UI + Moonshot group.
- **`src/commands/auth-choice.preferred-provider.ts`** — Map to `kimi-code` provider.
- **`src/commands/onboard-non-interactive/local/auth-choice.ts`** — Import handler: reads `~/.kimi/credentials/kimi-code.json`, converts `expires_at` (seconds → ms), stores as OAuth profile.
- **`src/cli/program/register.onboard.ts`** — CLI help text.
- **`docs/experiments/proposals/kimi-code-oauth.md`** — Full spec with protocol details and live testing results.

## Usage

```bash
# Log in with Kimi CLI first
kimi login

# Then import into Moltbot
moltbot onboard --auth-choice kimi-code-oauth
```

## How it works

Kimi Code CLI uses OAuth device authorization with `auth.kimi.com`, storing short-lived access tokens (~15 min) + refresh tokens (~30 days). This PR:

1. Imports the credentials from Kimi CLI's credential store
2. Stores them as a `kimi-code:default` OAuth auth profile
3. Auto-refreshes via the existing auth profile refresh-on-use mechanism

The refresh endpoint:
```
POST https://auth.kimi.com/api/oauth/token
client_id=17e5f671-d194-4dfb-9706-5516cb48c098
grant_type=refresh_token
```

## Testing

- ✅ Endpoint verified (API calls + token refresh)
- ✅ Compiles clean (`tsc --noEmit`)
- ✅ Lint clean (`oxlint`)
- ✅ Live tested: Moltbot agent running on `kimi-code/kimi-for-coding` via OAuth token
- ⚠️ Kimi uses single-use refresh tokens — each refresh invalidates the old one

## Reviews


## Comments


## Stats

- **Size:** large (562+, 3-, 8 files)
- **Age:** 1 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
