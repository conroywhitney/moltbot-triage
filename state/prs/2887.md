---
number: 2887
title: "fix(daemon): use correct service name for node install/uninstall"
author: MohammadErfan-Jabbari
created: 2026-01-27T17:35:51Z
updated: 2026-02-03T03:55:53Z
labels: ["gateway", "agents"]
additions: 7
deletions: 7
changed_files: 3
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/2887
fixes_issues: [2855]
related_prs: [2855]
duplicate_of: null
---

## Description

## Summary

`clawdbot node install` was failing on headless Linux servers with:

```
Node install failed: Error: systemctl enable failed: Failed to enable unit: Unit file clawdbot-gateway.service does not exist.
```

## Root Cause

In `src/daemon/systemd.ts`, both `installSystemdService` and `uninstallSystemdService` were hardcoded to use `resolveGatewaySystemdServiceName(env.CLAWDBOT_PROFILE)` instead of `resolveSystemdServiceName(env)`.

The problem:
1. `resolveSystemdUnitPath()` correctly uses `resolveSystemdServiceName(env)` which respects the `CLAWDBOT_SYSTEMD_UNIT` environment variable
2. But when calling `systemctl enable/disable`, it was directly using `resolveGatewaySystemdServiceName()`, ignoring the override

This caused:
1. The correct unit file to be created at `~/.config/systemd/user/clawdbot-node.service`
2. But `systemctl enable clawdbot-gateway.service` to fail because that file doesn't exist

## Fix

Replace `resolveGatewaySystemdServiceName(env.CLAWDBOT_PROFILE)` with `resolveSystemdServiceName(env)` in both functions so they respect the `CLAWDBOT_SYSTEMD_UNIT` override set by the node service installer.

## Testing

- [x] `pnpm lint` passes
- [x] `pnpm build` passes  
- [x] `pnpm test src/daemon/systemd.test.ts` passes (10 tests)
- [x] Verified the fix logic matches the existing `stopSystemdService` and `restartSystemdService` functions which already use `resolveSystemdServiceName(env)`

Fixes #2855

---

ðŸ¤– AI-assisted: This fix was developed with Claude Opus 4.5. The bug was identified by analyzing the source code and tracing the service name resolution path.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the daemonâ€™s systemd service installation/uninstallation logic to consistently resolve the unit name via `resolveSystemdServiceName(env)` (respecting `OPENCLAW_SYSTEMD_UNIT` overrides) instead of hardcoding the gateway service name. It also adjusts CI to build the A2UI canvas bundle before running Node-based tests on macOS, and simplifies ToolDefinition typing in the Pi tool adapter by using explicit return types rather than `satisfies`. Overall, the changes align systemd enable/disable behavior with how unit paths and restart/stop already resolve service names, preventing `systemctl enable` failures when a custom unit name is used.

<h3>Confidence Score: 4/5</h3>

- This PR looks safe to merge and fixes a real systemd unit-name mismatch, with low behavioral risk outside the installer paths.
- Changes are small and targeted (service name resolution for install/uninstall plus minor CI/type cleanup) and align with existing usage in stop/restart; main risk is around environment-variable naming/compat expectations, but current code/tests already reference OPENCLAW_* and CI change is straightforward.
- src/daemon/systemd.ts (ensure env var names match intended public interface); .github/workflows/ci.yml (ensure A2UI bundle build is desired for all macOS node tests)

<!-- greptile_other_comments_section -->

<sub>(4/5) You can add custom instructions or style guidelines for the agent [here](https://app.greptile.com/review/github)!</sub>

<!-- /greptile_comment -->

## Reviews


## Comments


## Stats

- **Size:** small (7+, 7-, 3 files)
- **Age:** 6 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #2855
