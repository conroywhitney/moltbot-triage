---
number: 3693
title: "fix(cron): delete deleteAfterRun jobs regardless of execution status"
author: HirokiKobayashi-R
created: 2026-01-29T02:25:21Z
updated: 2026-01-29T02:25:21Z
labels: []
additions: 109
deletions: 2
changed_files: 2
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/3693
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

- Fixed infinite loop bug where `deleteAfterRun: true` one-shot jobs would loop every 40ms when skipped or failed
- Changed deletion condition to trigger regardless of execution status (ok, skipped, or error)
- Added tests for skipped and failed scenarios

## Problem

One-shot jobs with `deleteAfterRun: true` were only deleted when `status === "ok"`. When the job was skipped or failed:
- The job was not deleted (`shouldDelete = false`)
- The job was not disabled (line 86-89 only handles `status === "ok"`)
- `nextRunAtMs` remained in the past
- Timer immediately re-fired → 40ms infinite loop

## Solution

Changed `src/cron/service/timer.ts:82-83` from:
```typescript
const shouldDelete =
  job.schedule.kind === "at" && status === "ok" && job.deleteAfterRun === true;
```

To:
```typescript
const shouldDelete =
  job.schedule.kind === "at" && job.deleteAfterRun === true;
```

This matches the intended semantics of `deleteAfterRun: true` — "delete after execution regardless of outcome".

## Test plan

- [x] Existing cron tests pass (54 tests)
- [x] Added test: `deleteAfterRun: true` + `status: "skipped"` → job deleted
- [x] Added test: `deleteAfterRun: true` + `status: "error"` → job deleted

## Reviews


## Comments


## Stats

- **Size:** medium (109+, 2-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
