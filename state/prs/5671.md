---
number: 5671
title: "fix(skills): deduplicate skill commands by skill name across agents"
author: Salt-Sunny
created: 2026-01-31T20:37:14Z
updated: 2026-02-01T09:44:39Z
labels: []
additions: 49
deletions: 1
changed_files: 2
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: passing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/5671
fixes_issues: []
related_prs: [5636]
duplicate_of: null
---

## Description

## üêõ Bug Fix
Duplicate slash commands were being registered on Discord when multiple agents were configured, because each agent would scan and report the same bundled skills as its own. This resulted in commands like `/bird` and `/bird_2`.

## üîß Changes
- Modified `listSkillCommandsForAgents` in `src/auto-reply/skill-commands.ts` to deduplicate skill commands by their `skillName` across all agents.
- Updated existing tests to reflect that duplicates are no longer expected.
- Added a new test case verifying deduplication of bundled skills.

## üß™ Testing
- [x] Verified with new test case in `skill-commands.test.ts`.
- [x] Existing tests pass (after updating expectations).
- [x] Confirmed manually that only the first instance of a skill is registered.

## ü¶û Lobster Checklist
- [x] Small bug fix
- [x] Includes test
- [x] No breaking changes

Fixes: #5636

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR changes `listSkillCommandsForAgents` to avoid registering the same skill slash command multiple times when multiple agents scan the same bundled skills directory. It does this by tracking seen skills across agents and skipping subsequent duplicates, and updates/adds tests in `src/auto-reply/skill-commands.test.ts` to reflect the new behavior.

The change fits into the existing command-registration flow where per-workspace skill commands are produced by `buildWorkspaceSkillCommandSpecs` and then aggregated for Discord registration; the new Set in `listSkillCommandsForAgents` adds a cross-agent dedupe layer on top of the existing per-workspace command-name dedupe logic.

<h3>Confidence Score: 3/5</h3>

- This PR is close to mergeable, but has at least one definite test-breaking issue and one behavioral edge case worth fixing.
- The cross-agent dedupe approach is small and localized, but the new test currently calls `writeSkill` with the wrong parameter name (will throw), and the dedupe Set is case-sensitive which can reintroduce duplicates for case-only differences in skill names.
- src/auto-reply/skill-commands.test.ts, src/auto-reply/skill-commands.ts

<!-- greptile_other_comments_section -->

<sub>(4/5) You can add custom instructions or style guidelines for the agent [here](https://app.greptile.com/review/github)!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps ‚Äî COMMENTED (2026-01-31)

<sub>2 files reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** medium (49+, 1-, 2 files)
- **Age:** 2 days
- **Last activity:** 2026-02-01

## Links

- Fixes: (none detected)
