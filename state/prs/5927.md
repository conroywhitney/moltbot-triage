---
number: 5927
title: "perf: optimize workspace setup and Chrome extension asset loading"
author: Elarwei001
created: 2026-02-01T03:53:06Z
updated: 2026-02-01T11:43:17Z
labels: ["channel: telegram", "cli", "agents"]
additions: 114
deletions: 25
changed_files: 5
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/5927
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

This PR improves startup performance and reliability by optimizing how OpenClaw handles workspace files and Chrome extension assets.

### Changes

**1. Lazy template loading in workspace setup** (`src/agents/workspace.ts`)
- Only loads templates when files are actually missing (vs. loading all templates upfront)
- Reduces unnecessary file I/O on subsequent startups when workspace already exists

**2. Workspace-based Chrome extension assets** (`src/cli/browser-cli-extension.ts`)
- Copies extension source to `STATE_DIR/browser/chrome-extension-source` on first use
- Searches multiple fallback locations for bundled assets
- Avoids hardcoded path assumptions that can break in different install scenarios (npm global, local dev, etc.)

### Testing
- [x] Tested locally with fresh workspace setup
- [x] Tested Chrome extension installation flow
- [x] Linter passes (`npm run lint`)

### AI Disclosure
ðŸ¤– This PR was AI-assisted (Claude via OpenClaw). I understand the changes and have tested them locally.

---

Happy to address any feedback! ðŸ¦ž

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR optimizes startup by lazily loading workspace bootstrap templates only when a file is missing, and changes Chrome extension installation to first copy the extension source into `STATE_DIR/browser/chrome-extension-source` with fallback asset discovery. There are also small formatting-only changes to satisfy lint rules.

Overall the direction is good, but the new extension asset discovery/copy path has a likely incorrect relative candidate for the bundled assets (can break installs when running from source/compiled layouts), and the workspace copy cleanup uses `rm` without `force`, which can fail due to TOCTOU or concurrent state changes.

<h3>Confidence Score: 3/5</h3>

- This PR is likely safe to merge, but the Chrome extension asset resolution has a probable path bug that could break extension installation in some environments.
- Workspace template lazy-loading looks correct and preserves error visibility (only ENOENT triggers template load). The main risk is in `ensureExtensionSourceInWorkspace` where the first fallback candidate appears to resolve to `src/assets/...` instead of the intended packaged `assets/...`, plus a small robustness issue around deleting the workspace source directory without `force`.
- src/cli/browser-cli-extension.ts

<!-- greptile_other_comments_section -->

<sub>(3/5) Reply to the agent's comments like "Can you suggest a fix for this @greptileai?" or ask follow-up questions!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-01)

<sub>1 file reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** medium (114+, 25-, 5 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: (none detected)
