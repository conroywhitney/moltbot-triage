---
number: 3407
title: "Fix macOS compatibility in docker-setup.sh"
author: AlvinHsieh
created: 2026-01-28T15:10:02Z
updated: 2026-01-28T23:25:09Z
labels: ["docker"]
additions: 3
deletions: 3
changed_files: 1
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/moltbot/moltbot/pull/3407
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
- Fixes docker-setup.sh failing on macOS with Bash 3.2
- Replaces Bash 4 associative array with string-based tracking

## Problem
macOS ships with Bash 3.2 which doesn't support `declare -A` (associative arrays introduced in Bash 4). This caused the script to fail immediately on macOS:

```
./docker-setup.sh: line 127: declare: -A: invalid option
```

## Solution
Replaced the `seen` associative array in the `upsert_env` function with a simple delimited string `seen_keys` to track processed environment variables.

**Before:**
```bash
declare -A seen=()
seen["$k"]=1
if [[ -z "${seen[$k]:-}" ]]; then
```

**After:**
```bash
local seen_keys=""
seen_keys="${seen_keys}${k};"
if [[ "$seen_keys" != *"${k};\"* ]]; then
```

## Testing
- ✅ Syntax check passed on macOS Bash 3.2.57
- ✅ Unit tested the `upsert_env` function logic
- ✅ Verified environment file update/insert behavior

The logic remains identical, just using string operations instead of associative array operations for Bash 3.2 compatibility.

## Reviews


## Comments


## Stats

- **Size:** tiny (3+, 3-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
