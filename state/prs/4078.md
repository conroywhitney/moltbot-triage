---
number: 4078
title: "fix(nextcloud-talk): calculate signature over message text, not JSON body"
author: KundKMC
created: 2026-01-29T16:48:48Z
updated: 2026-01-29T16:49:00Z
labels: ["channel: nextcloud-talk"]
additions: 1
deletions: 1
changed_files: 1
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4078
fixes_issues: [4073]
related_prs: [4073]
duplicate_of: null
---

## Description

## Summary

- Fix HMAC signature calculation to use message text instead of JSON body
- Resolves authentication failures when bots send responses to NextCloud Talk

## Problem

NextCloud Talk's Bot API expects the signature to be calculated as:
```
HMAC-SHA256(random + message, secret)
```

But Moltbot was calculating:
```
HMAC-SHA256(random + {"message":"..."}, secret)
```

This caused all bot response attempts to fail with:
```
Nextcloud Talk: authentication failed - check bot secret
```

## Solution

Changed line 93 in `extensions/nextcloud-talk/src/send.ts`:
```diff
  const { random, signature } = generateNextcloudTalkSignature({
-   body: bodyStr,
+   body: message,
    secret,
  });
```

The HTTP request body (line 107) still correctly uses `bodyStr` (JSON format).

## Testing

Verified manually:
1. Signature over `message` text ‚Üí ‚úÖ 201 Created
2. Signature over `bodyStr` JSON ‚Üí ‚ùå 401 Unauthorized

## Related

Closes #4073

---
ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** tiny (1+, 1-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: #4073
