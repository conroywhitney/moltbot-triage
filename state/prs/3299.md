---
number: 3299
title: "feat(session): add TTL/auto-cleanup for idle sessions (#3250)"
author: tiandee
created: 2026-01-28T11:28:08Z
updated: 2026-01-28T23:25:09Z
labels: ["gateway"]
additions: 414
deletions: 0
changed_files: 5
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/moltbot/moltbot/pull/3299
fixes_issues: [3250]
related_prs: [3250]
duplicate_of: null
---

## Description

## Summary
Implement automatic cleanup for idle sessions based on TTL configuration.

Fixes #3250

## Changes
- Add `session.ttl` config option (number or `{idle, maxAge}` object)
- Add `session.cleanup.intervalSeconds` for cleanup service interval
- Implement `session-ttl.ts` with TTL normalization and expiration checks
- Implement `session-cleanup.ts` with periodic cleanup service
- Add comprehensive unit tests

## Configuration Example
```json5
{
  session: {
    ttl: 3600,  // 1 hour idle timeout
    // or: ttl: { idle: 3600, maxAge: 86400 }
    cleanup: { intervalSeconds: 300 }  // optional, default 5 min
  }
}
```

## Testing

**Unit tests added:** `src/gateway/session-ttl.test.ts`

| Test Suite | Tests | Status |
|------------|-------|--------|
| normalizeSessionTtl | 6 | ✅ Pass |
| isSessionExpired | 7 | ✅ Pass |
| getExpiredSessionKeys | 3 | ✅ Pass |
| getCleanupConfig | 3 | ✅ Pass |

**Full test suite:**
```
pnpm test src/gateway/session-ttl.test.ts
✓ src/gateway/session-ttl.test.ts (19 tests) 5ms
```

All existing tests continue to pass (4802 tests).
<img width="1682" height="272" alt="image" src="https://github.com/user-attachments/assets/01cb44c4-aa74-4a3b-8227-6ec83d840e8f" />

## Reviews


## Comments


## Stats

- **Size:** large (414+, 0-, 5 files)
- **Age:** 0 days
- **Last activity:** 2026-01-28

## Links

- Fixes: #3250
