---
number: 3446
title: "feat(hooks): add agentId to webhook mappings and /hooks/agent endpoint [AI-assisted]"
author: wko
created: 2026-01-28T16:28:44Z
updated: 2026-01-28T23:25:08Z
labels: ["docs", "gateway"]
additions: 221
deletions: 13
changed_files: 10
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: true
url: https://github.com/moltbot/moltbot/pull/3446
fixes_issues: [3432]
related_prs: [3432]
duplicate_of: null
---

## Description

## Summary

Adds optional `agentId` field to webhook mappings and the direct `/hooks/agent` endpoint, enabling multi-agent webhook routing.

## ðŸ¤– AI-Assisted PR

This PR was created with Claude (Opus). 

- **Testing:** Lightly tested (unit tests added, no local runtime test due to missing deps)
- **Understanding:** Human reviewed all changes and verified logic flow

## Changes

- Add `agentId` to `HookMappingSchema` (zod) and `HookMappingConfig` type
- Add `agentId` to `HookMappingResolved`, `HookAction`, and `HookAgentPayload`
- Pass `agentId` through mapping resolution, dispatcher, and HTTP handler
- Add superRefine validation: `agentId` must exist in `agents.list`
- Update docs with `agentId` parameter and usage examples
- Add unit tests for `agentId` in mappings and config validation

## Usage

### Direct API call (`POST /hooks/agent`)
```json
{
  "message": "Process this email",
  "agentId": "email-handler"
}
```

### Config-driven mappings
```json5
{
  hooks: {
    mappings: [{
      match: { path: "email" },
      action: "agent",
      agentId: "email-handler",
      messageTemplate: "New email from {{from}}: {{subject}}"
    }]
  }
}
```

## Use Cases

- Route incoming emails to a dedicated email-handler agent
- Send GitHub webhooks to a CI/CD agent with repo access
- Separate support inbox to agent with different persona

## Breaking Changes

None â€” `agentId` is optional, defaults to default agent.

Closes #3432

## Reviews


## Comments


## Stats

- **Size:** large (221+, 13-, 10 files)
- **Age:** 0 days
- **Last activity:** 2026-01-28

## Links

- Fixes: #3432
