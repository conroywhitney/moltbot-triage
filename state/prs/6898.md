---
number: 6898
title: "fix(voice-call): hang up rejected inbound calls and add test"
author: ThinkIbrokeIt
created: 2026-02-02T05:17:52Z
updated: 2026-02-02T05:19:40Z
labels: ["channel: voice-call"]
additions: 65
deletions: 3
changed_files: 3
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6898
fixes_issues: []
related_prs: [6888]
duplicate_of: null
---

## Description

When inbound calls are rejected by policy, ensure provider calls are hung up to avoid leaving provider-side calls open. Includes a test to verify behavior.

Split from original combined PR #6888 into a focused change.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the voice-call manager’s inbound-event handling so that when an inbound call is rejected by policy (e.g. `inboundPolicy: "disabled"`), the provider call is proactively hung up to avoid leaving provider-side calls open. It also adds a unit test that simulates an inbound `call.ringing` event and asserts that `hangupCall` is invoked and the call is not left in the manager’s active call map.

The change fits into the existing design where inbound events can create an internal call record on first contact and then drive the state machine via `processEvent`; this PR extends that early inbound branch to immediately terminate rejected calls via the existing `endCall` mechanism.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge; changes are localized and add coverage for the new behavior.
- Behavioral change is constrained to the inbound-call creation path when policy rejects inbound calls, and it reuses the existing `endCall` logic. Main remaining risk is around the new async fire-and-forget behavior and test flakiness rather than functional correctness.
- extensions/voice-call/src/manager.test.ts (async timing), extensions/voice-call/src/manager.ts and extensions/voice-call/src/manager/events.ts (rejected-call persistence/noise).

<!-- greptile_other_comments_section -->

<sub>(5/5) You can turn off certain types of comments like style [here](https://app.greptile.com/review/github)!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>3 files reviewed, 3 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** medium (65+, 3-, 3 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
