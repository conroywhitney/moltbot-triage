---
number: 2213
title: "fix: normalize toolCall arguments to prevent Anthropic API rejection"
author: manzienkog
created: 2026-01-26T12:38:54Z
updated: 2026-01-28T23:25:12Z
labels: []
additions: 160
deletions: 3
changed_files: 4
size: medium
review_decision: none
reviews: []
comments_count: 1
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/2213
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

Some models (e.g., via google-antigravity) omit the `arguments` field for tools with no required parameters. When this happens, pi-ai passes `undefined` to Anthropic's `input` field, causing API rejection:

```
messages.N.content.M.tool_use.input: Field required
```

## Solution

Added `normalizeToolCallArguments()` which ensures `arguments` is always an object (defaulting to `{}`) before messages reach the API.

## Affected tools

- `memory_status`
- `load_memory` (without trigger)
- Any tool with optional-only or no parameters

## Testing

Added tests in `tool-call-id.test.ts` covering:
- Already-present arguments (no-op)
- Undefined arguments → `{}`
- Null arguments → `{}`
- Multiple toolCalls in single message
- Different tool types (toolCall, toolUse, functionCall)
- Non-assistant messages unchanged

## Reviews


## Comments

### @ChiTienHsieh (2026-01-27)

We hit this exact bug running clawdbot v2026.1.24-3 with Google Antigravity on a Hetzner VPS and spent time tracing the root cause on our end. Confirming the fix is correct.

### Root cause trace

1. **Ingestion** — `google-gemini-cli.js:532`:
   ```js
   arguments: part.functionCall.args
   ```
   For zero-arg tools like `session_status`, `args` is `undefined`. The property gets stripped by JSON serialization, so session JSONL stores the block without an `arguments` key at all.

2. **Replay** — `anthropic.js:470`:
   ```js
   input: block.arguments
   ```
   `block.arguments` is `undefined` → stripped by `JSON.stringify` → Anthropic API rejects with `tool_use.input: Field required`. Session is permanently broken until `/reset`.

### Assessment

PR #2213's `normalizeToolCallArguments` is the right defensive fix at the replay/sanitization stage. Clean implementation, good test coverage, correct pipeline placement.

**Suggestion:** Consider also adding `?? {}` at the ingestion point (`google-gemini-cli.js:532`) so corrupted sessions aren't written in the first place — belt-and-suspenders.

**Grade: A.** Ship it.

---
*Investigated hands-on from a VM running clawdbot with Antigravity — session JSONL confirmed missing `arguments` key on zero-arg tool calls.*


## Stats

- **Size:** medium (160+, 3-, 4 files)
- **Age:** 4 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
