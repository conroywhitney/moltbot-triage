---
number: 7285
title: "fix(update): remove always-failing restore control-ui step"
author: codeslayer44
created: 2026-02-02T16:53:50Z
updated: 2026-02-02T16:54:50Z
labels: []
additions: 37
deletions: 13
changed_files: 3
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7285
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

- The git-based auto-updater's "restore control-ui" step runs `git checkout -- dist/control-ui/` after every update, but `dist/` is gitignored and nothing under `dist/control-ui/` is tracked ‚Äî so this command always exits non-zero.
- Because the final status check (`steps.find(s => s.exitCode !== 0)`) treats any failed step as a fatal error, every successful git update is incorrectly reported as `status: "error"` with `reason: "restore control-ui"`.
- The step's stated purpose (preventing dirty working tree from blocking future updates) is already handled by the clean check's `:!dist/control-ui/` pathspec exclusion.

## Changes

- Remove the "restore control-ui" step from `runGatewayUpdate` in `src/infra/update-runner.ts`
- Adjust `gitTotalSteps` progress counts accordingly
- Add a test verifying the restore is no longer attempted
- Remove the stale mock from the existing "uses stable tag" test

## Test plan

- [x] New test: "does not attempt to restore untracked dist/control-ui/" passes
- [x] All existing update-runner tests pass (10/10)
- [x] `pnpm build` clean
- [x] `pnpm check` clean (lint + format)

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR removes the `restore control-ui` step from the git-based updater (`runGatewayUpdate`) because `dist/` is gitignored and `dist/control-ui/` isn‚Äôt tracked, making `git checkout -- dist/control-ui/` reliably return a non‚Äëzero exit code and incorrectly mark otherwise-successful updates as `status: "error"`. It also updates the updater‚Äôs progress total-step accounting and adjusts tests to assert the restore command is no longer executed (and cleans up an outdated mock in the beta/stable tag selection test).

These changes fit into the updater pipeline in `src/infra/update-runner.ts` by simplifying the post-`ui:build` cleanup phase and aligning the ‚Äúdirty tree‚Äù guard to continue excluding `dist/control-ui/` via the existing `git status --porcelain -- :!dist/control-ui/` pathspec.

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- Change removes a step that was deterministically failing (attempting to checkout an untracked, gitignored path) and updates tests accordingly; the remaining updater flow and error handling are unchanged.
- No files require special attention

<!-- greptile_other_comments_section -->

<sub>(3/5) Reply to the agent's comments like "Can you suggest a fix for this @greptileai?" or ask follow-up questions!</sub>

<!-- /greptile_comment -->

## Reviews


## Comments


## Stats

- **Size:** medium (37+, 13-, 3 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
