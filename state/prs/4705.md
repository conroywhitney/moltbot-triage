---
number: 4705
title: "feat(hooks): add message_received and message_sent hooks to chat completions endpoint"
author: David-Marsh-Photo
created: 2026-01-30T15:00:16Z
updated: 2026-01-30T15:00:27Z
labels: ["gateway"]
additions: 48
deletions: 0
changed_files: 1
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4705
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Adds plugin hooks for the `/v1/chat/completions` endpoint, enabling plugins to observe and react to API traffic.

## New Hooks

- **`message_received`** — Fires before agent processing, with user field, model, sessionKey, and source metadata
- **`message_sent`** — Fires after response (non-streaming only)

## Use Cases

- **Voice logging** — Log voice shortcut prompts/responses to a Discord channel
- **Analytics** — Track API usage patterns by user or source
- **Audit trails** — Record all interactions through the API endpoint
- **Custom routing** — Trigger workflows based on request metadata

## Example

A plugin can filter by the `user` field to identify specific callers:

```typescript
hooks: {
  message_received: async (payload) => {
    if (payload.metadata?.apiUser === 'voice-shortcut') {
      // Log to Discord, database, etc.
    }
  }
}
```

## Notes

- `message_sent` only fires for non-streaming responses (streaming delivers chunks progressively)
- Hooks are fire-and-forget; they don't block the response
- Uses `hasHooks()` check to avoid overhead when no plugins are listening

## Reviews


## Comments


## Stats

- **Size:** small (48+, 0-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
