---
number: 1904
title: "feat(nostr): Add Typing Indicators"
author: joelklabo
created: 2026-01-25T18:57:29Z
updated: 2026-01-28T23:25:13Z
labels: ["channel: discord", "channel: nostr", "channel: signal", "channel: telegram", "agents"]
additions: 513
deletions: 122
changed_files: 11
size: large
review_decision: none
reviews: []
comments_count: 2
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/moltbot/moltbot/pull/1904
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Adds Nostr typing indicators and updates Nostr DM handling to record sessions + route replies consistently, while fixing the SimplePool subscribeMany filter usage. Also hardens messageActions lookups for Discord/Signal/Telegram and includes CI reliability tweaks.

## Changes

- Nostr: send encrypted typing start/stop events (kind 20001), throttle start events, and track typing metrics.
- Nostr: use `subscribeMany(relays, { ...filter })` (Filter object, not array) and record inbound sessions with proper reply routing + prefixes.
- Channels: guard messageActions runtime access in Discord/Signal/Telegram to avoid null deref crashes.
- CI/tests: macOS vitest worker crash mitigation, Windows timeout delay adjustment.
- Packaging: revert `typescript/native-preview` to available version; align memory-core peer dependency with lockfile.

## Testing

- Not run locally (CI only).

## Reviews


## Comments

### @patrickulrich (2026-01-26)

The per-relay subscription approach here works around a subscribeMany issue, but the root cause is simpler: pool.subscribeMany expects a single Filter object, not a Filter[] array. Passing { kinds: [4], "#p": [pk], since } instead of [{ kinds: [4], "#p": [pk], since }] fixes it. Using subscribeMany is preferable since SimplePool handles connection pooling, automatic reconnection, and EOSE aggregation internally - avoiding ~40 lines of manual relay management.

### @joelklabo (2026-01-27)

Fixed, thanks!


## Stats

- **Size:** large (513+, 122-, 11 files)
- **Age:** 3 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
