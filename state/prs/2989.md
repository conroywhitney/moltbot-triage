---
number: 2989
title: "feat(tts): Convert Edge TTS MP3 to Opus for Telegram voice messages"
author: alnandr
created: 2026-01-27T22:07:59Z
updated: 2026-01-28T23:25:10Z
labels: []
additions: 30
deletions: 4
changed_files: 1
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/2989
fixes_issues: [2949]
related_prs: [2949]
duplicate_of: null
---

## Description

## Problem

When using Edge TTS (the free provider), Telegram delivers voice messages as MP3 files. Telegram treats MP3 files as audio files rather than voice messages, which means:
- No caption/text accompanies the voice message
- The message appears as a media file rather than a native voice note

OpenAI and ElevenLabs TTS already output Opus for Telegram (via `TELEGRAM_OUTPUT`), but Edge TTS uses its default MP3 format.

## Solution

Add an ffmpeg post-processing step that converts Edge TTS MP3 output to Opus when the target channel is Telegram. This allows Edge TTS voice messages to be delivered as native Telegram voice notes with caption support.

## Changes

After Edge TTS generates the audio file, the code now:
1. Checks if the channel is Telegram and the audio isn't already voice-compatible
2. Converts MP3 to Opus using ffmpeg (`-c:a libopus -b:a 64k -application voip`)
3. Cleans up the original MP3 file
4. Updates the return values to reflect the new format

## Requirements

- ffmpeg must be installed with libopus support
- Falls back gracefully to MP3 if ffmpeg is unavailable or conversion fails

## Testing

1. Configure TTS provider as `edge`
2. Send a TTS message to Telegram
3. Verify the message arrives as a voice note with caption text visible

## Benefits

- Free TTS (Edge) now has feature parity with paid providers on Telegram
- Voice messages show accompanying text caption
- Native voice note UI in Telegram (playback waveform, etc.)
- No user configuration needed â€” automatic based on channel detection

Fixes #2949

## Reviews


## Comments


## Stats

- **Size:** small (30+, 4-, 1 files)
- **Age:** 2 days
- **Last activity:** 2026-01-28

## Links

- Fixes: #2949
