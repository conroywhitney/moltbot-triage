---
number: 4249
title: "fix(telegram): properly nest link tags inside bold/italic formatting"
author: pradeeppeddineni
created: 2026-01-29T23:36:11Z
updated: 2026-01-29T23:36:23Z
labels: ["channel: telegram"]
additions: 24
deletions: 7
changed_files: 2
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4249
fixes_issues: [4174]
related_prs: [4174]
duplicate_of: null
---

## Description

## Summary

Fixes a bug where bold/italic formatting breaks when containing auto-linked URLs in Telegram messages.

### Problem

When a URL appears inside bold/italic text (e.g., `**Check https://example.com**`), the HTML tags were being closed in the wrong order:

```html
<!-- Before (broken) -->
<b>Check <a href="https://example.com">https://example.com</b></a>

<!-- After (fixed) -->
<b>Check <a href="https://example.com">https://example.com</a></b>
```

The misnested tags caused Telegram to fail to render the bold formatting when URLs were present inside styled spans.

### Root Cause

In `src/markdown/render.ts`, the `renderMarkdownWithMarkers` function was closing style tags (bold/italic) before link tags at the same position. Since links are nested inside styles, the inner element (link) should close first.

### Solution

Reordered the closing logic to close links before styles, maintaining proper HTML nesting order.

### Changes

- `src/markdown/render.ts`: Swapped order of closing links and styles
- `src/telegram/format.test.ts`: Added 3 test cases for the fix

## Test Plan

- [x] All existing tests pass (292 tests across markdown, telegram, discord, slack, whatsapp)
- [x] New test cases added:
  - `properly nests link tags inside bold when URL is at end of bold span`
  - `properly nests link tags inside italic`
  - `renders emoji before bold correctly`

## Testing

```typescript
// Before fix
markdownToTelegramHtml("**Check https://example.com**")
// => '<b>Check <a href="https://example.com">https://example.com</b></a>' (broken)

// After fix  
markdownToTelegramHtml("**Check https://example.com**")
// => '<b>Check <a href="https://example.com">https://example.com</a></b>' (correct)
```

Fixes #4174

## Reviews


## Comments


## Stats

- **Size:** small (24+, 7-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: #4174
