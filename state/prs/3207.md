---
number: 3207
title: "fix: use .moltbot for device identity directory"
author: aadeina
created: 2026-01-28T07:46:21Z
updated: 2026-02-03T03:56:29Z
labels: []
additions: 1
deletions: 1
changed_files: 1
size: tiny
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3207
fixes_issues: [3198]
related_prs: [3198]
duplicate_of: null
---

## Description

Fixes #3198

## Summary
   Change default device identity directory from `.clawdbot` to `.moltbot`.

   ## The Problem
   `src/infra/device-identity.ts` hardcodes `.clawdbot/identity` which causes the old directory to be recreated even
   for users who migrated to `.moltbot`.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the default device identity storage directory in `src/infra/device-identity.ts` from `~/.clawdbot/identity` to `~/.moltbot/identity`, preventing the legacy `.clawdbot` identity directory from being re-created after users have migrated.

The change is localized to the default path constant used by `loadOrCreateDeviceIdentity()`, which is consumed by gateway/client initialization and related tests/helpers when no explicit identity path is provided.

<h3>Confidence Score: 4/5</h3>

- This PR is low risk and likely safe to merge, with a small behavioral edge case around state-dir overrides.
- The change is a single constant update affecting where a file is read/written by default. The main concern is consistency with the repo’s broader state directory resolution (env overrides and legacy/new preference), which could lead to surprising identity location for users who rely on `MOLTBOT_STATE_DIR`/`CLAWDBOT_STATE_DIR` or migration behavior.
- src/infra/device-identity.ts

<!-- greptile_other_comments_section -->

<sub>(3/5) Reply to the agent's comments like "Can you suggest a fix for this @greptileai?" or ask follow-up questions!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`src/infra/device-identity.ts`**
[P1] Default identity path bypasses config-dir migration logic

`DEFAULT_DIR` is computed directly from `os.homedir()` and hardcodes `~/.moltbot/identity`. Elsewhere the repo centralizes state dir selection (including env overrides + legacy/new dir preference) in `resolveConfigDir` (`src/utils.ts:214-230`). With the current change, users who set `MOLTBOT_STATE_DIR`/`CLAWDBOT_STATE_DIR` (or rely on the legacy-dir preference when `~/.moltbot` exists) will still have their device identity read/written under `~/.moltbot/identity`, which can be surprising and may break setups that relocate state.

If the intent is “device identity always lives under the resolved state dir”, consider deriving this path from the same config-dir helper instead of `os.homedir()`.
 Is device identity intended to respect `MOLTBOT_STATE_DIR`/`CLAWDBOT_STATE_DIR` and the `resolveConfigDir()` legacy/new selection, or should it always be tied to `os.homedir()` regardless of config overrides?

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/infra/device-identity.ts
Line: 20:22

Comment:
[P1] Default identity path bypasses config-dir migration logic

`DEFAULT_DIR` is computed directly from `os.homedir()` and hardcodes `~/.moltbot/identity`. Elsewhere the repo centralizes state dir selection (including env overrides + legacy/new dir preference) in `resolveConfigDir` (`src/utils.ts:214-230`). With the current change, users who set `MOLTBOT_STATE_DIR`/`CLAWDBOT_STATE_DIR` (or rely on the legacy-dir preference when `~/.moltbot` exists) will still have their device identity read/written under `~/.moltbot/identity`, which can be surprising and may break setups that relocate state.

If the intent is “device identity always lives under the resolved state dir”, consider deriving this path from the same config-dir helper instead of `os.homedir()`.
 Is device identity intended to respect `MOLTBOT_STATE_DIR`/`CLAWDBOT_STATE_DIR` and the `resolveConfigDir()` legacy/new selection, or should it always be tied to `os.homedir()` regardless of config overrides?

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** tiny (1+, 1-, 1 files)
- **Age:** 5 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #3198
