---
number: 3993
title: "Fix: Plugin hooks registered but never fire #3249"
author: WallaceSociety
created: 2026-01-29T13:53:47Z
updated: 2026-02-03T02:51:31Z
labels: []
additions: 58
deletions: 23
changed_files: 3
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3993
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

Root Cause
The codebase had two separate hook systems that weren't properly connected:

Legacy hooks: api.registerHook() → registry.hooks
Typed hooks: api.on() → registry.typedHooks
The hook runner's hasHooks() and execution logic only checked registry.typedHooks, but the log message counted registry.hooks — creating a misleading situation where hooks appeared registered but never fired.

- types.ts: Added TYPED_HOOK_NAMES export to src\plugins\types.ts
- imported TYPED_HOOK_NAMES into src\plugins\registry.ts and modified `registerHook()` to bridge to `typedHooks `when the event name matches a typed hook like `message_received`

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR fixes a mismatch between plugin hook registration and execution by bridging legacy `api.registerHook()` registrations into the typed hook registry when the event name matches a typed hook (e.g. `message_received`). It also corrects the global hook runner init log to report the number of typed hooks (the only ones the runner checks).

Overall, this aligns registration and execution so hooks that appear registered will actually fire through the typed hook runner path.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge and should resolve the reported hook firing issue.
- Changes are localized and conceptually align hook registration with the hook runner’s lookup path; the main remaining concern is internal accounting (`hookCount`) consistency due to the new bridge incrementing counts.
- src/plugins/registry.ts (hookCount accounting and ensuring the bridge doesn’t skew plugin metadata)

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** medium (58+, 23-, 3 files)
- **Age:** 4 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
