---
number: 3760
title: "fix(signal): preserve case for group IDs in target normalization"
author: qike-ms
created: 2026-01-29T04:46:36Z
updated: 2026-01-29T13:31:02Z
labels: []
additions: 37
deletions: 1
changed_files: 2
size: small
review_decision: none
reviews: []
comments_count: 1
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/3760
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

Signal group IDs are base64-encoded and **case-sensitive**. The `normalizeSignalMessagingTarget` function was lowercasing the entire target including the group ID:

```typescript
return id ? `group:${id}`.toLowerCase() : undefined;
```

This broke group lookups for reactions and other actions with errors like:
```
Signal RPC -1: Group not found: igvop2ejr1sbxyywslhif/aemtjwtidityu88gwp5zo=
```

When the actual group ID is `igVOP2EJR1sBXYYwsLhif/AEMTJWtiDiTyu88GWP5ZQ=` (mixed case).

## Solution

Preserve the original case of the group ID while still normalizing the `group:` prefix consistently. The prefix check already uses `.toLowerCase()` for case-insensitive matching, so we just need to avoid lowercasing the ID portion.

## AI Disclosure

- [x] **AI-assisted**: This PR was created with assistance from Claude via Clawdbot
- [x] **Fully tested**: Manual verification in Signal group chat + unit tests added
- [x] **I understand what this code does**: The fix preserves the base64-encoded group ID's original case while still allowing case-insensitive prefix matching (`group:`/`GROUP:`/etc). Base64 encoding is case-sensitive, so lowercasing breaks the ID lookup.

## Testing

- `pnpm lint` ‚úÖ
- `pnpm format` ‚úÖ  
- `pnpm test -- --run src/channels/plugins/normalize/signal.test.ts` ‚úÖ (8 tests pass)
- Manual verification: Direct signal-cli RPC calls with correct case succeed; after this fix, group reactions work correctly

## Reviews


## Comments

### @qike-ms (2026-01-29)

## CI Failures Note

The failing tests (`checks-windows`, `checks (bun, test)`) are **unrelated to this PR**. They're caused by a pre-existing flaky test in `session-write-lock.test.ts` throwing `EBADF` file descriptor errors during garbage collection.

Evidence:
- ‚úÖ `checks (node, test)` passes with all 5908 tests
- ‚úÖ All format, lint, build, and protocol checks pass
- The same Windows test failures appear in other recently merged PRs (#3750, #3700)

This PR only touches Signal target normalization (`signal.ts` + `signal.test.ts`) ‚Äî completely unrelated to session/file locking code.

Happy to rebase or re-run if needed. Thanks for reviewing! üôè


## Stats

- **Size:** small (37+, 1-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
