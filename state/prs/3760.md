---
number: 3760
title: "fix(signal): preserve case for group IDs in target normalization"
author: qike-ms
created: 2026-01-29T04:46:36Z
updated: 2026-02-03T02:53:51Z
labels: []
additions: 37
deletions: 1
changed_files: 2
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3760
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

Signal group IDs are base64-encoded and **case-sensitive**. The `normalizeSignalMessagingTarget` function was lowercasing the entire target including the group ID:

```typescript
return id ? `group:${id}`.toLowerCase() : undefined;
```

This broke group lookups for reactions and other actions with errors like:
```
Signal RPC -1: Group not found: igvop2ejr1sbxyywslhif/aemtjwtidityu88gwp5zo=
```

When the actual group ID is `igVOP2EJR1sBXYYwsLhif/AEMTJWtiDiTyu88GWP5ZQ=` (mixed case).

## Solution

Preserve the original case of the group ID while still normalizing the `group:` prefix consistently. The prefix check already uses `.toLowerCase()` for case-insensitive matching, so we just need to avoid lowercasing the ID portion.

## AI Disclosure

- [x] **AI-assisted**: This PR was created with assistance from Claude via Clawdbot
- [x] **Fully tested**: Manual verification in Signal group chat + unit tests added
- [x] **I understand what this code does**: The fix preserves the base64-encoded group ID's original case while still allowing case-insensitive prefix matching (`group:`/`GROUP:`/etc). Base64 encoding is case-sensitive, so lowercasing breaks the ID lookup.

## Testing

- `pnpm lint` ‚úÖ
- `pnpm format` ‚úÖ  
- `pnpm test -- --run src/channels/plugins/normalize/signal.test.ts` ‚úÖ (8 tests pass)
- Manual verification: Direct signal-cli RPC calls with correct case succeed; after this fix, group reactions work correctly

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR fixes Signal target normalization for `group:` targets by preserving the original case of the group ID while still matching the `group:` prefix case-insensitively. It updates `normalizeSignalMessagingTarget` to stop lowercasing the ID portion (important because Signal group IDs are base64 and case-sensitive) and adds unit tests covering group targets, `signal:`-prefixed group targets, and target detection.

The change fits into the existing normalization layer (`src/channels/plugins/normalize`) which canonicalizes various Signal addressing forms (uuid/username/group/phone) into a consistent representation used by downstream Signal channel logic.

<h3>Confidence Score: 4/5</h3>

- This PR looks safe to merge and addresses a clear correctness issue in Signal group ID handling.
- The functional change is small and localized (only adjusts lowercasing for `group:` IDs) and is backed by new unit tests covering the intended behavior. The only notable issue is duplicated/overlapping tests which is a minor maintainability concern.
- src/channels/plugins/normalize/signal.test.ts (test duplication)

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps ‚Äî COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @qike-ms (2026-01-29)

## CI Failures Note

The failing tests (`checks-windows`, `checks (bun, test)`) are **unrelated to this PR**. They're caused by a pre-existing flaky test in `session-write-lock.test.ts` throwing `EBADF` file descriptor errors during garbage collection.

Evidence:
- ‚úÖ `checks (node, test)` passes with all 5908 tests
- ‚úÖ All format, lint, build, and protocol checks pass
- The same Windows test failures appear in other recently merged PRs (#3750, #3700)

This PR only touches Signal target normalization (`signal.ts` + `signal.test.ts`) ‚Äî completely unrelated to session/file locking code.

Happy to rebase or re-run if needed. Thanks for reviewing! üôè


## Stats

- **Size:** small (37+, 1-, 2 files)
- **Age:** 4 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
