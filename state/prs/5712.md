---
number: 5712
title: "(bugfix) Align CLI networking with gateway by sharing network namespace"
author: JaydenLiang
created: 2026-01-31T21:47:20Z
updated: 2026-02-02T03:41:36Z
labels: ["docker"]
additions: 43
deletions: 36
changed_files: 2
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"JaydenLiang","state":"COMMENTED"}]
comments_count: 1
reactions_total: 3
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/5712
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

### Background

The `openclaw-cli` service is intended to operate as a direct client of the
`openclaw-gateway`. In the previous setup, the CLI ran in its own network
namespace, which made `localhost` (`127.0.0.1`) ambiguous and required
environment-specific handling (Docker DNS, service names, bind modes).

This introduced unnecessary complexity and made connectivity behavior
dependent on runtime context.

### Changes

- Configure `openclaw-cli` to share the gateway’s network namespace using  
  `network_mode: service:openclaw-gateway`
- Add an explicit `depends_on` relationship to ensure the gateway starts first

### Rationale

By sharing the network namespace:
- `localhost` inside the CLI deterministically refers to the gateway
- Docker DNS and service-name-based routing are no longer required
- Network semantics are simplified and consistent across environments

This treats the CLI as a sidecar client rather than an independent network
entity, which better reflects its intended role.

### Impact

- CLI connectivity to the gateway becomes deterministic
- No change to external ports or gateway behavior
- CLI is now intentionally coupled to the gateway’s network lifecycle

This is a structural clarification rather than a workaround, and the change
is fully reversible if future requirements call for a standalone CLI network.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates `docker-compose.yml` so the `openclaw-cli` container shares the `openclaw-gateway` network namespace via `network_mode: service:openclaw-gateway`, and adds `depends_on` to ensure the gateway container starts first. The intent is to make `localhost` inside the CLI deterministically refer to the gateway, simplifying networking and avoiding Docker DNS/service-name variability.

It also contains a large reordering of `package.json`’s `files` allowlist (no apparent semantic change), likely from formatting or an automated tool.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge and should simplify Docker CLI→gateway connectivity.
- Changes are small and localized to Docker Compose configuration; main risk is behavioral change in how the CLI can be addressed on the network due to shared namespace semantics. The package.json change appears to be ordering-only, but it’s large enough that it should be double-checked wasn’t unintentionally modified by tooling.
- docker-compose.yml (network_mode semantics), package.json (confirm files allowlist is ordering-only)

<!-- greptile_other_comments_section -->

<sub>(4/5) You can add custom instructions or style guidelines for the agent [here](https://app.greptile.com/review/github)!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-01-31)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @JaydenLiang — COMMENTED (2026-01-31)




## Comments

### @JaydenLiang (2026-01-31)

fixes #5559 


## Stats

- **Size:** medium (43+, 36-, 2 files)
- **Age:** 2 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
