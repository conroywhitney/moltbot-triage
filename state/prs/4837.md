---
number: 4837
title: "fix: strip tools for Venice models without function calling support"
author: jonisjongithub
created: 2026-01-30T18:45:48Z
updated: 2026-02-03T03:19:32Z
labels: ["agents"]
additions: 75
deletions: 37
changed_files: 3
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"jonisjongithub","state":"COMMENTED"}]
comments_count: 2
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4837
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

Venice AI models that don't support function calling (`hermes-3-llama-3.1-405b`, `venice-uncensored`, `deepseek-v3.2`) receive tools from OpenClaw unconditionally, causing Venice to reject the request with validation errors and return empty responses.

Venice's `/v1/models` endpoint correctly reports `supportsFunctionCalling: false` for these 3 models.

## Solution

1. **`src/config/types.models.ts`**: Added optional `supportsFunctionCalling?: boolean` to `ModelDefinitionConfig`
2. **`src/agents/venice-models.ts`**:
   - Marked 3 models with `supportsFunctionCalling: false` in the static catalog
   - Updated `buildVeniceModelDefinition()` to propagate the field
   - Updated `discoverVeniceModels()` to read `supportsFunctionCalling` from the Venice API for newly discovered models
   - Exported `veniceModelSupportsFunctionCalling()` helper for runtime lookups
3. **`src/agents/pi-embedded-runner/run/attempt.ts`**: When provider is `venice`, checks function calling support before creating tools â€” strips tools for unsupported models (same behavior as `disableTools`)

## Notes

- The pi-ai `Model` interface doesn't support custom fields, so the runtime check uses a direct catalog lookup rather than threading through the model object
- Models default to supporting function calling; only explicitly marked models are affected
- Build passes cleanly (`pnpm build`)

Co-authored-by: jonisjongithub <jonisjongithub@users.noreply.github.com>
Co-authored-by: Clawdbot <bot@clawd.bot>

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds a `supportsFunctionCalling?: boolean` capability flag to `ModelDefinitionConfig`, annotates known Venice models that lack function calling support, propagates the flag through Venice model discovery, and uses a new `veniceModelSupportsFunctionCalling()` helper to strip tools at runtime for Venice models that canâ€™t handle tool schemas. This prevents Venice request validation errors and empty responses caused by sending tools unconditionally.

<h3>Confidence Score: 4/5</h3>

- This PR is generally safe to merge and addresses a real provider capability mismatch, with one potential provider-id mismatch to verify.
- Changes are localized (Venice model catalog/discovery and tool creation gating) and align with Veniceâ€™s reported capabilities. Main remaining risk is whether `params.provider` vs `params.model.provider` can diverge, which could cause tools to be stripped (or not) unexpectedly.
- src/agents/pi-embedded-runner/run/attempt.ts (provider check logic)

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @jonisjongithub â€” COMMENTED (2026-02-03)




## Comments

### @jesseproudman (2026-01-30)

This should partially fix: https://github.com/openclaw/openclaw/issues/2315

### @jonisjongithub (2026-02-02)

Hey team ðŸ‘‹ Just bumping this â€” we've rebased against latest main and all CI checks are passing (aside from the pre-existing swiftlint issue on macOS). Happy to address any questions or concerns. Would love to get this merged when you have a chance to review!


## Stats

- **Size:** medium (75+, 37-, 3 files)
- **Age:** 3 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
