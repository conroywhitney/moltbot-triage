---
number: 3507
title: "[AI-Assisted] feat(gateway): add HTTP health endpoints for K8s probes"
author: ronit111
created: 2026-01-28T18:02:53Z
updated: 2026-01-28T23:25:08Z
labels: ["gateway"]
additions: 427
deletions: 0
changed_files: 5
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3507
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Adds HTTP health endpoints for container orchestration (Kubernetes, Docker Compose):

- `GET /health` - Liveness probe (always 200 if process alive)
- `GET /ready` - Readiness probe (200 if healthy, 503 if degraded/unhealthy)
- `GET /health/deep` - Detailed health with auth (shows channel/agent status)

## Motivation

Users deploying Moltbot in Kubernetes or Docker Compose environments need standard health endpoints for:
- Liveness probes (restart unhealthy containers)
- Readiness probes (remove from load balancer when degraded)
- Detailed debugging (see which channels are failing)

## Changes

- `src/gateway/http-health.ts` - Health endpoint implementation (~180 lines)
- `src/gateway/http-health.test.ts` - Unit tests (~195 lines)
- `src/config/types.gateway.ts` - `GatewayHealthConfig` type
- `src/gateway/server-http.ts` - Wire up health handler

## Configuration

```yaml
gateway:
  health:
    enabled: true           # default: true
    basePath: ""            # default: "" (mount at /)
    deepAuthRequired: true  # default: true (require auth for /health/deep)
```

## Test Plan

- [x] `pnpm lint` passes
- [x] `pnpm build` passes
- [x] `pnpm test` passes (875 tests in health batch)
- [ ] Manual test: `curl http://localhost:18789/health`
- [ ] Manual test: `curl http://localhost:18789/ready`
- [ ] Manual test with auth: `curl -H "Authorization: Bearer $TOKEN" http://localhost:18789/health/deep`

## Response Format

```json
{
  "status": "healthy",
  "version": "2026.1.27",
  "uptimeMs": 12345,
  "timestamp": "2026-01-28T12:00:00.000Z",
  "checks": {
    "channels": { "total": 3, "configured": 2, "healthy": 2, "degraded": [] },
    "agents": { "total": 1, "default": "pi" }
  }
}
```

---

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** large (427+, 0-, 5 files)
- **Age:** 1 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
