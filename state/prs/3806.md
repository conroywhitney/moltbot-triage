---
number: 3806
title: "fix(ui): quote cmd path for Windows spawn with spaces"
author: henrytien
created: 2026-01-29T06:23:50Z
updated: 2026-02-03T03:52:40Z
labels: ["scripts"]
additions: 2
deletions: 2
changed_files: 1
size: tiny
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3806
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem
On Windows, `pnpm ui:build` fails when pnpm is installed in a path containing spaces (e.g., [C:\Program Files\...](cci:9://file:///Program%20Files/...:0:0-0:0)).

## Solution
Quote the command path in `spawn()` and `spawnSync()` calls when running on Windows with `shell: true`.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates `scripts/ui.js` to quote the resolved `pnpm` command path before calling `spawn()`/`spawnSync()`, aiming to fix Windows failures when the executable path contains spaces while using `shell: true`.

The change is localized to the UI helper script that drives `install/dev/build/test` commands from the repo root, and primarily impacts how the runner process is launched across platforms.

<h3>Confidence Score: 2/5</h3>

- This PR has a high chance of breaking non-Windows UI script execution due to unconditional command quoting.
- The fix targets Windows+`shell: true`, but the implementation changes the `file` argument passed to `spawn`/`spawnSync` on all platforms. On POSIX where `shell` is false, the added quotes become part of the executable name and can make the command fail to resolve, creating a regression in common dev/build paths.
- scripts/ui.js

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-03)

<sub>1 file reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (2)</summary>

**`scripts/ui.js`**
[P0] Quoting `cmd` unconditionally breaks non-Windows / `shell: false` execution

In `run()`/`runSync()` you now always pass `` `"${cmd}"` `` as the command, but `shell` is only enabled on Windows (`shell: process.platform === "win32"`). On POSIX (and any case where `shell` is false), `spawn`/`spawnSync` will treat the quotes as part of the executable name, so this will fail to resolve (e.g., it will look for a binary literally named `"/usr/bin/pnpm"`). This change likely breaks `scripts/ui.js` on macOS/Linux.

Consider only quoting when `process.platform === "win32" && shell: true`, or (better) avoid quoting the `file` argument and instead pass `cmd` unchanged while handling the Windows+shell quoting via the `command` string in the shell (or by setting `shell` to a specific shell and escaping appropriately).

Also appears in: `scripts/ui.js:67-71`

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: scripts/ui.js
Line: 54:58

Comment:
[P0] Quoting `cmd` unconditionally breaks non-Windows / `shell: false` execution

In `run()`/`runSync()` you now always pass `` `"${cmd}"` `` as the command, but `shell` is only enabled on Windows (`shell: process.platform === "win32"`). On POSIX (and any case where `shell` is false), `spawn`/`spawnSync` will treat the quotes as part of the executable name, so this will fail to resolve (e.g., it will look for a binary literally named `"/usr/bin/pnpm"`). This change likely breaks `scripts/ui.js` on macOS/Linux.

Consider only quoting when `process.platform === "win32" && shell: true`, or (better) avoid quoting the `file` argument and instead pass `cmd` unchanged while handling the Windows+shell quoting via the `command` string in the shell (or by setting `shell` to a specific shell and escaping appropriately).

Also appears in: `scripts/ui.js:67-71`

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>

---

**`scripts/ui.js`**
[P2] Extra escaping in template literal reduces readability and can be simplified

Using `` `\"${cmd}\"` `` is harder to read and easy to get wrong. If you keep this approach on Windows, consider using a plain string concatenation with `"` or a small helper like `const quoted = process.platform === "win32" ? `"${cmd}"` : cmd;` so the quoting intent is clearer.

<sub>Note: If this suggestion doesn't match your team's coding style, reply to this and let me know. I'll remember it for next time!</sub>

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: scripts/ui.js
Line: 54:58

Comment:
[P2] Extra escaping in template literal reduces readability and can be simplified

Using `` `\"${cmd}\"` `` is harder to read and easy to get wrong. If you keep this approach on Windows, consider using a plain string concatenation with `"` or a small helper like `const quoted = process.platform === "win32" ? `"${cmd}"` : cmd;` so the quoting intent is clearer.

<sub>Note: If this suggestion doesn't match your team's coding style, reply to this and let me know. I'll remember it for next time!</sub>

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** tiny (2+, 2-, 1 files)
- **Age:** 4 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
