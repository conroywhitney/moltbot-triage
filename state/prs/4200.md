---
number: 4200
title: "feat: persist thinking level default per agent"
author: Glucksberg
created: 2026-01-29T21:23:21Z
updated: 2026-01-29T23:47:09Z
labels: ["agents"]
additions: 1920
deletions: 3
changed_files: 20
size: huge
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4200
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

When using `/think <level>`, the thinking level is now persisted to the agent's config entry (`thinkingDefault` field). This ensures the thinking level survives session resets (`/new`, `/reset`) for the same agent.

## Problem

Previously, when starting a new session with `/new` or `/reset`, the thinking level would reset to the global default (typically `low` for reasoning-capable models). Users had to manually set their preferred thinking level every time they started a new session.

## Solution

This PR adds the ability to persist the thinking level as a per-agent default in the config. When you use `/think high` (or any level), it:
1. Sets the session's thinking level (existing behavior)
2. **NEW:** Also persists `thinkingDefault` to the agent's config entry

Next time you start a new session with that agent, it will use your persisted thinking level instead of the global default.

## Changes

- **`src/config/types.agents.ts`**: Added `thinkingDefault` field to `AgentConfig` type
- **`src/config/zod-schema.agent-runtime.ts`**: Added `thinkingDefault` to `AgentEntrySchema` (zod validation)
- **`src/agents/agent-scope.ts`**: Added `thinkingDefault` to `ResolvedAgentConfig` type and resolution
- **`src/auto-reply/reply/directive-handling.impl.ts`**: Added `persistAgentThinkingDefault()` helper that writes to config when `/think` is used

## Config Example

After using `/think high` with an agent, the config will include:

```json
{
  "agents": {
    "list": [
      {
        "id": "myagent",
        "thinkingDefault": "high",
        ...
      }
    ]
  }
}
```

## Notes

- Config writes are asynchronous and best-effort (failures don't break the directive flow)
- Using `/think off` removes the `thinkingDefault` field from the agent config
- The per-agent `thinkingDefault` takes precedence over `agents.defaults.thinkingDefault`

## Reviews


## Comments


## Stats

- **Size:** huge (1920+, 3-, 20 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
