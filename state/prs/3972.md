---
number: 3972
title: "Add inline buttons to Telegram exec approval messages"
author: TechWizard9999
created: 2026-01-29T12:56:55Z
updated: 2026-01-29T12:57:07Z
labels: ["channel: telegram"]
additions: 181
deletions: 7
changed_files: 3
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3972
fixes_issues: [3934]
related_prs: [3934]
duplicate_of: null
---

## Description

## Summary

Closes #3934

This PR adds inline keyboard buttons to Telegram exec approval messages for a better user experience, especially on mobile devices. 

### Before
Users had to manually type `/approve <uuid> allow-once|allow-always|deny` to respond to exec approval requests.

### After
Three inline buttons appear below the approval message:
- **Allow once** - Approve this single command
-  **Always allow** - Add to allowlist for future executions
-  **Deny** - Reject the command

When a button is clicked, the approval is submitted automatically and the message updates to show the result.

## Changes

### [src/infra/exec-approval-forwarder.ts](cci:7://file:///Users/stack/Documents/moltbot/src/infra/exec-approval-forwarder.ts:0:0-0:0)
- Added [buildTelegramExecApprovalCallbackData()](cci:1://file:///Users/stack/Documents/moltbot/src/infra/exec-approval-forwarder.ts:18:0-23:1) - creates callback data string for buttons
- Added [parseTelegramExecApprovalCallbackData()](cci:1://file:///Users/stack/Documents/moltbot/src/infra/exec-approval-forwarder.ts:25:0-36:1) - parses callback data from button clicks
- Added [buildTelegramApprovalButtons()](cci:1://file:///Users/stack/Documents/moltbot/src/infra/exec-approval-forwarder.ts:38:0-57:1) - generates the inline keyboard layout
- Modified [deliverToTargets()](cci:1://file:///Users/stack/Documents/moltbot/src/infra/exec-approval-forwarder.ts:210:0-239:1) - passes buttons via `channelData.telegram` for Telegram channels
- Modified [buildRequestMessage()](cci:1://file:///Users/stack/Documents/moltbot/src/infra/exec-approval-forwarder.ts:155:0-169:1) - returns buttons along with message text

### [src/telegram/bot-handlers.ts](cci:7://file:///Users/stack/Documents/moltbot/src/telegram/bot-handlers.ts:0:0-0:0)
- Added callback handler for `execapproval:*` button clicks
- Resolves approvals via gateway `exec.approval.resolve` method
- Updates the original message with result and removes buttons

### [src/infra/exec-approval-forwarder.test.ts](cci:7://file:///Users/stack/Documents/moltbot/src/infra/exec-approval-forwarder.test.ts:0:0-0:0)
- Added 6 unit tests for callback data build/parse functions

## Testing

- [x] Linter passes (`pnpm lint`)
- [x] Build passes (`pnpm build`)
- [x] Tests pass (`pnpm test`)

Used AI for assistance

## Reviews


## Comments


## Stats

- **Size:** medium (181+, 7-, 3 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: #3934
