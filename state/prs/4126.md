---
number: 4126
title: "feat(tools): add session_compact tool for agent-invoked context compaction"
author: sasheenmusic
created: 2026-01-29T18:34:54Z
updated: 2026-01-30T12:33:13Z
labels: ["channel: telegram", "scripts", "commands", "agents"]
additions: 1291
deletions: 23
changed_files: 16
size: huge
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4126
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Adds a new core tool `session_compact` that allows agents to proactively compact their own session context without user intervention.

## Problem

Currently, agents can monitor their context usage via `session_status` but cannot take action when approaching limits. The only way to compact is for a user to type `/compact`. This makes autonomous context management impossible.

## Solution

Add a `session_compact` tool that:
- Uses the existing `compactEmbeddedPiSession` infrastructure (same as `/compact` command)
- Supports optional `instructions` parameter for focused compaction
- Returns token usage before/after for transparency
- Integrates with existing compaction count tracking

## Use Case

Agents can implement autonomous context management:
1. Monitor context via `session_status` on heartbeats
2. When context reaches threshold (e.g., 60%), save state to compaction file
3. Invoke `session_compact` to free up tokens
4. Read compaction file to restore working context

## Changes

- `src/agents/tools/session-compact-tool.ts` - New tool implementation
- `src/agents/moltbot-tools.ts` - Register the tool

## Testing

Build passes. Tool follows the same patterns as `session_status` and uses battle-tested `compactEmbeddedPiSession` internally.

## Reviews


## Comments


## Stats

- **Size:** huge (1291+, 23-, 16 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
