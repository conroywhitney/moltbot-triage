---
number: 2505
title: "feat(whatsapp): extract mentions from text for real @mentions"
author: zurizuriaria
created: 2026-01-27T02:02:02Z
updated: 2026-01-28T23:25:11Z
labels: ["channel: whatsapp-web"]
additions: 18
deletions: 4
changed_files: 1
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: passing
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/2505
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

WhatsApp's Baileys library requires a separate `mentions` array in the message payload for @mentions to work properly. Without this array, text like `@5511999999999` appears as plain text (or just a phone link) instead of a clickable mention that notifies the user.

## Changes

This PR automatically extracts phone numbers in the format `@<10-15 digits>` from the message text **and media captions**, adding them to the mentions array as JIDs.

### Supported message types
- âœ… Text messages
- âœ… Image with caption
- âœ… Video with caption
- âœ… Document with caption

## Testing

- [x] Tested locally with real WhatsApp group
- [x] Verified mention notification is received (text)
- [x] Verified mention notification is received (image with caption)
- [x] Verified user name appears highlighted instead of raw number

### How to test

```
message(action="send", channel="whatsapp", target="group@g.us", message="Hey @5511999999999 check this!")
```

Or with an image:
```
message(action="send", channel="whatsapp", target="group@g.us", message="@5511999999999 look at this!", media="https://example.com/image.jpg")
```

**Before:** Shows `@5511999999999` as plain text/phone link  
**After:** Shows the user's name as a clickable mention with notification

---

## ðŸ¤– AI-Assisted PR

This PR was developed with **Claude Opus 4.5** via Clawdbot.

- **Testing level:** Fully tested on real WhatsApp groups (text + image)
- **Code understanding:** Confirmed - extracts phone patterns from message text/captions and passes them to Baileys' `mentions` array for proper WhatsApp mention rendering

## Reviews


## Comments


## Stats

- **Size:** small (18+, 4-, 1 files)
- **Age:** 2 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
