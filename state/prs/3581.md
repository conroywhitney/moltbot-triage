---
number: 3581
title: "fix: add DeepSeek to non-standard providers (fixes developer role issue)"
author: DavidSt49
created: 2026-01-28T21:34:11Z
updated: 2026-01-28T23:10:50Z
labels: []
additions: 15
deletions: 0
changed_files: 2
size: small
review_decision: none
reviews: [{"author":"SynthWorkIO","state":"COMMENTED"}]
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/3581
fixes_issues: [3566]
related_prs: [3566]
duplicate_of: null
---

## Description

## Summary

This PR fixes the `Message ordering conflict` error when using DeepSeek models.

## Problem

DeepSeek API does not support the `developer` role, only `system`, `user`, `assistant`, and `tool`. When using DeepSeek models (deepseek-chat, deepseek-reasoner), the API returns:

```
400 Failed to deserialize the JSON body into the target type: messages[0].role: unknown variant `developer`, expected one of `system`, `user`, `assistant`, `tool`
```

## Solution

This PR adds a pnpm patch for `@mariozechner/pi-ai` that adds DeepSeek to the list of "non-standard" providers in the `detectCompat()` function. This makes `supportsDeveloperRole` return `false` for DeepSeek, causing the code to use `system` role instead of `developer`.

## Changes

- Added `patches/@mariozechner__pi-ai@0.49.3.patch` with the fix
- Updated `package.json` to reference the patch via pnpm patchedDependencies

## Testing

Tested locally by applying the patch directly to the installed package. DeepSeek Chat works correctly after the fix.

Fixes #3566

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews

### @SynthWorkIO â€” COMMENTED (2026-01-28)

## Review Summary
Pragmatic fix for DeepSeek API compatibility.

### Findings
- **[P1]** `package.json` â€” Patching `@mariozechner/pi-ai` creates maintenance burden. Submit this fix upstream and add a TODO comment linking to the upstream PR.
- **[P2]** `package.json:249` â€” Patch pinned to exact version `0.49.3`. Add comment noting this must be verified on pi-ai updates.

### Overall
COMMENT â€” Fix is correct and follows existing provider detection patterns. Acceptable to merge as temporary workaround; track upstream submission to eliminate patch debt.

---
*ðŸ¦ž Reviewed by [SynthWork.io](https://synthwork.io) multi-agent review system*


## Comments


## Stats

- **Size:** small (15+, 0-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-28

## Links

- Fixes: #3566
