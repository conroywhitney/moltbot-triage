---
number: 3662
title: "fix(wizard): handle undefined token input during onboarding"
author: hclsys
created: 2026-01-29T00:56:45Z
updated: 2026-02-03T03:52:25Z
labels: ["commands"]
additions: 2
deletions: 2
changed_files: 2
size: tiny
review_decision: none
reviews: [{"author":"orzelig","state":"APPROVED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3662
fixes_issues: [3384]
related_prs: [3384]
duplicate_of: null
---

## Description

## Summary

Fixes #3384

When user leaves token blank during onboarding or `configure gateway`, `text()` may return `undefined` at runtime (despite TypeScript type declaring `string`). `String(undefined)` produces the literal string `"undefined"` which is truthy, so `randomToken()` was never called.

### Changes
- `src/wizard/onboarding.gateway-config.ts:183`: `String(tokenInput)` ‚Üí `(tokenInput ?? "")`
- `src/commands/configure.gateway.ts:178`: Same fix

### Why this fix
Nullish coalescing `??` converts `undefined` to empty string before `.trim()`, allowing the `|| randomToken()` fallback to work correctly.

## Test plan
- [ ] CI tests pass
- [ ] Manual test: run onboarding, leave token blank, verify random token is generated

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR fixes a UX/logic bug in gateway onboarding and `configure gateway` where an undefined prompt result could be coerced via `String(tokenInput)` into the literal truthy value `"undefined"`, preventing the intended `|| randomToken()` fallback from running. The change replaces `String(tokenInput)` with `(tokenInput ?? "")` before `.trim()`, ensuring blank/undefined inputs are treated as empty strings so token generation proceeds correctly.

Changes are localized to the two code paths that prompt for a gateway token (`src/commands/configure.gateway.ts` and `src/wizard/onboarding.gateway-config.ts`), aligning runtime behavior with the prompt semantics (‚Äúblank to generate‚Äù).

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- The change is a small, targeted runtime-safety fix that improves correctness for an edge case (undefined prompt value) without altering broader control flow; it is applied consistently in both affected call sites and preserves existing behavior for normal string inputs.
- No files require special attention

<!-- greptile_other_comments_section -->

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @orzelig ‚Äî APPROVED (2026-01-29)

Good fix! Properly handles undefined token input by using nullish coalescing before trim(). LGTM!


## Comments

### @hclsys (2026-01-30)

thanks for the approval! CI red is macos-app timeout - changes limited to gateway config files. ok to merge?


## Stats

- **Size:** tiny (2+, 2-, 2 files)
- **Age:** 4 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #3384
