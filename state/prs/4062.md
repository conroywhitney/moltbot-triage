---
number: 4062
title: "feat(discord): add reactionTrigger config for invoking agent on reactions"
author: David-Marsh-Photo
created: 2026-01-29T16:18:44Z
updated: 2026-01-29T16:18:54Z
labels: ["docs", "channel: discord"]
additions: 13704
deletions: 14
changed_files: 8
size: huge
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/4062
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Add a new `reactionTrigger` option to Discord guild config that allows reactions to invoke an agent turn immediately, instead of just queueing a system event.

## Motivation

Currently, Discord reactions queue system events that are only processed on the next agent turn (message or heartbeat). This PR adds the ability to have reactions trigger immediate agent responses, enabling interactive workflows where reactions serve as commands (e.g., ðŸ‘€ to request analysis, ðŸ¤– to trigger a response).

## Configuration

```json
{
  "channels": {
    "discord": {
      "guilds": {
        "GUILD_ID": {
          "reactionTrigger": "all",
          "reactionTriggerEmojis": ["ðŸ¤–", "ðŸ‘€"],
          "reactionTriggerCooldownMs": 15000
        }
      }
    }
  }
}
```

### Options

- `reactionTrigger`: Mode for triggering agent turns on reactions
  - `off` (default): existing behavior, reactions queue system events
  - `own`: trigger when reacting to bot's own messages
  - `all`: trigger on any reaction
  - `allowlist`: trigger for reactions from users in `guilds.<id>.users`

- `reactionTriggerEmojis`: Optional array of emojis that trigger (e.g., `["ðŸ¤–", "ðŸ‘€"]`). Omit to allow all emojis.

- `reactionTriggerCooldownMs`: Cooldown between triggers per user per message. Default: 30000 (30 seconds). Set to 0 to disable.

## Safety Features

- **Add-only triggers**: Only reaction adds trigger the agent (removes do not)
- **Rate limiting**: 30s default cooldown per user per message prevents spam
- **Emoji filtering**: Optional allowlist of triggering emojis
- **Unique MessageSid**: Uses `{messageId}:reaction:{userId}:{emoji}:{action}` format to avoid inbound deduplication conflicts

## Files Changed

- `src/config/zod-schema.providers-core.ts` - Schema for new options
- `src/config/types.discord.ts` - TypeScript types
- `src/discord/monitor/allow-list.ts` - Helper function and resolved types
- `src/discord/monitor/listeners.ts` - Reaction handler logic with rate limiting
- `src/discord/monitor/provider.ts` - Pass token to reaction listeners
- `src/discord/monitor/reaction-trigger.ts` - New dispatch module
- `docs/channels/discord.md` - Documentation

## Testing

Tested manually on a private Discord server:
- âœ… Trigger on bot's own messages (mode: own)
- âœ… Trigger on any message (mode: all)
- âœ… Rate limiting blocks rapid reactions
- âœ… Emoji filtering restricts which emojis trigger
- âœ… Removes don't trigger (only adds)
- âœ… System event notifications still work alongside triggers

## Reviews


## Comments


## Stats

- **Size:** huge (13704+, 14-, 8 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
