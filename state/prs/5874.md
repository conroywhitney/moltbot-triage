---
number: 5874
title: "fix(logging): add safe-regex validation to prevent ReDoS in parsePattern"
author: hclsys
created: 2026-02-01T02:58:08Z
updated: 2026-02-03T04:07:58Z
labels: ["app: macos"]
additions: 491
deletions: 244
changed_files: 104
size: large
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/5874
fixes_issues: [5124]
related_prs: [5124]
duplicate_of: null
---

## Description

## Summary

Fixes #5124 - Logging module `parsePattern()` accepts arbitrary regex

The `parsePattern()` function in `src/logging/redact.ts` accepted user-supplied regex patterns without any complexity validation, making it vulnerable to ReDoS (Regular Expression Denial of Service) attacks via catastrophic backtracking.

## Changes

- Add `safe-regex` dependency for pattern complexity validation
- Validate patterns using `safeRegex(re)` after compilation to respect Unicode flags
- Add warning deduplication cache to prevent log spam
- Reject dangerous patterns silently (return null) with one-time warning

## CWE

CWE-1333 (Inefficient Regular Expression Complexity)

## Test Plan

- [x] Existing tests pass (208/208)
- [x] `pnpm format` passes
- [x] Malicious patterns like `/(a+)+$/` are now rejected
- [x] Legitimate patterns continue to work

ðŸ¤– Generated with [Claude Code](https://claude.ai/code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR hardens the logging redaction regex parser by introducing `safe-regex` to detect and reject potentially catastrophic patterns before theyâ€™re used in `.replace()`, and adds a one-time warning mechanism to avoid repeated log spam when unsafe patterns are supplied. The change fits into the existing `src/logging/redact.ts` flow by keeping `parsePattern()` as the single entry point for compiling user-configured patterns, now returning `null` for patterns deemed unsafe so downstream `resolvePatterns()` naturally filters them out.

<h3>Confidence Score: 4/5</h3>

- This PR is safe to merge with low risk; main concern is an unbounded warning-dedup cache under adversarial inputs.
- The change is localized and uses an established library (`safe-regex`) to mitigate a clear ReDoS vector; behavior on invalid/unsafe patterns is consistent (`null`), and the only notable risk introduced is the global `Set` that can grow without bound if fed many unique patterns in a long-running process.
- src/logging/redact.ts (warning deduplication cache growth)

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-01)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** large (491+, 244-, 104 files)
- **Age:** 1 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #5124
