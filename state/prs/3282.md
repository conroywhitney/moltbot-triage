---
number: 3282
title: "security(archive): fix path traversal in zip/tar extraction [AI-assisted]"
author: robbyczgw-cla
created: 2026-01-28T10:50:19Z
updated: 2026-01-28T23:25:09Z
labels: []
additions: 15
deletions: 3
changed_files: 1
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3282
fixes_issues: [3277]
related_prs: [3277]
duplicate_of: null
---

## Description

## Summary
Fix zip and tar extraction to block archive path traversal.

## Problem
The zip extractor validated paths with `outPath.startsWith(destDir)`. This can be bypassed when the destination is a prefix of another path:

```ts
const destDir = "/tmp/foo";
const outPath = "/tmp/foobar/evil.txt";
outPath.startsWith(destDir); // true (bypass)
```

The tar extractor did not validate entry paths at all, so entries like `../evil.txt` could escape the destination.

## Solution
Introduce a shared helper that uses `path.relative()` to validate boundaries and apply it to both zip and tar extraction.

```ts
const rel = path.relative(destDir, outPath);
if (rel.startsWith("..") || path.isAbsolute(rel)) {
  throw new Error("zip entry escapes destination");
}
```

Tar extraction now uses a `filter` to reject escaping entries.

## Changes
- `src/infra/archive.ts`: add `isPathWithinBase()` helper, replace `startsWith` checks, add tar path filter.

## Testing
- ✅ Build passes
- ⚠️ Lightly tested (manual verification)

## AI Disclosure
- **AI-assisted:** Yes (Claude/Clawdbot)
- **Testing level:** Lightly tested
- **Understanding confirmed:** Yes

Fixes #3277 (partial)

## Reviews


## Comments


## Stats

- **Size:** small (15+, 3-, 1 files)
- **Age:** 2 days
- **Last activity:** 2026-01-28

## Links

- Fixes: #3277
