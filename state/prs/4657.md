---
number: 4657
title: "Fix #4531: Improve device pairing error message for remote connections"
author: spiceoogway
created: 2026-01-30T13:38:44Z
updated: 2026-01-30T14:35:55Z
labels: ["app: web-ui", "gateway"]
additions: 232
deletions: 9
changed_files: 5
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4657
fixes_issues: [4531]
related_prs: [4531]
duplicate_of: null
---

## Description

## Summary
Fixes #4531

Improves the user experience when accessing the Web UI from a different machine on the LAN by providing clear, actionable instructions in the error message.

## Problem
Users connecting to the Web UI from a remote machine (e.g., another computer on their LAN) were getting a cryptic error:
```
disconnected (1008): pairing required
```

This error provided no indication of:
- **WHY** pairing is required
- **HOW** to approve the pairing
- **WHERE** to approve it (must be on the server machine)
- **WHAT** the request ID is

## Solution
### 1. Server-Side Error Message Enhancement
Updated `src/gateway/server/ws-connection/message-handler.ts` to include:
- Clear explanation of the pairing requirement
- Step-by-step CLI commands: `openclaw devices list` and `openclaw devices approve <request-id>`
- The specific request ID for this pairing request
- Note that approval must be done on the server machine
- Alternative method (localhost Control UI)
- Structured `instructions` field in error details for programmatic access

### 2. Web UI Error Propagation
Updated `ui/src/ui/gateway.ts` to propagate the full error message from the server instead of the generic "connect failed" message.

## Impact
- ✅ **Non-breaking change** - only improves error messaging
- ✅ **Backwards compatible** - works with existing clients
- ✅ **Low risk** - only affects error path, not success path
- ✅ **Significantly improves UX** for LAN/remote access scenarios

## Before/After
**Before:**
```
Error: disconnected (1008): pairing required
[User is confused, no clear path forward]
```

**After:**
```
Error: Device pairing required. On the OpenClaw server machine, run: 
'openclaw devices list' to see pending requests, then 
'openclaw devices approve abc123...' to approve this device. 
Alternatively, access the Control UI from the server's localhost to approve.
```

## Testing
- [x] Code review - changes are minimal and focused
- [x] Committed and pushed
- [ ] Manual testing with Docker setup (reviewer can verify)
- [ ] Verify error displays correctly in Web UI
- [ ] Verify pairing workflow works as documented

## Related
- Issue #4531: Original bug report
- Commands mentioned in issue comments are now included in the error message

## Reviews


## Comments


## Stats

- **Size:** large (232+, 9-, 5 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #4531
