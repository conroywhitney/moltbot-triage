---
number: 5521
title: "perf(workspace): optimize template loading for better performance"
author: Elarwei001
created: 2026-01-31T15:58:05Z
updated: 2026-02-01T11:44:12Z
labels: ["agents"]
additions: 28
deletions: 14
changed_files: 1
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/5521
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

- Only load templates for missing files instead of always loading all templates
- Performance improvement: skip I/O operations for existing workspace files

## Testing
- Fresh workspace creation: âœ… All templates copied correctly
- Incomplete workspace: âœ… Only missing files get templates loaded
- Linter passed: âœ… pnpm lint (0 warnings, 0 errors)

## AI-Assisted
- Built with Claude Code assistance
- Fully tested locally with multiple scenarios

ðŸ¤– Generated with [Claude Code](https://claude.ai/code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR optimizes `ensureAgentWorkspace` by avoiding eagerly reading all workspace bootstrap templates on every run. Instead, it checks for the presence of each expected workspace file (AGENTS/SOUL/TOOLS/IDENTITY/USER/HEARTBEAT, plus BOOTSTRAP on brand-new workspaces) and only loads/copies the template for files that are missing, reducing unnecessary I/O when a workspace already exists.

<h3>Confidence Score: 4/5</h3>

- Likely safe to merge; change is localized and behavior-preserving in common cases.
- The change is limited to workspace bootstrap logic and primarily reorders I/O to be conditional. Main remaining concern is subtle behavioral drift in edge cases (e.g., permission errors or non-regular files) due to added `fs.access` checks that may mask underlying errors by falling back to template loading/writing.
- src/agents/workspace.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-01-31)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** small (28+, 14-, 1 files)
- **Age:** 2 days
- **Last activity:** 2026-02-01

## Links

- Fixes: (none detected)
