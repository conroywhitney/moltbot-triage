---
number: 2027
title: "[AI-Assisted] Fix ExtensionRunner initialization in embedded mode"
author: ArtemHorik
created: 2026-01-26T02:07:59Z
updated: 2026-01-30T02:59:59Z
labels: ["agents"]
additions: 165
deletions: 7
changed_files: 4
size: medium
review_decision: none
reviews: []
comments_count: 1
reactions_total: 0
ci_status: pending
mergeable: false
draft: false
url: https://github.com/openclaw/openclaw/pull/2027
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary                                                                                                                            
  - Initialize `extensionRunner` in embedded mode to fix auto-compaction summaries                                                      
  - Without this, `ctx.model` remains undefined and compaction hooks fall back to "Summary unavailable..."                              
                                                                                                                                        
  ## Why                                                                                                                                
  In embedded mode (used by bots), `extensionRunner.initialize()` was never called, unlike interactive mode where the UI calls it. This caused `compaction-safeguard` to skip real summarization.                                                                             
                                                                                                                                        
  ## Changes                                                                                                                            
  - Call `extensionRunner.initialize()` after session creation in `attempt.ts`                                                          
  - `getActiveTools` returns only valid string tool names (filters undefined)                                                           
  - `setModel` validates API key and returns `Promise<boolean>`                                                                         
  - `compact` forwards `onComplete`/`onError` callbacks properly                                                                        
                                                                                                                                        
  ## Testing                                                                                                                            
  ✅ Fully tested locally with Clawdbot instance                                                                                        
  - Verified compaction now produces actual summaries instead of "Summary unavailable..."                                               
                                                                                                                                        
  ## AI Disclosure                                                                                                                      
  - Code & review: Codex, Claude Code                                                                                                   
  - ✅ Tested locally, code reviewed and understood 

## Reviews


## Comments

### @ArtemHorik (2026-01-30)

Guys thats crucial - compaction not working properly without this fix.. please do priority review @sebslight 


## Stats

- **Size:** medium (165+, 7-, 4 files)
- **Age:** 4 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
