---
number: 3223
title: "[AI] fix: ignore tool calls from aborted assistant turns"
author: mbelinky
created: 2026-01-28T08:25:37Z
updated: 2026-01-28T23:25:09Z
labels: ["agents"]
additions: 274
deletions: 0
changed_files: 6
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/3223
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
- skip tool-call extraction for assistant messages with stopReason="aborted"
- avoid generating synthetic toolResults for aborted tool calls
- add regression test for aborted tool-call handling

## What's the problem?
When an assistant turn is aborted, it can still contain toolCall blocks. Our guard treats those as real tool calls and may synthesize toolResult entries. That creates toolResults with no corresponding toolUse in the immediately previous assistant turn, which strict providers (e.g. Anthropic-compatible APIs) reject.

## How do I reproduce it?
1) Create a session that includes:
   - assistant message with stopReason: "aborted" and a toolCall block
   - a following assistant text message
2) Send the transcript to a strict provider.
3) The request is rejected with:
   `LLM request rejected: ... unexpected tool_use_id found in tool_result blocks ... Each tool_result block must have a corresponding tool_use block in the previous message.`

## Fix
Treat aborted assistant messages as having no tool calls. This prevents synthetic toolResults from being inserted for those aborted calls.

## Testing
- pnpm test

## AI Assistance
- [x] AI-assisted (Codex)
- [x] Degree of testing: fully tested (pnpm test)
- [x] Prompts/logs available on request
- [x] I understand these changes and their impact

## Reviews


## Comments


## Stats

- **Size:** large (274+, 0-, 6 files)
- **Age:** 2 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
