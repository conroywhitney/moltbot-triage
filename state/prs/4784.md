---
number: 4784
title: "fix(imessage): handle non-JSON output from imsg CLI gracefully"
author: spiceoogway
created: 2026-01-30T17:27:16Z
updated: 2026-01-30T17:27:30Z
labels: ["channel: imessage"]
additions: 12
deletions: 3
changed_files: 1
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4784
fixes_issues: [4707]
related_prs: [4707]
duplicate_of: null
---

## Description

Fixes #4707

## Problem
When the  CLI encounters errors (e.g., permission denied accessing chat.db), it outputs plain-text error messages to stdout instead of properly formatted JSON-RPC responses. This causes the RPC client to fail parsing and log overwhelming error messages like:

```
msg rpc: failed to parse permissionDenied(path: "/Users/.../chat.db", underlying: authorization denied (code: 23)): Unexpected token 'p', "permission"... is not valid JSON
```

## Solution
This fix improves error handling in the RPC client:
- Adds explanatory comments about why non-JSON output can occur
- Truncates long lines in error messages (max 200 chars) to prevent log spam
- Improves error message clarity: "received non-JSON output" instead of "failed to parse"
- Removes unused error detail variable

## Testing
- Linter passed with no errors
- Change is backward compatible (only affects error handling)

## Reviews


## Comments


## Stats

- **Size:** small (12+, 3-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #4707
