---
number: 6677
title: "fix(tts): always load fresh config for voice selection"
author: Jinqiao
created: 2026-02-01T23:05:57Z
updated: 2026-02-01T23:07:11Z
labels: ["agents"]
additions: 2
deletions: 1
changed_files: 1
size: tiny
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6677
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem
The TTS tool was caching config at tool creation time, causing voice/provider changes to be ignored until gateway restart.

When users changed the TTS voice via config (e.g. from `alloy` to `fable`), the change wouldn't take effect because the tool kept using the stale config object passed during initialization.

## Solution
Changed `tts-tool.ts` to call `loadConfig()` on each invocation instead of using the cached `opts?.config`.

This ensures runtime config changes (voice selection, provider changes via `/tts` command or config updates) are picked up immediately.

## Testing
- Verified voice changes take effect immediately after config update
- Confirmed OpenAI TTS uses correct voice from config

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR changes the TTS agent tool to call `loadConfig()` on each `execute` invocation instead of using the config captured at tool creation time, so runtime updates (voice/provider selection) are picked up without restarting the gateway.

Change is localized to `src/agents/tools/tts-tool.ts`, and it feeds the freshly loaded config into the existing `textToSpeech` pipeline while keeping channel selection behavior the same.

<h3>Confidence Score: 4/5</h3>

- This PR is safe to merge with low risk; behavior change is straightforward and localized.
- The change removes reliance on a captured config object and instead uses the existing `loadConfig()` API (which already has internal caching/invalidations). Primary concern is interface drift: `opts.config` is now effectively ignored, which may surprise callers/tests, but runtime TTS behavior should improve as intended.
- src/agents/tools/tts-tool.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-01)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-01)

<details>
<summary>Additional Comments (1)</summary>

**`src/agents/tools/tts-tool.ts`**
[P2] `createTtsTool` still accepts `opts?.config` but this change makes it unused, which can confuse callers/tests that pass a config expecting it to take effect. Either remove the `config?: OpenClawConfig` option (and update call sites), or keep honoring it when explicitly provided while still reloading from disk for runtime changes (e.g., merge/override strategy).

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/agents/tools/tts-tool.ts
Line: 16:18

Comment:
[P2] `createTtsTool` still accepts `opts?.config` but this change makes it unused, which can confuse callers/tests that pass a config expecting it to take effect. Either remove the `config?: OpenClawConfig` option (and update call sites), or keep honoring it when explicitly provided while still reloading from disk for runtime changes (e.g., merge/override strategy).

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** tiny (2+, 1-, 1 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: (none detected)
