---
number: 2225
title: "Android: fix device identity/pairing + A2UI action bridge"
author: DeanoC
created: 2026-01-26T13:47:05Z
updated: 2026-02-03T04:51:40Z
labels: ["channel: telegram", "app: android", "scripts"]
additions: 590
deletions: 83
changed_files: 12
size: large
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 3
reactions_total: 2
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/2225
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

This PR contains a set of fixes/improvements discovered while pairing an Android node over Tailscale and validating Canvas/A2UI.

Highlights:
- Force-register BouncyCastle provider on Android to ensure Ed25519 identity works on OEM builds.
- Expose Identity status + Reset identity button in Settings.
- Fix operator handshake client id/mode (avoid CONTROL_UI secure-context rules).
- Add Request Pairing UI and send node.pair.request (with correct nodeId once identity is enabled).
- Improve Settings UX around connected/operator-offline states.
- Add A2UI WebView bridge compat shim (force string payloads) + direct action->node.invoke wiring for a small demo control panel.

Notes:
- There is a known remaining issue: on some devices the Compose overlays may block WebView touch events; not addressed in this PR yet.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR improves the Android node’s gateway pairing/identity and Canvas/A2UI integration:

- Forces BouncyCastle registration to make Ed25519 identity more reliable across OEM builds, and surfaces identity status + a reset button in Settings.
- Adjusts gateway handshake client id/mode so Android operator connections aren’t treated like the web Control UI (secure-context rules).
- Adds a “Request Pairing” UI and sends `node.pair.request` with node/device metadata.
- Improves Settings UX around operator-offline vs node-connected states.
- Adds an A2UI WebView bridge compatibility shim (ensuring JS interface payloads are strings) and wires select A2UI actions to `node.invoke` for a demo.
- CI/test harness now ensures the generated A2UI bundle exists before running Vitest/bun tests.

The changes primarily touch the Android runtime/session connection logic and the WebView canvas bridge, with small supporting updates in CI/scripts/tests.

<h3>Confidence Score: 3/5</h3>

- This PR is likely safe to merge, with a couple of behavioral edge cases to double-check around pairing and operator-only RPCs when only the node session is connected.
- Core changes are localized and align with existing session/auth patterns, and the CI/test updates look straightforward. Main remaining risk is semantic: `isConnected` now means “operator OR node”, but some code paths still assume operator connectivity; plus pairing requests may behave oddly when identity generation falls back to placeholder keys/UUIDs.
- apps/android/app/src/main/java/ai/openclaw/android/NodeRuntime.kt; apps/android/app/src/main/java/ai/openclaw/android/gateway/DeviceIdentityStore.kt; scripts/bundle-a2ui.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>3 files reviewed, 4 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @DeanoC (2026-02-02)

Rebased the PR branch onto latest main to resolve merge conflicts (previous conflict in scripts/test-parallel.mjs). PR should be mergeable again; CI rerunning.

### @DeanoC (2026-02-02)

Rebased onto latest main and force-pushed (merge conflicts should be resolved again). Also fixed Telegram media test expectations to be portable across fetch implementations (arg count can differ).

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`apps/android/app/src/main/java/ai/openclaw/android/NodeRuntime.kt`**
[P1] `_isConnected` now includes node-only sessions, but some code still treats it as “operator-connected”

After changing `_isConnected` to `operatorConnected || nodeConnected` (apps/android/app/src/main/java/ai/openclaw/android/NodeRuntime.kt:262-270), methods like `scheduleWakeWordsSyncIfNeeded()` still gate on `_isConnected.value` before calling `operatorSession.request(...)` (apps/android/app/src/main/java/ai/openclaw/android/NodeRuntime.kt:953-966). When only the node session is connected (operator offline), this can attempt operator RPCs and silently fail, causing confusing “connected” UI with non-working sync.

Suggestion: gate operator-only RPCs on `operatorConnected` (or a dedicated `isOperatorConnected` state) instead of `_isConnected`.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: apps/android/app/src/main/java/ai/openclaw/android/NodeRuntime.kt
Line: 271:273

Comment:
[P1] `_isConnected` now includes node-only sessions, but some code still treats it as “operator-connected”

After changing `_isConnected` to `operatorConnected || nodeConnected` (apps/android/app/src/main/java/ai/openclaw/android/NodeRuntime.kt:262-270), methods like `scheduleWakeWordsSyncIfNeeded()` still gate on `_isConnected.value` before calling `operatorSession.request(...)` (apps/android/app/src/main/java/ai/openclaw/android/NodeRuntime.kt:953-966). When only the node session is connected (operator offline), this can attempt operator RPCs and silently fail, causing confusing “connected” UI with non-working sync.

Suggestion: gate operator-only RPCs on `operatorConnected` (or a dedicated `isOperatorConnected` state) instead of `_isConnected`.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** large (590+, 83-, 12 files)
- **Age:** 7 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
