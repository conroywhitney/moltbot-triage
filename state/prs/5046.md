---
number: 5046
title: "schtasks: add helpful hint for 'stub received bad data' error"
author: shayan919293
created: 2026-01-31T00:20:35Z
updated: 2026-02-03T02:23:23Z
labels: ["app: macos", "gateway"]
additions: 103
deletions: 36
changed_files: 6
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/5046
fixes_issues: [5026]
related_prs: [5026]
duplicate_of: null
---

## Description

## Summary

Adds a helpful troubleshooting hint when users encounter the "stub received bad data" (0x6F7) error during Windows Task Scheduler service installation.

## Problem

On Windows 11 Home (and potentially other editions), users can encounter the error:
```
Gateway service install failed: schtasks create failed: ERROR: The stub received bad data.
```

This is Windows error code 0x6F7 (RPC_E_INVALID_DATA) and typically indicates Task Scheduler service issues rather than a problem with OpenClaw itself.

## Solution

Added a new `resolveSchtasksErrorHint()` function that provides specific hints based on the error message:

1. **For "stub received bad data" errors**: Suggests restarting the Task Scheduler service, running from elevated PowerShell, or using manual gateway run as a fallback.

2. **For "access is denied" errors**: Existing hint suggesting elevated PowerShell.

## Changes

- Added `resolveSchtasksErrorHint()` function in `src/daemon/schtasks.ts`
- Updated error handling to use the new function
- Added tests for the new function in `src/daemon/schtasks.test.ts`

## Testing

- All existing tests pass
- Added 3 new tests for `resolveSchtasksErrorHint()`
- Linting passes
- Type checking passes

Closes #5026

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds a small error-message improvement for Windows Task Scheduler installation failures by factoring hint generation into `resolveSchtasksErrorHint()` and adding unit tests. It also includes unrelated changes: macOS exec approval prompt UI tweaks and a legacy config migration adjustment to allow custom `audio.transcription` command paths.

The schtasks changes integrate into the existing `installScheduledTask()` error path by appending a contextual hint to the thrown error when `schtasks /Create` fails, improving troubleshooting without altering the scheduler logic itself.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge with low functional risk.
- The primary change is additive (string hinting + tests) and the integration point is localized to the `schtasks` failure path. The main area to double-check is the broadened legacy migration behavior for `audio.transcription`, which changes what legacy configs will be accepted/migrated.
- src/config/legacy.shared.ts; src/config/legacy.migrations.part-2.ts

<!-- greptile_other_comments_section -->

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`src/config/legacy.shared.ts`**
[P1] Removing the transcription CLI allowlist broadens what legacy configs can migrate into `tools.media.audio.models`.

This looks intentional for custom scripts, but it also means any arbitrary command path in legacy config will now be migrated (previously non-`whisper` executables were dropped). If that older restriction was a security/product decision, this change silently relaxes it and could surprise users.

If the goal is “custom scripts allowed”, consider documenting that in the migration change message and/or adding a more conservative check (e.g., require absolute path, or keep allowlist but allow `.sh`/`.cmd` when a path is provided).

Also appears in: `src/config/legacy.migrations.part-2.ts:361-382` (the new migration path will now accept any executable name).

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/config/legacy.shared.ts
Line: 44:58

Comment:
[P1] Removing the transcription CLI allowlist broadens what legacy configs can migrate into `tools.media.audio.models`.

This looks intentional for custom scripts, but it also means any arbitrary command path in legacy config will now be migrated (previously non-`whisper` executables were dropped). If that older restriction was a security/product decision, this change silently relaxes it and could surprise users.

If the goal is “custom scripts allowed”, consider documenting that in the migration change message and/or adding a more conservative check (e.g., require absolute path, or keep allowlist but allow `.sh`/`.cmd` when a path is provided).

Also appears in: `src/config/legacy.migrations.part-2.ts:361-382` (the new migration path will now accept any executable name).

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** medium (103+, 36-, 6 files)
- **Age:** 2 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #5026
