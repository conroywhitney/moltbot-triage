---
number: 3385
title: "fix(discord): respect replyToMode in threads"
author: aerolalit
created: 2026-01-28T14:42:52Z
updated: 2026-01-30T17:11:11Z
labels: ["channel: discord"]
additions: 19
deletions: 3
changed_files: 2
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/3385
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

When `replyToMode` is set to `"off"` in the Discord channel config, messages in threads still include a reply reference. This is because the `existingId` check in `createReplyReferencePlanner` happens before the `replyToMode` check.

## Root Cause

In `src/auto-reply/reply/reply-reference.ts`:

```typescript
const use = (): string | undefined => {
  if (!allowReference) return undefined;
  if (existingId) {           // <-- checked first
    hasReplied = true;
    return existingId;        // returns early, ignoring replyToMode
  }
  // ...
  if (options.replyToMode === "off") return undefined;  // <-- too late
};
```

When replying in a thread, `existingId` is set to the parent message ID, so the function returns early before ever checking `replyToMode`.

## Fix

Move the `replyToMode === "off"` check to the top (right after `allowReference`), so it's respected in all contexts including threads.

## Testing

- Set `channels.discord.replyToMode: "off"` in config
- Send messages in a Discord thread
- Verify no reply references are added to outgoing messages

## Reviews


## Comments


## Stats

- **Size:** small (19+, 3-, 2 files)
- **Age:** 1 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
