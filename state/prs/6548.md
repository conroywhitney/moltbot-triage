---
number: 6548
title: "feat(signal): include quoted message context in replies"
author: joeykrug
created: 2026-02-01T19:39:04Z
updated: 2026-02-02T20:21:22Z
labels: ["channel: signal"]
additions: 51
deletions: 2
changed_files: 2
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 2
reactions_total: 1
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6548
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

When a Signal user replies to a specific message, include the quoted message text and metadata in the inbound message context. This allows the agent to see what message was being replied to.

## Problem
Currently when someone replies to a Signal message, the agent only sees the reply text — not what message was being replied to. This makes it hard to understand context in conversations.

## Solution
Extract the quote information from `dataMessage.quote` and prepend it to the message body.

**Format:**
```
(replying to +1234567890 id:1234567890)
> quoted message text

actual reply message
```

## Changes
- Expand `SignalDataMessage.quote` type to include `id`, `author`, `authorUuid`
- Add `quoteContext` field to `SignalInboundEntry`
- Extract quote info from `dataMessage.quote` when present
- Prepend quote context to message body in `handleSignalInboundMessage`

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR enhances Signal inbound message handling by extracting `dataMessage.quote` (id/author/authorUuid/text) and prepending a standardized “replying to …” quoted block to the message body. It also threads a `quoteContext` field through the inbound debouncer so quoted replies keep their context.

Most of the diff outside `src/signal/monitor/*` is formatting/docs-only churn.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge, with minor edge-case handling to consider.
- The changes are localized to Signal inbound message formatting and type expansion, with minimal cross-cutting impact. The main concern is small correctness edge cases (e.g., falsy numeric quote IDs) and a minor future-proofing issue in debounce gating.
- src/signal/monitor/event-handler.ts

<!-- greptile_other_comments_section -->

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-01)

<sub>1 file reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @greptile-apps — COMMENTED (2026-02-01)

<sub>1 file reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-01)

<details>
<summary>Additional Comments (1)</summary>

**`src/signal/monitor/event-handler.ts`**
[P1] Debouncing can attach the *wrong* quote context to a combined message body.

When `entries.length > 1`, the flush handler combines multiple `bodyText` values but spreads `...last`, which carries only the last entry's `quoteContext`. If earlier entries had different (or any) quote context, it’s lost, and the resulting combined message may misleadingly show the last quote prefix above multiple lines of replies. This shows up whenever users send multiple quick replies (potentially to different quoted messages).

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/signal/monitor/event-handler.ts
Line: 291:294

Comment:
[P1] Debouncing can attach the *wrong* quote context to a combined message body.

When `entries.length > 1`, the flush handler combines multiple `bodyText` values but spreads `...last`, which carries only the last entry's `quoteContext`. If earlier entries had different (or any) quote context, it’s lost, and the resulting combined message may misleadingly show the last quote prefix above multiple lines of replies. This shows up whenever users send multiple quick replies (potentially to different quoted messages).

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>

### @joeykrug (2026-02-01)

@greptile-apps review


## Stats

- **Size:** medium (51+, 2-, 2 files)
- **Age:** 1 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
