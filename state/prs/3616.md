---
number: 3616
title: "feat(cli): add --json flag to channels login for programmatic QR access"
author: cgaspart
created: 2026-01-28T22:41:29Z
updated: 2026-01-28T23:05:05Z
labels: ["docs", "cli"]
additions: 76
deletions: 1
changed_files: 4
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3616
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

  Adds a `--json` flag to `moltbot channels login` that outputs QR code data as JSON instead of
  rendering to the terminal. This enables programmatic WhatsApp linking for web dashboards, hosting
  platforms, and automation tools.

  ## Motivation

  When building hosting platforms or web UIs for moltbot, there's no way to programmatically obtain
  the WhatsApp QR code - the current `channels login` command only renders to the terminal. This
  forces hosting providers to either:
  - Require users to SSH into their server
  - Build custom solutions outside of moltbot

  The gateway already has `loginWithQrStart` and `loginWithQrWait` methods that return structured
  data - this PR exposes them via CLI.

  ## Changes

  - **`src/cli/channels-cli.ts`**: Added `--json` and `--timeout` flags to the login command
  - **`src/cli/channel-auth.ts`**: JSON mode uses `plugin.gateway.loginWithQrStart/Wait` instead of
  `plugin.auth.login`
  - **`docs/cli/channels.md`**: Documented the new JSON mode with examples

  ## Usage

  ```bash
  # Existing interactive mode (unchanged)
  moltbot channels login --channel whatsapp

  # New JSON mode
  moltbot channels login --channel whatsapp --json --timeout 60000

  Output format

  Two JSON objects are printed to stdout:

  1. Initial response (QR data):
  {
    "status": "pending",
    "qrDataUrl": "data:image/png;base64,iVBORw0KGgo...",
    "message": "Scan this QR in WhatsApp → Linked Devices.",
    "accountId": "default",
    "channel": "whatsapp"
  }

  2. Final response (after scan or timeout):
  {
    "status": "connected",
    "connected": true,
    "message": "✅ Linked! WhatsApp is ready.",
    "accountId": "default",
    "channel": "whatsapp"
  }

  The qrDataUrl is a base64-encoded PNG that can be displayed directly in an <img src="..."> tag.

## Reviews


## Comments


## Stats

- **Size:** medium (76+, 1-, 4 files)
- **Age:** 1 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
