---
number: 4256
title: "fix: bypass empty-heartbeat-file check for cron jobs"
author: radling005
created: 2026-01-29T23:57:40Z
updated: 2026-01-30T01:57:42Z
labels: []
additions: 7
deletions: 2
changed_files: 1
size: tiny
review_decision: none
reviews: []
comments_count: 1
reactions_total: 1
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4256
fixes_issues: [4224]
related_prs: [4224]
duplicate_of: null
---

## Description

## Summary

Cron jobs with `wakeMode: 'now'` were being skipped when `HEARTBEAT.md` was empty or contained only comments, even though they had pending system events to process.

## Problem

When a cron job fires with `wakeMode: 'now'`, it:
1. Enqueues the system event via `enqueueSystemEvent(text)`
2. Calls `runHeartbeatOnce({ reason: 'cron:${job.id}' })`

But `runHeartbeatOnce()` checks if `HEARTBEAT.md` is effectively empty and skips if so — returning `{ status: 'skipped', reason: 'empty-heartbeat-file' }`.

The bypass only existed for `reason === 'exec-event'`, not for cron jobs.

## Fix

Add cron jobs to the bypass list:
```typescript
const isCronReason = opts.reason?.startsWith('cron:');
```

This ensures cron-triggered wakes are treated the same as exec-event wakes — both have pending system events that need processing regardless of `HEARTBEAT.md` state.

## Testing

Tested locally with:
- Cron job with `wakeMode: 'now'` and empty `HEARTBEAT.md`
- Before: `lastStatus: 'skipped'`, `lastError: 'empty-heartbeat-file'`
- After: Job executes and delivers as expected

Fixes #4224

## Reviews


## Comments

### @jeanlucthumm (2026-01-30)

Thanks, thats what I had in mind too


## Stats

- **Size:** tiny (7+, 2-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #4224
