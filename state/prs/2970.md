---
number: 2970
title: "exec: resilient background mode for coding agents"
author: 4xiomdev
created: 2026-01-27T21:35:42Z
updated: 2026-01-28T23:25:10Z
labels: ["agents"]
additions: 438
deletions: 0
changed_files: 2
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/2970
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

Problem
- When users run long-lived coding agents (claude/codex/opencode/pi) via exec with background/yield, the gateway owns the PTY.
- Gateway restarts (updates/crashes/SIGTERM) kill the agent process tree, leaving the user with no progress visibility and no completion/failure notification.

Change
- Detect backgroundable coding-agent commands and (best-effort) run them in a detached `screen` session instead of a gateway-owned PTY.
- Persist logs under `$CLAWDBOT_STATE_DIR/logs/coding-agent` (defaults to `~/.clawdbot/logs/coding-agent`).
- Send start/progress/completion messages to the initiating session's `deliveryContext` via `clawdbot message send`.
  - Falls back to `clawdbot system event` if `deliveryContext` can't be resolved.
- Fall back to normal exec if `screen` spawn fails, or on Windows.

Notes
- Only triggers for background/yield runs; foreground exec behavior is unchanged.
- The wrapper uses `script(1)` when available for better PTY capture, but falls back to running the shell directly if `script` is missing.

Tests
- Add unit tests covering the coding-agent command detection heuristics.

## Reviews


## Comments


## Stats

- **Size:** large (438+, 0-, 2 files)
- **Age:** 2 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
