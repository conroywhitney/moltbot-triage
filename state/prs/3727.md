---
number: 3727
title: "fix(googlechat): space type detection for modern API"
author: gustavozirbes
created: 2026-01-29T03:25:00Z
updated: 2026-02-03T02:54:19Z
labels: ["channel: googlechat"]
additions: 108
deletions: 3
changed_files: 3
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 2
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3727
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
- Fix space type detection to use modern `spaceType` field instead of deprecated `type`
- Add backwards-compatible fallback for legacy API responses

## Problem
Google Chat deprecated `space.type` (values: `DM`, `ROOM`) in favor of `space.spaceType` (values: `DIRECT_MESSAGE`, `GROUP_CHAT`, `SPACE`). Modern API responses may only include `spaceType`, causing the integration to misidentify space types and return bad request errors for group chats/spaces.

## References
- [Google Chat spaces REST API](https://developers.google.com/workspace/chat/api/reference/rest/v1/spaces) - documents `spaceType` enum values
- [Google Chat Event reference](https://developers.google.com/workspace/chat/api/reference/rest/v1/Event) - webhook payload structure

## AI-Assisted ðŸ¤–
- [x] AI-assisted (Claude)
- [x] Lightly tested (unit tests pass, no live Google Chat testing)
- [x] I understand what the code does

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates Google Chat space type detection to support the modern `space.spaceType` field (e.g., `DIRECT_MESSAGE`, `GROUP_CHAT`, `SPACE`) and adds unit tests for the new resolution logic. It introduces `resolveSpaceType()` in `extensions/googlechat/src/monitor.ts` and uses it when deciding whether an inbound message is a group chat vs DM, with a fallback to the deprecated legacy `space.type` field.


<h3>Confidence Score: 4/5</h3>

- This PR is mostly safe to merge; itâ€™s a small behavioral change with test coverage, with one edge-case mapping that could misclassify legacy space types.
- Changes are localized (space type normalization + tests) and should fix modern API payloads. The main concern is the legacy `type` fallback mapping any non-`DM` value to `SPACE`, which could over-classify unknown/empty legacy values as group chats and affect policy enforcement paths.
- extensions/googlechat/src/monitor.ts (legacy type fallback mapping logic)

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @iHildy (2026-01-30)

LGTM thanks @gustavozirbes 


## Stats

- **Size:** medium (108+, 3-, 3 files)
- **Age:** 4 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
