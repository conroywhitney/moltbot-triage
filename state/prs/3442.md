---
number: 3442
title: "fix: add missing arguments/input field to tool calls [AI-assisted]"
author: ken88ling
created: 2026-01-28T16:23:52Z
updated: 2026-01-28T23:25:09Z
labels: ["agents"]
additions: 72
deletions: 6
changed_files: 3
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/3442
fixes_issues: [2889]
related_prs: [2889]
duplicate_of: null
---

## Description

## Summary

Fixes #2889

When models call tools without parameters (e.g., `session_status`), they sometimes omit the `arguments` field entirely. The Anthropic/Cloud Code Assist API requires this field to be present (even if empty `{}`), causing the error:
```
messages.X.content.Y.tool_use.input: Field required
```

This corrupts the session history and prevents any further messages until the session is reset.

## Changes

- Added `sanitizeToolCallArguments()` function in `images.ts` that adds `arguments: {}` or `input: {}` to tool call blocks missing the required field
- Added 2 test cases to verify the fix

## Testing

- [x] Unit tests pass (8/8 tests)
- [x] Linter passes (0 warnings, 0 errors)  
- [x] Tested locally with Moltbot instance

## AI Disclosure ðŸ¤–

- [x] AI-assisted (built with Anthropic Claude via Antigravity)
- [x] **Testing level**: Fully tested (unit tests + local testing)
- [x] I understand what this code does

## Reviews


## Comments


## Stats

- **Size:** medium (72+, 6-, 3 files)
- **Age:** 0 days
- **Last activity:** 2026-01-28

## Links

- Fixes: #2889
