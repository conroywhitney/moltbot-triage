---
number: 3833
title: "fix(gateway): prevent unnecessary restart on meta.lastTouchedAt changes"
author: HirokiKobayashi-R
created: 2026-01-29T07:11:03Z
updated: 2026-02-03T03:52:36Z
labels: ["gateway"]
additions: 1
deletions: 0
changed_files: 1
size: tiny
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3833
fixes_issues: [3811]
related_prs: [3811]
duplicate_of: null
---

## Description

## Summary

- Added `{ prefix: "meta", kind: "none" }` to `BASE_RELOAD_RULES_TAIL`
- Prevents gateway restart when `meta.lastTouchedAt` changes

## Problem

When tools modify the config (e.g., `moltbot agents add`), the `meta.lastTouchedAt` field gets updated. Without a reload rule for "meta", this fell through to `restartGateway = true`, causing:

1. Gateway sends SIGUSR1, restarts
2. In-flight HTTP requests to LLM providers are aborted
3. User never receives the agent's response

```
04:58:51.420Z - Tool result received (clawdbot agents add completed)
04:58:51.936Z - [reload] config change detected; evaluating reload (meta.lastTouchedAt, ...)
04:58:51.939Z - [reload] config change requires gateway restart (meta.lastTouchedAt)
04:58:51.961Z - [clawdbot] Unhandled promise rejection: AbortError: This operation was aborted
```

## Solution

Add `meta` prefix to the reload rules with `kind: "none"` so changes to `meta.*` fields are ignored.

## Test plan

- [x] Existing config-reload tests pass (8 tests)
- [x] Lint/type check pass

Fixes #3811

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates gateway config reload rules to treat `meta.*` config changes as a no-op (by adding a `{ prefix: "meta", kind: "none" }` rule). This prevents automatic metadata updates like `meta.lastTouchedAt` from falling through to the default “restart required” behavior, avoiding unnecessary gateway restarts and aborted in-flight provider requests during tool-driven config writes.

The change fits into the existing `config-reload.ts` rule-based reload planner (`matchRule` + `buildGatewayReloadPlan`) that classifies changed config paths into restart/hot/no-op categories, with plugin-provided channel reload rules merged in at runtime.

<h3>Confidence Score: 4/5</h3>

- This PR is safe to merge with low risk; it’s a small, targeted behavior change in reload classification.
- Only a single reload rule is added and it follows the existing rule-matching semantics; the main residual risk is lack of explicit regression test coverage for `meta.*` changes.
- src/gateway/config-reload.ts (rule ordering/coverage); src/gateway/config-reload.test.ts (add regression test).

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`src/gateway/config-reload.test.ts`**
[P2] Consider adding a regression test for the newly added `meta` no-op rule.

This PR changes behavior so `meta.*` (e.g. `meta.lastTouchedAt`) no longer triggers a restart; without a test, a future refactor of the reload rules could reintroduce the restart on meta changes without being noticed. A simple case like `buildGatewayReloadPlan(["meta.lastTouchedAt"])` asserting `restartGateway === false` and `noopPaths` contains the path would lock in the intended behavior.

<sub>Note: If this suggestion doesn't match your team's coding style, reply to this and let me know. I'll remember it for next time!</sub>

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/gateway/config-reload.test.ts
Line: 105:114

Comment:
[P2] Consider adding a regression test for the newly added `meta` no-op rule.

This PR changes behavior so `meta.*` (e.g. `meta.lastTouchedAt`) no longer triggers a restart; without a test, a future refactor of the reload rules could reintroduce the restart on meta changes without being noticed. A simple case like `buildGatewayReloadPlan(["meta.lastTouchedAt"])` asserting `restartGateway === false` and `noopPaths` contains the path would lock in the intended behavior.

<sub>Note: If this suggestion doesn't match your team's coding style, reply to this and let me know. I'll remember it for next time!</sub>

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** tiny (1+, 0-, 1 files)
- **Age:** 4 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #3811
