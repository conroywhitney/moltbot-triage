---
number: 3677
title: "fix(system-prompt): hint session_status for date/time instead of embedding it"
author: conroywhitney
created: 2026-01-29T01:37:11Z
updated: 2026-01-29T05:43:03Z
labels: ["agents"]
additions: 41
deletions: 1
changed_files: 2
size: small
review_decision: none
reviews: [{"author":"orzelig","state":"APPROVED"}]
comments_count: 1
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3677
fixes_issues: []
related_prs: [1897,1928,2108,3658]
duplicate_of: null
---

## Description

The system prompt intentionally excludes the current date/time for cache stability (see https://github.com/moltbot/moltbot/commit/66eec295b894bce8333886cfbca3b960c57c4946). This leaves agents without date awareness, causing wrong day-of-week claims (#1897, #1928, #2108).

Instead of reverting the cache optimization, add a one-line hint directing agents to use session_status when they need the current date/time. This keeps the prompt stable while teaching frontier models where to look.

Also adds a negative test ensuring the date/time is NOT re-added to the system prompt, with comments explaining why and pointing to #3658 for the complementary gateway-level timestamp injection approach.

Refs: #1897, #1928, #3658

---

## QA Results

### Before Fix (no hint in prompt)

**Test 1:**
> What day of the week is it today?
> â†’ "Today is Thursday." _(wrong)_
> Is it the weekend?
> â†’ "Nope, not yet! Thursday means you've still got one more day" _(wrong day)_
> How many days until February 1st?
> â†’ "199 days until February 1st, 2026." _(wildly wrong â€” actual: 4 days)_

**Test 2:**
> How many days until February 1st?
> â†’ "Today is July 11, 2025. February 1st, 2026 is 205 days away." _(hallucinated date)_

**Test 3:**
> Is it the weekend?
> â†’ "Yes! It's Saturday, July 19, 2025." _(hallucinated â€” it was Wednesday Jan 28, 2026)_

### After Fix â€” Main Session (full prompt)

**Test 1:**
> How many days until February 1st?
> â†’ "It's January 28, 2026 â€” so 4 days until February 1st." âœ… (used `session_status`)

**Test 2:**
> What day of the week is it today?
> â†’ "It's Wednesday, January 28th, 2026." âœ… (used `session_status`)
> Is it the weekend?
> â†’ "Nope â€” it's Wednesday evening. Middle of the week." âœ…

**Test 3:**
> How many days until February 1st?
> â†’ "It's currently January 28th, so February 1st is 4 days away." âœ…

### After Fix â€” Spawned Subagent Sessions (minimal prompt)

We verified via debug logging that `isMinimal` does **not** strip the time hint â€” `buildTimeSection` is not gated by `isMinimal`, only by `userTimezone`. Confirmed: `promptMode=minimal | hasTimeHint=true`.

However, spawned agents behave differently:

| Test | Round | Tool Used | Correct? |
|------|-------|-----------|----------|
| "What day?" | 1 | `exec date` | âœ… |
| "Weekend?" | 1 | **none** (hallucinated "Thursday July 17, 2025") | âŒ |
| "Days til Feb 1?" | 1 | `exec python3` | âœ… |
| "What day?" | 2 | `exec date` | âœ… |
| "Weekend?" | 2 | **none** (hallucinated "Thursday") | âŒ |
| "Days til Feb 1?" | 2 | `exec python3` | âœ… |
| "Weekend?" | 3 | `exec date` | âœ… |
| "Weekend?" | 4 | `exec date` | âœ… |

**Key findings:**
- The hint IS present in minimal (subagent) prompts â€” confirmed via subsystem logging
- When models check, they prefer `exec` over `session_status` (reasonable â€” more direct)
- Simple yes/no date questions ("is it the weekend?") are **non-deterministic** â€” sometimes the model checks, sometimes it hallucates
- Computation questions ("how many days until...") reliably trigger tool use
- Zero `session_status` calls across all spawned tests â€” `exec` is the natural instinct

### Complementary Fix: Gateway Timestamp Injection (#3658)

This hint helps frontier models that think to check, but doesn't help when models skip checking entirely. **#3658 (gateway timestamp injection) is the stronger complement** â€” it injects the date into the user message itself so models don't need to look it up.

However, #3658 as proposed injects timestamps into incoming user messages at the gateway level. **Spawned subagent tasks may need the same treatment** â€” the task text passed via `sessions_spawn` goes through `callGateway({ method: "agent", params: { message: task } })` and currently has no timestamp injected. If #3658 only covers inbound channel messages (TUI/web), spawned agents would still be blind.

### ğŸ¤– AI-Assisted

This PR was developed and tested collaboratively between a human and an AI agent (Claude, running in Moltbot). Testing included spawned-session tests across multiple rounds, debug logging verification, and live main-session QA. We understand what the code does â€” it's a one-line hint + a guardrail test.

## Reviews

### @orzelig â€” APPROVED (2026-01-29)

Excellent fix! The hint preserves cache stability while giving models the right tool to check date/time. Comprehensive QA shows it works well for main sessions. Good negative test ensuring the date isn't re-added. The detailed testing documentation is super helpful. LGTM!


## Comments

### @Takhoffman (2026-01-29)

Lgtmi


## Stats

- **Size:** small (41+, 1-, 2 files)
- **Age:** 1 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
