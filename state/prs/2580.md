---
number: 2580
title: "Security: SSRF, path traversal, shell injection, and rate limiting protections"
author: joefulfill
created: 2026-01-27T04:43:43Z
updated: 2026-01-28T23:25:11Z
labels: ["channel: whatsapp-web", "gateway", "agents"]
additions: 660
deletions: 39
changed_files: 10
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/moltbot/moltbot/pull/2580
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

This PR adds several security hardening measures:

- **SSRF protection** in media fetch: blocks private IPs, localhost, link-local addresses (169.254.x.x) using `ipaddr.js`; manually follows redirects to validate each hop against SSRF rules
- **Path traversal protection** in web media: allowlists `~/.clawdbot` and `tmpdir` only; follows symlinks via `realpathSync` to prevent escape attacks
- **Shell injection fix** in CLI credentials: uses `spawnSync` with argument arrays instead of `execSync` with string interpolation for keychain operations
- **Rate limiting** for gateway auth: 5 failures = 1 minute lockout, prevents brute-force attacks
- **Tailscale auth failure tracking**: records failures for whois mismatches
- **Logger permissions**: sets `0o700` on log directory, warns if chmod fails

## Test plan

- [x] All 46 security-related tests pass
- [x] SSRF tests: localhost, private IPs, loopback, link-local, redirect validation
- [x] Path traversal tests: allowed paths, restricted paths, symlink escapes
- [x] Rate limiting tests: lockout after 5 failures, independent IP tracking

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** large (660+, 39-, 10 files)
- **Age:** 2 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
