---
number: 3587
title: "fix(message): disable cross-context marker by default (#1782) "
author: nadesh00
created: 2026-01-28T21:45:42Z
updated: 2026-02-03T03:51:29Z
labels: []
additions: 9
deletions: 4
changed_files: 5
size: small
review_decision: none
reviews: []
comments_count: 4
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3587
fixes_issues: [1782]
related_prs: [1782]
duplicate_of: null
---

## Description

## Summary
- Disable `[from #...]` prefix on cross-context messages by default
- Users who want the origin marker can set `tools.message.crossContext.marker.enabled: true`
- Updated docs and config schema to reflect new default

## Test plan
- [x] `pnpm lint` passes
- [x] `pnpm build` passes  
- [x] `pnpm test` passes (4590/4590)
- [x] Updated test to explicitly enable marker when testing embed behavior

Rebased on latest main and resolved CHANGELOG.md conflict. Ready for review.

Closes #1782

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR changes cross-context message decoration so the visible origin marker (e.g., `[from â€¦]`) is **disabled by default**, and must be explicitly enabled via `tools.message.crossContext.marker.enabled: true`. It updates the outbound decoration logic (`src/infra/outbound/outbound-policy.ts`) accordingly, adjusts the relevant test to opt in to the marker (`src/infra/outbound/outbound-policy.test.ts`), and updates config UI/schema help text plus the changelog to document the new default.

The change is localized to the outbound message pipeline: `message-action-runner.ts` calls `buildCrossContextDecoration`, which now returns `null` unless the marker is explicitly enabled, preventing the prefix/suffix or embeds from being applied on cross-context sends unless opted in.

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- The change is narrowly scoped to the cross-context decoration gate, flips the default as intended, and updates the associated test and config help text. No other call sites rely on the old default, and decoration is already optional (null-safe) in the outbound pipeline.
- No files require special attention

<!-- greptile_other_comments_section -->

<sub>(3/5) Reply to the agent's comments like "Can you suggest a fix for this @greptileai?" or ask follow-up questions!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews


## Comments

### @sebslight (2026-01-29)

**Closing: Large PRs (1000+ lines) require prior alignment with maintainers before submission.** Please:

1. Open an issue first to discuss the feature/change
2. Get maintainer buy-in on the approach
3. Consider breaking into smaller, reviewable PRs

We appreciate your interest in contributing, but reviewing massive unaligned PRs is not sustainable. Feel free to reopen after discussing the approach in an issue.

### @nadesh00 (2026-01-29)

> **Closing: Large PRs (1000+ lines) require prior alignment with maintainers before submission.** Please:
> 
> 1. Open an issue first to discuss the feature/change
> 2. Get maintainer buy-in on the approach
> 3. Consider breaking into smaller, reviewable PRs
> 
> We appreciate your interest in contributing, but reviewing massive unaligned PRs is not sustainable. Feel free to reopen after discussing the approach in an issue.

Hi, I think there may be a misunderstanding - this PR is quite small:

- **4 files changed** with minimal edits
- Core fix: 1-line change in `outbound-policy.ts` (line 127)
- Test update: added explicit config to match new default
- Schema doc string update
- Changelog entry

This addresses #1782 (disable cross-context marker by default). The large diff count may have appeared due to rebase against upstream, but the actual changes are straightforward.

Happy to discuss or clarify anything!

### @thewilloftheshadow (2026-01-29)

<img width="2256" height="350" alt="CleanShot 2026-01-29 at 10 01 13@2x" src="https://github.com/user-attachments/assets/96c55e4c-cb4a-4f27-99a8-6c425b5e6759" />

You have a massive package-lock.json file that should not be here, we use pnpm.

### @nadesh00 (2026-01-29)

> <img alt="CleanShot 2026-01-29 at 10 01 13@2x" width="2000" height="350" src="https://private-user-images.githubusercontent.com/35580099/542301145-96c55e4c-cb4a-4f27-99a8-6c425b5e6759.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Njk3MDI4NjQsIm5iZiI6MTc2OTcwMjU2NCwicGF0aCI6Ii8zNTU4MDA5OS81NDIzMDExNDUtOTZjNTVlNGMtY2I0YS00ZjI3LTk5YTgtNmM0MjViNWU2NzU5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNjAxMjklMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjYwMTI5VDE2MDI0NFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTQ0NjE1ZTM1Y2RmMjY1N2ExMTYyYjAzMzQ0NTEzYjQ3YjRmZmUxMDMwY2Q3YWFjOTQyNTA0NDEzMmQ1OTdmYjImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.ZqcfX2t2DPXvu-6DydbI-luX22f6PmvsKcWe5nNp8mg">
> You have a massive package-lock.json file that should not be here, we use pnpm.

Hi, apologies for the noise - I accidentally included a `package-lock.json` (13k lines) when I ran `npm install` locally. I've removed it and force-pushed. The PR now contains only the intended changes:

- 5 files changed, ~24 lines total
- Core fix in `outbound-policy.ts`
- Test update, schema doc, changelog

Could you please reopen? Thanks!



## Stats

- **Size:** small (9+, 4-, 5 files)
- **Age:** 5 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #1782
