---
number: 3253
title: "Agents: add per-model fallbacks support"
author: tombii
created: 2026-01-28T09:37:15Z
updated: 2026-01-29T19:51:52Z
labels: ["agents"]
additions: 163
deletions: 2
changed_files: 4
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3253
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
Adds per-model fallbacks support in `agents.defaults.models[...].fallbacks` to configure model-specific fallback chains without changing the global primary model.

## Changes
- Type: Added `fallbacks?: string[]` to `AgentModelEntryConfig`
- Schema: Updated Zod validation to accept per-model fallbacks
- Logic: Per-model fallbacks take precedence over global `agents.defaults.model.fallbacks`
- Tests: Added 4 test cases covering per-model fallback scenarios
- Docs: Updated CHANGELOG with feature description

## Motivation
Users want to configure fallback chains for specific models (e.g., GLM-Air â†’ ZAI GLM-Air â†’ Claude Haiku) without setting that model as their global primary. This enables provider-specific fallback strategies.

## Example Configuration
```json
"agents": {
  "defaults": {
    "model": {
      "primary": "zai/glm-4.7"
    },
    "models": {
      "openrouter/z-ai/glm-4.5-air:free": {
        "alias": "GLM-Air",
        "fallbacks": [
          "zai/glm-4.5-air",
          "claude-haiku-4-5-20251001"
        ]
      },
      "zai/glm-4.5-air": {},
      "claude-haiku-4-5-20251001": {}
    }
  }
}
```

## Test Plan
- âœ… All existing model-fallback tests pass (23/23)
- âœ… Per-model fallbacks correctly override global fallbacks
- âœ… Empty per-model fallbacks array disables global fallbacks
- âœ… Fallbacks respect allowlist validation
- âœ… 429 rate limit errors trigger per-model fallback chain

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** medium (163+, 2-, 4 files)
- **Age:** 2 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
