---
number: 6553
title: "feat(slack): expose thread-reply action"
author: erauner12
created: 2026-02-01T19:48:14Z
updated: 2026-02-01T20:24:54Z
labels: ["docs", "channel: telegram", "docker"]
additions: 113
deletions: 23
changed_files: 10
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"greptile-apps","state":"COMMENTED"},{"author":"greptile-apps","state":"COMMENTED"},{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 6
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6553
fixes_issues: [6542]
related_prs: [6542]
duplicate_of: null
---

## Description

## Summary

Expose `thread-reply` as a first-class action for Slack so agents don't need to discover the workaround (`send` + `replyTo`) through trial and error.

## Problem

When an agent tries `thread-reply` on Slack, it fails:
```
Action thread-reply is not supported for provider slack.
```

The agent then has to fall back to using `send` with `replyTo` - which works, but requires trial-and-error discovery.

## Solution

- Add `thread-reply` to `listActions()` under the `messages` gate
- Add handler that routes to `sendMessage` with `threadTs`
- The underlying functionality already existed, this just exposes it properly

## Changes

- `src/channels/plugins/slack.actions.ts`: Add `thread-reply` to actions list and add handler
- `src/channels/plugins/slack.actions.test.ts`: Add tests for listing, handling, and error cases

## Test plan

- [x] `thread-reply` appears in `listActions()` when messages enabled
- [x] `thread-reply` does not appear when messages disabled
- [x] `thread-reply` action routes to `sendMessage` with correct `threadTs`
- [x] `thread-reply` throws helpful error when `threadId` missing

Fixes #6542

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR exposes a new Slack channel action, `thread-reply`, by adding it to `listActions()` (behind the existing `messages` action gate) and implementing a handler that forwards to the existing Slack tool action `sendMessage` with `threadTs` set (falling back from `threadId` ‚Üí `replyTo` ‚Üí `toolContext.currentThreadTs`). Tests were added to validate that the action is listed when enabled, hidden when disabled, and that invoking it maps to `sendMessage` with the expected parameters and errors when `threadId` is missing.

<h3>Confidence Score: 4/5</h3>

- This PR looks safe to merge, with only minor correctness and test robustness issues.
- Changes are localized to Slack action listing/dispatch and a small test extension. Previously-reported logic issues cover the main behavioral risks; beyond those, remaining concerns are mainly around misleading error messaging and tests that can be order-dependent due to mock call state.
- src/channels/plugins/slack.actions.ts, src/channels/plugins/slack.actions.test.ts

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps ‚Äî COMMENTED (2026-02-01)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @greptile-apps ‚Äî COMMENTED (2026-02-01)

<sub>1 file reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @greptile-apps ‚Äî COMMENTED (2026-02-01)

<sub>1 file reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @greptile-apps ‚Äî COMMENTED (2026-02-01)

<sub>2 files reviewed, 3 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @erauner12 (2026-02-01)

@greptile-apps, please review this code with the latest changes... and let me know when/if we are ready to merge.

...

Pushed both fixes to PR #6553:

  1. replyToMessageId fix - Removed non-existent property from SlackActionContext
  2. Operator precedence fix - Split ternary into separate variable to fix ?? vs ?: precedence

  The other review items (accountId fallback, readOpts/writeOpts bugs in slack-actions.ts) are pre-existing issues in different files - not introduced by this PR. Those would be separate fixes if you want them addressed.
  
  ...
  


### @erauner12 (2026-02-01)


@greptile-apps, please review this code with the latest changes... and let me know when/if we are ready to merge.

...
Pushed fix for P2 (double-prefixing).

  Re P1 (gate mismatch): This is a non-issue because:
  - thread-reply is only listed when messages is enabled (line 41-46)
  - If somehow called directly, handleSlackAction throws "Slack messages are disabled" for sendMessage
  - The existing send action has the same pattern (always listed, gated downstream)

  No other actions in this file have explicit gate checks in handleAction - they all rely on the downstream check.

### @greptile-apps (2026-02-01)

<details>
<summary>Additional Comments (1)</summary>

**`src/channels/plugins/slack.actions.ts`**
[P2] `thread-reply` is listed under the `messages` gate, but the implementation ultimately calls `sendMessage` (a ‚Äúsend‚Äù capability). If `messages` is disabled but `send` is allowed, `listActions()` hides `thread-reply` while `handleAction` will still execute it if invoked directly, which is confusing.

Consider gating `thread-reply` behind the same gate as `send`, or explicitly rejecting the action in `handleAction` when `messages` is disabled for consistency.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/channels/plugins/slack.actions.ts
Line: 41:46

Comment:
[P2] `thread-reply` is listed under the `messages` gate, but the implementation ultimately calls `sendMessage` (a ‚Äúsend‚Äù capability). If `messages` is disabled but `send` is allowed, `listActions()` hides `thread-reply` while `handleAction` will still execute it if invoked directly, which is confusing.

Consider gating `thread-reply` behind the same gate as `send`, or explicitly rejecting the action in `handleAction` when `messages` is disabled for consistency.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>

### @erauner12 (2026-02-01)

@greptile-apps, please review this code with the latest changes... and let me know when/if we are ready to merge.

Fixed P0. The logic now:
  - to param: used as-is (user provides #channel or channel:C123)
  - channelId param: prefixed (raw ID C123 ‚Üí channel:C123)
  - context fallback: prefixed

  Re P2: The bot is still confused. Both send and thread-reply call handleSlackAction({ action: "sendMessage" }), which checks isActionEnabled("messages") and throws if disabled. There's no scenario where "messages is disabled but send is allowed" - they share the same downstream gate. thread-reply is actually more correctly gated than send because it's also hidden from listActions().
  
  
  

### @erauner12 (2026-02-01)

@greptile-apps, please review this code with the latest changes... and let me know when/if we are ready to merge.

...

‚è∫ Addressed all P2 items:

  1. Test isolation: Added beforeEach to reset mock
  2. Test name: Renamed to "throws without thread identifier"
  3. Error message: Updated to "thread-reply requires threadId, replyTo, or thread context"

### @greptile-apps (2026-02-01)

Perfect! You've addressed all the P2 items:

‚úÖ **Test isolation**: Added `beforeEach()` with `handleSlackAction.mockClear()`  
‚úÖ **Test name**: Renamed to "throws without thread identifier"  
‚úÖ **Error message**: Updated to "thread-reply requires threadId, replyTo, or thread context"

**This PR is ready to merge.** 

The implementation is solid:
- Clean action listing gated behind `messages` 
- Proper fallback chain for thread identification
- Clear error messages
- Comprehensive test coverage

Once CI passes, this is good to go! üöÄ


## Stats

- **Size:** medium (113+, 23-, 10 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: #6542
