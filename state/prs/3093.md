---
number: 3093
title: "feat(slack): add thread.followOnMention config"
author: samirrayani
created: 2026-01-28T02:42:53Z
updated: 2026-01-28T23:25:10Z
labels: ["channel: slack"]
additions: 80
deletions: 1
changed_files: 6
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/moltbot/moltbot/pull/3093
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

# PR: Slack thread follow-on-mention

## Summary

Add `thread.followOnMention` config option for Slack that allows the bot to continue responding in threads where it was mentioned, without requiring repeated @mentions.

## Problem

Currently, when a user tags the bot in a Slack thread, they must continue tagging it on every subsequent message. This creates friction in threaded conversations — the natural expectation is that once you bring someone into a conversation, they stay engaged.

**Current behavior:**
1. User tags `@bot` in a channel → bot responds (creates/joins thread)
2. User replies in that thread without tagging → bot ignores
3. User must tag `@bot` again for each follow-up

**Expected behavior:**
1. User tags `@bot` → bot responds
2. User replies without tagging → bot still responds (thread is "active")
3. Thread stays active until idle timeout

## Solution

Track "active threads" in memory. When the bot is mentioned in a thread, mark it as active. Subsequent messages in active threads bypass the mention gate.

### Configuration

```json
{
  "channels": {
    "slack": {
      "thread": {
        "followOnMention": true,
        "followIdleMinutes": 60
      }
    }
  }
}
```

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `followOnMention` | boolean | `false` | Enable thread following after initial mention |
| `followIdleMinutes` | number | `60` | Minutes of inactivity before thread is no longer "active" |

### Files Changed

1. **`src/config/types.slack.ts`** - Added `followOnMention` and `followIdleMinutes` to `SlackThreadConfig`
2. **`src/config/zod-schema.providers-core.ts`** - Added Zod validation for new options
3. **`src/config/schema.ts`** - Added UI labels and help text
4. **`src/slack/monitor/context.ts`** - Added active thread tracking (Map + helper functions)
5. **`src/slack/monitor/provider.ts`** - Wire config to context
6. **`src/slack/monitor/message-handler/prepare.ts`** - Check active threads in mention gate logic

### Implementation Details

- Active threads stored in memory as `Map<string, number>` (key: `channelId:threadTs`, value: last activity timestamp)
- Threads marked active when `effectiveWasMentioned` is true and message is in a thread
- Active check includes idle timeout expiration (auto-cleanup on check)
- Thread tracking resets on gateway restart (intentional — no persistence complexity)

### How It Works

In `prepare.ts`, the `implicitMention` calculation now includes active thread check:

```typescript
const isInActiveThread = Boolean(
  !isDirectMessage &&
  message.thread_ts &&
  ctx.isActiveThread(message.channel, message.thread_ts),
);

const implicitMention = Boolean(
  !isDirectMessage &&
  ctx.botUserId &&
  message.thread_ts &&
  (message.parent_user_id === ctx.botUserId || isInActiveThread),
);
```

When a mention is detected in a thread, it's marked active:

```typescript
if (effectiveWasMentioned && message.thread_ts && ctx.threadFollowOnMention) {
  ctx.markThreadActive(message.channel, message.thread_ts);
}
```

## Testing

1. Enable the feature:
   ```json
   { "channels": { "slack": { "thread": { "followOnMention": true } } } }
   ```

2. Tag the bot in a Slack channel (creates a thread)

3. Reply in the thread **without** tagging

4. Bot should respond

5. Wait beyond `followIdleMinutes` and verify the thread becomes inactive

## Future Considerations

- **Persistence**: Could persist active threads to disk for gateway restart continuity
- **Per-user scope**: Option to only follow messages from the original tagger vs. anyone in thread
- **Channel-level config**: Allow per-channel `followOnMention` overrides
- **Explicit exit**: Recognize "bye" or similar to deactivate a thread early

## Related

- Extends existing `thread.historyScope` and `thread.inheritParent` config pattern
- Builds on `implicitMention` logic (already handles bot-started threads)

## Reviews


## Comments


## Stats

- **Size:** medium (80+, 1-, 6 files)
- **Age:** 1 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
