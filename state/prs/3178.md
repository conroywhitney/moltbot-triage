---
number: 3178
title: "fix(extensions): resolve Gemini CLI auth paths on Windows npm installs"
author: AkgulMuhammed
created: 2026-01-28T06:34:03Z
updated: 2026-01-30T07:56:25Z
labels: ["extensions: google-gemini-cli-auth"]
additions: 19
deletions: 5
changed_files: 1
size: small
review_decision: none
reviews: []
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/3178
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

The current extractGeminiCliCredentials logic assumes a Unix-style symlink structure where realpathSync resolves to a binary inside a package directory.

On Windows global npm installations, gemini is often a .cmd shim located directly in the npm prefix folder. Additionally, depending on the npm version and installation method, gemini-cli-core might be nested inside gemini-cli/node_modules rather than being flat.

This caused 'Gemini CLI not found' errors on Windows environments even when the CLI was correctly installed and accessible via PATH.

## Solution

- Updated the path resolution logic to check dirname(resolvedPath) in addition to the parent directory, covering Windows npm shim behavior.
- Added search paths to look for nested gemini-cli-core installations (e.g., .../gemini-cli/node_modules/@google/gemini-cli-core).

## Testing

- Verified on Windows 11 with a global npm installation.
- Before fix: clawdbot models auth login failed to find the CLI.
- After fix: Auth flow initiates correctly and credentials are extracted.

## Reviews


## Comments

### @AllenCoder (2026-01-30)

“Thanks! I pulled this locally and it fixes the Gemini CLI auth issue for me. Looks good to merge.”


## Stats

- **Size:** small (19+, 5-, 1 files)
- **Age:** 2 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
