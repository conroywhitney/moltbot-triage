---
number: 4711
title: "fix(cron): keep cron list/status responsive under long cron runs"
author: joshwegener
created: 2026-01-30T15:07:09Z
updated: 2026-01-30T17:46:49Z
labels: []
additions: 25
deletions: 2
changed_files: 2
size: small
review_decision: none
reviews: []
comments_count: 3
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4711
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Why
In a local OpenClaw/Clawdbot setup, `cron.list` and `cron.status` tool calls were intermittently failing with gateway timeouts (10s / 30s) and occasional WS close 1006 while the gateway service itself was healthy.

Evidence (example excerpts):
- `/tmp/clawdbot/clawdbot-2026-01-30.log` shows repeated `[tools] cron failed: gateway timeout after 10000ms`.
- Diagnostic logs show the cron lane frequently taking ~17–24s, meaning *read* requests can queue behind long-running cron executions.

Root cause:
- `cron.list` / `cron.status` were using the same `locked(state, ...)` path as mutating operations, so they could block behind long cron execution that holds the cron lock.

## What this changes
Adds a fast-path for **read-only** operations:
- If `state.store` is already loaded, `cron.list` and `cron.status` return immediately without waiting on `locked(...)`.
- If the store is not loaded yet, behavior is unchanged (still goes through `locked(...)` + `ensureLoaded`).

This keeps cron reads responsive and reduces tool timeouts during long cron jobs.

## Safety
- Only affects `list` and `status`.
- Mutating operations (`add`, `update`, `remove`, `run`) remain locked.
- The fast-path only reads the in-memory store snapshot.

## Testing
Targeted tests relevant to cron behavior:
- `pnpm -s vitest run src/agents/tools/cron-tool.test.ts`
- `pnpm -s vitest run src/cli/cron-cli.test.ts`
- `pnpm -s vitest run src/cron/cron-protocol-conformance.test.ts`

All passed locally.

## Reviews


## Comments

### @joshwegener (2026-01-30)

CI note: the failing jobs appear to be due to  (ENOTEMPTY rmdir on a temp dir), which looks like test cleanup flakiness rather than this PR’s change (only adds a fast-path for / when  is already loaded). Happy to rerun CI or follow up with a small robustness tweak if it keeps reproducing.

### @joshwegener (2026-01-30)

CI note: the failing jobs appear to be due to `src/cron/service.prevents-duplicate-timers.test.ts`
(ENOTEMPTY rmdir on a temp dir), which looks like test cleanup flakiness rather than this PR’s change
(only adds a fast-path for `cron.list`/`cron.status` when `state.store` is already loaded).

Happy to rerun CI or follow up with a small robustness tweak if it keeps reproducing.


### @joshwegener (2026-01-30)

(Sorry for any weird shell expansion in my prior comment; re-posting cleanly.)


## Stats

- **Size:** small (25+, 2-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
