---
number: 6858
title: "feat(hooks): improve session-memory with LLM summarization"
author: alauppe
created: 2026-02-02T04:04:25Z
updated: 2026-02-02T04:25:47Z
labels: []
additions: 266
deletions: 78
changed_files: 2
size: large
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6858
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

The session-memory hook now generates proper summaries instead of capturing just 15 lines of raw content.

## Changes

- Read full session transcript instead of last N lines
- Filter out noise (heartbeats, NO_REPLY, tool blocks, system messages)
- Use LLM to generate structured summary with:
  - Topics discussed
  - Decisions made
  - Outcomes achieved
  - Open items remaining
- Fall back to raw content if LLM summarization fails
- Update HOOK.md documentation

## Why

This makes `/new` actually preserve useful session context for future memory recall, rather than capturing mostly heartbeat noise.

## Example Output

```markdown
# Session: 2026-01-31 14:30:00 UTC

**Topics**: T3ch5 website deployment, Veritas MI prospect research

**Decisions**: 
- Use Hugo over WordPress
- Deploy to htel.me

**Outcomes**:
- Website live at t3ch5.com
- 28 prospect companies identified

**Open Items**:
- Wire contact form to Formspree
```

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR enhances the bundled `session-memory` hook so `/new` writes more useful context into `<workspace>/memory/YYYY-MM-DD-<slug>.md`. Instead of capturing the last N raw transcript lines, the handler now parses the full JSONL session file, filters out common noise, generates a smaller-context slug, and makes a second LLM call to produce a structured Markdown summary (topics/decisions/outcomes/open items), falling back to a raw excerpt if summarization fails.

The core change lives in `src/hooks/bundled/session-memory/handler.ts`, adding transcript parsing and a new embedded-agent summarization step; `src/hooks/bundled/session-memory/HOOK.md` is updated to document the new behavior and token usage.

<h3>Confidence Score: 3/5</h3>

- This PR is reasonably safe but has a high-likelihood failure mode that can prevent the LLM summary from being generated.
- Main logic is self-contained and has a fallback path, but the summarization call likely won’t persist the prompt because the temp session file is created without initializing a session header, which the embedded session manager is known to require for correct persistence. This could cause frequent raw-excerpt fallbacks and reduce the feature’s effectiveness.
- src/hooks/bundled/session-memory/handler.ts

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>1 file reviewed, 4 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** large (266+, 78-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
