---
number: 1985
title: "feat: Add Perplexity Search API as web_search provider"
author: kesku
created: 2026-01-25T22:41:34Z
updated: 2026-01-28T23:25:13Z
labels: ["docs", "commands", "agents"]
additions: 798
deletions: 457
changed_files: 14
size: huge
review_decision: none
reviews: [{"author":"james-pplx","state":"CHANGES_REQUESTED"},{"author":"james-pplx","state":"APPROVED"}]
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/moltbot/moltbot/pull/1985
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Adds support for [Perplexity's Search API](https://docs.perplexity.ai/guides/search-quickstart) as a web search provider.

### Why Perplexity Search API (not Sonar)?

Perplexity offers two different APIs:

| API | What it returns | Use case |
|-----|-----------------|----------|
| Sonar (Chat Completions) | AI-synthesized answers with citations | Conversational Q&A with grounded citations |
| Search API | Raw structured results (title, URL, snippet) | Structured web search results to augment Agents |

The Search API is the right fit for `web_search` because it returns structured results the agent can process as opposed to pre-summarized answers (so the agent can decide what to do with the results), it's also faster and cheaper than Sonar!

###  Code changes
- Added `runPerplexitySearchApi()` - calls Perplexity Search API (POST to `https://api.perplexity.ai/search`)
- Unified parameters: `freshness` (accepts both `pd`/`pw`/`pm`/`py` and `day`/`week`/`month`/`year`), `language` (maps to provider-specific formats), `date_after`/`date_before` (ISO format, converts to Perplexity's `M/D/YYYY` internally)
- Added Perplexity-specific parameters: `domain_filter`, `max_tokens`, `max_tokens_per_page`
- Simplified `PerplexityConfig` - removed `baseUrl` and `model` (not needed for Search API)
- Updated tool schema to expose all parameters with sensible defaults
- Removed `OPENROUTER_API_KEY` from `hasWebSearchKey` check (not relevant for search)

### Onboarding flow
- `clawdbot configure --section web` now asks which provider you want
- Prompts for the appropriate API key based on selection
- Onboarding summary explains both providers

## Testing

### Integration tests updated
- `src/agents/tools/web-search.test.ts` - Updated for unified params, added date normalization tests
- `src/agents/tools/web-tools.enabled-defaults.test.ts` - Added Perplexity Search API tests (freshness, domain filter, language, multiple filters)

| | |
|---|---|
| <img src="https://github.com/user-attachments/assets/d037815d-2e54-439f-b795-30c9453c2265" width="100%"> | <img src="https://github.com/user-attachments/assets/401f4a3a-0cbf-4d88-91d5-c754cb4fc9bd" width="100%"> |
| <img src="https://github.com/user-attachments/assets/ca47ae73-8cb1-43ee-be4c-9d9eaee82bbc" width="100%"> | <img src="https://github.com/user-attachments/assets/38b2a9ba-9967-473a-a0db-402d4aba471b" width="100%"> |


## Reviews

### @james-pplx — CHANGES_REQUESTED (2026-01-25)

all in all looks good just these nits and supporting our filters

### @james-pplx — APPROVED (2026-01-27)




## Comments


## Stats

- **Size:** huge (798+, 457-, 14 files)
- **Age:** 3 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
