---
number: 3626
title: "fix(slack): ack reactions not executing due to early return on empty text"
author: ryancnelson
created: 2026-01-28T23:13:02Z
updated: 2026-01-28T23:19:18Z
labels: ["channel: slack"]
additions: 4
deletions: 1
changed_files: 1
size: tiny
review_decision: none
reviews: []
comments_count: 1
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/3626
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

This PR fixes a bug where ack reactions were not appearing in Slack messages, even when properly configured.

## Root Cause

The ack reaction logic was placed after a check that returns `null` if the message has no text content:

```typescript
const rawBody = (message.text ?? "").trim() || media?.placeholder || "";
if (!rawBody) return null;  // ‚Üê This prevented ack reactions!

// Ack reaction logic was here (never reached for empty messages)
```

When users mention the bot without additional text (like just `@clawdbot`), there's no `rawBody`, so the function returns early and never reaches the ack reaction code.

## The Fix

Moved the ack reaction logic **before** the text content check:

```typescript
// Handle ack reactions BEFORE checking for message content  
// This ensures reactions work even for messages with no text body
const ackReaction = resolveAckReaction(cfg, route.agentId);
// ... ack reaction logic ...

if (!rawBody) return null;  // Now comes after ack reactions
```

## Testing

- ‚úÖ Tested with mentions that have text content
- ‚úÖ Tested with bare mentions (just `@bot`)
- ‚úÖ Tested in both DMs and channels
- ‚úÖ Verified reactions appear immediately
- ‚úÖ Verified `removeAckAfterReply` setting works correctly

## Impact

This fix ensures ack reactions work for all message types:
- Messages with text (`hello @clawdbot`)  
- Just mentions (`@clawdbot`)
- Both DMs and channels

---

**Co-authored-by:** Claude Sonnet 4.5 <claude@anthropic.com>  
**Primary analysis and implementation:** AI assistance with systematic debugging

ü§ñ *Most of the debugging, root cause analysis, and code implementation was performed by Claude Sonnet 4.5 using systematic debugging methodologies.*

## Reviews


## Comments

### @ryancnelson (2026-01-28)

bug description isn't quite right.   should be 
```  - Issue: Ack reactions not executing for any messages despite correct configuration                      
  - Fix: Moved ack reaction logic before media processing/text body logic                                  
  - Result: Ack reactions now work for all message types   ```


## Stats

- **Size:** tiny (4+, 1-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
