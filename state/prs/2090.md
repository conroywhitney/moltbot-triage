---
number: 2090
title: "fix: enable shell mode for npm on Windows (#1963)"
author: andrescardonas7
created: 2026-01-26T05:43:02Z
updated: 2026-01-28T23:25:12Z
labels: []
additions: 9
deletions: 9
changed_files: 1
size: small
review_decision: none
reviews: [{"author":"copilot-pull-request-reviewer","state":"COMMENTED"}]
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/2090
fixes_issues: [1963]
related_prs: [1963]
duplicate_of: null
---

## Description

## Summary
- Fix Windows plugin install: run npm via shell only on win32 to execute npm.cmd
- Keep default spawn behavior for other commands
- Resolves spawn npm ENOENT error on Windows

Fixes #1963

AI + Manual Review
- [x] AI-assisted (Opus 4.5, Cursor)
- [x] Fully tested locally (pnpm test, pnpm lint, pnpm build, pnpm format)
- [x] I understand what the code does
Manual sanity-check: verified the change only enables shell: true on Windows when invoking npm/npm.cmd/npm.exe, and does not affect other commands

 I understand what the code does

## Test Plan
- Existing exec.test.ts tests pass
- All CI checks validated locally before push

Fix Windows plugin install: run npm via shell only on win32 to execute npm.cmd; keep default spawn behavior for other commands.

## Reviews

### @copilot-pull-request-reviewer â€” COMMENTED (2026-01-26)

## Pull request overview

This PR fixes a Windows-specific bug where plugin installation fails with "spawn npm ENOENT" by enabling shell mode for npm commands on Windows. On Windows, npm is distributed as npm.cmd (a batch file) which cannot be executed by Node's spawn() without shell mode.

**Changes:**
- Enables `shell: true` for npm commands on Windows only in `runCommandWithTimeout`
- Refactors npm detection logic for better readability and code reuse
- Adds explanatory comment documenting the Windows npm.cmd requirement





---

ðŸ’¡ <a href="/clawdbot/clawdbot/new/main/.github/instructions?filename=*.instructions.md" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Add Copilot custom instructions</a> for smarter, more guided reviews. <a href="https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Learn how to get started</a>.


## Comments


## Stats

- **Size:** small (9+, 9-, 1 files)
- **Age:** 4 days
- **Last activity:** 2026-01-28

## Links

- Fixes: #1963
