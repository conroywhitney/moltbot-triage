---
number: 5791
title: "fix(telegram): enforce 100 command limit for setMyCommands"
author: battman21
created: 2026-02-01T00:02:51Z
updated: 2026-02-01T00:43:30Z
labels: ["channel: telegram"]
additions: 17
deletions: 3
changed_files: 1
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/5791
fixes_issues: [5787]
related_prs: [5787]
duplicate_of: null
---

## Description

## Summary

Telegram's Bot API limits `setMyCommands` to 100 commands maximum. With 52+ bundled skills plus custom agent skills, OpenClaw easily exceeds this limit, causing `BOT_COMMANDS_TOO_MUCH` errors on every gateway startup.

## Changes

- Add `TELEGRAM_MAX_COMMANDS` constant (100)
- Truncate command list to first 100 commands before registration
- Log warning when limit exceeded with guidance on how to disable
- Prioritizes: native commands > plugin commands > custom commands

## Before

```
[telegram] setMyCommands failed: Call to 'setMyCommands' failed! (400: Bad Request: BOT_COMMANDS_TOO_MUCH)
```

Repeats on every startup/reload with no indication of cause.

## After

```
Telegram limits bots to 100 commands. 127 commands configured; registering first 100. 
Set channels.telegram.commands.native: false to disable skill command registration.
```

Commands register successfully, user gets actionable guidance.

## Test plan

- [ ] Verify warning is logged when >100 commands configured
- [ ] Verify first 100 commands are registered successfully
- [ ] Verify no `BOT_COMMANDS_TOO_MUCH` error occurs
- [ ] Verify command handlers still work for registered commands

Fixes #5787

ðŸ¦ž Generated with [Claude Code](https://claude.ai/code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR prevents Telegram startup failures caused by exceeding the Bot APIâ€™s `setMyCommands` limit by introducing a 100-command cap. It builds the combined command list (native commands, plugin commands, then custom commands), logs a warning when the configured list exceeds the limit, and registers only the first 100 commands via `bot.api.setMyCommands(...)`.

The change fits into the existing Telegram gateway initialization flow by adjusting command registration inside `registerTelegramNativeCommands`, keeping handler registration logic unchanged while ensuring the API call no longer trips `BOT_COMMANDS_TOO_MUCH`.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge and should stop repeated Telegram startup errors, with only minor logging-level concerns.
- The change is localized to command registration, uses a straightforward slice to enforce Telegramâ€™s documented limit, and does not alter command parsing or handler execution. Main remaining concern is that the warning is emitted via `runtime.error` (potentially misclassified as an error), but functional behavior should still improve.
- src/telegram/bot-native-commands.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-01)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** small (17+, 3-, 1 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: #5787
