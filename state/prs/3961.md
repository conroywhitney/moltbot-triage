---
number: 3961
title: "fix: prevent plugins from auto-enabling without user consent (#3932)"
author: lalitraj881
created: 2026-01-29T12:34:39Z
updated: 2026-02-03T03:53:08Z
labels: []
additions: 14
deletions: 14
changed_files: 2
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3961
fixes_issues: [3932]
related_prs: [3932]
duplicate_of: null
---

## Description

## Summary
Fixes #3932 where plugins (bluebubbles, notion, slack, tmux) were being automatically enabled during onboarding without explicit user consent.
## Problem
During `clawdbot onboard`, the `applyPluginAutoEnable()` function automatically set `enabled: true` for plugins when their corresponding channels were configured, violating user consent principles.
## Solution
- Changed default plugin `enabled` state from `true` to `false` in `enablePluginEntry()`
- Plugins are now configured but require explicit user enablement
- Updated all tests to verify new default behavior
- Preserved existing `enabled: true` values (non-destructive)
## Changes
- Modified `src/config/plugin-auto-enable.ts` (1 line)
- Updated `src/config/plugin-auto-enable.test.ts` (14 lines)
## Testing
- ✅ All 9 tests in `plugin-auto-enable.test.ts` pass
- ✅ Linter passes with 0 errors
- ✅ Full test suite: 4785 tests passed
- ✅ Non-destructive: existing `enabled: true` values preserved
## Impact
- **Breaking Change:** No - only affects new onboarding
- **Existing Users:** Unaffected
- **New Users:** Must explicitly enable plugins during setup
## Verification
```bash
npx vitest src/config/plugin-auto-enable.test.ts 
pnpm lint
```
Resolves #3932


<img width="1474" height="492" alt="passed Test" src="https://github.com/user-attachments/assets/adf4c175-5dde-4b41-8d91-d6c2fcdf6001" />

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates onboarding plugin auto-configuration so that detecting a configured channel/provider plugin no longer auto-enables it (`enabled` now defaults to `false` when an entry is created), while still adding the plugin to the allowlist and preserving any pre-existing explicit `enabled: true` values. Tests in `src/config/plugin-auto-enable.test.ts` were updated accordingly to assert the new default disabled state and to keep the existing preferOver prioritization behavior.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge; it’s a small behavior change with updated tests, but one helper still has a surprising side effect worth addressing.
- The change is narrowly scoped (one-line behavior change plus test updates) and aligns with the stated consent goal. Main remaining concern is maintainability/behavior coupling: `enablePluginEntry` can still mutate `plugins.enabled` globally, which could accidentally override explicit global disable if the helper is reused outside the current guarded call path.
- src/config/plugin-auto-enable.ts (enablePluginEntry side effect)

<!-- greptile_other_comments_section -->

<sub>(3/5) Reply to the agent's comments like "Can you suggest a fix for this @greptileai?" or ask follow-up questions!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`src/config/plugin-auto-enable.ts`**
[P1] Auto-enable path still flips `plugins.enabled` from `false` to `true`

`enablePluginEntry` now sets per-plugin `enabled: false`, but it still contains `...(cfg.plugins?.enabled === false ? { enabled: true } : {})`, which will re-enable plugins globally if this helper is ever called with `plugins.enabled === false`. Today `applyPluginAutoEnable` returns early when `next.plugins?.enabled === false`, but this coupling is fragile (future callers/refactors could call `enablePluginEntry` directly and accidentally override a user’s explicit global disable). Consider removing the global flip from this helper or making it explicit at the callsite.


<sub>Note: If this suggestion doesn't match your team's coding style, reply to this and let me know. I'll remember it for next time!</sub>

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/config/plugin-auto-enable.ts
Line: 389:403

Comment:
[P1] Auto-enable path still flips `plugins.enabled` from `false` to `true`

`enablePluginEntry` now sets per-plugin `enabled: false`, but it still contains `...(cfg.plugins?.enabled === false ? { enabled: true } : {})`, which will re-enable plugins globally if this helper is ever called with `plugins.enabled === false`. Today `applyPluginAutoEnable` returns early when `next.plugins?.enabled === false`, but this coupling is fragile (future callers/refactors could call `enablePluginEntry` directly and accidentally override a user’s explicit global disable). Consider removing the global flip from this helper or making it explicit at the callsite.


<sub>Note: If this suggestion doesn't match your team's coding style, reply to this and let me know. I'll remember it for next time!</sub>

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** small (14+, 14-, 2 files)
- **Age:** 4 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #3932
