---
number: 7023
title: "feat(ui): inject build SHA fingerprint into index.html"
author: sergi039
created: 2026-02-02T09:26:12Z
updated: 2026-02-02T09:27:54Z
labels: ["scripts"]
additions: 49
deletions: 2
changed_files: 1
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/7023
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Adds git SHA to the built index.html to enable runtime verification that the UI matches the current codebase version. This helps detect stale cached UIs after server restarts or crashes.

## Changes

- Add `getGitSha()` to read current HEAD
- Add `injectBuildSha()` to modify `dist/control-ui/index.html` after vite build
- SHA is added as both `data-build-sha` attribute on `<html>` and `<meta name="build-sha">` tag

## Use case

After a gateway restart or crash, the browser may serve a cached UI that doesn't match the new server version. This fingerprint allows the UI to detect the mismatch and prompt a refresh.

## Test plan

- [x] `pnpm ui:build` runs successfully
- [x] `dist/control-ui/index.html` contains `data-build-sha` attribute
- [x] SHA matches `git rev-parse HEAD`

ðŸ¤– Generated with [Claude Code](https://claude.ai/code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates `scripts/ui.js` so that after the UI build completes it injects the current git HEAD SHA into the generated `dist/control-ui/index.html` (as `data-build-sha` on `<html>` and as a `<meta name="build-sha">`), enabling runtime detection of stale cached UIs after restarts.

Main thing to watch is that the injection is implemented with simple string/regex replacements, which can become non-idempotent (duplicate attributes/meta tags on repeated builds) or fail silently if the generated HTML differs in casing/formatting (e.g., no literal `</head>` match, multiline `<html>` tag). Tightening the matching and/or making the operation explicitly idempotent would make this more robust in CI and across Vite output changes.

<h3>Confidence Score: 3/5</h3>

- This PR is likely safe to merge, but the HTML injection approach is brittle and can produce incorrect or duplicated fingerprints in some build outputs.
- Change scope is small and isolated to the UI build script, but relies on regex/string replacement of generated HTML, which is prone to silent mismatch across formatting/casing changes and can become non-idempotent when builds are re-run.
- scripts/ui.js

<!-- greptile_other_comments_section -->

<sub>(3/5) Reply to the agent's comments like "Can you suggest a fix for this @greptileai?" or ask follow-up questions!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-02)

<sub>1 file reviewed, 3 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** medium (49+, 2-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
