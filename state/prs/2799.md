---
number: 2799
title: "fix(imessage): prevent self-chat and outbound echo loops (#2585)"
author: Tfh-Yqf
created: 2026-01-27T14:42:20Z
updated: 2026-01-28T23:25:11Z
labels: ["channel: imessage"]
additions: 146
deletions: 3
changed_files: 3
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/2799
fixes_issues: []
related_prs: [2585]
duplicate_of: null
---

## Description

Trying to kill the iMessage self-reply loop with a few layers of protection:
1. Already checking `is_from_me` early — but it can be false in self-chat cases, so not enough by itself.
2. Extra check: if it’s not a group chat (`is_group=false`) and the only participant is the sender → drop it right away. Catches the classic “talking to myself” echo.
3. Stronger one: when we send a message, save its `messageId` in a small short-lived cache. If an incoming message has an id that’s in the cache → treat it as our own echo and discard it. This catches the weird non-self-chat bounces too.

Added tests:
- Self-chat where `is_from_me=false` → make sure we don’t reply
- Normal inbound → we send → record id → fake same id coming back in → confirm it gets dropped and doesn’t trigger again

Should finally squash the infinite self-reply mess in #2585.

## Reviews


## Comments


## Stats

- **Size:** medium (146+, 3-, 3 files)
- **Age:** 2 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
