---
number: 4395
title: "Improve subagent error messages with categorization and hints"
author: spiceoogway
created: 2026-01-30T05:26:44Z
updated: 2026-01-30T07:38:37Z
labels: ["commands", "agents"]
additions: 473
deletions: 13
changed_files: 7
size: large
review_decision: none
reviews: []
comments_count: 1
reactions_total: 0
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4395
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

This PR improves subagent error messages by categorizing errors and providing actionable hints for common failure scenarios.

## Changes

### 1. Enhanced Error Types
- Extended `SubagentRunOutcome` to include `errorType` and `errorHint` fields
- Error types: `model`, `tool`, `network`, `config`, `timeout`, `unknown`

### 2. Error Categorization
- Added `categorizeError()` helper that identifies common error patterns:
  - **File system errors**: ENOENT, EACCES, EISDIR, etc.
  - **API/model errors**: Rate limits (429), auth failures (401), invalid requests (400), service errors (500/503)
  - **Network errors**: Connection refused, DNS failures, network unreachable
  - **Timeout errors**: Various timeout scenarios
  - **Configuration errors**: Missing credentials, quota limits

### 3. Improved Error Emission
- Updated `agent-runner-execution.ts` to categorize errors before emitting lifecycle events
- Error metadata now includes type and hint for remediation

### 4. Better User-Facing Messages
- Added `buildErrorStatusLabel()` to create descriptive error messages
- Announcements now include error type context and remediation hints

## Examples

**Before:**
```
A background task "research-task" just failed: unknown error.
```

**After:**
```
A background task "research-task" just failed (tool error): ENOENT — File or directory not found.
```

**More examples:**
- `failed (API error): Rate limit exceeded — Rate limit exceeded - retry in a few moments`
- `failed (configuration error): Missing API key — Check API credentials and permissions`
- `failed (network error): ECONNREFUSED — Connection failed - check network connectivity`

## Impact

- **Better DX**: Developers can quickly understand what went wrong
- **Faster debugging**: Error type and hints guide towards solutions
- **Backward compatible**: Existing error handling continues to work
- **Low risk**: Changes are additive; no existing behavior modified

## Testing

- ✅ Build passes
- ⏳ Existing tests pass (some unrelated memory-lancedb failures)
- Manual testing recommended with real subagent failures

## Related

Research document: `~/clawd/memory/research/2026-01-30-subagent-errors.md`

## Reviews


## Comments

### @spiceoogway (2026-01-30)

CI failures are all **pre-existing on main** — none caused by this PR:
- `install-smoke` — Docker smoke test infra issue
- `format` — `src/commands/onboard-helpers.ts` formatting (exists on main)
- `test` — `src/config/paths.test.ts:52` expects length 1 but gets 16 (exists on main)


## Stats

- **Size:** large (473+, 13-, 7 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
