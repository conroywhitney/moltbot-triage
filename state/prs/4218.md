---
number: 4218
title: "feat(discord): peer typing-aware debounce for multi-bot coordination"
author: solwakes
created: 2026-01-29T21:56:40Z
updated: 2026-01-29T21:56:50Z
labels: ["channel: discord"]
additions: 153
deletions: 5
changed_files: 5
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4218
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

Multiple Moltbot instances responding to the same channel can generate simultaneous responses because they don't know when peers are mid-generation. This creates "response storms" in shared channels.

## Solution

Track peer bot typing indicators and extend debounce when detected.

### New Config Options (`messages.inbound`)

```json5
{
  "messages": {
    "inbound": {
      "peerBots": ["123456789", "987654321"],  // Bot user IDs to watch
      "peerTypingDelayMs": 3000,                  // Backoff delay (default: 3000)
      "peerTypingMaxRetries": 3                   // Max retries (default: 3)
    }
  }
}
```

### Implementation

1. **PeerTypingListener** - Subscribes to Discord TYPING_START events and tracks peer bot typing state in a TTL-based map (10s expiry matching Discord's typing indicator)

2. **Debouncer enhancement** - `onFlush` callback now receives a `requeue(item, delayMs)` function for custom-delay re-enqueueing

3. **Message handler integration** - Before processing, checks if any configured peer is typing. If so, re-queues with backoff delay (up to max retries)

### Files Changed

- `src/discord/monitor/peer-typing.ts` (new) - Typing listener and state management
- `src/auto-reply/inbound-debounce.ts` - Added requeue support and config resolvers
- `src/discord/monitor/message-handler.ts` - Peer typing check in onFlush
- `src/discord/monitor/provider.ts` - Listener registration
- `src/config/types.messages.ts` - New config types

### Testing

1. Configure two Moltbot instances with each other's bot ID in `peerBots`
2. Send a message that triggers both
3. First bot to start typing should cause second to delay
4. Only one response should appear (or responses should be staggered)

---

*Built in collaboration with Vesper during the Waking Town experiment* üèõÔ∏è

## Reviews


## Comments


## Stats

- **Size:** medium (153+, 5-, 5 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
