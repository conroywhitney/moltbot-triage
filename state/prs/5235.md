---
number: 5235
title: "fix(discord): detect binary content in voice message text"
author: hclsys
created: 2026-01-31T07:17:59Z
updated: 2026-01-31T07:20:20Z
labels: ["channel: discord"]
additions: 46
deletions: 2
changed_files: 1
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 2
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/5235
fixes_issues: [4580]
related_prs: [4580]
duplicate_of: null
---

## Description

## Summary
- Add `looksLikeBinaryData()` helper to detect null bytes and control characters
- Skip `message.content` if it contains binary data (misidentified MIME)
- Fall through to attachment placeholder for proper display
- Applied to both `resolveDiscordMessageText()` and `resolveDiscordSnapshotMessageText()`

Fixes #4580

## Test plan
- [ ] Type check passes
- [ ] Format check passes
- [ ] Codex code review: OK
- [ ] Manual test: send Discord voice message â†’ should show `<media:audio>` not garbled text

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR fixes an issue where Discord voice messages (OGG audio files) were incorrectly displayed as garbled text instead of the proper `<media:audio>` placeholder. The fix adds a `looksLikeBinaryData()` helper that detects null bytes and control characters in message content, allowing the code to skip misidentified binary data and fall through to the attachment placeholder logic.

The implementation samples the first 100 characters and uses two detection strategies: any null byte triggers immediate binary detection, and >10% control characters (excluding tab/newline/CR) also indicates binary content. The check is applied to both `resolveDiscordMessageText()` and `resolveDiscordSnapshotMessageText()` for consistency.

- Added binary content detection helper with clear documentation
- Applied detection to both message text resolution functions
- Properly scoped to only check when attachments are present

<h3>Confidence Score: 4/5</h3>

- This PR is safe to merge with minimal risk
- The implementation is straightforward and well-documented. Binary detection logic is sound (null bytes + control character threshold). Only checks when attachments are present, which is the correct scope. No breaking changes to existing behavior.
- No files require special attention

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-01-31)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** small (46+, 2-, 1 files)
- **Age:** 2 days
- **Last activity:** 2026-01-31

## Links

- Fixes: #4580
