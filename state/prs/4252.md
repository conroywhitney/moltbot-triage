---
number: 4252
title: "FIX:Issue #2590 [Security] :default gateway bind to loopback, require explicit opt-in for public exposure"
author: syedDS
created: 2026-01-29T23:42:27Z
updated: 2026-02-03T02:51:30Z
labels: ["cli", "commands", "docker"]
additions: 19
deletions: 3
changed_files: 5
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4252
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
- Change default gateway bind from `lan` to `loopback` in deployment templates
- Add startup warning when binding to non-loopback (even with auth)
- Enhance security doctor warnings about public exposure

Resolves: Gateway binds to public network interfaces by default

## Changes
- `docker-compose.yml`: Default `CLAWDBOT_GATEWAY_BIND` to `loopback`
- `fly.toml`: Remove explicit `--bind lan`, use default loopback
- `fly.private.toml`: Same as above
- `src/cli/gateway-cli/run.ts`: Add warning for non-loopback binding
- `src/commands/doctor-security.ts`: Enhance exposure warning

## Security Impact
- New deployments default to localhost-only binding
- Existing deployments using explicit `--bind lan` continue working
- Users get clear warning when exposing gateway publicly

## Test Plan
- [ ] `moltbot gateway` starts on 127.0.0.1 by default
- [ ] `moltbot gateway --bind lan --token secret` shows warning but starts
- [ ] `moltbot gateway --bind lan` (no auth) still fails
- [ ] `moltbot doctor security` shows enhanced warning for public exposure
- [ ] Docker Compose starts with loopback by default

Verification Steps
1.Build and test locally:
pnpm build
node dist/index.js gateway  # Should bind to 127.0.0.1
node dist/index.js gateway --bind lan  # Should fail (no auth)
node dist/index.js gateway --bind lan --token test  # Should warn then start

2.Test docker-compose:
docker-compose up moltbot-gateway  # Should bind to loopback
CLAWDBOT_GATEWAY_BIND=lan docker-compose up moltbot-gateway  # Should bind to lan

3.Run security audit:

node dist/index.js doctor security

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR hardens default gateway exposure by switching deployment templates to `loopback` binding by default, adding a runtime warning when users bind the gateway to a non-loopback interface even with auth configured, and expanding `doctor security` messaging about discoverability.

The direction matches the repo’s security posture (don’t expose by default; warn loudly when users do). The main concern is Fly deployments: with `[http_service]` enabled, binding only to loopback will likely break inbound connectivity via Fly’s proxy unless the process listens on a non-loopback interface.

<h3>Confidence Score: 2/5</h3>

- Not safe to merge as-is due to likely broken Fly ingress when binding to loopback.
- Templates moving Fly’s gateway process to default loopback binding conflicts with Fly’s public proxy expectations (needs non-loopback listening). The other changes are mostly additive warnings, but the deployment breakage is significant.
- fly.toml, fly.private.toml

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>2 files reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`src/commands/doctor-security.ts`**
[P1] Suggested CLI command doesn’t set a token

In the token-mode branch, the message says “Or set token directly” but the command shown only sets `gateway.auth.mode token` and never sets `gateway.auth.token`, so following it won’t actually configure auth.

This seems like a regression in the warning text (it was likely intended to be `moltbot config set gateway.auth.token <TOKEN>` or similar).

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/commands/doctor-security.ts
Line: 55:58

Comment:
[P1] Suggested CLI command doesn’t set a token

In the token-mode branch, the message says “Or set token directly” but the command shown only sets `gateway.auth.mode token` and never sets `gateway.auth.token`, so following it won’t actually configure auth.

This seems like a regression in the warning text (it was likely intended to be `moltbot config set gateway.auth.token <TOKEN>` or similar).

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** small (19+, 3-, 5 files)
- **Age:** 4 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
