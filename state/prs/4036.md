---
number: 4036
title: "fix: include cause detail in agent connection error diagnostic"
author: anajuliabit
created: 2026-01-29T15:20:14Z
updated: 2026-01-29T15:20:25Z
labels: ["gateway"]
additions: 107
deletions: 2
changed_files: 3
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/4036
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
- Add `describeNetworkError()` helper to `src/infra/errors.ts` that extracts one level of `.cause` from network errors (e.g. Anthropic SDK's `APIConnectionError`) and appends the underlying code or message
- Use it in the agent catch block (`src/gateway/server-methods/agent.ts`) so users see e.g. `Connection error. (UNABLE_TO_VERIFY_LEAF_SIGNATURE)` instead of just `Connection error.`
- Add tests for the new function and existing error utilities in `src/infra/errors.test.ts`

## Test plan
- [x] `pnpm build` â€” type-check passes
- [x] `pnpm test src/infra/errors` â€” 16 tests pass
- [x] `pnpm lint` â€” clean

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** medium (107+, 2-, 3 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
