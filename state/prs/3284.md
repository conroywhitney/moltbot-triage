---
number: 3284
title: "security(gateway): validate transcript sessionFile path [AI-assisted]"
author: robbyczgw-cla
created: 2026-01-28T10:51:58Z
updated: 2026-01-28T23:25:09Z
labels: ["app: web-ui", "gateway"]
additions: 15
deletions: 2
changed_files: 1
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/moltbot/moltbot/pull/3284
fixes_issues: [3277]
related_prs: [3277]
duplicate_of: null
---

## Description

## Summary
Validate transcript `sessionFile` paths to prevent directory escape.

## Problem
`resolveTranscriptPath()` returned user-provided `sessionFile` directly without validation. An attacker could pass an arbitrary path such as `/etc/cron.d/evil` and cause writes outside the intended transcript directory.

```ts
// before
if (sessionFile) return sessionFile;
```

## Solution
When `storePath` exists, resolve the file under the store directory and validate the path with `path.relative()`. When `storePath` is missing, require an absolute `sessionFile` to avoid ambiguous relative paths.

```ts
const rel = path.relative(storeDir, absSessionFile);
if (rel.startsWith("..") || path.isAbsolute(rel)) {
  throw new Error("sessionFile escapes store directory");
}
```

## Changes
- `src/gateway/server-methods/chat.ts`: validate `sessionFile` paths with `path.relative()` and require absolute paths when no `storePath` exists.

## Testing
- ✅ Build passes
- ⚠️ Lightly tested (manual verification)

## AI Disclosure
- **AI-assisted:** Yes (Claude/Clawdbot)
- **Testing level:** Lightly tested
- **Understanding confirmed:** Yes

Fixes #3277 (partial)

## Reviews


## Comments


## Stats

- **Size:** small (15+, 2-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-01-28

## Links

- Fixes: #3277
