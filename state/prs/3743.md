---
number: 3743
title: "fix(slack): pass toolContext to read action for thread reply support"
author: tumf
created: 2026-01-29T03:49:34Z
updated: 2026-01-29T04:40:13Z
labels: ["channel: slack", "agents"]
additions: 169
deletions: 4
changed_files: 10
size: medium
review_decision: none
reviews: [{"author":"chatgpt-codex-connector","state":"COMMENTED"}]
comments_count: 1
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/3743
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
- Forward `threadId` for Slack message read actions
- Pass `toolContext` to `handleSlackAction` in read action (extensions/slack)
- Auto-inject `threadId` when reading from current thread context
- Add `ThreadRepliesBody` for automatic thread context in agent prompts
- Add `resolveSlackThreadReplies` helper for fetching thread replies
- Add `threadId` parameter to message tool fetch schema
- Respect `historyLimit=0` to skip thread replies fetch

## Problem
When an agent was in a Slack thread and used `message.read` to read messages, it could only read the channel's top-level messages, not the thread replies. This made it impossible for the agent to understand the thread context.

## Solution
Pass `toolContext` (containing `currentChannelId` and `currentThreadTs`) through the read action path so that `threadId` is auto-injected when reading from the current thread.

## Testing
- Added regression test for read threadId forwarding
- Manually verified thread replies are now correctly fetched
- Verified `historyLimit=0` properly skips thread context injection

---

## ü§ñ AI-Assisted PR

- **AI Tools Used:** Claude (via Claude Code CLI)
- **Testing Level:** Lightly tested - manual verification + regression test added
- **Human Review:** Code changes reviewed and understood by contributor

## Reviews

### @chatgpt-codex-connector ‚Äî COMMENTED (2026-01-29)


### üí° Codex Review

Here are some automated review suggestions for this pull request.

**Reviewed commit:** `eb8e004499`
    

<details> <summary>‚ÑπÔ∏è About Codex in GitHub</summary>
<br/>

[Your team has set up Codex to review pull requests in this repo](http://chatgpt.com/codex/settings/general). Reviews are triggered when you
- Open a pull request for review
- Mark a draft as ready
- Comment "@codex review".

If Codex has suggestions, it will comment; otherwise it will react with üëç.




Codex can also answer questions or update the PR. Try commenting "@codex address that feedback".
            
</details>


## Comments

### @tumf (2026-01-29)

The Windows CI failure is unrelated to this PR. The failing test (`src/media-understanding/apply.test.ts`) attempts to create a file named `file<test>.txt`, but `<` and `>` are invalid characters in Windows filenames. This is a pre-existing issue outside the scope of this PR.


## Stats

- **Size:** medium (169+, 4-, 10 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
