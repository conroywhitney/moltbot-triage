---
number: 3838
title: "fix(agents): pass contextFiles to createAgentSession for openai-completions API"
author: ai-fanatic
created: 2026-01-29T07:20:19Z
updated: 2026-01-29T16:17:53Z
labels: ["agents"]
additions: 2
deletions: 2
changed_files: 2
size: tiny
review_decision: none
reviews: []
comments_count: 1
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/3838
fixes_issues: [3775]
related_prs: [3775]
duplicate_of: null
---

## Description

## Summary
- Passes the resolved `contextFiles` to `createAgentSession` instead of an empty array
- Fixes bootstrap files (SOUL.md, USER.md, IDENTITY.md) not being injected into system prompt for openai-completions API providers (like Ollama)

## Problem
When using the `openai-completions` API (e.g., Ollama), workspace bootstrap files were not reaching the model despite being correctly resolved and embedded into the system prompt. The model would try to use `memory_get` to fetch these files (failing) or hallucinate the information.

**Root cause**: While `contextFiles` were resolved from workspace bootstrap files and embedded into the system prompt via `buildEmbeddedSystemPrompt`, an empty array `[]` was passed to `createAgentSession`. Some providers may use the `contextFiles` parameter directly.

## Solution
Pass the actual `contextFiles` array to `createAgentSession` so that providers using both:
1. The system prompt override (existing behavior)
2. The `contextFiles` parameter directly

...will receive the workspace bootstrap content.

## Files changed
- `src/agents/pi-embedded-runner/run/attempt.ts` - Changed `contextFiles: []` to `contextFiles`
- `src/agents/pi-embedded-runner/compact.ts` - Changed `contextFiles: []` to `contextFiles`

## Test plan
- [ ] Test with Ollama provider and verify SOUL.md, USER.md, IDENTITY.md content is available to the model
- [ ] Test with Anthropic provider to ensure no regression
- [ ] Verify input token count increases appropriately with bootstrap content

## Related
This may also improve bootstrap file injection for other openai-completions providers (MiniMax, Moonshot, etc.)

Fixes #3775

---

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments

### @adriangrassi (2026-01-29)

this alone [won't] fix it see  [https://github.com/moltbot/moltbot/issues/4028](url)


## Stats

- **Size:** tiny (2+, 2-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: #3775
