---
number: 3420
title: "fix: skip heartbeat wake for subagent exec completions"
author: zarianl
created: 2026-01-28T15:31:17Z
updated: 2026-01-28T23:25:09Z
labels: ["agents"]
additions: 8
deletions: 2
changed_files: 1
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3420
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

When sub-agents run many exec commands (e.g., during builds), each completion triggers `requestHeartbeatNow()` which wakes the main session. With only 250ms coalesce time, this causes heartbeat spam flooding the main session.

**Observed behavior:** Main session receives dozens of heartbeat polls per minute when sub-agents are running builds or other multi-exec workflows.

## Solution

Skip the `requestHeartbeatNow()` call when the exec belongs to a subagent session (sessionKey contains `:subagent:`). 

The system event is still enqueued for the subagent session to process, but the main session heartbeat is not triggered.

## Changes

- `src/agents/bash-tools.exec.ts`: Add subagent check before both `requestHeartbeatNow()` calls
  - `maybeNotifyOnExit()` - exec completion notifications
  - `emitExecSystemEvent()` - exec event notifications

## Testing

Tested locally by running sub-agent builds. Main session no longer receives heartbeat spam when sub-agents execute many commands.

## Reviews


## Comments


## Stats

- **Size:** small (8+, 2-, 1 files)
- **Age:** 1 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
