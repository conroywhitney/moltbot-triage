---
number: 7289
title: "fix(status): probe memory plugins via RPC instead of showing 'unavailable'"
author: tsukhani
created: 2026-02-02T16:57:59Z
updated: 2026-02-02T17:00:10Z
labels: ["channel: telegram", "extensions: memory-lancedb", "scripts", "commands", "agents"]
additions: 3857
deletions: 206
changed_files: 32
size: huge
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7289
fixes_issues: [7273]
related_prs: [7273]
duplicate_of: null
---

## Description

## Summary

When `plugins.slots.memory` is set to a non-core plugin (e.g. `memory-lancedb`), `openclaw status` showed `Memory │ enabled (plugin memory-lancedb) · unavailable` because the status scanner only knew how to probe `memory-core` directly.

## Changes

1. **`extensions/memory-lancedb/index.ts`** — Register a `memory.status` gateway method that exposes entry count, db path, embedding model, and feature flags (autoRecall, autoCapture, coreMemory)

2. **`src/commands/status.scan.ts`** — When the memory slot is not `memory-core` and the gateway is reachable, query the running gateway via `memory.status` RPC and map the response to the expected `MemoryStatusSnapshot` shape

3. **`src/commands/status.command.ts`** — Render plugin memory as `N entries` instead of `N files · N chunks` (since plugin memory stores individual entries, not file-based chunks)

## Before

```
│ Memory │ enabled (plugin memory-lancedb) · unavailable │
```

## After

```
│ Memory │ 345 entries · plugin memory-lancedb │
```

Fixes #7273

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR improves `openclaw status` when `plugins.slots.memory` points at a non-core memory plugin by probing the running gateway via a new `memory.status` RPC method (implemented in `memory-lancedb`) and mapping that response into the existing `MemoryStatusSnapshot` shape for display. It also updates status rendering to show plugin memory as an entry count rather than file/chunk counts.

Most changes are cohesive around memory plugin status visibility, but there are a couple of cross-cutting additions (notably per-session metadata storage and the session-memory hook’s optional gateway write path) that introduce new path/namespace and security/logging edge cases worth addressing before merge.

<h3>Confidence Score: 2/5</h3>

- This PR is not safe to merge as-is due to a likely injection issue in LanceDB filter construction and an agentId path parsing bug on POSIX.
- Core status/RPC change is straightforward, but the PR introduces (1) string-interpolated query filters in `memory-lancedb` that can be exploited if `agentId` is not strictly controlled, and (2) a Windows-only regex when extracting `agentId` from `storePath`, causing per-session metadata writes to go to the wrong location on Linux/macOS. There are also smaller robustness concerns around the session-memory hook’s gateway call and status rendering heuristics.
- extensions/memory-lancedb/index.ts; src/config/sessions/store.ts; src/hooks/bundled/session-memory/handler.ts

<!-- greptile_other_comments_section -->

<sub>(5/5) You can turn off certain types of comments like style [here](https://app.greptile.com/review/github)!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>4 files reviewed, 4 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** huge (3857+, 206-, 32 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: #7273
