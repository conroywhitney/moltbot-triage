---
number: 3459
title: "feat: add proxy support for web_search tool"
author: zxz0622
created: 2026-01-28T16:44:40Z
updated: 2026-01-28T23:25:08Z
labels: ["agents"]
additions: 17
deletions: 0
changed_files: 1
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3459
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Add HTTP/HTTPS proxy support for the `web_search` tool using `undici`'s `ProxyAgent`.

This change resolves issues where the `web_search` tool fails to access external APIs (Brave Search, Perplexity) when Moltbot runs behind corporate proxies or VPNs.

## Changes

- Import `ProxyAgent` from `undici`
- Add `getProxyDispatcher()` helper function to read proxy configuration from environment variables
- Apply proxy dispatcher to both `runPerplexitySearch()` and `runWebSearch()` fetch calls
- Respect `HTTP_PROXY` and `HTTPS_PROXY` environment variables

## Testing

- ✅ All unit tests pass (73 test files)
- ✅ Local validation: Successfully called Brave Search API through proxy
- ✅ Build verification: TypeScript compilation with no errors

## Motivation

Node.js `fetch` API does not automatically use system proxy settings. When users run Moltbot behind a proxy or VPN, web search requests fail with "fetch failed" errors. This PR adds explicit proxy support following `undici` best practices.

## Related Issues

Fixes web_search failures for users running behind proxies/VPNs who were experiencing "fetch failed" errors.

## Reviews


## Comments


## Stats

- **Size:** small (17+, 0-, 1 files)
- **Age:** 1 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
