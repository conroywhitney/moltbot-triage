---
number: 4783
title: "fix: Make text extraction more robust for providers without type field"
author: spiceoogway
created: 2026-01-30T17:26:01Z
updated: 2026-01-30T17:26:10Z
labels: ["agents"]
additions: 28
deletions: 6
changed_files: 1
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4783
fixes_issues: [4536]
related_prs: [4536]
duplicate_of: null
---

## Description

Fixes #4536

## Problem
WebChat was showing empty Assistant responses despite successful API calls. The issue affected Gemini 2.0 Flash and potentially other providers.

## Root Cause
The `extractAssistantText()` function was filtering out content blocks that didn't have `type="text"`. Some providers (especially Gemini 2.0) don't consistently set the type field, causing valid text content to be discarded.

## Solution
Added fallback logic to extract text from content blocks even when the type field is missing or set differently:

- First tries standard format: `{ type: "text", text: "..." }`
- Falls back to extracting `text` field if present (regardless of type)
- Still excludes known non-text blocks (`toolCall`, `thinking`)
- Preserves all existing sanitization logic

## Testing
- Existing unit tests should pass
- Backwards compatible with all existing formats
- Handles edge cases (missing type, different type values)

## Impact
- ✅ Fixes Gemini 2.0 Flash empty responses
- ✅ More tolerant of API schema variations across providers
- ✅ No breaking changes
- ✅ Risk level: Low

## Related
See research document: `~/clawd/memory/research/2026-01-30-fix-4536.md`

## Reviews


## Comments


## Stats

- **Size:** small (28+, 6-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #4536
