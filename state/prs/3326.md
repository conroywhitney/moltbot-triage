---
number: 3326
title: "fix: respect groupPolicy when explicit group configs exist"
author: impozzible
created: 2026-01-28T12:56:49Z
updated: 2026-02-03T03:53:21Z
labels: []
additions: 7
deletions: 1
changed_files: 1
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3326
fixes_issues: [3323]
related_prs: [3323]
duplicate_of: null
---

## Description

## Summary

Fixes #3323

Previously, having ANY explicit group config in `channels.<channel>.groups` would enable allowlist mode, blocking all groups not explicitly listed — even when `groupPolicy` was set to `'open'`.

## Changes

Modified `resolveChannelGroupPolicy()` in `src/config/group-policy.ts` to only enable allowlist when `groupPolicy === 'allowlist'`.

This allows explicit group configs (e.g., `requireMention` settings) to coexist with `groupPolicy: 'open'` without creating an implicit allowlist.

## Testing

1. Configure with `groupPolicy: 'open'` and one explicit group entry
2. Get mentioned in a different group (not in explicit config)
3. Bot now responds correctly

Verified working on Clawdbot 2026.1.24-3 with local patch.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

Fixes channel group allowlist behavior by gating allowlist enforcement on an explicit `groupPolicy: "allowlist"` setting, so that per-group configs (e.g. `requireMention`) can exist without implicitly blocking unlisted groups when `groupPolicy` is open.

This change is localized to `resolveChannelGroupPolicy()` in `src/config/group-policy.ts`, which is used by the downstream helpers (`resolveChannelGroupRequireMention`, `resolveChannelGroupToolsPolicy`) to decide whether a group is allowed and which group/default configs apply.

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- Change is small and targeted: it only alters how `allowlistEnabled` is computed, aligning behavior with the documented intent (only enforce allowlist when explicitly configured). It doesn’t change group config resolution or tool/mention logic beyond the allowlist gate.
- src/config/group-policy.ts

<!-- greptile_other_comments_section -->

<sub>(5/5) You can turn off certain types of comments like style [here](https://app.greptile.com/review/github)!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews


## Comments


## Stats

- **Size:** tiny (7+, 1-, 1 files)
- **Age:** 5 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #3323
