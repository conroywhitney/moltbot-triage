---
number: 4749
title: "fix: handle string thread IDs in queue drain for Slack"
author: nvonpentz
created: 2026-01-30T16:04:52Z
updated: 2026-01-30T16:04:52Z
labels: []
additions: 3
deletions: 3
changed_files: 1
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4749
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

When multiple messages arrive while the agent is busy (queued messages), replies to Slack threads were incorrectly being sent to the main channel instead of the thread.

## Root Cause

The code in `src/auto-reply/reply/queue/drain.ts` checks for thread IDs using:
```typescript
typeof threadId === "number"
```

However, Slack thread timestamps are **strings** (e.g., `"1769015989.090599"`), not numbers. This caused:
1. Thread IDs to be filtered out when checking for cross-channel routing
2. `originatingThreadId` to be `undefined` when collecting queued messages
3. Replies going to the main channel instead of the originating thread

## Fix

Changed type checks from `typeof threadId === "number"` to `threadId != null` which correctly handles both string (Slack) and number thread IDs across different providers.

## Testing

Tested locally by:
1. Sending multiple messages in a Slack thread while agent was busy
2. Verified replies now correctly go to the thread instead of main channel

## Reviews


## Comments


## Stats

- **Size:** tiny (3+, 3-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
