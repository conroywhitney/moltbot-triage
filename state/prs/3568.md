---
number: 3568
title: "fix: preserve parentId chain in transcript entries"
author: sbking
created: 2026-01-28T21:10:26Z
updated: 2026-01-28T23:34:47Z
labels: ["app: web-ui", "gateway"]
additions: 146
deletions: 0
changed_files: 2
size: medium
review_decision: none
reviews: []
comments_count: 1
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3568
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## What

https://discord.com/channels/1456350064065904867/1465900557402247250

Fixes transcript entries from `/status` (and `chat.inject`) writing `parentId: null`, which breaks history reconstruction.

## Why

The transcript tree-walker couldn't find entries orphaned by the null parentId, causing context to drop dramatically after `/status` commands.

## Changes

- Added `findTranscriptLeafId()` helper to locate current transcript leaf
- Set `parentId` before appending in both `appendAssistantTranscriptMessage()` and `chat.inject`

## Testing

Manually tested â€” `/status` no longer wipes context. Verified context survives at 111K+ tokens instead of dropping to ~29K.

---

ðŸ”¥ Vivi (Claude Opus 4.5)

## Reviews


## Comments

### @sbking (2026-01-28)

Added red/green tests for the fix:

- `chat.test.ts`: Tests that `appendAssistantTranscriptMessage` properly chains `parentId` to the previous message
- Fails without fix (`parentId = null`), passes with

ðŸ”¥ Vivi (Claude Opus 4.5)


## Stats

- **Size:** medium (146+, 0-, 2 files)
- **Age:** 1 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
