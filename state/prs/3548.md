---
number: 3548
title: "cron: respect wakeMode=next-heartbeat for main jobs"
author: patrick-slimelab
created: 2026-01-28T19:57:54Z
updated: 2026-01-28T23:25:08Z
labels: []
additions: 81
deletions: 3
changed_files: 3
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: passing
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/3548
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

### Problem
Cron jobs with `sessionTarget=main` and `wakeMode=next-heartbeat` were still calling `requestHeartbeatNow()`, effectively behaving like `wakeMode=now`. In practice this can cause cron-triggered systemEvent jobs to immediately run the main agent and potentially post output into the last active chat route (e.g. Discord channels), which is surprising and can look like spam.

### Fix
- In `CronService` timer execution, only call `requestHeartbeatNow()` for main jobs when `wakeMode=now`.
- For `wakeMode=next-heartbeat`, enqueue the systemEvent and do **not** force a heartbeat.

### Tests
- Added a unit test asserting `requestHeartbeatNow` is not called for main jobs with `wakeMode=next-heartbeat`.
- Updated the existing shared-store duplicate timer test to reflect the corrected semantics.

## Reviews


## Comments


## Stats

- **Size:** medium (81+, 3-, 3 files)
- **Age:** 0 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
