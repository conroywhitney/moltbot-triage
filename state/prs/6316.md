---
number: 6316
title: "fix: unconditionally classify 'fetch failed' TypeErrors as transient network errors."
author: KuzeyC
created: 2026-02-01T14:41:02Z
updated: 2026-02-01T22:27:21Z
labels: []
additions: 6
deletions: 4
changed_files: 2
size: small
review_decision: none
reviews: [{"author":"copilot-pull-request-reviewer","state":"COMMENTED"},{"author":"yofabr","state":"APPROVED"},{"author":"copilot-pull-request-reviewer","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6316
fixes_issues: []
related_prs: [6147]
duplicate_of: null
---

## Description

## Summary
Treat all "fetch failed" unhandled rejections as transient network errors to prevent gateway crashes on recoverable connectivity issues.

## Problem
The gateway's unhandled rejection handler (isTransientNetworkError) only classified TypeError: fetch failed as safe if the underlying cause matched a specific allowlist of error codes (e.g., ECONNREFUSED). However, undici (Node's fetch implementation) can throw fetch failed errors with missing or unknown causes during certain network conditions. This caused the gateway to strictly interpret these as fatal errors and exit the process, leading to unnecessary crashes and restarts during temporary network glitches.

##Solution
In src/infra/unhandled-rejections.ts, modified isTransientNetworkError to unconditionally treat TypeError: fetch failed as a transient error.

Removed the recursive check for specific error codes on the cause property for this specific error type.
Ensures that any fetch failure logic is logged as a warning instead of triggering a fatal process exit.
Preserves fatal crashing behavior for actual critical errors (OOM, config issues).

Fixes [#6147](https://github.com/openclaw/openclaw/issues/6147)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This change updates `isTransientNetworkError` (`src/infra/unhandled-rejections.ts`) so that undiciâ€™s `TypeError: fetch failed` is always treated as transient. Previously, it would only be considered transient if a `cause` existed and the `cause` chain resolved to an allowlisted transient error code. The unhandled rejection handler uses this classification to decide whether to log a warning and continue, or treat the rejection as fatal and exit; this PR reduces unnecessary gateway crashes caused by fetch failures that donâ€™t carry a useful `cause`.

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- The diff is a small, localized behavior change: it removes a recursive cause-based allowlist check only for the specific undici `TypeError: fetch failed` case, while leaving the existing transient-code checks and general cause-chain traversal intact. No new dependencies, APIs, or data flows are introduced.
- No files require special attention

<!-- greptile_other_comments_section -->

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @copilot-pull-request-reviewer â€” COMMENTED (2026-02-01)

## Pull request overview

This PR fixes a gateway crash issue by treating all "fetch failed" TypeErrors from Node's undici as transient network errors, regardless of their underlying cause. Previously, the gateway would check the error's cause chain and only classify it as transient if the cause matched a known network error code, but undici can throw "fetch failed" errors with missing or unknown causes during certain network conditions, leading to unnecessary crashes.

**Changes:**
- Modified `isTransientNetworkError` to unconditionally return true for "TypeError: fetch failed" without checking the cause chain
- Removed 4 lines of code that performed recursive cause checking for this specific error type
- Preserves fatal error protection through handler-level checks that run before transient error classification





---

ðŸ’¡ <a href="/openclaw/openclaw/new/main/.github/instructions?filename=*.instructions.md" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Add Copilot custom instructions</a> for smarter, more guided reviews. <a href="https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Learn how to get started</a>.

### @yofabr â€” APPROVED (2026-02-01)



### @copilot-pull-request-reviewer â€” COMMENTED (2026-02-01)

## Pull request overview

Copilot reviewed 2 out of 2 changed files in this pull request and generated no new comments.





---

ðŸ’¡ <a href="/openclaw/openclaw/new/main/.github/instructions?filename=*.instructions.md" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Add Copilot custom instructions</a> for smarter, more guided reviews. <a href="https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Learn how to get started</a>.


## Comments


## Stats

- **Size:** small (6+, 4-, 2 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: (none detected)
