---
number: 4226
title: "Fix/sandbox containerworkdir rw access"
author: ozgur-polat
created: 2026-01-29T22:29:49Z
updated: 2026-02-03T02:52:40Z
labels: ["docs", "agents"]
additions: 90
deletions: 7
changed_files: 4
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: passing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4226
fixes_issues: [4171]
related_prs: [4171]
duplicate_of: null
---

## Description

## Summary

Fixes #4171 - Cron isolated agent does not pass sandboxInfo to system prompt

## Problem

When running a cron job with `sessionTarget: "isolated"` and sandbox enabled with `workspaceAccess: "rw"`, the agent receives the host workspace path (e.g., `/home/node/loom-novia`) in the system prompt instead of the Docker container mount path (`/workspace`).

## Root Cause

The [buildEmbeddedSandboxInfo()](cci:1://file:///Users/ozgur/Documents/Repos/Apps/moltbot/moltbot/src/agents/pi-embedded-runner/sandbox-info.ts:4:0-36:1) function was only setting `agentWorkspaceMount` for read-only ([ro](cci:2://file:///Users/ozgur/Documents/Repos/Apps/moltbot/moltbot/src/agents/system-prompt.ts:12:0-12:53)) access, but not for read-write (`rw`) access.

## Changes

- **[src/agents/pi-embedded-runner/sandbox-info.ts](cci:7://file:///Users/ozgur/Documents/Repos/Apps/moltbot/moltbot/src/agents/pi-embedded-runner/sandbox-info.ts:0:0-0:0)**: Added logic to set `agentWorkspaceMount` to `containerWorkdir` (typically `/workspace`) for `rw` access
- **[src/agents/pi-embedded-runner.buildembeddedsandboxinfo.test.ts](cci:7://file:///Users/ozgur/Documents/Repos/Apps/moltbot/moltbot/src/agents/pi-embedded-runner.buildembeddedsandboxinfo.test.ts:0:0-0:0)**: Added 2 new test cases for `rw` and [ro](cci:2://file:///Users/ozgur/Documents/Repos/Apps/moltbot/moltbot/src/agents/system-prompt.ts:12:0-12:53) workspace access modes

## Testing

- [x] All existing tests pass
- [x] New test cases added for rw/ro access modes  
- [x] Lint passes
- [x] Build passes

## AI-Assisted

- [x] This PR was AI-assisted
- [x] Lightly tested (unit tests only)
- [x] I understand what the code does

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates `buildEmbeddedSandboxInfo` to populate `agentWorkspaceMount` for `workspaceAccess: "rw"` using the sandbox’s `containerWorkdir`, so system prompts reference the container-mounted workspace path (e.g. `/workspace`) instead of host paths. It also adds unit coverage for `rw`/`ro` access modes, and includes small doc/changelog updates.

In the codebase, `EmbeddedSandboxInfo` is used to shape what the agent sees in the system prompt about its execution sandbox; this change ensures the prompt reflects the actual filesystem mount point when the agent has read/write workspace access inside the container.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge and addresses the reported sandbox path issue with minimal surface area.
- The change is localized to sandbox prompt info construction and is backed by new unit tests. Remaining risk is mostly around assumptions that `containerWorkdir` is always set for `rw`, and that tests don’t fully assert the originally reported host-vs-container path mismatch scenario.
- src/agents/pi-embedded-runner/sandbox-info.ts; src/agents/pi-embedded-runner.buildembeddedsandboxinfo.test.ts

<!-- greptile_other_comments_section -->

<sub>(5/5) You can turn off certain types of comments like style [here](https://app.greptile.com/review/github)!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>3 files reviewed, 3 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (2)</summary>

**`src/agents/pi-embedded-runner.buildembeddedsandboxinfo.test.ts`**
[P2] New tests don’t cover the real failing case (cron isolated agent showing host path).

Both added cases hardcode `containerWorkdir: "/workspace"` and only assert it’s copied into `agentWorkspaceMount`. The regression described in the PR sounds like the system prompt was using the *host* workspace path; it would be useful to add a test where `workspaceDir`/`agentWorkspaceDir` are host paths while `containerWorkdir` differs, and assert that `agentWorkspaceMount` uses the container path for `rw` (and `/agent` for `ro`). That would catch a future change that accidentally reverts to host paths.


<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/agents/pi-embedded-runner.buildembeddedsandboxinfo.test.ts
Line: 146:181

Comment:
[P2] New tests don’t cover the real failing case (cron isolated agent showing host path).

Both added cases hardcode `containerWorkdir: "/workspace"` and only assert it’s copied into `agentWorkspaceMount`. The regression described in the PR sounds like the system prompt was using the *host* workspace path; it would be useful to add a test where `workspaceDir`/`agentWorkspaceDir` are host paths while `containerWorkdir` differs, and assert that `agentWorkspaceMount` uses the container path for `rw` (and `/agent` for `ro`). That would catch a future change that accidentally reverts to host paths.


How can I resolve this? If you propose a fix, please make it concise.
`````
</details>

---

**`docs/start/onboarding.md`**
[P3] This doc tweak changes the heading numbering but doesn’t mention the new “security notice” page in the “Page order (current)” list above unless the list was also updated.

Double-check that the numbered “Page order (current)” section matches the later headings after renumbering (it looks aligned in this diff, but this file is easy to get out of sync if one is edited without the other).

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: docs/start/onboarding.md
Line: 24:26

Comment:
[P3] This doc tweak changes the heading numbering but doesn’t mention the new “security notice” page in the “Page order (current)” list above unless the list was also updated.

Double-check that the numbered “Page order (current)” section matches the later headings after renumbering (it looks aligned in this diff, but this file is easy to get out of sync if one is edited without the other).

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** medium (90+, 7-, 4 files)
- **Age:** 4 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #4171
