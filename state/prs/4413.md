---
number: 4413
title: "fix: use null check for thread IDs in queue drain (Slack thread_ts)"
author: spiceoogway
created: 2026-01-30T05:59:33Z
updated: 2026-01-30T06:19:55Z
labels: ["cli", "commands"]
additions: 204
deletions: 12
changed_files: 4
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4413
fixes_issues: [4380]
related_prs: [4380]
duplicate_of: null
---

## Description

## Summary

Slack `thread_ts` values are always strings (e.g. `"1769742846.264069"`), but the queue drain code used `typeof === "number"` to check for thread IDs. This caused all three checks to fail for Slack, resulting in queued/collected replies posting as new top-level messages instead of threading correctly.

## Changes

In `src/auto-reply/reply/queue/drain.ts`, replaced three `typeof === "number"` checks with `!= null`:

1. **Cross-channel detection** — `typeof threadId !== "number"` → `threadId == null`
2. **Thread key routing** — `typeof threadId === "number"` → `threadId != null`
3. **Collected batch threadId** — `typeof i.originatingThreadId === "number"` → `i.originatingThreadId != null`

This handles both string thread IDs (Slack) and numeric ones (if any platform uses them).

## Testing

All 6 existing tests in `queue.collect-routing.test.ts` pass.

Fixes #4380

## Reviews


## Comments


## Stats

- **Size:** large (204+, 12-, 4 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #4380
