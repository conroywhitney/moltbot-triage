---
number: 5237
title: "fix(tui): truncate long media paths to prevent render crash"
author: hclsys
created: 2026-01-31T07:18:32Z
updated: 2026-01-31T15:17:27Z
labels: []
additions: 64
deletions: 3
changed_files: 1
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"hclsys","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/5237
fixes_issues: [4818]
related_prs: [4818]
duplicate_of: null
---

## Description

## Summary
- Add `truncatePath()` helper that preserves filename (supports both `/` and `\`)
- Limit media note lines to 80 characters (safe for all standard terminals)
- Truncation priority: keep full path â†’ truncate/omit URL â†’ truncate path
- Handle edge cases: very small available space, Windows paths, abnormally long type

Fixes #4818

## Test plan
- [ ] Type check passes
- [ ] Format check passes
- [ ] Codex code review: OK
- [ ] Manual test: TUI renders long audio paths without crash

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

Added path truncation to prevent TUI render crashes from long media file paths. The implementation preserves filenames when truncating and handles edge cases for small terminal widths.

**Key changes:**
- Added `MAX_LINE_WIDTH = 80` constant for terminal compatibility
- Implemented `truncatePath()` helper that preserves filenames during truncation
- Added multi-strategy truncation: full path â†’ truncate URL â†’ truncate path
- Handles edge cases like very small available space and abnormally long type strings

**Issues found:**
- Path separator mixing: `truncatePath()` always uses `/` in truncated output, even for Windows paths with `\`
- No test coverage for the new truncation logic (long paths, Windows paths, edge cases)

<h3>Confidence Score: 4/5</h3>

- safe to merge after fixing Windows path separator issue
- the truncation logic correctly prevents TUI crashes and handles edge cases well, but the hardcoded forward slash in line 24 will produce malformed paths on Windows (mixing `\` and `/` separators)
- src/auto-reply/media-note.ts line 24 needs separator fix

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-01-31)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @hclsys â€” COMMENTED (2026-01-31)




## Comments

### @sfo2001 (2026-01-31)

LGTM! Clean fix for TUI crash on long paths.

- Truncation logic is solid with good edge case handling
- Windows separator issue addressed in second commit
- Priority order (path --> URL --> truncate) makes sense

One minor note: consider adding a test for the truncatePath helper (long paths, Windows paths, edge cases) in a follow-up.


## Stats

- **Size:** medium (64+, 3-, 1 files)
- **Age:** 2 days
- **Last activity:** 2026-01-31

## Links

- Fixes: #4818
