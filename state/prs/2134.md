---
number: 2134
title: "fix: enable iOS chat messaging via node role"
author: abdaraxus
created: 2026-01-26T08:10:39Z
updated: 2026-02-03T04:51:36Z
labels: ["app: ios", "gateway"]
additions: 117
deletions: 13
changed_files: 8
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/2134
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

iOS app messaging section was spinning indefinitely when trying to access chat history.

## Root Cause

iOS devices connect with `node` role, but chat methods (`chat.history`, `chat.send`, `chat.abort`, `sessions.list`) were only accessible to `operator` role.

The gateway was returning `unauthorized role: node` errors, causing the iOS app to hang waiting for responses.

## Solution

This PR includes two fixes:

1. **Gateway**: Expanded `NODE_ROLE_METHODS` to include chat-related methods
2. **iOS**: Route chat requests through operator session when available

## Testing

- ✅ iOS messaging section loads without spinning
- ✅ Chat history accessible from iOS devices
- ✅ Maintains security boundaries for other node operations

Fixes the issue where iOS devices couldn't access messaging functionality due to role restrictions.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR addresses iOS chat UI hangs caused by role-based RPC restrictions by (1) allowing additional chat/session RPC methods for the `node` role at the gateway and (2) adding an iOS-side operator-session connection and routing chat UI/voice components through that operator session (with chat subscription disabled where unsupported).

The iOS app’s `NodeAppModel` now maintains two `GatewayNodeSession` connections (node + operator) and surfaces separate status text for each; `RootCanvas` routes the Chat sheet through the operator session, and `IOSGatewayChatTransport`/`TalkModeManager` gain a `supportsChatSubscribe` flag to avoid calling `chat.subscribe` where it isn’t supported.

Main risk is security/role-boundary expansion at the gateway: broadening `NODE_ROLE_METHODS` to include chat/session methods makes them accessible to any node-authenticated client, not just iOS UI clients.

<h3>Confidence Score: 2/5</h3>

- This PR is not safe to merge as-is due to a likely role-boundary/security regression in the gateway method allowlist.
- While the iOS-side changes are relatively contained, the gateway change expands the generic `node` role to include chat history/send/abort and session listing, which can materially weaken the intended trust separation between node and operator. There are also consistency issues in iOS connection state modeling with two concurrent sessions updating shared UI fields.
- src/gateway/server-methods.ts, apps/ios/Sources/Model/NodeAppModel.swift

<!-- greptile_other_comments_section -->

<sub>(4/5) You can add custom instructions or style guidelines for the agent [here](https://app.greptile.com/review/github)!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>2 files reviewed, 3 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** medium (117+, 13-, 8 files)
- **Age:** 7 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
