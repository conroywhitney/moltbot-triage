---
number: 2416
title: "chore: add detect-secrets baseline and loc check"
author: zeroslashagency
created: 2026-01-26T22:26:06Z
updated: 2026-02-03T03:58:13Z
labels: ["scripts"]
additions: 316
deletions: 67
changed_files: 4
size: large
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 2
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/2416
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
- add detect-secrets baseline for current repo state
- run pnpm check:loc in CI checks matrix

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds a `detect-secrets` baseline for the current repository state, and introduces a new CI matrix task (`pnpm check:loc`) to enforce a TypeScript max-lines-per-file check. It also relaxes the default LOC threshold in `package.json` (500 → 3000) and updates the LOC checker script to support `--exclude` regex patterns.

Overall these changes fit as CI hygiene and repo maintenance guardrails: the baseline enables repeatable secret scanning in CI, while `check:loc` adds a lightweight maintainability gate for TS/TSX files.

<h3>Confidence Score: 4/5</h3>

- This PR is generally safe to merge with low risk; changes are mostly CI/config updates.
- Most changes are additive (new CI task, secret-scanning baseline) and the LOC checker script change is small and straightforward. The main concern is around the default exclusion regex possibly missing intended folders, which could lead to noisy CI failures rather than runtime bugs.
- scripts/check-ts-max-loc.ts and .github/workflows/ci.yml

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>2 files reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @greptile-apps — COMMENTED (2026-02-03)

<sub>2 files reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`.github/workflows/ci.yml`**
[P3] `NODE_OPTIONS` only applied to macOS checks, not the full checks matrix

This sets `NODE_OPTIONS: --max-old-space-size=4096` only for the `checks-macos` job (`Run ${{ matrix.task }}` step). If the goal is to prevent OOMs for `check-loc` (or other Node tasks) generally, the main `checks` job (Ubuntu) and potentially `install-check` won’t get it. Conversely, if the intent was *only* to bump memory for macOS, it might be worth a quick comment in the workflow to avoid confusion.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: .github/workflows/ci.yml
Line: 348:350

Comment:
[P3] `NODE_OPTIONS` only applied to macOS checks, not the full checks matrix

This sets `NODE_OPTIONS: --max-old-space-size=4096` only for the `checks-macos` job (`Run ${{ matrix.task }}` step). If the goal is to prevent OOMs for `check-loc` (or other Node tasks) generally, the main `checks` job (Ubuntu) and potentially `install-check` won’t get it. Conversely, if the intent was *only* to bump memory for macOS, it might be worth a quick comment in the workflow to avoid confusion.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`.github/workflows/ci.yml`**
[P3] `NODE_OPTIONS` env only added to macOS checks

The new `NODE_OPTIONS: --max-old-space-size=4096` is set for `checks-macos` only (`.github/workflows/ci.yml:348-350`). If the intent was to prevent OOMs for `pnpm check:loc`, it might be worth applying consistently to the main `checks` job as well (since that’s where `check-loc` is added) or documenting why only macOS needs it.

<sub>Note: If this suggestion doesn't match your team's coding style, reply to this and let me know. I'll remember it for next time!</sub>

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: .github/workflows/ci.yml
Line: 342:350

Comment:
[P3] `NODE_OPTIONS` env only added to macOS checks

The new `NODE_OPTIONS: --max-old-space-size=4096` is set for `checks-macos` only (`.github/workflows/ci.yml:348-350`). If the intent was to prevent OOMs for `pnpm check:loc`, it might be worth applying consistently to the main `checks` job as well (since that’s where `check-loc` is added) or documenting why only macOS needs it.

<sub>Note: If this suggestion doesn't match your team's coding style, reply to this and let me know. I'll remember it for next time!</sub>

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** large (316+, 67-, 4 files)
- **Age:** 7 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
