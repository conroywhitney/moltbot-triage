---
number: 3744
title: "Gateway: fix device pairing when local connection retries with existing non-silent pending request"
author: photon3710
created: 2026-01-29T03:52:39Z
updated: 2026-02-03T03:52:59Z
labels: ["docs", "docker"]
additions: 74
deletions: 13
changed_files: 5
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3744
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
Fixes a bug where the Control UI dashboard fails to connect with "pairing required" error when a browser reconnects after a failed pairing attempt.

## Problem
When a browser connects to the dashboard (e.g., `http://127.0.0.1:18789/?token=...`), if there's already a pending pairing request with `silent: false` from a previous connection attempt, subsequent local connection retries would fail because:

1. `requestDevicePairing()` returns the existing pending request unchanged
2. The request remains `silent: false`, preventing auto-approval
3. Gateway rejects the connection with "pairing required" before showing the pairing code

This commonly occurs in Docker setups where the initial connection may not be detected as local due to Docker bridge network addressing.

## Solution
Update `requestDevicePairing()` to upgrade existing pending requests to `silent: true` when a new local connection retries. This allows auto-approval to proceed even if the original request was non-silent.

## Changes
- **Core Fix**: `src/infra/device-pairing.ts` - Check if new request is `silent: true` and update existing pending request
- **Test**: `src/infra/device-pairing.test.ts` - Add test case for silent flag upgrade behavior  
- **Docs**: `docs/gateway/pairing.md` - Document the silent flag upgrade behavior
- **Docs**: `docs/install/docker.md` - Add Docker configuration guidance for Control UI access
- **Changelog**: Add entry for the fix

## Testing
- ✅ Added unit test verifying silent flag upgrade
- ✅ Tested with Docker setup: `docker compose run --rm moltbot-cli dashboard`
- ✅ Verified dashboard connects successfully after clearing pairing state
- ✅ Linter passes

## AI-Assisted
- [x] Built with Claude (Cursor IDE)
- [x] Fully tested with Docker environment
- [x] Code review performed, root cause analysis confirmed

## Related
Addresses the "pairing required" error commonly seen in Docker deployments when accessing the Control UI dashboard.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR fixes a gateway pairing edge case by upgrading an existing pending pairing request to `silent: true` when a retry comes from a local connection, enabling auto-approval to proceed. It adds a unit test covering the silent-flag upgrade path and updates Docker install docs / compose defaults to help users avoid “pairing required” issues in common Docker bridge setups.

<h3>Confidence Score: 2/5</h3>

- Not safe to merge as-is due to likely broken Docker quick-start configuration from env var renames.
- The core pairing change is small and covered by a targeted test, but the Docker Compose changes appear inconsistent with the existing `docker-setup.sh`/docs environment variable contract (CLAWDBOT_* vs MOLTBOT_*), which can break the documented onboarding flow and lead to missing tokens or invalid mounts.
- docker-compose.yml, docs/install/docker.md, docker-setup.sh (not in PR but impacted)

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>1 file reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** medium (74+, 13-, 5 files)
- **Age:** 4 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
