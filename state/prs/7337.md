---
number: 7337
title: "fix(docker): ensure macOS compatibility in docker-setup.sh"
author: esc-ouni
created: 2026-02-02T18:20:50Z
updated: 2026-02-02T18:22:04Z
labels: ["docker"]
additions: 7
deletions: 5
changed_files: 1
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7337
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

- Replace `declare -A` associative arrays with portable string matching to support Bash 3.2 (macOS default).
- Initialize variables to prevent "unbound variable" errors under `set -u`.
- Ensure robust .env generation across BSD and Linux environments.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates `docker-setup.sh` to be macOS/Bash 3.2 compatible by removing the associative-array `seen` map used during `.env` upsert, and replacing it with a string-based “seen” tracker. The script also keeps `set -euo pipefail` behavior while generating compose override mounts and writing a normalized `.env`.

Main concern: the new implementation uses `eval` to indirectly reference variables when writing key/value pairs, which introduces a command-injection risk if the list of keys ever becomes user-controlled in the future (even accidentally).

<h3>Confidence Score: 3/5</h3>

- Mostly safe, but the new `eval` usage is a notable footgun to address before merging.
- The change is small and targeted (Bash 3.2 compatibility), but the introduction of `eval` creates an avoidable command-execution hazard if the key list ever becomes influenced by external input; removing `eval` would make this solid.
- docker-setup.sh (upsert_env)

<!-- greptile_other_comments_section -->

<sub>(4/5) You can add custom instructions or style guidelines for the agent [here](https://app.greptile.com/review/github)!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** small (7+, 5-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
