---
number: 6089
title: "fix(slack): add reactionNotifications config check to reactions handler"
author: jontsai
created: 2026-02-01T08:23:35Z
updated: 2026-02-01T08:30:21Z
labels: ["channel: slack"]
additions: 25
deletions: 0
changed_files: 1
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 2
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6089
fixes_issues: []
related_prs: [2638]
duplicate_of: null
---

## Description

## Problem

The Slack reactions handler (`src/slack/monitor/events/reactions.ts`) processes all reactions unconditionally, ignoring the `reactionNotifications` config setting. Even with `channels.slack.reactionNotifications: "own"` configured, reaction events are not filtered appropriately.

## Root Cause

Unlike Telegram's implementation (`src/telegram/bot.ts:379-382`), the Slack handler doesn't check `ctx.reactionMode` before processing reactions.

**Telegram (working):**
```typescript
const reactionMode = telegramCfg.reactionNotifications ?? "own";
if (reactionMode === "off") return;
if (user?.is_bot) return;
if (reactionMode === "own" && !wasSentByBot(chatId, messageId)) return;
```

**Slack (before this fix):**
```typescript
const handleReactionEvent = async (event: SlackReactionEvent, action: string) => {
  // ... just processes everything without checking reactionMode
```

## Solution

Added `reactionNotifications` config filtering at the start of `handleReactionEvent`:

- Check `reactionMode` config (off/own/all/allowlist)
- Skip bot's own reactions (consistent with other providers)
- For `own` mode, only process reactions on messages sent by the bot
- For `allowlist` mode, only process reactions from allowlisted users

## Testing

- [x] Verified `ctx.reactionMode`, `ctx.reactionAllowlist`, and `ctx.botUserId` are available on `SlackMonitorContext`
- [x] TypeScript compiles without errors (`npx tsc --noEmit`)
- [x] Lint passes for changed file (`pnpm lint -- src/slack/monitor/events/reactions.ts`)
- [ ] Runtime testing pending (would appreciate maintainer testing on live Slack instance)

Supersedes #2638

---

## AI Disclosure ðŸ¤–

- [x] **AI-assisted:** This PR was developed with Claude (via OpenClaw)
- [x] **Testing level:** Lightly tested (type-check + lint; no live Slack testing)
- [x] **I understand what this code does:** Yes - adds early-return guards matching Telegram's reaction filtering pattern

**Context:** Discovered this gap while configuring my own OpenClaw Slack integration. The fix mirrors the existing Telegram implementation pattern.

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-01)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @jontsai (2026-02-01)

Thanks @greptileai for the review! 

Pushed a fix for the edge case you identified: `daec1623e` adds a guard so that if `botUserId` is unavailable, the "own" mode check falls back to processing all reactions rather than dropping them.

The logic is now:
```typescript
if (reactionMode === "own" && ctx.botUserId && event.item_user !== ctx.botUserId) {
  return;  // Only skip if we KNOW the bot ID and it doesn't match
}
```

### @greptile-apps (2026-02-01)

Perfect! The fix correctly adds the `ctx.botUserId` guard as discussed. The fallback behavior (processing all reactions when bot identity is unknown) is the right approach - it's better to be permissive than to silently drop reactions.

This handles the edge case nicely and maintains the expected behavior. The implementation now safely handles the scenario where the bot's user ID might not be available during initialization or connection issues.


## Stats

- **Size:** small (25+, 0-, 1 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: (none detected)
