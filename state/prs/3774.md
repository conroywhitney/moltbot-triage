---
number: 3774
title: "fix(voice-call): include intro message in AI context for outbound calls"
author: hclsys
created: 2026-01-29T05:17:34Z
updated: 2026-01-30T03:19:18Z
labels: ["channel: voice-call"]
additions: 24
deletions: 3
changed_files: 3
size: small
review_decision: none
reviews: []
comments_count: 2
reactions_total: 0
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3774
fixes_issues: [3256]
related_prs: [3256]
duplicate_of: null
---

## Description

## Summary
- Fixes #3256
- When initiating an outbound call with an intro message, the AI now receives this as explicit context in its system prompt
- Previously the intro was played via TTS but the AI didn't understand the call's objective

## Changes
- `manager.ts`: Store `callPurpose` in metadata at call creation time (not later in `speakInitialMessage` to avoid race conditions)
- `response-generator.ts`: Accept `callPurpose` param and include in system prompt as "Purpose of this call"
- `webhook.ts`: Pass `callPurpose` to `generateVoiceResponse`

## Example
Before: AI hears "She is fine, thanks" and responds with generic "How are you?"
After: AI knows the call purpose was "ask about mother" and responds appropriately

## Test plan
- [ ] Initiate outbound call with `message` parameter
- [ ] Verify AI responses stay focused on the stated purpose
- [ ] Verify inbound calls are not affected (no `callPurpose` set)

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments

### @hclsys (2026-01-29)

## CI Failure Analysis

**Failed job:** `checks-windows (node, test, pnpm canvas:a2ui:bundle && pnpm test)`
**Failed test:** `src/canvas-host/server.test.ts > serves the gateway-hosted A2UI scaffold`
**Error:** `expected 503 to be 200`

### Verdict: ‚ùå Unrelated to this PR

This PR only modifies `extensions/voice-call/` files:
- `manager.ts` - Added callPurpose to metadata
- `response-generator.ts` - Inject callPurpose into system prompt  
- `webhook.ts` - Pass callPurpose to generateVoiceResponse

The failing test is in `src/canvas-host/` which has **zero dependency** on the voice-call extension.

The 503 error (Service Unavailable) indicates the A2UI bundle service wasn't ready during the test - this is a timing/environment issue on the Windows CI runner, not a code regression.

**Request:** Please re-run CI or merge if this is a known flaky test.

---
*Analysis by Claude Code*

### @hclsys (2026-01-29)

CI still failing on the same flaky test (`canvas-host/server.test.ts` ‚Üí 503).

This is unrelated to my voice-call changes. Could a maintainer please re-run CI or merge if acceptable? üôè

Thanks!


## Stats

- **Size:** small (24+, 3-, 3 files)
- **Age:** 1 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #3256
