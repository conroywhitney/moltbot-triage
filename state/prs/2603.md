---
number: 2603
title: "Fix: Enable unlimited WhatsApp Web auto-reconnect by default"
author: Blindripper
created: 2026-01-27T06:05:15Z
updated: 2026-01-28T23:25:11Z
labels: ["channel: whatsapp-web"]
additions: 42
deletions: 4
changed_files: 1
size: small
review_decision: none
reviews: []
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/2603
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

After WhatsApp Web disconnects (status codes 428, 503, 408), Clawdbot does not automatically reconnect. The gateway shows "OK" status after manual `clawdbot channels login`, but the internal listener is not running. A gateway restart is required to restore functionality.

### Current Behavior
- Default reconnect policy has `maxAttempts: 12`
- After 12 failed reconnect attempts, the monitoring loop exits permanently
- Status shows as stopped/disconnected
- Requires manual gateway restart to restore service
- Manual login via `clawdbot channels login` doesn't restart the monitoring loop

### Expected Behavior
Clawdbot should automatically reconnect WhatsApp Web after disconnects without requiring manual intervention or gateway restart.

## Root Cause

The reconnect loop in `src/web/auto-reply/monitor.ts` has a hard limit on reconnect attempts:

```typescript
if (reconnectPolicy.maxAttempts > 0 && reconnectAttempts >= reconnectPolicy.maxAttempts) {
  // Break out of monitoring loop permanently
  break;
}
```

When this limit is reached after temporary network issues or WhatsApp API errors, the monitoring loop exits completely and never restarts, even though the underlying issue may be transient.

## Solution

Changed the default `maxAttempts` from **12 to 0 (unlimited)** in `src/web/reconnect.ts`:

```typescript
export const DEFAULT_RECONNECT_POLICY: ReconnectPolicy = {
  initialMs: 2_000,
  maxMs: 30_000,
  factor: 1.8,
  jitter: 0.25,
  maxAttempts: 0, // unlimited - never give up on reconnecting
};
```

### Why This Is Safe

1. **Exponential backoff is capped**: The backoff delay is already capped at `maxMs: 30_000` (30 seconds), preventing excessive connection attempts
2. **Jitter prevents thundering herd**: 25% jitter randomization prevents synchronized reconnect storms
3. **Reset on success**: Reconnect attempts counter resets to 0 after a successful connection lasting longer than the heartbeat interval (60 seconds)
4. **Logout detection**: The loop still breaks immediately on proper logout (401/403 auth errors)
5. **User override available**: Users can still set `web.reconnect.maxAttempts > 0` in their config for the old behavior

### Impact

- ✅ Automatic recovery from temporary network issues
- ✅ Automatic recovery from WhatsApp API temporary errors (428, 503, 408)
- ✅ No manual intervention required for transient disconnects
- ✅ No breaking changes - existing configs with explicit `maxAttempts` are respected
- ✅ Graceful handling of permanent failures (logged out) - still breaks immediately

## Testing

Existing test "stops after hitting max reconnect attempts" continues to work because it explicitly overrides the reconnect policy with `maxAttempts: 2` in its test configuration.

## Related Issues

Fixes the WhatsApp Web auto-reconnect bug where the gateway becomes unresponsive after multiple disconnects.

---

**Note**: This change aligns WhatsApp reconnect behavior with other long-running services that should maintain availability through transient failures.

## Reviews


## Comments

### @Blindripper (2026-01-27)

## Updated Implementation

I've updated this PR with a more robust fix. Instead of changing the default `maxAttempts` to unlimited (which could cause issues with genuinely dead connections), this implementation adds a **recovery mode**.

### What Changed

When max reconnect attempts is reached, instead of stopping completely, the monitor now:

1. Enters "recovery mode" 
2. Checks every 30 seconds if valid auth credentials exist
3. When auth is detected (e.g., after `clawdbot channels login`), automatically resumes monitoring

This approach:
- Keeps the default 12 max attempts (prevents infinite loops on dead connections)
- Enables self-healing after manual re-authentication
- No gateway restart required

### Testing the Fix

1. Start gateway with WhatsApp connected
2. Wait for disconnect + max attempts reached
3. Run `clawdbot channels login` 
4. Gateway auto-resumes within 30 seconds ✅


## Stats

- **Size:** small (42+, 4-, 1 files)
- **Age:** 2 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
