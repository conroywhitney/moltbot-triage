---
number: 6094
title: "auto-reply: ignore HTML comments in heartbeat check"
author: rudrapanchal81
created: 2026-02-01T08:30:03Z
updated: 2026-02-01T17:38:20Z
labels: []
additions: 62
deletions: 1
changed_files: 2
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6094
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

- strip single-line and multi-line HTML comments before testing heartbeat content
- preserve state across lines so trailing comments don’t trigger false positives
- add unit coverage for comment-only files and mixed comment/task scenarios

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates `isHeartbeatContentEffectivelyEmpty` to strip HTML comments (`<!-- ... -->`) before evaluating whether HEARTBEAT.md contains actionable content, including support for multi-line comments by tracking “in comment” state across lines. It also adds unit tests covering comment-only files, mixed comment/task content, and multi-line HTML comment blocks.

The change fits into the auto-reply heartbeat flow by reducing false positives when HEARTBEAT.md contains only HTML comments (or comments around tasks), so the heartbeat check more accurately decides when there is meaningful work to do.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge; changes are small, localized, and covered by new unit tests.
- The logic change is confined to comment-stripping within `isHeartbeatContentEffectivelyEmpty` and is exercised by added tests for single-line and multi-line HTML comments plus mixed content. Main remaining risk is semantic: stripping `<!-- -->` sequences could remove intended literal content if users include them in tasks, so clarifying intended behavior with an additional test would improve confidence.
- src/auto-reply/heartbeat.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-01)

<sub>1 file reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** medium (62+, 1-, 2 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: (none detected)
