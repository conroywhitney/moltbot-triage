---
number: 2556
title: "fix(plugin-install): handle existing plugins and filter workspace deps"
author: longmaba
created: 2026-01-27T03:43:16Z
updated: 2026-01-28T23:25:11Z
labels: ["commands"]
additions: 56
deletions: 1
changed_files: 3
size: medium
review_decision: none
reviews: [{"author":"hoangnb24","state":"APPROVED"}]
comments_count: 2
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/2556
fixes_issues: []
related_prs: [1839]
duplicate_of: null
---

## Description

Fix for #1839

fix(plugin-install): handle existing plugins and filter workspace deps

Description: This PR addresses two issues encountered during plugin installation and onboarding:

1. Existing Plugin Detection:
   
   - Problem: Onboarding would attempt to re-install plugins even if they were already present in the workspace or config, leading to ID conflicts.
   - Fix: Added findExistingPluginOrigin in src/commands/onboarding/plugin-install.ts to check if a plugin exists (in config, workspace, global, or bundled) before attempting installation. If found (and not a bundled plugin requiring a local copy), it simply enables the existing plugin.

2. Workspace Protocol Support:
   
   - Problem: Installing plugins that depend on workspace:* versions (like clawdbot ) failed with EUNSUPPORTEDPROTOCOL when installed via npm in a standalone environment.
   - Fix: Modified src/plugins/install.ts to filter out workspace:* dependencies from the temporary package.json before running npm install . The runtime relies on the clawdbot/plugin-sdk alias, so the direct workspace dependency is not needed for the installed artifact.

Verification:

- Verified that onboarding correctly identifies existing plugins (e.g., Zalo) and skips unnecessary installation.
- Verified that npm install succeeds for plugins with workspace:* dependencies by stripping them from the manifest.
- Ran pnpm test to ensure no regressions.

## Reviews

### @hoangnb24 ‚Äî APPROVED (2026-01-28)




## Comments

### @eciuca (2026-01-27)

Please merge this üòÅ

### @hoangnb24 (2026-01-28)

+1


## Stats

- **Size:** medium (56+, 1-, 3 files)
- **Age:** 2 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
