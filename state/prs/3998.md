---
number: 3998
title: "Connect message_sending and message_sent hooks to outbound pipeline"
author: TechWizard9999
created: 2026-01-29T13:59:45Z
updated: 2026-01-29T14:00:50Z
labels: []
additions: 256
deletions: 0
changed_files: 2
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3998
fixes_issues: []
related_prs: [3945]
duplicate_of: null
---

## Description

Closes **#3945**

## Summary
Connects the `message_sending` and `message_sent` hooks to the outbound message delivery pipeline in `src/infra/outbound/deliver.ts`.

## Changes
- **src/infra/outbound/deliver.ts**:
  - Added `message_sending` hook call before delivery loop.
  - Implemented logic to allow hook to modify content or cancel delivery.
  - Added `message_sent` hook call in `finally` block to track delivery status.
- **src/infra/outbound/deliver.hooks.test.ts**:
  - Added comprehensive test suite verifying hook behavior.

## Verification
- Added new unit tests pass: `src/infra/outbound/deliver.hooks.test.ts`
- Verified no regressions in existing delivery tests: `src/infra/outbound/deliver.test.ts`

Used AI Assistance (Gemini Flash)

## Reviews


## Comments


## Stats

- **Size:** large (256+, 0-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
