---
number: 7307
title: "Better cron tools: avoid invalid timestamp from the past"
author: LeightonWang
created: 2026-02-02T17:27:49Z
updated: 2026-02-02T17:51:03Z
labels: ["agents"]
additions: 104
deletions: 8
changed_files: 2
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"LeightonWang","state":"COMMENTED"},{"author":"LeightonWang","state":"COMMENTED"}]
comments_count: 0
reactions_total: 2
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7307
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

# What's New
- Enhanced `createCronTool` description with clear guidance on how to properly set `atMs` (use a time tool first, calculate based on current time, avoid hardcode).
- Added validation to reject past timestamps for `schedule.kind="at"` in `cron.add` action.
- Updated test suite to use future timestamps and added tests for timestamp validation.

This might make the tool **more robust for models with limited capabilities**.

# Motivation
I was trying to set a reminder but nothing happened when the time came. The reason is that the LLM I was using called the tool with a wrong timestamp. The responding tool call:
```json
"content":[{"type":"text","text":"{\n \"id\":\"fd2ec891-dd86-41d3-82db-ecede678d803\", \n \"agentId\": \"main\", In \"name\": \"~Y~K~0~P0~F~R\", \n \"createdAtMs\": 1770021056903, \n \"updatedAtMs\": 17770021056903,\n \"schedule\":{\n\"kind\":\"at\",\n\"atMs\":1706929800e0e\n }, \n \"sessionTarget\": \"main\", \n \"wakeMode\": \"next-heartbeat\",\n \"payload\": {\n\"kind\": \"systemEvent\",\n\"text\":"(Some text here)\"\n }, \n n \"state\": {}\n}"}]
```

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR improves the `cron` agent tool’s ergonomics and reliability for one-shot schedules:

- Expands `createCronTool`’s inline schema docs to explicitly instruct models to compute `schedule.atMs` from the current time (and avoid hardcoded/guessed timestamps).
- Adds runtime validation in the `cron.add` path to reject `schedule.kind="at"` jobs where `atMs` is not in the future.
- Updates/extends the Vitest suite to use future timestamps and adds coverage for the new past-timestamp rejection.

Overall, the change fits the existing pattern of doing provider-friendly schema docs + runtime validation for tool inputs, and helps prevent “silent no-op” reminders caused by past timestamps.

<h3>Confidence Score: 4/5</h3>

- This PR is generally safe to merge and improves correctness for one-shot cron scheduling.
- The core behavior change is narrowly scoped (rejecting past `atMs`) and is covered by new unit tests; main residual concern is the new error-construction path calling `toISOString()` on potentially invalid `atMs` values, which can throw a different error than intended.
- src/agents/tools/cron-tool.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>2 files reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @LeightonWang — COMMENTED (2026-02-02)



### @LeightonWang — COMMENTED (2026-02-02)




## Comments


## Stats

- **Size:** medium (104+, 8-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
