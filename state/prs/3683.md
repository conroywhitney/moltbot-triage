---
number: 3683
title: "feat(infra): introduce global proxy configuration via undici"
author: xovoxy
created: 2026-01-29T01:48:19Z
updated: 2026-01-29T02:08:22Z
labels: ["cli"]
additions: 43
deletions: 0
changed_files: 2
size: small
review_decision: none
reviews: [{"author":"orzelig","state":"APPROVED"}]
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/3683
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
This PR introduces a centralized global proxy configuration for the CLI. It leverages `undici`'s `EnvHttpProxyAgent` to automatically respect standard environment variables (`HTTP_PROXY`, `HTTPS_PROXY`, `NO_PROXY`) across all outgoing requests.

## Context
Previously, network requests—especially those made by extensions or third-party integrations—could fail in environments requiring a proxy (e.g., corporate networks, VPNs, or local debugging setups). Some extensions handled this ad-hoc, while others ignored it entirely, leading to inconsistent connectivity.

This change ensures that **all** `fetch` requests and `undici` clients used throughout the application inherit the correct proxy settings from the environment immediately upon CLI startup.

## Technical Details
- **Infrastructure**: Added `src/infra/proxy.ts`, which initializes the `EnvHttpProxyAgent` and sets it as the global dispatcher.
- **Entry Point**: Updated `src/cli/run-main.ts` to invoke `configureGlobalProxy()` during the bootstrap phase, ensuring the environment is ready before any network calls occur.
- **Security**: The system logs when a proxy is detected/active but intentionally avoids logging the full proxy URL to prevent leaking credentials (e.g., `http://user:pass@host`).

## Verification
- **Manual Testing**:
  1. Set `HTTPS_PROXY=http://127.0.0.1:8888`.
  2. Executed CLI commands requiring network access (e.g., auth, plugin sync).
  3. Verified that traffic was correctly routed through the local proxy.
- **Regression**: Confirmed that the CLI functions normally (direct connection) when no proxy environment variables are set.

## Reviews

### @orzelig — APPROVED (2026-01-29)

Clean implementation of global proxy support! Using undici's EnvHttpProxyAgent is the right approach. Early initialization in the bootstrap ensures all network calls will respect proxy settings. LGTM!


## Comments


## Stats

- **Size:** small (43+, 0-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
