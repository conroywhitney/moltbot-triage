---
number: 5415
title: "fix: don't skip heartbeat for cron systemEvent jobs with empty HEARTB…"
author: betterthanhajin
created: 2026-01-31T13:16:53Z
updated: 2026-01-31T13:55:48Z
labels: []
additions: 7
deletions: 2
changed_files: 1
size: tiny
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/5415
fixes_issues: [5349]
related_prs: [5349]
duplicate_of: null
---

## Description

## Problem
Cron jobs with `kind: systemEvent` were not being processed when `HEARTBEAT.md` was empty.

The heartbeat runner skips execution when `HEARTBEAT.md` has no actionable content to save API costs. However, only `exec-event` was exempted from this optimization, while cron jobs with pending system events were incorrectly skipped.

This caused system events from cron to queue up indefinitely until a user message triggered processing.

## Solution
Add `isCronReason` check alongside `isExecEventReason` to prevent skipping heartbeat when cron jobs enqueue system events.

## Changes
- Added check for cron reasons (`opts.reason?.startsWith("cron:")`)
- Updated condition to not skip heartbeat for cron-triggered events

Fixes #5349

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the heartbeat “empty HEARTBEAT.md” optimization in `src/infra/heartbeat-runner.ts` so that the runner will not skip heartbeats when the wake reason indicates a cron-triggered run (`reason` starts with `cron:`), alongside the existing exception for `exec-event`. This aligns the skip logic with the fact that cron `systemEvent` jobs may have pending system events to process even when the heartbeat file itself is effectively empty, preventing cron-enqueued events from stalling until a user message arrives.

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- The change is small, localized, and consistent with existing reason-based exceptions, using a null-safe check for cron-prefixed reasons; it only broadens the set of reasons that bypass the empty-heartbeat skip, which matches the stated behavior for pending system events.
- No files require special attention

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-01-31)

<sub>No files reviewed, no comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @usama7871 (2026-01-31)

Approved.

The skip condition was too aggressive for cron-triggered heartbeats — good catch that pending systemEvents were being starved.

`isCronReason` addition + existing `isExecEventReason` makes the logic consistent now.

No regressions expected since it's only widening the bypass set.

Great minimal PR.


## Stats

- **Size:** tiny (7+, 2-, 1 files)
- **Age:** 2 days
- **Last activity:** 2026-01-31

## Links

- Fixes: #5349
