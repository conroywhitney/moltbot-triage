---
number: 3892
title: "feat(routing): add thread parent binding inheritance for Discord"
author: aerolalit
created: 2026-01-29T09:29:47Z
updated: 2026-01-30T17:10:56Z
labels: ["channel: discord"]
additions: 202
deletions: 23
changed_files: 3
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/3892
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

When a Discord thread message doesn't match a direct peer binding, this PR enables checking if the parent channel has a binding and uses that agent instead.

This enables multi-agent setups where threads inherit their parent channel's agent binding automatically.

## Problem

In multi-agent Discord setups, messages in threads were being routed to the default agent instead of the agent bound to the parent channel. For example:

- `#adecco-pr` channel is bound to `adecco` agent
- User creates a thread in `#adecco-pr`
- Messages in that thread were routed to `main` agent instead of `adecco`

## Solution

1. Add `parentPeer` parameter to `ResolveAgentRouteInput`
2. Add `binding.peer.parent` match type
3. In Discord message preflight, resolve thread parent early and pass to routing
4. If direct peer binding doesn't match, check parent peer binding before falling back to guild/team/account bindings

## Changes

- `src/routing/resolve-route.ts`: Add parentPeer parameter and binding.peer.parent matching
- `src/routing/resolve-route.test.ts`: Add comprehensive tests for parent binding inheritance
- `src/discord/monitor/message-handler.preflight.ts`: Resolve thread parent early and pass to routing

## Tests Added

- Thread inherits binding from parent channel when no direct match
- Direct peer binding wins over parent peer binding
- Parent peer binding wins over guild binding
- Falls back to guild binding when no parent peer match
- Handles empty/null parentPeer gracefully

## Breaking Changes

None. This is additive - existing bindings continue to work as before.

## Reviews


## Comments


## Stats

- **Size:** large (202+, 23-, 3 files)
- **Age:** 1 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
