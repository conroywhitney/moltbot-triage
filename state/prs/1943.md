---
number: 1943
title: "Add jan.ai provider documentation"
author: csa1234
created: 2026-01-25T20:22:49Z
updated: 2026-02-03T04:51:39Z
labels: ["docs"]
additions: 305
deletions: 8
changed_files: 7
size: large
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 2
reactions_total: 2
ci_status: failing
mergeable: false
draft: false
url: https://github.com/openclaw/openclaw/pull/1943
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

added jan.ai provider integration with auto-discovery

- Add jan.ai provider implementation with automatic model discovery
- Update documentation to include jan.ai setup and configuration
- Extend FAQ to mention jan.ai as supported self-hosted option
- Update tsconfig to include Node.js types for type safety

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds a new `jan` model provider with local auto-discovery (fetching `/v1/models` from a default local jan.ai base URL), plus documentation for setup/configuration and a FAQ update. It also tweaks CI/Vitest worker/timeouts and the parallel test runner to improve stability.

The new provider wiring follows the existing implicit-provider pattern (only enabled when auth is present), but there is a correctness issue in the env-key resolution path for `jan` that can cause the provider `apiKey` to be set incorrectly. Additionally, the test runner’s Node memory flag is currently passed in a way that likely has no effect.

<h3>Confidence Score: 3/5</h3>

- This PR is moderately safe to merge, but has a correctness issue in jan provider auth resolution that should be fixed first.
- Most changes are documentation and CI/test tuning, but the jan provider wiring likely assigns an identifier string instead of a resolved credential when using env-based configuration, which can break provider availability/discovery in normal usage. The test runner memory flag change also appears ineffective as implemented.
- src/agents/models-config.providers.ts, scripts/test-parallel.mjs

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>3 files reviewed, 3 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @greptile-apps — COMMENTED (2026-02-03)

<sub>2 files reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (3)</summary>

**`src/agents/models-config.providers.ts`**
[P0] jan.ai discovery uses `fetch` without sending an API key, but the docs say discovery requires `JAN_API_KEY`/auth profile.

`discoverJanModels()` always calls `http://127.0.0.1:1337/v1/models` with no `Authorization` header, so setting `JAN_API_KEY` (or an auth profile) won’t actually affect the discovery request if jan.ai is configured to require a key. If discovery truly needs a key, this will fail in practice despite docs claiming it works.

Also appears in `buildJanProvider()` usage in `resolveImplicitProviders()` which sets `apiKey` on the provider config but does not pass it to discovery (same file:491-497).

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/agents/models-config.providers.ts
Line: 154:162

Comment:
[P0] jan.ai discovery uses `fetch` without sending an API key, but the docs say discovery requires `JAN_API_KEY`/auth profile.

`discoverJanModels()` always calls `http://127.0.0.1:1337/v1/models` with no `Authorization` header, so setting `JAN_API_KEY` (or an auth profile) won’t actually affect the discovery request if jan.ai is configured to require a key. If discovery truly needs a key, this will fail in practice despite docs claiming it works.

Also appears in `buildJanProvider()` usage in `resolveImplicitProviders()` which sets `apiKey` on the provider config but does not pass it to discovery (same file:491-497).

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>

---

**`docs/providers/jan.md`**
[P1] Docs conflict with implementation: discovery is gated on presence of a key/profile.

This doc says jan.ai auto-discovery happens when you “opt in with `JAN_API_KEY` (or an auth profile)” and omit `models.providers.jan`, but in code `resolveImplicitProviders()` only adds the implicit `jan` provider if it finds an env var name/profile entry (and uses that as an apiKey placeholder). There’s no mention here that discovery won’t run at all unless a key/profile exists, even though jan.ai “doesn’t require a real key.” Consider clarifying the requirement as an opt-in toggle and whether jan.ai actually enforces auth on `/v1/models`.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: docs/providers/jan.md
Line: 9:12

Comment:
[P1] Docs conflict with implementation: discovery is gated on presence of a key/profile.

This doc says jan.ai auto-discovery happens when you “opt in with `JAN_API_KEY` (or an auth profile)” and omit `models.providers.jan`, but in code `resolveImplicitProviders()` only adds the implicit `jan` provider if it finds an env var name/profile entry (and uses that as an apiKey placeholder). There’s no mention here that discovery won’t run at all unless a key/profile exists, even though jan.ai “doesn’t require a real key.” Consider clarifying the requirement as an opt-in toggle and whether jan.ai actually enforces auth on `/v1/models`.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>

---

**`tsconfig.json`**
[P1] Adding `"types": ["node"]` can unintentionally drop other global `@types/*` from the compilation.

In TS, specifying `compilerOptions.types` opts out of automatic inclusion and limits ambient types to the listed packages. If this repo relies on other global types (e.g., `vitest/globals`, `vite/client`, etc.) elsewhere, this can introduce new type errors outside `src/**/*`. If the goal is just Node built-ins, `"lib"`/`"moduleResolution"`/`"types"` should be evaluated against existing tooling configs to avoid regressions.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: tsconfig.json
Line: 2:16

Comment:
[P1] Adding `"types": ["node"]` can unintentionally drop other global `@types/*` from the compilation.

In TS, specifying `compilerOptions.types` opts out of automatic inclusion and limits ambient types to the listed packages. If this repo relies on other global types (e.g., `vitest/globals`, `vite/client`, etc.) elsewhere, this can introduce new type errors outside `src/**/*`. If the goal is just Node built-ins, `"lib"`/`"moduleResolution"`/`"types"` should be evaluated against existing tooling configs to avoid regressions.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`scripts/test-parallel.mjs`**
[P1] `--max-old-space-size=4096` is a V8 flag and won’t be honored when passed as a plain CLI argument to `node` (it needs to be in `NODE_OPTIONS` or included in the `execArgv` for the spawned Node process). As-is, this likely provides no memory increase and won’t address OOM issues.

Consider moving this into `NODE_OPTIONS` for the workers (or wiring it into the spawn options as `execArgv`).

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: scripts/test-parallel.mjs
Line: 34:38

Comment:
[P1] `--max-old-space-size=4096` is a V8 flag and won’t be honored when passed as a plain CLI argument to `node` (it needs to be in `NODE_OPTIONS` or included in the `execArgv` for the spawned Node process). As-is, this likely provides no memory increase and won’t address OOM issues.

Consider moving this into `NODE_OPTIONS` for the workers (or wiring it into the spawn options as `execArgv`).

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** large (305+, 8-, 7 files)
- **Age:** 8 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
