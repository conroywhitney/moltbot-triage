---
number: 3845
title: "fix(skills): ignore Python venvs and caches in skills watcher"
author: kylehowells
created: 2026-01-29T07:35:47Z
updated: 2026-02-03T02:53:43Z
labels: ["agents"]
additions: 34
deletions: 1
changed_files: 2
size: small
review_decision: none
reviews: []
comments_count: 2
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3845
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Adds Python virtual environment directories and cache folders to the default ignore list for the skills file watcher.

## Problem

I added a skill that used a Python tool, which created a `scripts/.venv` folder containing ~42,000 files. The skills watcher was monitoring all these files, causing file descriptor exhaustion on macOS. This resulted in `EBADF` (spawn) errors that caused **all** exec/shell commands to fail across Moltbot.

## Solution

Added the following patterns to `DEFAULT_SKILLS_WATCH_IGNORED`:

**Python virtual environments and caches:**
- `.venv` / `venv` - Virtual environment directories
- `__pycache__` - Python bytecode cache
- `.mypy_cache` - mypy type checker cache
- `.pytest_cache` - pytest cache

**Build artifacts and caches:**
- `build` - Common build output directory
- `.cache` - Generic cache directory

## Test plan

- [x] Updated existing test to verify all new patterns are correctly ignored
- [x] Verified normal skill files (e.g., `SKILL.md`) are NOT ignored
- [x] Tested locally - confirmed EBADF errors resolved after removing heavy venv from skills folder

## AI Assistance

ðŸ¤– Generated with [Claude Code](https://claude.ai/code) (Claude Opus 4.5)

- **Testing level:** Fully tested locally
- **Human review:** Code reviewed and understood

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR expands the skills file watcherâ€™s default ignore list (`DEFAULT_SKILLS_WATCH_IGNORED` in `src/agents/skills/refresh.ts`) to exclude common Pythonenv and cache directories (`.venv`, `venv`, `__pycache__`, `.mypy_cache`, `.pytest_cache`) plus generic build/cache folders (`build`, `.cache`). The associated unit test (`src/agents/skills/refresh.test.ts`) is updated to assert these new patterns are ignored while ensuring normal skill files (e.g. `SKILL.md`) are not excluded.

This fits into the existing skills refresh subsystem by reducing chokidarâ€™s watched file set for skill directories, which directly mitigates file descriptor exhaustion on large dependency trees (notably on macOS).

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- Changes are limited to adding additional ignore regexes for chokidar and expanding a unit test to cover them; the patterns are anchored to path separators and should not affect normal skill files. No behavioral changes outside watcher filtering were introduced.
- No files require special attention

<!-- greptile_other_comments_section -->

<sub>(3/5) Reply to the agent's comments like "Can you suggest a fix for this @greptileai?" or ask follow-up questions!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews


## Comments

### @kylehowells (2026-01-29)

This caused me hours of grief trying to work out what I had misconfigured so all bash execution was failing. The agent could talk to me, and run some limited tools, but could not DO anything. `spawn EBADF`

Eventually me and opus worked out it was file exhaustion from the 40k+ files I had in my skills directory causing the file watcher to eat up all the file descriptors because the skill I'd created ran in it's own python venv.

PR (code and above) was written by Claude Code Opus 4.5, this comment was written by me.

### @kylehowells (2026-01-29)

Related #3708  and #3801. Also possibly #2532 


## Stats

- **Size:** small (34+, 1-, 2 files)
- **Age:** 4 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
