---
number: 4238
title: "Fix/docker migration atomicity"
author: ricardotrevisan
created: 2026-01-29T23:00:29Z
updated: 2026-01-30T04:25:07Z
labels: ["docker"]
additions: 112
deletions: 32
changed_files: 5
size: medium
review_decision: none
reviews: []
comments_count: 1
reactions_total: 0
ci_status: failing
mergeable: false
draft: false
url: https://github.com/openclaw/openclaw/pull/4238
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

1. The Problem
Migration Loop: The core logic tried to rename .clawdbot to .moltbot. In Docker, these are often bind mounts from the host. Renaming a mount point fails with EBUSY, causing the container to crash and restart in a loop.
Permission Denied (EACCES): The container runs as a non-root user (node). If the host directories or Docker volumes were created by root (common during initial start), the app crashes when trying to write to cron, canvas, or logs.
Usability: The moltbot CLI was not in the global PATH inside the container, requiring confusing commands like node dist/index.js.


Robustness: 
src/infra/state-migrations.ts
 now safely skips migration if it hits EBUSY (common in Docker), preventing crashes.
Atomicity: 
docker-compose.yml
 now uses named volumes for verified isolation and permissions, rather than host bind mounts.
DX: 
Dockerfile
 now includes a global moltbot CLI symlink for easy access via docker exec.

## Reviews


## Comments

### @warmcustard (2026-01-30)

docker-setup.sh is dying with `no such service: moltbot-cli`


## Stats

- **Size:** medium (112+, 32-, 5 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
