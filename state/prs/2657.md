---
number: 2657
title: "fix: use TLS 1.2 for gemini-cli and google-antigravity OAuth requests via proxy"
author: PrentissLiu
created: 2026-01-27T08:12:31Z
updated: 2026-01-28T23:25:11Z
labels: ["extensions: google-antigravity-auth", "extensions: google-gemini-cli-auth"]
additions: 72
deletions: 8
changed_files: 2
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/moltbot/moltbot/pull/2657
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

Problem:
OAuth token exchange can fail behind certain local proxies because TLS 1.3 handshakes to oauth2.googleapis.com get reset (connection reset during handshake), causing the OAuth flow to fail.

Fix:
When proxy env vars are present (e.g. HTTP_PROXY / HTTPS_PROXY / ALL_PROXY), use undici ProxyAgent and cap TLS to TLSv1.2 via requestTls.maxVersion for:
  - google-gemini-cli-auth
  - google-antigravity-auth

  Impact:
  OAuth works reliably behind proxy setups that reset TLS 1.3 connections.

## Reviews


## Comments


## Stats

- **Size:** medium (72+, 8-, 2 files)
- **Age:** 2 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
