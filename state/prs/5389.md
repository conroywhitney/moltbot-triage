---
number: 5389
title: "Document requirements for postToMainMode on isolated cron jobs"
author: graham-u
created: 2026-01-31T12:35:31Z
updated: 2026-01-31T12:49:20Z
labels: ["docs"]
additions: 19
deletions: 0
changed_files: 1
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"graham-u","state":"COMMENTED"},{"author":"graham-u","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/5389
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
- Add a note under isolation options linking to troubleshooting
- Add troubleshooting section documenting the three conditions required for `postToMainMode` to work

## Detail

`postToMainMode` on isolated cron jobs silently fails unless specific conditions are met. The summary gets queued as a system event but is never drained into the main session.

**Root cause:** The heartbeat runner in `heartbeat-runner.js` skips processing when `HEARTBEAT.md` is effectively empty (only comments/headers). The empty-file check exempts `exec-event` reasons but not cron wake reasons, so cron summaries are silently dropped.

**Three conditions must all be met:**

1. `wakeMode: "now"` — triggers an immediate heartbeat after the isolated run. Without this, the queued event waits for the next scheduled heartbeat interval.

2. The agent must have a `heartbeat` block in its config with a non-zero `every` value. Without this, `resolveHeartbeatAgents()` in `heartbeat-runner.js` excludes the agent from the heartbeat processing loop entirely. The interval can be arbitrarily long (e.g. `"1440m"`) since `wake: now` triggers on demand.

3. `HEARTBEAT.md` in the agent's workspace must contain at least one non-comment, non-header line. Examples of files that cause the skip:

   ```markdown
   # HEARTBEAT.md
   # This file is empty
   ```

   ```markdown
   # HEARTBEAT.md

   ```

   A file like this will work:

   ```markdown
   # HEARTBEAT.md
   Try to be useful.
   ```

   The check is in `heartbeat-runner.js` around line 341 — `isHeartbeatContentEffectivelyEmpty()` returns true for files with only markdown headers and comments, causing an early return before system events are drained.

**Working example — cron job creation:**

```bash
openclaw cron add \
  --name "Morning briefing" \
  --cron "30 7 * * *" \
  --tz "Europe/London" \
  --session isolated \
  --agent ops \
  --message "Summarize inbox and calendar for today." \
  --wake now \
  --post-prefix "Cron" \
  --post-mode summary \
  --deliver \
  --channel discord \
  --to "user:123456789"
```

**Resulting job in `~/.openclaw/cron/jobs.json`:**

```json
{
  "id": "a1b2c3d4-...",
  "agentId": "ops",
  "name": "Morning briefing",
  "enabled": true,
  "schedule": {
    "kind": "cron",
    "expr": "30 7 * * *",
    "tz": "Europe/London"
  },
  "sessionTarget": "isolated",
  "wakeMode": "now",
  "payload": {
    "kind": "agentTurn",
    "message": "Summarize inbox and calendar for today.",
    "deliver": true,
    "channel": "discord",
    "to": "user:123456789"
  },
  "isolation": {
    "postToMainPrefix": "Cron",
    "postToMainMode": "summary",
    "postToMainMaxChars": 8000
  }
}
```

**Working example — agent config with heartbeat block:**

```json5
{
  agents: {
    list: [
      { id: "main", default: true },
      {
        id: "ops",
        workspace: "/home/user/agents/ops",
        heartbeat: {
          every: "1440m"  // 24h — only needs to be non-zero; wake: now triggers on demand
        }
      }
    ]
  }
}
```

**Possible future fix:** The empty-HEARTBEAT.md check could also check `hasSystemEvents(sessionKey)` before skipping, similar to how it already exempts `exec-event` reasons.

Claude Code helped to create this PR.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

Updates `docs/automation/cron-jobs.md` to clarify how isolated cron jobs can post results back to the main session.

- Adds a cross-link from the isolated-job isolation options to a troubleshooting section.
- Documents three prerequisites for `postToMainMode` to work reliably (wake mode, agent heartbeat configuration, and non-empty `HEARTBEAT.md`).

This fits into the existing cron/heartbeat documentation by making an implicit runtime dependency (heartbeat processing draining queued system events) explicit for users configuring isolated cron jobs.

<h3>Confidence Score: 4/5</h3>

- This PR is safe to merge with minimal risk (docs-only change).
- Only documentation was changed and the additions are scoped and consistent with existing cron/heartbeat concepts; the main risk is minor user confusion from mixed `wakeMode` vs `--wake` terminology.
- docs/automation/cron-jobs.md

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-01-31)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @graham-u — COMMENTED (2026-01-31)



### @graham-u — COMMENTED (2026-01-31)




## Comments


## Stats

- **Size:** small (19+, 0-, 1 files)
- **Age:** 2 days
- **Last activity:** 2026-01-31

## Links

- Fixes: (none detected)
