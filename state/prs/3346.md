---
number: 3346
title: "feat(whatsapp): expose forwarded message metadata to agents"
author: rafaelpini
created: 2026-01-28T13:40:08Z
updated: 2026-01-28T23:25:09Z
labels: ["channel: whatsapp-web"]
additions: 34
deletions: 1
changed_files: 3
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/3346
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Adds forwarding metadata detection to WhatsApp inbound messages, allowing agents to distinguish between messages sent directly vs forwarded.

## Changes

- Export `extractContextInfo` from `extract.ts`
- Add `extractForwardingInfo()` function that extracts `isForwarded` and `forwardingScore`
- Prepend `[forwarded]` or `[forwarded many times]` tag to message body
- Include `isForwarded` and `forwardingScore` in `WebInboundMessage` type

## Behavior

- Forwarded messages: `[forwarded] <content>`
- Frequently forwarded (5+ times): `[forwarded many times] <content>`
- Direct messages: unchanged

## Use Case

Agents can detect when users forward content vs send directly, enabling different handling for forwarded/viral content.

---

## AI-Assisted PR Checklist ðŸ¤–

- [x] **AI-assisted**: Built with Claude (Moltbot agent session)
- [x] **Testing**: Fully tested locally - confirmed working with forwarded audio, text, and media on WhatsApp
- [x] **Understanding**: Code reviewed and understood - uses Baileys' `contextInfo.isForwarded` and `forwardingScore` fields already present in message objects
- [X] **Linter**: `npm run lint` (CI will verify)

### How it was built
Sub-agent session analyzed the existing Moltbot codebase, identified that `contextInfo` was already being extracted but forwarding metadata wasn't exposed, and created the minimal patch to surface it to agents.


---

## Reviews


## Comments


## Stats

- **Size:** small (34+, 1-, 3 files)
- **Age:** 1 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
