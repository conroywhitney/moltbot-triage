---
number: 3397
title: "feat(skills): add promptMode config for compact/lazy skill injection"
author: cryptosquanch
created: 2026-01-28T15:05:51Z
updated: 2026-01-28T23:25:09Z
labels: ["agents"]
additions: 134
deletions: 4
changed_files: 3
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/moltbot/moltbot/pull/3397
fixes_issues: [3395]
related_prs: [3395]
duplicate_of: null
---

## Description

## Summary

Adds a new `skills.promptMode` config option to control how skills are injected into the system prompt.

## Problem

With 40+ skills installed, the full `<available_skills>` XML block consumes ~3,700 tokens per request (~14,700 characters). For a typical session with 100 messages, this adds up to ~370,000 tokens of overhead.

## Solution

New config option:

```yaml
skills:
  promptMode: full | compact | lazy  # default: full
```

### Modes

| Mode | Description | Token Savings |
|------|-------------|---------------|
| `full` | Current behavior - inject all skill metadata | 0% (baseline) |
| `compact` | Inject only skill names and truncated descriptions | ~50% |
| `lazy` | Minimal prompt - skills available via tool | ~95%+ |

## Changes

- Added `SkillsPromptMode` type to `types.skills.ts`
- Added `promptMode` option to `SkillsConfig`
- Updated `buildWorkspaceSkillsPrompt` and `buildWorkspaceSkillSnapshot` to respect the mode
- Added helper functions `formatSkillsCompact` and `formatSkillsLazy`

## TODO (follow-up PR)

- [ ] Add `list_skills` tool for lazy mode (currently lazy mode shows a note about available skills count)

## Testing

- Added `skills.prompt-mode.test.ts` for basic mode switching

Closes #3395

## Reviews


## Comments


## Stats

- **Size:** medium (134+, 4-, 3 files)
- **Age:** 0 days
- **Last activity:** 2026-01-28

## Links

- Fixes: #3395
