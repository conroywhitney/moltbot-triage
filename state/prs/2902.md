---
number: 2902
title: "fix(matrix): check if requestOwnUserVerification exists before calling"
author: dokterdok
created: 2026-01-27T18:25:21Z
updated: 2026-02-03T03:55:22Z
labels: ["channel: matrix"]
additions: 8
deletions: 4
changed_files: 1
size: small
review_decision: none
reviews: []
comments_count: 3
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/2902
fixes_issues: [2901]
related_prs: [2901]
duplicate_of: null
---

## Description

## Summary
The crypto SDK may not have the `requestOwnUserVerification` function, causing a TypeError on startup when E2EE is enabled.

## Problem
When `channels.matrix.encryption: true` is set, the code calls `client.crypto.requestOwnUserVerification()` without checking if the function exists. This causes:
```
{"error":"TypeError: client.crypto.requestOwnUserVerification is not a function"}
```

## Solution
Add a runtime check to verify the function exists before calling it. If not supported, log a debug message instead of throwing.

## Testing
- Tested with E2EE enabled on self-hosted Synapse
- Bot starts without error
- Gracefully handles missing verification support

Fixes #2901

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR hardens Matrix E2EE startup by guarding the `client.crypto.requestOwnUserVerification()` call with a runtime `typeof === "function"` check, avoiding a `TypeError` on crypto SDK versions that donâ€™t expose that API. When unsupported, it logs a debug message and continues startup normally, keeping the monitor flow unchanged aside from the verification request branch.

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge; it adds a narrow runtime guard to prevent a startup crash on older/alternate Matrix crypto SDK implementations.
- Change is minimal and localized: it only checks method existence before calling and adds a debug log path; no behavior changes when the method exists, and the previous try/catch remains in place for other errors.
- No files require special attention

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews


## Comments

### @dokterdok (2026-01-27)

**Note:** The underlying issue is that matrix-bot-sdk doesn't implement device verification. Filed upstream feature request: https://github.com/element-hq/matrix-bot-sdk/issues/82

### @ericmigi (2026-01-30)

I recommend switching to use [mautrixgo](https://github.com/mautrix/go) as the underlying matrix library

### @ericmigi (2026-01-30)

brb asking clawd to fork https://github.com/gomuks/gomuks and replace the web frontend with a clawd interface



## Stats

- **Size:** small (8+, 4-, 1 files)
- **Age:** 6 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #2901
