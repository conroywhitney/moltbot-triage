---
number: 4208
title: "fix: enforce allowlist for explicit sends across all channels"
author: JoelCooperPhD
created: 2026-01-29T21:34:52Z
updated: 2026-01-29T21:35:01Z
labels: ["channel: googlechat", "channel: whatsapp-web"]
additions: 61
deletions: 28
changed_files: 5
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4208
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Explicit-mode sends (agent tool calls, gateway `send` command) bypassed the `allowFrom` allowlist on every channel adapter. An agent hallucination or prompt injection could send messages to arbitrary recipients despite `dmPolicy: "allowlist"` being configured.

- Adds allowlist enforcement to the default fallback in `targets.ts`, covering all channels without a custom `resolveTarget` (Discord, Slack, Matrix, MS Teams, etc.)
- Fixes WhatsApp (core + extension), Twitch, and Google Chat adapters to reject explicit sends to non-allowlisted targets
- Enforces allowlist on WhatsApp group JIDs (previously unguarded)

Implicit and heartbeat modes still fall back to `allowList[0]` as before.

## Files changed

- `src/infra/outbound/targets.ts` â€” default fallback now checks allowlist
- `src/channels/plugins/outbound/whatsapp.ts` â€” enforce for DMs + groups
- `extensions/whatsapp/src/channel.ts` â€” same fix for extension copy
- `extensions/twitch/src/outbound.ts` â€” enforce for explicit sends
- `extensions/googlechat/src/channel.ts` â€” enforce for explicit sends

## Test plan

- [ ] Explicit send to non-allowlisted target is rejected
- [ ] Implicit/heartbeat sends still fall back to `allowList[0]`
- [ ] Wildcard (`*`) in allowFrom still permits all targets
- [ ] Empty allowFrom still permits all targets (no allowlist configured)
- [ ] Group JIDs in WhatsApp require allowlist entry

ðŸ¤– AI-assisted (Claude). I understand what the code does.
Testing: locally tested with WhatsApp allowlist configuration.

## Reviews


## Comments


## Stats

- **Size:** medium (61+, 28-, 5 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
