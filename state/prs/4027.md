---
number: 4027
title: "fix(telegram): prevent message truncation when mentioning think tags"
author: zerone0x
created: 2026-01-29T15:10:01Z
updated: 2026-01-29T15:10:01Z
labels: []
additions: 182
deletions: 1
changed_files: 2
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/4027
fixes_issues: [3952]
related_prs: [3952]
duplicate_of: null
---

## Description

## Summary
Fixes #3952

When users discuss `<think>` tags in prose (e.g., "Use the `<think>` tag to enable thinking"), the text was being truncated because the unclosed tag caused all trailing content to be dropped.

## Changes
- Added tag pairing detection in `stripReasoningTagsFromText()`
- Added heuristic to differentiate between:
  1. **Model thinking output** (tag at start) â†’ strip as before
  2. **Prose mentioning tags** (content before tag) â†’ preserve the text
- Added comprehensive test suite for `reasoning-tags.ts` (24 tests)

## Test Plan
- [x] All 4870 existing tests pass
- [x] New tests cover the fix scenarios:
  - `<think>` in prose without closing tag (preserved)
  - `<thinking>` in prose (preserved)
  - `<think>` in code blocks (preserved)
  - Properly paired `<think>...</think>` (still stripped)
  - Model output starting with `<think>` (still stripped)
- [x] Lint passes
- [x] Build succeeds

---
ðŸ¤– Generated with Claude Code (issue-hunter-pro)

## Reviews


## Comments


## Stats

- **Size:** medium (182+, 1-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: #3952
