---
number: 4722
title: "feat: Kimi K2.5 native features, reasoning_content fix, subagent announce stats"
author: Milofax
created: 2026-01-30T15:24:43Z
updated: 2026-01-30T17:13:47Z
labels: ["agents"]
additions: 1235
deletions: 211
changed_files: 17
size: huge
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4722
fixes_issues: [21]
related_prs: [21]
duplicate_of: null
---

## Description

## Summary

### Subagent announce stats fix (original)
- **`formatDurationShort()`**: Allow `0ms` as valid duration (sub-second tasks), display as `<1s` instead of `n/a`
- **`waitForSessionUsage()`**: Increase polling to 10x500ms (5s total) so token data persists before announce reads it
- **`readLatestAssistantReply()`**: Add retry loop (5x500ms) when transcript hasn't flushed yet

### Kimi K2.5 native features (#21)
- **`sessions_spawn_batch` tool**: Parallel batch spawning of subagents via `Promise.allSettled`. Max 10 tasks, partial failure handling, same guards as single spawn. Shared core logic extracted into `sessions-spawn-core.ts`.
- **`image_to_code` tool**: Convert screenshot/mockup to code using vision model. Supports html, react, vue, astro, svelte, tailwind frameworks. Uses existing `runImagePrompt` infrastructure.

### Kimi K2.5 reasoning_content fix
- **`stripReasoningReplaySignatures()`**: Strip plain `reasoning_content` / `reasoning` / `reasoning_text` replay signatures from thinking blocks before they reach the API. Kimi K2.5 streams thinking via `reasoning_content` but rejects it in request messages. OpenAI Responses API JSON signatures (`{id: "rs_...", type: "reasoning"}`) are preserved.

Closes #21

## Test plan

- [x] `pnpm lint` passes (0 warnings, 0 errors)
- [x] `pnpm build` passes (no type errors)
- [x] `pnpm test` passes (4912 pass, 4 pre-existing failures in spawn lifecycle tests)
- [x] New unit tests for `sessions_spawn_batch` (5 tests)
- [x] New unit tests for `image_to_code` (10 tests)
- [x] New unit tests for `stripReasoningReplaySignatures` (7 tests)
- [x] Deployed to VM and verified healthy container

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** huge (1235+, 211-, 17 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #21
