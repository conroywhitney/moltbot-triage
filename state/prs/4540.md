---
number: 4540
title: "Fix #4501: Handle unhandled promise rejections in Telegram polling"
author: spiceoogway
created: 2026-01-30T09:17:15Z
updated: 2026-01-30T13:09:07Z
labels: ["channel: telegram", "gateway", "commands"]
additions: 32
deletions: 2
changed_files: 4
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4540
fixes_issues: [4501]
related_prs: [2586,4501]
duplicate_of: null
---

## Description

## Summary
Fixes #4501: Gateway crash due to unhandled promise rejections in Telegram polling

## Problem
The gateway crashes when Telegram Bot API long-polling encounters network failures during idle periods. The crash is caused by unhandled promise rejections from background fetch operations.

## Solution
1. **Global handler**: Added `unhandledRejection` event handler in gateway startup to log and gracefully handle any unhandled rejections instead of crashing
2. **Telegram cleanup**: Fixed `runner.stop()` calls in monitor to properly catch rejections
3. **Defensive cleanup**: Added runner cleanup in finally block to prevent lingering promises

## Changes
- `src/gateway/server.impl.ts`: Added global unhandled rejection handler
- `src/telegram/monitor.ts`: Fixed promise cleanup in Telegram polling loop

## Testing
- Existing tests continue to pass
- Manual testing confirms gateway no longer crashes on network failures
- Errors are properly logged for debugging

## Impact
- **Risk**: Low - purely defensive error handling, no changes to business logic
- **Benefit**: High - prevents gateway crashes during network instability

## Related Issues
- openclaw/openclaw#4501 (this fix)
- Similar issue: moltbot/moltbot#2586

## Reviews


## Comments


## Stats

- **Size:** small (32+, 2-, 4 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #4501
