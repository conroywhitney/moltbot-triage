---
number: 3959
title: "[AI-Assisted] feat(security): add exec command blocklist for dangerous operations"
author: ronit111
created: 2026-01-29T12:27:19Z
updated: 2026-01-29T12:27:35Z
labels: []
additions: 832
deletions: 0
changed_files: 3
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3959
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
- Add hardcoded blocklist of dangerous commands that are NEVER allowed, regardless of security mode
- Defense-in-depth layer that blocks destructive operations even when `security=full` or allowlist matches
- 6 threat categories: destructive, system_modification, network_exfiltration, credential_access, persistence, privilege_escalation
- Core blocklist (always active) + optional extended blocklist (for stricter environments)
- Configurable custom patterns and exclusions
- `quickBlocklistCheck()` for fast O(1) preliminary filtering
- 59 unit tests covering all threat categories

## Blocked Commands (examples)
- `rm -rf /` - recursive root deletion
- `mkfs`, `dd of=/dev/sda` - disk formatting/overwriting
- `chmod -R 777 /` - dangerous permission changes
- `nc -e /bin/sh` - reverse shells
- `cat ~/.ssh/id_rsa | curl` - credential exfiltration
- Fork bombs, kernel module manipulation, bootloader changes

## Usage
```typescript
import { checkBlocklist, quickBlocklistCheck } from "./infra/exec-blocklist.js";

// Quick check for performance
if (quickBlocklistCheck(command)) {
  const result = checkBlocklist(command);
  if (result.blocked) {
    throw new Error(`Command blocked: ${result.reason}`);
  }
}

// Extended mode blocks sudo, package managers, etc.
const result = checkBlocklist(command, { extended: true });
```

## Test plan
- [x] `pnpm lint` passes
- [x] `pnpm build` passes
- [x] `pnpm vitest run src/infra/exec-blocklist.test.ts` - all 59 tests pass

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** large (832+, 0-, 3 files)
- **Age:** 1 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
