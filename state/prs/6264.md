---
number: 6264
title: "Wire up after_tool_call hook in agent execution loop"
author: xampla
created: 2026-02-01T13:30:18Z
updated: 2026-02-02T22:46:49Z
labels: ["agents"]
additions: 181
deletions: 7
changed_files: 2
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 2
reactions_total: 4
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/6264
fixes_issues: []
related_prs: [6535,6570]
duplicate_of: null
---

## Description

## Summary

Now that `before_tool_call` is implemented (#6570), this PR adds the complementary `after_tool_call` hook for post-execution telemetry.

### Changes

- Add `pi-tools.hooks.ts`: wraps tool execute methods to fire `after_tool_call`
- Hook fires as fire-and-forget after tool returns
- Provides: `toolName`, `params`, `result`, `error`, `durationMs`
- Hook context includes `agentId` and `sessionKey` for correlation
- Hook errors are caught and logged, never breaking tool execution
- Tools are only wrapped when hooks are registered (zero overhead otherwise)

### API Usage

Plugins can register `after_tool_call` handlers:

```typescript
api.on("after_tool_call", (event, ctx) => {
  console.log(`Tool ${event.toolName} completed in ${event.durationMs}ms`);
  if (event.error) {
    console.error(`Tool failed: ${event.error}`);
  }
});
```

### Related

- Builds on #6570 (before_tool_call)
- Addresses #6535 (2 of 8 unimplemented hooks now working)

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-01)

<sub>1 file reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @xampla (2026-02-01)

This PR fixes #5943 and #5513.

It supersedes #2340 (by @AhmedTheGeek) and the closed #2363, rebasing the work onto current main with fixes for:
- Type compatibility (separate wrappers for `AnyAgentTool` and `ToolDefinition`)
- Lint compliance (unbound method fix)

This also unblocks #6232 (Security & Access Control) by enabling plugins to intercept and block tool calls before execution.

### @fuushyn (2026-02-02)

following


## Stats

- **Size:** medium (181+, 7-, 2 files)
- **Age:** 1 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
