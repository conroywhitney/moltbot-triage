---
number: 1879
title: "fix: handle 400 status in failover to enable model fallback"
author: orenyomtov
created: 2026-01-25T17:42:20Z
updated: 2026-01-28T23:25:13Z
labels: []
additions: 2
deletions: 0
changed_files: 2
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/1879
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
- Fix failover system to treat HTTP 400 errors as failover-eligible, enabling automatic model fallback when providers return bad request errors

## Problem
When Anthropic (or other providers) returned a 400 error, the failover system would not attempt the fallback model because:

1. `resolveFailoverReasonFromError` only checked for status codes 401, 402, 403, 408, and 429
2. 400 errors fell through to message-based classification
3. If the error message didn't match specific patterns, `coerceToFailoverError` returned `null`
4. This caused the error to be thrown immediately without trying fallback models

## Fix
Added `status === 400` check to return `"format"` as the failover reason, consistent with the existing `resolveFailoverStatus` mapping.

## Test plan
- [x] Added test case for `{ status: 400 }` â†’ `"format"` in HTTP status inference test
- [x] All existing failover tests pass (7 tests)
- [x] Model fallback tests pass (17 tests)

## Reviews


## Comments


## Stats

- **Size:** tiny (2+, 0-, 2 files)
- **Age:** 4 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
