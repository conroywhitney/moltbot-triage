---
number: 6592
title: "Security: guardrails audit + external content improvements"
author: georgeykalangi
created: 2026-02-01T21:05:42Z
updated: 2026-02-02T20:29:22Z
labels: ["docs", "channel: discord", "channel: imessage", "channel: signal", "channel: slack", "channel: telegram", "channel: whatsapp-web", "gateway", "commands"]
additions: 1036
deletions: 402
changed_files: 31
size: huge
review_decision: none
reviews: []
comments_count: 1
reactions_total: 1
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6592
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## What
- **Audit:** Add security audit warning when `allowUnsafeExternalContent` is enabled for hooks (Gmail or hook mappings). Check ID: `hooks.allow_unsafe_external_content`.
- **External content:** Extend suspicious-pattern detection for prompt-leak / instruction-extraction (e.g. "repeat your instructions", "what are your rules", "ignore safety").
- **Docs:** New "Guardrails and external content" section under gateway security: where wrapping is applied (cron/hooks only), where it is not (channel messages, OpenAI/OpenResponses API), and that the audit warns when wrapping is disabled.

## Why
Improves visibility of prompt-injection risk and documents guardrails so users can run OpenClaw with clearer safety expectations.

## Testing
- `pnpm build` — passed
- `vitest run src/security/audit.test.ts src/security/external-content.test.ts` — 66 tests passed (42 audit + 24 external-content)

Made with [Cursor](https://cursor.com)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR improves OpenClaw’s prompt-injection guardrails by (1) adding a security-audit warning when `allowUnsafeExternalContent` disables external-content wrapping for Gmail/hooks mappings, (2) extending suspicious-pattern detection for prompt-leak / instruction-extraction phrases, and (3) documenting where external-content wrapping does and does not apply in the gateway security docs.

The changes fit into the existing security tooling by extending `collectHooksHardeningFindings` in `src/security/audit-extra.ts` and expanding `src/security/external-content.ts` pattern matching, with accompanying Vitest coverage updates.

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- Changes are localized to security-audit findings, suspicious-pattern regexes, and documentation, with targeted tests added/updated to cover the new behavior. No behavioral changes outside the intended hook-wrapping/audit surface were identified.
- No files require special attention

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews


## Comments

### @georgeykalangi (2026-02-02)

Done


## Stats

- **Size:** huge (1036+, 402-, 31 files)
- **Age:** 1 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
