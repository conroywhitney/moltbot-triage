---
number: 2791
title: "fix: add \\"Cache-Control: no-cache\\" header to brave api web search requests."
author: KuzeyC
created: 2026-01-27T14:32:40Z
updated: 2026-01-28T23:25:11Z
labels: ["agents"]
additions: 1
deletions: 0
changed_files: 1
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/moltbot/moltbot/pull/2791
fixes_issues: []
related_prs: [2476]
duplicate_of: null
---

## Description

## Summary
Add explicit Cache-Control: no-cache header to Brave Search API web search requests to prevent 422 validation errors.

## Problem
The Brave Search API strictly validates the Cache-Control request header.
In some environments (e.g., system proxies or HTTP clients), a default header such as Cache-Control: max-stale=0 is injected when no value is explicitly set. Brave rejects these requests with a 422 error:

- VALIDATION error on header cache-control
- Expected value: no-cache

This caused web_search to fail consistently despite valid query parameters and API keys.

## Solution
In src/agents/tools/web-search.ts, explicitly set the required header on Brave API requests:
- Add "Cache-Control": "no-cache" to request headers
- Ensures compliance with Brave API validation
- Prevents environment-dependent header injection issues
- No behavior change for other providers

## Test Plan
- Verified Brave web search succeeds with explicit Cache-Control: no-cache
- Reproduced failure without header in proxy-influenced environments
- Confirmed no regression in other web search providers
- Manual curl comparison matches fixed behavior

Fixes [#2476](https://github.com/moltbot/moltbot/issues/2476)

## Reviews


## Comments


## Stats

- **Size:** tiny (1+, 0-, 1 files)
- **Age:** 1 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
