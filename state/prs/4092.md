---
number: 4092
title: "feat: Add GitHub Copilot SDK integration for copilot-cli backend"
author: htekdev
created: 2026-01-29T17:21:30Z
updated: 2026-01-30T06:31:12Z
labels: ["docs", "gateway", "agents"]
additions: 1132
deletions: 89
changed_files: 14
size: huge
review_decision: none
reviews: [{"author":"htekdev","state":"COMMENTED"},{"author":"siwatanejo","state":"COMMENTED"},{"author":"Aditya190803","state":"COMMENTED"}]
comments_count: 1
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4092
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Adds `@github/copilot-sdk` integration to use the Copilot CLI as a CLI backend via JSON-RPC, enabling `copilot-cli/*` model references.

### Why this matters

**Zero-friction onboarding for GitHub users.** Anyone with a GitHub account can immediately start using Moltbot without signing up for Anthropic, OpenAI, or any other AI provider. Just install the Copilot CLI, authenticate with `gh auth login`, and you're ready to go.

**Opens Moltbot to the entire GitHub Copilot community.** Millions of developers already use GitHub Copilot daily. This integration lets them leverage Moltbot's automation and messaging capabilities using the same authentication and models they already have access to.

- Free GitHub accounts get access to `gpt-4.1` at no cost
- No API keys to manage or billing to set up
- Works out of the box if you already use GitHub Copilot

## Changes

- **Dependency**: Add `@github/copilot-sdk@^0.1.19`
- **Credential management** (`copilot-credentials.ts`): Auth status checking with TTL caching
- **SDK wrapper** (`copilot-sdk.ts`): Client lifecycle, session create/resume, proper cleanup
- **Runner** (`copilot-runner.ts`): Routes `copilot-cli` requests through SDK instead of CLI spawn
- **Backend config** (`cli-backends.ts`): Default Copilot backend with model aliases
- **Model routing** (`cli-runner.ts`, `model-selection.ts`): Recognize and route `copilot-cli` provider

## Usage

```bash
# Prerequisites
npm install -g @github/copilot
gh auth login

# Use in Moltbot
moltbot agent --message "hi" --model copilot-cli/gpt-4.1
```

## Config

```json5
{
  agents: {
    defaults: {
      model: { primary: "copilot-cli/gpt-4.1" },
      cliBackends: {
        "copilot-cli": { command: "copilot" }
      }
    }
  }
}
```

Supported models: `gpt-5`, `gpt-4.1`, `gpt-4.1-mini`, `gpt-4o`, `o1`, `o3-mini`, `claude-sonnet-4.5`

## Testing

- Verified SDK integration works correctly
- Fixed TypeScript errors (`SessionMetadata` properties, `AgentStreamParams`)
- Fixed cleanup order: abort session → destroy session → stop client
- Added proper handle unreffing to work around SDK cleanup bug

## Known Limitation

Due to `vscode-jsonrpc` (used internally by the SDK) not unreffing its `setImmediate` calls, the process may not exit cleanly after one-off CLI commands. This is acceptable for gateway usage since the gateway stays running.

## Reviews

### @htekdev — COMMENTED (2026-01-29)



### @siwatanejo — COMMENTED (2026-01-30)



### @Aditya190803 — COMMENTED (2026-01-30)




## Comments

### @htekdev (2026-01-29)

@Aditya190803 thoughts.


## Stats

- **Size:** huge (1132+, 89-, 14 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
