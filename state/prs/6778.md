---
number: 6778
title: "feat(typing): add configurable typingTtlSeconds option"
author: rahultappetla
created: 2026-02-02T01:54:07Z
updated: 2026-02-03T01:06:12Z
labels: ["docs"]
additions: 78
deletions: 5
changed_files: 7
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 2
reactions_total: 1
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/6778
fixes_issues: [7192]
related_prs: [5637,7192]
duplicate_of: null
---

## Description

## Problem                                                                                                                                                                                                                       
                                                                                                                                                                                                                                   
  The typing indicator TTL is currently hardcoded to 2 minutes (120 seconds). For long-running LLM operations—such as complex tool chains, slow model responses, or rate limit fallbacks—the typing indicator stops prematurely,   
  making the bot appear unresponsive even though it's still actively processing.                                                                                                                                                   
                                                                                                                                                                                                                                   
  **Real-world scenario:** When using model fallback chains (e.g., primary → backup → CLI), a single request can take 5-10+ minutes. Users see the typing indicator stop after 2 minutes and assume the bot has crashed.           
                                                                                                                                                                                                                                   
  ## Solution                                                                                                                                                                                                                      
                                                                                                                                                                                                                                   
  Add `typingTtlSeconds` as a configurable option in both agent defaults and session config, following the exact pattern established by `typingIntervalSeconds`.                                                                   
                                                                                                                                                                                                                                   
  ### Key points:                                                                                                                                                                                                                  
  - **Default remains 120 seconds** — no breaking changes for existing installations                                                                                                                                               
  - **Configurable at agent level** via `agents.defaults.typingTtlSeconds`                                                                                                                                                         
  - **Overridable per session** via `session.typingTtlSeconds`                                                                                                                                                                     
  - **Priority chain:** Agent config → Session config → Default (120s)                                                                                                                                                             

## Related Issues                                                                                                                                                                                                                
                                                                                                                                                                                                                                   
  This PR helps address:                                                                                                                                                                                                           
                                                                                                                                                                                                                                   
  - **#7192** - Typing indicator stops prematurely for slow models. Users can now configure `typingTtlSeconds` to extend the indicator duration for long-running inference.                                                        
  - **#5637** - Typing indicator stops before TTS completes. Increasing `typingTtlSeconds` keeps the indicator active through longer dispatch phases.                                                                              
                                                                                                                                                                                                                                   
  Closes #7192                                                                                                                                                                                                                     
  Helps mitigate #5637                                                                                                                                                                                                             
                        

                                                                                                                                                                                                                                  
  ## Changes                                                                                                                                                                                                                       
                                                                                                                                                                                                                                   
  | File | Change |                                                                                                                                                                                                                
  |------|--------|                                                                                                                                                                                                                
  | `zod-schema.agent-defaults.ts` | Add Zod schema validation |                                                                                                                                                                   
  | `zod-schema.session.ts` | Add Zod schema validation |                                                                                                                                                                          
  | `types.agent-defaults.ts` | Add TypeScript type with JSDoc |                                                                                                                                                                   
  | `types.base.ts` | Add TypeScript type with JSDoc |                                                                                                                                                                             
  | `get-reply.ts` | Wire config value to typing controller |                                                                                                                                                                      
  | `typing.test.ts` | Add test coverage for TTL behavior |                                                                                                                                                                        
  | `docs/concepts/typing-indicators.md` | Document the new option |                                                                                                                                                               
                                                                                                                                                                                                                                   
  ## Usage                                                                                                                                                                                                                         
                                                                                                                                                                                                                                   
  ```json5                                                                                                                                                                                                                         
  {                                                                                                                                                                                                                                
    agents: {                                                                                                                                                                                                                      
      defaults: {                                                                                                                                                                                                                  
        typingTtlSeconds: 300,  // 5 minutes for long-running operations                                                                                                                                                           
      },                                                                                                                                                                                                                           
    },                                                                                                                                                                                                                             
  }                                                                                                                                                                                                                                
                                                                                                                                                                                                                                   
  Or per-session override:                                                                                                                                                                                                         
                                                                                                                                                                                                                                   
  {                                                                                                                                                                                                                                
    session: {                                                                                                                                                                                                                     
      typingTtlSeconds: 600,  // 10 minutes                                                                                                                                                                                        
    },                                                                                                                                                                                                                             
  }                                                                                                                                                                                                                                
                                                                                                                                                                                                                                   
  Test Plan                                                                                                                                                                                                                        
                                                                                                                                                                                                                                   
  - Added unit tests for TTL expiration behavior                                                                                                                                                                                   
  - Added unit tests for custom TTL values                                                                                                                                                                                         
  - Existing typing tests continue to pass *(verified locally: 19 tests passed)*                                                                                                                                      
  - Manual verification with slow model responses (requires live deployment)                                                                                                                                                       
                                                                                                                                                                                                                                   
  Note for CI: Please verify all existing typing controller tests pass and consider a manual smoke test with a slow-responding model to confirm the TTL behavior works as expected in production.                                  
                                                                                                                                                                                                                                   
  Backward Compatibility                                                                                                                                                                                                           
                                                                                                                                                                                                                                   
  ✅ No breaking changes — field is optional with sensible default matching current behavior.                                                                                                                                      
  ```

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

Adds a new `typingTtlSeconds` configuration option alongside `typingIntervalSeconds`, wiring it into `getReplyFromConfig` to pass `typingTtlMs` into the typing controller. Updates agent/session config types and Zod schemas to accept the new field, expands typing controller tests to cover TTL expiration, and documents the option in the typing-indicators concept doc.

This fits the existing typing-indicator architecture by keeping TTL enforcement inside `createTypingController` (ms-based), while allowing the higher-level reply pipeline to source configuration from agent defaults and session overrides (seconds-based) and convert once at the boundary.

<h3>Confidence Score: 4/5</h3>

- This PR looks safe to merge with minor documentation/test robustness fixes.
- The change is additive, defaults remain unchanged, and the TTL is already implemented in the typing controller; this PR mainly exposes it via config and adds coverage. The main actionable issues are a docs example that appears to use the wrong config key and a TTL test that relies on exact timer ordering/call counts (potential flakiness).
- docs/concepts/typing-indicators.md, src/auto-reply/reply/typing.test.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>2 files reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-02)

<details>
<summary>Additional Comments (1)</summary>

**`docs/concepts/typing-indicators.md`**
[P1] Docs config key doesn't match actual schema

The examples use a top-level `agent` key, but the config types/schema use `agents.defaults` (agent-level) and `session` (session-level). As written, users who copy/paste the example will configure a key that the loader likely ignores. Consider updating the snippet to `agents: { defaults: { ... } }` (or whatever the repo’s canonical config shape is) to avoid confusion.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: docs/concepts/typing-indicators.md
Line: 40:47

Comment:
[P1] Docs config key doesn't match actual schema

The examples use a top-level `agent` key, but the config types/schema use `agents.defaults` (agent-level) and `session` (session-level). As written, users who copy/paste the example will configure a key that the loader likely ignores. Consider updating the snippet to `agents: { defaults: { ... } }` (or whatever the repo’s canonical config shape is) to avoid confusion.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>

### @rahultappetla (2026-02-02)

Addressed Greptile Feedback                                                                                                                                                                                                      
                                                                                                                                                                                                                                   
  P1 - Docs config key mismatch: Fixed the examples in docs/concepts/typing-indicators.md to use the correct config structure (agents: { defaults: { ... } } instead of agent: { ... }). This was a pre-existing issue in the docs,
   but since we're modifying that file anyway, it made sense to fix it for accuracy.                                                                                                                                               
                                                                                                                                                                                                                                   
  P2 - Fragile test assertions: Updated the TTL tests to use isActive() checks and verify that call counts stop increasing after TTL, rather than asserting exact call counts which could be sensitive to timer ordering.          
                   


## Stats

- **Size:** medium (78+, 5-, 7 files)
- **Age:** 0 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #7192
