---
number: 7339
title: "fix(openrouter): add reasoning_content on tool-call messages"
author: isandom
created: 2026-02-02T18:21:41Z
updated: 2026-02-02T20:39:55Z
labels: ["agents"]
additions: 108
deletions: 5
changed_files: 4
size: medium
review_decision: none
reviews: []
comments_count: 1
reactions_total: 1
ci_status: pending
mergeable: false
draft: false
url: https://github.com/openclaw/openclaw/pull/7339
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

- **Problem:** OpenRouter (Kimi K2.5) errors with `thinking is enabled but reasoning_content is missing in assistant tool call message`.
- **Repro:** Use an OpenRouter model with thinking enabled → trigger a tool call → follow-up message; request fails because history includes an assistant tool-call message missing `reasoning_content`.
- **Fix:** When provider is OpenRouter (`openai-completions`), inject `reasoning_content: ""` for assistant messages that contain tool calls before sending the request. Does not mutate persisted transcript.
- **Tests:** Added unit test covering injection and non-mutation.

**AI assisted with GPT-5.2 in VS Code**

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds an OpenRouter-specific `streamFn` wrapper that injects `reasoning_content: ""` onto assistant messages containing tool calls when using the `openai-completions` API, addressing OpenRouter errors when thinking is enabled. The wrapper is applied in `applyExtraParamsToAgent` alongside the existing OpenRouter attribution headers wrapper, and a unit test verifies both that the injected field is passed downstream and that the persisted transcript (`context.messages`) is not mutated.

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- Changes are narrowly scoped to OpenRouter + openai-completions requests, apply a non-mutating message transform only when needed, and include a unit test asserting both behavior and immutability. No functional regressions were identified in the wrapper composition or message handling logic.
- No files require special attention

<!-- greptile_other_comments_section -->

<sub>(4/5) You can add custom instructions or style guidelines for the agent [here](https://app.greptile.com/review/github)!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews


## Comments

### @jakobdylanc (2026-02-02)

Hi, I work at OpenRouter!

We pushed a fix for this on our end and you shouldn't see the `"thinking is enabled but reasoning_content is missing in assistant tool call message"` error anymore. Let me know if you're still having issues.


## Stats

- **Size:** medium (108+, 5-, 4 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
