---
number: 7101
title: "fix(sandbox): add error handler to execDocker spawn"
author: hclsys
created: 2026-02-02T11:37:55Z
updated: 2026-02-02T11:38:54Z
labels: ["agents"]
additions: 12
deletions: 0
changed_files: 1
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/7101
fixes_issues: [5135]
related_prs: [5135,6839]
duplicate_of: null
---

## Description

## Summary

Fix [CWE-755] vulnerability in `src/agents/sandbox/docker.ts`.

**Problem**: `execDocker()` spawn missing error event handler
**Impact**: Unhandled rejection / process hang when docker spawn fails
**Fix**: Add `child.on("error", ...)` handler with `settled` flag pattern

## Changes

- `src/agents/sandbox/docker.ts`: Add error handler to execDocker spawn
  - Added `settled` flag to prevent double resolve/reject (error + close can both fire)
  - Added `child.on("error", ...)` handler following codebase pattern from `src/process/exec.ts`

## Testing

- [x] `pnpm test` passes
- [x] `pnpm lint` passes

## References

- Fixes #5135
- CWE: https://cwe.mitre.org/data/definitions/755.html
- Similar fix: PR #6839 (ngrok spawn error handler)

---

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR hardens `execDocker()` in `src/agents/sandbox/docker.ts` by adding a `child.on("error")` handler for the `spawn("docker", ...)` call and a `settled` guard to prevent double resolve/reject when both `error` and `close` events fire. This aligns the sandboxâ€™s Docker execution behavior with the existing spawn-wrapper pattern used elsewhere (e.g. `src/process/exec.ts`), preventing hangs/unhandled promise behavior when the `docker` binary canâ€™t be spawned.

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- Change is small, localized to `execDocker()` spawn handling, and follows an established pattern (`settled` guard + `error` handler). It closes a real failure mode (spawn error never settling the Promise) without altering success-path behavior.
- No files require special attention

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews


## Comments


## Stats

- **Size:** small (12+, 0-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: #5135
