---
number: 4665
title: "fix(slack): reject HTML responses when downloading media"
author: tumf
created: 2026-01-30T13:47:31Z
updated: 2026-01-30T13:52:52Z
labels: ["channel: slack"]
additions: 185
deletions: 0
changed_files: 2
size: medium
review_decision: none
reviews: [{"author":"chatgpt-codex-connector","state":"COMMENTED"}]
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4665
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Slack sometimes returns HTML login pages instead of binary media when authentication fails (e.g., missing `files:read` scope) or URLs expire. This change detects and rejects HTML responses, improving error visibility.

## Changes

- Add `looksLikeHtml()` function to detect HTML content by checking:
  - `<!doctype html` or `<html` prefixes
  - `slack-edge.com` or `redirecturl:` patterns (Slack-specific)
- Log warning when HTML is received instead of media
- Skip to next file URL when HTML is detected
- Add tests for HTML detection scenarios

## Testing

- [x] Unit tests added and passing
- [x] Tested locally with Slack channel file uploads
- [x] Verified warning log helps identify scope/auth issues

## AI Assistance

- [x] AI-assisted (Claude)
- [x] Fully tested
- [x] I understand what the code does

This fix helped diagnose a real issue where `files:read` scope was missing from the Slack bot token - the warning log made it clear that HTML was being returned instead of the actual file.

## Reviews

### @chatgpt-codex-connector ‚Äî COMMENTED (2026-01-30)


### üí° Codex Review

Here are some automated review suggestions for this pull request.

**Reviewed commit:** `da6f3e21a5`
    

<details> <summary>‚ÑπÔ∏è About Codex in GitHub</summary>
<br/>

[Your team has set up Codex to review pull requests in this repo](http://chatgpt.com/codex/settings/general). Reviews are triggered when you
- Open a pull request for review
- Mark a draft as ready
- Comment "@codex review".

If Codex has suggestions, it will comment; otherwise it will react with üëç.




Codex can also answer questions or update the PR. Try commenting "@codex address that feedback".
            
</details>


## Comments


## Stats

- **Size:** medium (185+, 0-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
