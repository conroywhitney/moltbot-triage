---
number: 3899
title: "Add onCompactionStart callback to handle context compaction notifications (#2730)"
author: nexiouscaliver
created: 2026-01-29T09:58:16Z
updated: 2026-01-29T10:08:57Z
labels: ["agents"]
additions: 9
deletions: 0
changed_files: 3
size: tiny
review_decision: none
reviews: [{"author":"Lavkushwaha","state":"APPROVED"}]
comments_count: 1
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3899
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

This pull request introduces a new callback to notify when context compaction starts during an embedded Pi agent run, and integrates this notification into the agent execution flow. The changes improve the user experience by providing real-time feedback when the system is compacting context to handle overflows.

**Callback and notification enhancements:**

* Added an optional `onCompactionStart` callback to the `RunEmbeddedPiAgentParams` type, allowing consumers to react when compaction begins.
* Invoked the `onCompactionStart` callback in `runEmbeddedPiAgent` when a context overflow triggers auto-compaction.
* Implemented a handler for `onCompactionStart` in `runAgentTurnWithFallback` to send a partial reply ("ðŸ§¹ Compacting context, please wait...") to the user, improving transparency during compaction events.

## Reviews

### @Lavkushwaha â€” APPROVED (2026-01-29)




## Comments

### @nexiouscaliver (2026-01-29)

This is the proposed solution implementation for Issue #2730, forgot to mention in pull req.


## Stats

- **Size:** tiny (9+, 0-, 3 files)
- **Age:** 1 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
