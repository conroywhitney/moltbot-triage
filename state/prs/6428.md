---
number: 6428
title: "fix(discord): support forum thread creation without messageId"
author: David-Marsh-Photo
created: 2026-02-01T17:07:09Z
updated: 2026-02-01T17:08:18Z
labels: ["channel: discord"]
additions: 79
deletions: 1
changed_files: 3
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6428
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem
`createThreadDiscord` only supports creating threads from existing messages (requires messageId). Forum channels (type 15) need a different API — POST to channel without messageId, with a `message` object.

## Changes

### 1. `src/discord/send.types.ts`
- Made `messageId` explicitly optional  
- Added `message?: { content: string }` for forum posts
- Added `appliedTags?: string[]` for optional forum tags

### 2. `src/discord/send.messages.ts`
Updated `createThreadDiscord` to detect forum posts (no messageId + has message) and use the correct route:
- Forum: `Routes.threads(channelId)` — POST without messageId
- Regular: `Routes.threads(channelId, messageId)` — POST to message

### 3. Tests
Added 4 new tests in `send.creates-thread.test.ts`:
- Forum post without messageId
- Forum post with appliedTags  
- Forum post with auto_archive_duration
- Renamed existing test for clarity

## Test
```bash
pnpm test src/discord/send.creates-thread.test.ts
# ✓ 19 tests pass
```

Closes: weston-f1r

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR extends Discord thread creation to support forum/media channels by allowing `createThreadDiscord` to POST to `Routes.threads(channelId)` when no `messageId` is provided and a `message` payload is supplied, while preserving the existing “create from message” flow using `Routes.threads(channelId, messageId)`. It also updates the request type to include forum-specific fields (`message`, `appliedTags`) and adds targeted tests to cover the new route/body shapes.

<h3>Confidence Score: 4/5</h3>

- This PR is generally safe to merge, with one edge-case that could produce an invalid Discord route if callers omit both `messageId` and `message`.
- Changes are localized, match Discord API behavior for forum thread creation, and are covered by new unit tests; however, the updated `DiscordThreadCreate` type now permits invalid payload combinations, and `createThreadDiscord` will still attempt `Routes.threads(channelId, undefined)` in that case.
- src/discord/send.messages.ts; src/discord/send.types.ts

<!-- greptile_other_comments_section -->

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-01)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** medium (79+, 1-, 3 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: (none detected)
