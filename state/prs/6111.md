---
number: 6111
title: "fix: detect float underflow in duration parsing"
author: T1mn
created: 2026-02-01T08:58:20Z
updated: 2026-02-01T09:32:13Z
labels: ["cli"]
additions: 5
deletions: 1
changed_files: 1
size: tiny
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6111
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds an additional validation step to `parseDurationMs` (`src/cli/parse-duration.ts`) that throws when the computed duration rounds to `0ms` even though the parsed numeric value is non-zero. The goal is to detect cases where floating-point underflow or precision loss causes an otherwise-valid duration to collapse to zero after conversion and rounding.

The change is localized to the CLI duration parsing helper and impacts all call sites that rely on this shared parsing logic (e.g., agent runtime config validation and various CLI commands that accept duration flags).

<h3>Confidence Score: 4/5</h3>

- This PR is generally safe to merge but may introduce unintended rejections of sub-millisecond durations that previously parsed to 0ms.
- The change is small and easy to reason about, but the new `ms === 0 && value !== 0` guard will fire for any value that legitimately rounds to 0ms (not just float underflow), which could be behavior-breaking for callers that allow very small durations.
- src/cli/parse-duration.ts

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-01)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** tiny (5+, 1-, 1 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: (none detected)
