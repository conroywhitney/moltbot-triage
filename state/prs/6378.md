---
number: 6378
title: "fix(cli): escape brackets in zsh completion option descriptions"
author: janckerchen
created: 2026-02-01T15:57:11Z
updated: 2026-02-01T16:06:45Z
labels: ["cli"]
additions: 6
deletions: 1
changed_files: 1
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6378
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Fixes zsh completion parser error when tab-completing commands with options that have quotes or special characters in their descriptions.

## Problem

When running `openclaw gateway res<TAB>`, zsh reports:
```
_arguments:comparguments:327: invalid option definition: --compact[Alias for --ws-log
```

**Root Cause:** The `generateZshArgs` function was not escaping special characters in option descriptions. Options like `--ws-log` with descriptions containing quotes like `("auto"|"full"|"compact")` broke zsh's `_arguments` parser when embedded in double-quoted strings.

Example of broken output:
```zsh
"--ws-log[WebSocket log style ("auto"|"full"|"compact")]"
                                 â†‘ unescaped quotes break parsing
```

## Solution

Added proper escaping for all special characters in option descriptions:

```typescript
const desc = opt.description
  .replace(/\\/g, "\\\\")      // Backslashes (must be first!)
  .replace(/"/g, "\\\"")       // Double quotes (main issue)
  .replace(/'/g, "'\\''")      // Single quotes
  .replace(/\[/g, "\\[")       // Square brackets
  .replace(/\]/g, "\\]");
```

**Key insight:** Escaping order matters - backslash must be escaped first to avoid double-escaping other characters.

Now generates correctly escaped output:
```zsh
"--ws-log[WebSocket log style (\"auto\"|\"full\"|\"compact\")]"
```

## Testing

1. âœ… Built and verified the generated completion script properly escapes all special chars
2. âœ… Manual test: `source <(openclaw completion --shell zsh)` loads without errors
3. âœ… Tab completion now works: `openclaw gateway res<TAB>` completes successfully
4. âœ… Existing tests pass

## Related

- Fixes completion errors for any option with special characters in descriptions
- Aligns with proper zsh `_arguments` escaping requirements
- Follows similar pattern to `generateZshSubcmdList` but adds quote escaping

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** tiny (6+, 1-, 1 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: (none detected)
