---
number: 6505
title: "fix(whatsapp): use actual filename for document sends instead of hardcoded 'file'"
author: sidmohan0
created: 2026-02-01T18:42:08Z
updated: 2026-02-01T18:46:08Z
labels: ["channel: whatsapp-web"]
additions: 63
deletions: 3
changed_files: 5
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"sidmohan0","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6505
fixes_issues: [6455]
related_prs: [6455]
duplicate_of: null
---

## Description

## Summary

Fixes #6455 — WhatsApp document sends always used the hardcoded filename `"file"` regardless of the actual source filename. Recipients see every document named "file" instead of the real name (e.g. "report.pdf").

## Root Cause

`loadWebMedia()` already extracts and returns `fileName` from the media source, but it was never threaded through to the Baileys payload:

1. `sendMessageWhatsApp()` in `web/outbound.ts` called `loadWebMedia()`, captured `media.buffer` and `media.contentType`, but **dropped `media.fileName`**
2. `createWebSendApi().sendMessage()` in `web/inbound/send-api.ts` **hardcoded `fileName: "file"`** for all document payloads

## Fix

Thread the existing `fileName` through via `ActiveWebSendOptions` (3 lines of plumbing):

- **`active-listener.ts`**: Add `fileName?: string` to `ActiveWebSendOptions`
- **`outbound.ts`**: Capture `media.fileName` from `loadWebMedia()` result, include in `sendOptions`
- **`send-api.ts`**: Use `sendOptions?.fileName ?? "file"` instead of hardcoded `"file"`

Falls back to `"file"` when no filename is available (zero behavior change for existing callers).

## What's NOT changed

- No other channels affected (WhatsApp-only code path)
- No changes to `message-action-runner.ts` or `inferAttachmentFilename()`
- No new dependencies

## Testing

- [x] Updated existing test `"maps other kinds to document with filename"` to verify filename flows through
- [x] Added new test `"falls back to 'file' when loadWebMedia returns no fileName"` for the fallback
- [x] `pnpm tsgo` — no type errors
- [x] `pnpm format` — clean
- [x] `pnpm lint` — 0 warnings, 0 errors
- [x] `pnpm build` — clean
- [x] `pnpm test` — all passing (10/10 in outbound suite, 880/880 full suite)

## AI Disclosure

Built with Claude (AI-assisted). Fully tested locally. I understand what the code does. 

**Diff: 4 files, +23 / -3 lines.**

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR threads a `fileName` value extracted by `loadWebMedia()` through the WhatsApp Web outbound/send pipeline so document messages display the original filename instead of a hardcoded `"file"`. Concretely:
- `ActiveWebSendOptions` adds an optional `fileName` field (`src/web/active-listener.ts`).
- `sendMessageWhatsApp` captures `media.fileName` and passes it via `sendOptions` (`src/web/outbound.ts`).
- The Baileys document payload now uses `sendOptions?.fileName ?? "file"` (`src/web/inbound/send-api.ts`).
- Tests were updated to cover filename propagation and intended fallback (`src/web/outbound.test.ts`).

The change is localized to the WhatsApp web channel and fits the existing pattern of threading per-send options through `ActiveWebSendOptions` to the Baileys payload builder.

<h3>Confidence Score: 4/5</h3>

- This PR is low risk and should be safe to merge after tightening the fallback test to actually cover the send-api defaulting behavior.
- Behavioral change is small and localized (adds an optional option field and uses it when constructing document payloads). The only real concern is test coverage: the newly added fallback test doesn’t exercise the `send-api` defaulting path, so a future regression there could slip through.
- src/web/outbound.test.ts

<!-- greptile_other_comments_section -->

<sub>(5/5) You can turn off certain types of comments like style [here](https://app.greptile.com/review/github)!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-01)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @sidmohan0 — COMMENTED (2026-02-01)




## Comments


## Stats

- **Size:** medium (63+, 3-, 5 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: #6455
