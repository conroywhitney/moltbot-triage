---
number: 5486
title: "Fix status display to show correct model for each agent's sessions"
author: jsholmes
created: 2026-01-31T15:01:09Z
updated: 2026-02-02T20:15:45Z
labels: ["commands"]
additions: 13
deletions: 4
changed_files: 1
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 2
ci_status: passing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/5486
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

The `openclaw status` command was showing the default agent's model (claude-opus-4-5) for all new sessions, regardless of which agent owned them.

This happened because new sessions don't have the `model` field populated until their first API call completes. The fallback logic in `status.summary.ts` line 98 used `configModel` (the default agent's configured model) when `entry?.model` was null.

## Solution

This PR fixes the issue by:
1. Importing `resolveAgentModelPrimary` from `agent-scope.js`
2. Resolving each session's agent ID from the session key
3. Looking up that agent's configured model  
4. Using the agent's model as fallback instead of the default agent's model

## Testing

Before fix - all sessions showed `claude-opus-4-5`:
```
â”‚ agent:minimax-agent:telegram:grâ€¦  â”‚ group  â”‚ 3m ago  â”‚ claude-opus-4-5 â”‚ 0.0k/200k (0%) â”‚
â”‚ agent:kimi-agent:telegram:groupâ€¦  â”‚ group  â”‚ 3m ago  â”‚ claude-opus-4-5 â”‚ 0.0k/200k (0%) â”‚
â”‚ agent:gpt-agent:telegram:group:â€¦  â”‚ group  â”‚ 3m ago  â”‚ claude-opus-4-5 â”‚ 0.0k/200k (0%) â”‚
```

After fix - sessions show their agent's configured model:
```
â”‚ agent:minimax-agent:telegram:grâ€¦  â”‚ group  â”‚ 3m ago  â”‚ minimax/minimax-m2-her â”‚ 0.0k/1000k (0%) â”‚
â”‚ agent:kimi-agent:telegram:groupâ€¦  â”‚ group  â”‚ 5m ago  â”‚ moonshotai/kimi-k2.5   â”‚ 13k/262k (5%)   â”‚
â”‚ agent:gpt-agent:telegram:group:â€¦  â”‚ group  â”‚ 10m ago â”‚ gpt-5.2                â”‚ 12k/400k (3%)   â”‚
```

## Files Changed

- `src/commands/status.summary.ts`: Added agent-specific model resolution

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates `openclaw status` session rendering to avoid showing the default agentâ€™s configured model for new sessions that havenâ€™t populated `entry.model` yet. In `src/commands/status.summary.ts`, it derives an `agentId` per session (via parsing the session key and/or an override) and uses `resolveAgentModelPrimary(cfg, agentId)` as the fallback model before falling back to the global configured model.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge, but double-check the new import path/extension resolves in the built output.
- Change is small and localized to status display fallback logic, but thereâ€™s a concrete risk of a module resolution/build break if `../agents/agent-scope.js` isnâ€™t an actual resolvable module in the emitted artifacts (this checkout only shows `agent-scope.ts`).
- src/commands/status.summary.ts (new import path), src/agents/agent-scope.ts (verify export/emit mapping)

<!-- greptile_other_comments_section -->

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-01-31)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @jsholmes (2026-01-31)

Thanks for the review! The module resolution concern is addressed:

**Import pattern is correct:**
The import `from "../agents/agent-scope.js"` follows the standard TypeScript ESM pattern used throughout the codebase. All imports in this file use `.js` extensions even though source files are `.ts`:
- `from "../agents/context.js"`
- `from "../agents/defaults.js"`
- `from "../config/config.js"`

**Verified in build output:**
- âœ… Source file exists: `src/agents/agent-scope.ts`
- âœ… Function is exported at line 117
- âœ… Built file exists: `dist/agents/agent-scope.js`
- âœ… Export present in built output at line 79
- âœ… Import resolves correctly in `dist/commands/status.summary.js`

**Tested before/after:**
Without the fix (at commit 77e703c6):
```
â”‚ agent:gpt-agent:telegram:group:â€¦ â”‚ group â”‚ 45m ago â”‚ claude-opus-4-5 â”‚ 0.0k/200k (0%) â”‚
```
âŒ Shows wrong model for new gpt-agent session

With the fix (at commit 72ec4611):
```
â”‚ agent:gpt-agent:telegram:group:â€¦ â”‚ group â”‚ 46m ago â”‚ openai-codex/gpt-5.2 â”‚ 0.0k/200k (0%) â”‚
```
âœ… Shows correct model

The module resolution works correctly and the fix has been verified!


## Stats

- **Size:** small (13+, 4-, 1 files)
- **Age:** 2 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
