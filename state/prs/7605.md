---
number: 7605
title: "fix(cron): support postToMainMode \"off\" + fix session dropdown (#4575)"
author: briancolinger
created: 2026-02-03T01:14:06Z
updated: 2026-02-03T04:53:47Z
labels: ["app: web-ui", "gateway", "cli"]
additions: 113
deletions: 54
changed_files: 6
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"briancolinger","state":"COMMENTED"},{"author":"briancolinger","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7605
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

Setting `isolation.postToMainMode: "off"` on isolated cron jobs is rejected by API validation, even though the type system (`CronIsolation`) and runtime (`timer.ts`) already support it.

This means there is no way to silence noisy cron jobs that post "nothing to do" summaries to the main session every N minutes. For users running periodic task runners or polling jobs, this creates significant noise in the main chat session.

### Error

```
invalid cron.update params: at /patch/isolation/postToMainMode:
must be equal to constant; must match a schema in anyOf
```

## Root Cause

The `CronIsolation` type in `types.ts` includes `"off"` in the union:
```ts
postToMainMode?: "summary" | "full" | "off";
```

But the TypeBox/Ajv validation schema in `protocol/schema/cron.ts` only accepts:
```ts
Type.Union([Type.Literal("summary"), Type.Literal("full")])
```

The runtime guard in `timer.ts` was also missing.

## Fix

1. **Schema** (`src/gateway/protocol/schema/cron.ts`): Add `Type.Literal("off")` to `CronIsolationSchema.postToMainMode`
2. **Runtime** (`src/cron/service/timer.ts`): Add `if (mode !== "off")` guard around `enqueueSystemEvent` call
3. **CLI** (`src/cli/cron-cli/register.cron-add.ts`): Accept `"off"` in `--post-mode` option and update help text

## Usage

```bash
# CLI
openclaw cron add --name my-job --post-mode off ...

# API
cron.update({ jobId: "...", patch: { isolation: { postToMainMode: "off" } } })
```

## Testing

Tested locally by patching the installed dist and updating a cron job via `openclaw gateway call cron.update`. Confirmed the system event is no longer injected into the main session when `postToMainMode: "off"` is set.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR aligns cron isolation behavior across type definitions, API validation, runtime execution, and the CLI by adding support for `isolation.postToMainMode: "off"`. Specifically, it expands the TypeBox schema to accept `"off"`, updates the `CronIsolation` type union and docs, gates main-session posting in the cron timer when mode is `"off"`, and updates `openclaw cron add --post-mode` help/handling to allow `off`.

Overall, the changes are small and consistent with the existing design (post-to-main is an isolation concern), but there is one runtime behavior that still wakes the main lane even when posting is disabled.

<h3>Confidence Score: 4/5</h3>

- This PR is generally safe to merge, with a small behavior mismatch around heartbeats when post-to-main is disabled.
- Schema/type/CLI updates are straightforward and the runtime guard correctly prevents enqueueing system events when `postToMainMode` is `off`. The remaining concern is that `wakeMode: now` still triggers a heartbeat even when no post occurs, which could reintroduce noise/work in some setups; otherwise the changes are low-risk.
- src/cron/service/timer.ts (heartbeat behavior when postToMainMode is off)

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>2 files reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @briancolinger — COMMENTED (2026-02-03)



### @briancolinger — COMMENTED (2026-02-03)




## Comments

### @briancolinger (2026-02-03)

## Context on the `activeMinutes` removal (session dropdown fix, #4575)

Traced the git history to understand why this filter existed before removing it:

1. **Originally**: `activeMinutes: 0` — no filter, all sessions shown in dropdown
2. **Jan 30 (`57c34a32`, Tyler Yust)**: Changed to `CHAT_SESSIONS_ACTIVE_MINUTES = 10` (10 minutes) as part of "enhance session display names" — intent was to keep the dropdown tidy
3. **Feb 1 (`f8575c40`, same author)**: Bumped to `120` (2 hours) because 10 minutes was too aggressive — commit message explicitly says "Increased CHAT_SESSIONS_ACTIVE_MINUTES from 10 to 120 for extended session duration"
4. **Feb 2 (#4575 opened)**: Users reported the dropdown only shows the current session

The filter was a UI polish attempt (3 days old) that had unintended consequences — it hides the exact sessions users need to switch to (Telegram channels, cron jobs, background sessions). The original behavior showed all sessions, and the dropdown/select component handles the full list correctly.

If the session list grows too long in the future, a better approach would be UI-level filtering (search/categories in the dropdown) rather than silently hiding sessions based on recency.


## Stats

- **Size:** medium (113+, 54-, 6 files)
- **Age:** 0 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
