---
number: 5305
title: "fix(slack): skip conversations.list API call when all channel entries are IDs"
author: gunpyo-park-musinsa
created: 2026-01-31T09:30:22Z
updated: 2026-02-01T11:22:25Z
labels: ["channel: slack"]
additions: 81
deletions: 3
changed_files: 2
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/5305
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

When Slack channels are configured using channel IDs (e.g., `C087C6LMAQZ`) instead of names (e.g., `#general`), the `resolveSlackChannelAllowlist` function still calls `conversations.list` API to fetch all channels. This causes:

1. **Unnecessary API calls** - Channel IDs don't need resolution
2. **Rate limit issues** - Repeated calls can trigger Slack's rate limits (30s retry loops)
3. **Slow startup** - Fetching channel list delays provider initialization

## Solution

Pre-parse all entries before fetching the channel list. Only call `conversations.list` when at least one entry requires name-based resolution.

```typescript
const needsChannelList = parsedEntries.some(({ parsed }) => !parsed.id && parsed.name);
const channels = needsChannelList ? await listSlackChannels(client) : [];
```

## Testing

Added 3 new test cases:
- ‚úÖ Skips API call when all entries are channel IDs
- ‚úÖ Calls API when entries contain a mix of IDs and names  
- ‚úÖ Handles Slack mention format without API call

All existing tests pass.

## Impact

- Zero breaking changes
- Significant performance improvement for ID-based configurations
- Eliminates rate limit issues when using channel IDs

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

Optimizes Slack channel resolution by pre-parsing entries and skipping the `conversations.list` API call when all channel entries are IDs. Previously, the function always fetched the full channel list from Slack, even when all entries were already channel IDs that don't need resolution. The new logic checks if any entry requires name-based lookup (`!parsed.id && parsed.name`) before calling the API, eliminating unnecessary API calls and preventing rate limit issues for ID-based configurations.

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with no identified risks
- The change is a pure optimization that preserves existing behavior while eliminating unnecessary API calls. The logic is straightforward: parse all entries first, check if any require name resolution, and only fetch the channel list if needed. All edge cases are covered by comprehensive tests, and the implementation maintains backward compatibility
- No files require special attention

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps ‚Äî COMMENTED (2026-01-31)

<sub>No files reviewed, no comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @gunpyo-park-musinsa (2026-02-01)

## CI Failures Analysis

The CI failures appear to be **unrelated to this PR**:

### 1. `swiftlint` failure
- ‚ùå No Swift files were modified in this PR
- This PR only modifies `src/slack/resolve-channels.ts` and its test file

### 2. `docker-setup.test.ts` failure
- ‚ùå No Docker-related files were modified
- Error: `AssertionError: expected '...' to contain '"gateway"'`
- This seems to be a pre-existing test issue

### Files changed in this PR:
- `src/slack/resolve-channels.ts`
- `src/slack/resolve-channels.test.ts`

Could you please check if these are known issues or re-run the CI? Thanks! üôè


## Stats

- **Size:** medium (81+, 3-, 2 files)
- **Age:** 2 days
- **Last activity:** 2026-02-01

## Links

- Fixes: (none detected)
