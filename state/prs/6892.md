---
number: 6892
title: "feat(telegram): add inline button support for exec approvals"
author: Dutchthenomad
created: 2026-02-02T05:10:49Z
updated: 2026-02-02T05:17:41Z
labels: ["channel: telegram"]
additions: 197
deletions: 13
changed_files: 4
size: large
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"copilot-pull-request-reviewer","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6892
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Adds one-tap approval/rejection of exec commands directly in Telegram via inline keyboard buttons.

## Changes

- **extensions/telegram/src/channel.ts**: Add `sendPayload` method to Telegram channel adapter supporting inline keyboards
- **src/telegram/bot-handlers.ts**: Implement callback query handler for `approve:*` and `reject:*` button taps
- **src/infra/exec-approval-forwarder.ts**: Forward approvals with interactive buttons to Telegram
- **src/channels/plugins/outbound/load.ts**: Update outbound plugin loader to expose `sendPayload` capability

## How it works

1. When an exec approval is requested, the forwarder generates inline buttons (Approve/Reject)
2. Telegram displays the approval request with tappable buttons
3. User taps a button, callback query is handled, approval is resolved
4. Message is updated to show the decision

## Testing

- Verified buttons appear in Telegram messages
- Verified button taps resolve approvals correctly
- Gateway logs show clean resolution without debug output

---

Generated with [Claude Code](https://claude.com/claude-code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds Telegram inline keyboard buttons for exec approvals by introducing a `sendPayload` capability in the Telegram outbound adapter, passing per-channel button metadata through outbound delivery, and handling `approve:<id>:<decision>` callback queries to resolve approvals and edit the original message.

Key integration points:
- `extensions/telegram/src/channel.ts` implements `outbound.sendPayload` to send text/media with optional inline buttons.
- `src/infra/exec-approval-forwarder.ts` now builds an approval message plus button rows and forwards them only to Telegram via `payload.channelData.telegram.buttons`.
- `src/channels/plugins/outbound/load.ts` falls back to statically-imported built-in outbound adapters so `sendPayload` is available even when the plugin registry doesnâ€™t have a channel entry.
- `src/telegram/bot-handlers.ts` adds callback query handling for the approval buttons and edits the original message to reflect the decision.

Main concerns are around correctness and security of the new callback handling (one block is currently in the wrong scope and will throw at runtime; another path resolves approvals based solely on callback data without verifying the sender is authorized).

<h3>Confidence Score: 2/5</h3>

- Not safe to merge as-is due to a clear runtime error and an authorization gap in the new approval callback path.
- The PR introduces a new callback handler that (a) is duplicated into `flushTextFragments` where referenced variables are out of scope and will throw, and (b) resolves exec approvals based on callback data without verifying the tapper is an allowed approver. These are high-impact issues affecting reliability and access control. Other changes are mostly straightforward plumbing for `sendPayload`.
- src/telegram/bot-handlers.ts; src/infra/exec-approval-forwarder.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-02)

<sub>2 files reviewed, 3 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @copilot-pull-request-reviewer â€” COMMENTED (2026-02-02)

## Pull request overview

This pull request adds inline button support for exec command approvals specifically for Telegram. When an exec approval is requested, Telegram users can now tap "Allow Once", "Allow Always", or "Deny" buttons directly in the message instead of typing commands.

**Changes:**
- Added inline button callback handler to Telegram bot for processing approval button taps
- Modified exec approval forwarder to generate button payloads and send them to Telegram
- Extended Telegram channel adapters with `sendPayload` method to support inline buttons and channel-specific data
- Added static fallback adapters for outbound channel loading to ensure `sendPayload` capability is available

### Reviewed changes

Copilot reviewed 4 out of 4 changed files in this pull request and generated 8 comments.

| File | Description |
| ---- | ----------- |
| src/telegram/bot-handlers.ts | Added callback query handler for `approve:*` button taps, includes approval resolution logic and message updates |
| src/infra/exec-approval-forwarder.ts | Modified approval message format to include inline buttons (Telegram-only), removed command-based instructions |
| src/channels/plugins/outbound/load.ts | Added static fallback adapters with imports for built-in channels to support `sendPayload` |
| extensions/telegram/src/channel.ts | Implemented `sendPayload` method in Telegram plugin to handle buttons and channel-specific data |





---

ðŸ’¡ <a href="/openclaw/openclaw/new/main/.github/instructions?filename=*.instructions.md" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Add Copilot custom instructions</a> for smarter, more guided reviews. <a href="https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Learn how to get started</a>.


## Comments


## Stats

- **Size:** large (197+, 13-, 4 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
