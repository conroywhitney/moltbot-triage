---
number: 4459
title: "fix: enable image input for Kimi K2.5 and refresh stale config model definitions"
author: manikv12
created: 2026-01-30T07:24:12Z
updated: 2026-02-03T02:26:05Z
labels: ["agents"]
additions: 35
deletions: 14
changed_files: 3
size: small
review_decision: none
reviews: [{"author":"chatgpt-codex-connector","state":"COMMENTED"},{"author":"copilot-pull-request-reviewer","state":"COMMENTED"},{"author":"manikv12","state":"COMMENTED"},{"author":"manikv12","state":"COMMENTED"},{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4459
fixes_issues: []
related_prs: [4407]
duplicate_of: null
---

## Description

## Summary

Follow-up to #4407 (5e635c9) which added Kimi K2.5 to the synthetic catalog but declared it text-only.

- **Enable image input** for Kimi K2.5 in both the synthetic catalog (`synthetic-models.ts`) and the moonshot provider (`models-config.providers.ts`).
- **Fix stale config override bug** in `mergeProviderModels` (`models-config.ts`): onboarding bakes the full model catalog into `~/.openclaw/openclaw.json`, and the old merge logic let stale config definitions shadow code updates ‚Äî so even after fixing the catalog in code, existing users would never see capability changes (like adding image support).

### What changed in the merge logic

**Before:** when both config file and code defined a model with the same ID, config always won ‚Äî stale values for `input`, `reasoning`, `contextWindow`, `maxTokens` persisted forever.

**After:** code-defined capability fields override stale config entries, while user-specific fields (`cost`, `headers`, `compat`, `apiKey`) are preserved from config.

This affects all 7 providers that write model definitions during onboarding: synthetic, moonshot, kimi-code, xiaomi, venice, minimax, and qwen-portal.

### Testing

- Verified old merge produces `["text"]` (broken), new merge produces `["text", "image"]` (fixed)
- Verified user-specific fields (cost, apiKey) are preserved through merge
- Verified new model IDs from code are still appended
- End-to-end gateway test: stale `openclaw.json` + code fix ‚Üí runtime `models.json` has correct `["text", "image"]`

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR enables image input for Kimi K2.5 in both the synthetic catalog and the Moonshot provider defaults, and updates model merging so code-defined capability fields refresh stale model definitions that were previously written into users‚Äô `openclaw.json` during onboarding.

The core behavioral change is in `mergeProviderModels`, which now merges per-model entries by id: it preserves user-specific overrides from the config (e.g., cost/headers/compat/apiKey) while taking updated capability fields from the code-defined catalog, and still appends any new code-defined model ids not present in the config.

<h3>Confidence Score: 4/5</h3>

- This PR is generally safe to merge and addresses a real stale-config issue with low blast radius.
- Changes are localized to model catalog metadata and the merge behavior for provider model definitions; the new merge logic is straightforward and preserves explicit provider config while refreshing a fixed set of capability fields. Main remaining risk is schema drift: if additional capability fields exist or are added later, they may still remain stale, and the current override assigns `undefined` if an implicit model omits one of the refreshed fields.
- src/agents/models-config.ts

<!-- greptile_other_comments_section -->

<sub>(3/5) Reply to the agent's comments like "Can you suggest a fix for this @greptileai?" or ask follow-up questions!</sub>

<!-- /greptile_comment -->

## Reviews

### @chatgpt-codex-connector ‚Äî COMMENTED (2026-01-30)


### üí° Codex Review

Here are some automated review suggestions for this pull request.

**Reviewed commit:** `8bca9fd828`
    

<details> <summary>‚ÑπÔ∏è About Codex in GitHub</summary>
<br/>

[Your team has set up Codex to review pull requests in this repo](http://chatgpt.com/codex/settings/general). Reviews are triggered when you
- Open a pull request for review
- Mark a draft as ready
- Comment "@codex review".

If Codex has suggestions, it will comment; otherwise it will react with üëç.




Codex can also answer questions or update the PR. Try commenting "@codex address that feedback".
            
</details>

### @copilot-pull-request-reviewer ‚Äî COMMENTED (2026-01-30)

## Pull request overview

Enables image input support for Kimi K2.5 and updates provider model merge behavior so code-defined capability updates can take effect even when users have stale model definitions in their config.

**Changes:**
- Enabled `["text", "image"]` input for Kimi K2.5 in the synthetic model catalog.
- Enabled `["text", "image"]` input for Kimi K2.5 in the Moonshot provider defaults.
- Reworked `mergeProviderModels` to merge implicit (code) and explicit (config) model definitions by ID instead of letting explicit always fully shadow implicit.

### Reviewed changes

Copilot reviewed 3 out of 3 changed files in this pull request and generated 2 comments.

| File | Description |
| ---- | ----------- |
| src/agents/synthetic-models.ts | Marks Kimi K2.5 as accepting image input in the synthetic catalog. |
| src/agents/models-config.ts | Changes model merge strategy to refresh stale config entries based on code-defined models. |
| src/agents/models-config.providers.ts | Updates Moonshot‚Äôs default Kimi K2.5 model to accept image input. |





---

üí° <a href="/openclaw/openclaw/new/main/.github/instructions?filename=*.instructions.md" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Add Copilot custom instructions</a> for smarter, more guided reviews. <a href="https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Learn how to get started</a>.

### @manikv12 ‚Äî COMMENTED (2026-01-30)



### @manikv12 ‚Äî COMMENTED (2026-01-30)



### @greptile-apps ‚Äî COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** small (35+, 14-, 3 files)
- **Age:** 3 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
