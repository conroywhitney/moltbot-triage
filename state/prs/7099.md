---
number: 7099
title: "feat(tts): add Cartesia Sonic 3 as TTS provider"
author: alessiolidoz-hash
created: 2026-02-02T11:37:04Z
updated: 2026-02-02T11:50:58Z
labels: ["docs"]
additions: 219
deletions: 4
changed_files: 5
size: large
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/7099
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Adds [Cartesia Sonic 3](https://cartesia.ai/sonic) as a fourth TTS provider.

- **40ms TTFA** ‚Äî fastest TTS provider available (vs 75-300ms ElevenLabs, 200ms Edge)
- **40+ languages** with auto-detect (Italian, English, German, French, etc.)
- **Emotion controls** ‚Äî anger, positivity, surprise, sadness, curiosity
- **Simple config** ‚Äî `messages.tts.provider: "cartesia"` + API key
- **Telegram compatible** ‚Äî PCM‚ÜíOpus conversion via ffmpeg for voice notes
- **Fallback chain** ‚Äî integrates with existing provider fallback (Cartesia ‚Üí ElevenLabs ‚Üí Edge)

### Changes

| File | Change |
|------|--------|
| `src/config/types.tts.ts` | Add `"cartesia"` to `TtsProvider` type + config type |
| `src/tts/tts.ts` | `cartesiaTTS()` function + factory integration + PCM‚ÜíOpus helper |
| `src/config/zod-schema.core.ts` | Zod validation for Cartesia config fields |
| `src/config/schema.ts` | UI labels for Cartesia config |
| `docs/tts.md` | User documentation |

### Config Example

```json5
{
  messages: {
    tts: {
      provider: "cartesia",
      cartesia: {
        voiceId: "694f9389-aac1-45b6-b726-9d9369183238",
        modelId: "sonic-3",
        language: "it"
      }
    }
  }
}
```

### Requirements

- `ffmpeg` installed for Telegram Opus conversion (most systems have this)
- `CARTESIA_API_KEY` env var or `messages.tts.cartesia.apiKey` in config

### Test plan

- [x] TypeScript compilation (`pnpm tsgo`)
- [x] Linting (`pnpm lint`)
- [x] Build (`pnpm build`)
- [x] Unit tests (`pnpm test`)
- [ ] Manual test: Cartesia ‚Üí MP3 output (default channels)
- [ ] Manual test: Cartesia ‚Üí Opus output (Telegram voice note)
- [ ] Manual test: Fallback chain (no API key ‚Üí falls back to next provider)
- [ ] Manual test: Italian language TTS quality

ü§ñ AI-assisted: Analysis by Claude Opus 4.5 (Claude Code), code reviewed and understood.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds Cartesia (Sonic 3) as an additional TTS provider across config types (`TtsProvider` / `TtsConfig`), runtime resolution (`resolveTtsConfig`, API key lookup), and the main `textToSpeech` / `textToSpeechTelephony` flows. It also documents Cartesia usage and adds UI labels + Zod validation for the new config fields.

Key runtime changes are in `src/tts/tts.ts`, adding a `cartesiaTTS()` fetch-based implementation and a Telegram-specific PCM‚ÜíOpus conversion path via `ffmpeg`.

Issues found:
- `textToSpeech` returns the wrong `outputFormat` for Cartesia successes (it falls into the ‚Äúnon-openai‚Äù branch and reports ElevenLabs‚Äô format).
- Model directive parsing does not allow `provider=cartesia`, so Cartesia can‚Äôt be selected via `[[tts:...]]` overrides.
- The docs contain stray citation artifacts and the intro sentence doesn‚Äôt mention Cartesia.

<h3>Confidence Score: 3/5</h3>

- This PR is likely safe to merge after fixing a couple of correctness issues in the TTS reporting/override paths.
- Core integration looks straightforward (new provider, config plumbing, fetch call, Telegram conversion), but there are at least two user-visible correctness gaps: Cartesia results report the wrong outputFormat in `textToSpeech`, and directive parsing can‚Äôt select Cartesia despite adding it as a provider. Docs also contain visible artifacts that should be cleaned up.
- src/tts/tts.ts (provider outputFormat + directive provider list), docs/tts.md (citation artifacts and consistency)

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps ‚Äî COMMENTED (2026-02-02)

<sub>2 files reviewed, 4 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-02)

<details>
<summary>Additional Comments (3)</summary>

**`src/tts/tts.ts`**
[P1] `[[tts:provider=...]]` directives can‚Äôt select the new Cartesia provider

`parseTtsDirectives` only accepts `openai|elevenlabs|edge` for `provider`, so even with `TtsProvider` now including `cartesia`, model-driven overrides can‚Äôt request Cartesia. If Cartesia is intended to participate in the directive system (especially in `tagged` mode), this will silently ignore `provider=cartesia` and emit a warning.

Also affects the docs list of directive providers in docs/tts.md:282-283.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/tts/tts.ts
Line: 663:671

Comment:
[P1] `[[tts:provider=...]]` directives can‚Äôt select the new Cartesia provider

`parseTtsDirectives` only accepts `openai|elevenlabs|edge` for `provider`, so even with `TtsProvider` now including `cartesia`, model-driven overrides can‚Äôt request Cartesia. If Cartesia is intended to participate in the directive system (especially in `tagged` mode), this will silently ignore `provider=cartesia` and emit a warning.

Also affects the docs list of directive providers in docs/tts.md:282-283.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>

---

**`docs/tts.md`**
[P2] Docs include stray `\ue200cite...` artifacts

The Edge TTS section contains citation tokens like `\ue200cite\ue202turn2search0\ue201`, which looks like an LLM export artifact and will render as garbage in the published docs. Likely should be removed from this file.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: docs/tts.md
Line: 49:57

Comment:
[P2] Docs include stray `\ue200cite...` artifacts

The Edge TTS section contains citation tokens like `\ue200cite\ue202turn2search0\ue201`, which looks like an LLM export artifact and will render as garbage in the published docs. Likely should be removed from this file.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>

---

**`docs/tts.md`**
[P2] Docs still claim only ‚ÄúElevenLabs, OpenAI, or Edge‚Äù

The introduction says ‚ÄúOpenClaw can convert outbound replies into audio using ElevenLabs, OpenAI, or Edge TTS.‚Äù but the supported services list now includes Cartesia. Consider updating the intro sentence for consistency.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: docs/tts.md
Line: 12:20

Comment:
[P2] Docs still claim only ‚ÄúElevenLabs, OpenAI, or Edge‚Äù

The introduction says ‚ÄúOpenClaw can convert outbound replies into audio using ElevenLabs, OpenAI, or Edge TTS.‚Äù but the supported services list now includes Cartesia. Consider updating the intro sentence for consistency.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** large (219+, 4-, 5 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
