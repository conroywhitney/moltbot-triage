---
number: 4415
title: "fix: catch network-level fetch errors in web_fetch to prevent gateway crash"
author: spiceoogway
created: 2026-01-30T06:08:15Z
updated: 2026-01-30T06:16:44Z
labels: ["commands", "agents"]
additions: 113
deletions: 58
changed_files: 4
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4415
fixes_issues: [4392]
related_prs: [4392]
duplicate_of: null
---

## Description

## Summary

Fixes #4392. When `fetch()` fails at the network level (e.g., connection refused, DNS failure), the `web_fetch` tool did not catch the resulting `TypeError: fetch failed`. This caused an unhandled promise rejection that triggered `process.exit(1)` in `infra/unhandled-rejections.js`, crashing the entire gateway and orphaning all in-flight sub-agent sessions.

## Changes

- **`src/agents/tools/web-fetch.ts`**:
  - Wrap `execute` handler in try-catch to return error results instead of throwing — prevents network-level errors from becoming unhandled rejections
  - Add try-catch around `fetchFirecrawlContent`'s `fetch()` call for clearer error messages
  - Fix `void res.body?.cancel()` floating promise by adding `.catch(() => {})`

- **`src/agents/tools/web-tools.fetch.test.ts`**:
  - Update existing tests to expect error results instead of thrown errors (consistent with how the tool adapter handles errors)
  - Add new test: `returns error result for network-level TypeError instead of crashing`

## Testing

All 7 tests pass:
```
✓ src/agents/tools/web-tools.fetch.test.ts (7 tests) 289ms
```

## Reviews


## Comments


## Stats

- **Size:** medium (113+, 58-, 4 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #4392
