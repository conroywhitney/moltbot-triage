---
number: 2805
title: "fix: wire onToolResult to dispatcher for verbose tool summaries"
author: LinghaoZhuang
created: 2026-01-27T14:56:34Z
updated: 2026-02-03T03:56:53Z
labels: []
additions: 7
deletions: 0
changed_files: 1
size: tiny
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/2805
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
- Previously, `onToolResult` was not connected in `dispatchReplyFromConfig`, causing verbose tool summaries to not be sent to messaging channels like Telegram
- This adds the missing `onToolResult` handler similar to `onBlockReply`

## Test plan
- [x] Enable verbose mode in Telegram with `/verbose full`
- [x] Send a message that triggers tool calls
- [x] Verify tool result summaries are now visible in the chat

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This change updates `dispatchReplyFromConfig` to properly forward `onToolResult` callbacks through the configured `ReplyDispatcher`, matching the existing `onBlockReply` wiring so verbose tool-result summaries can reach external messaging channels (e.g., Telegram). It also introduces block-text accumulation to synthesize a TTS-only final audio reply when streaming completes without a final payload, using `resolveTtsConfig`/`maybeApplyTtsToPayload` to keep behavior consistent with existing TTS routing logic.

Overall, the PR focuses on improving reply dispatch plumbing so tool and block outputs are routed either via `routeReply` (cross-provider/originating channel) or via the dispatcher, and ensures TTS still works in streaming-only scenarios.

<h3>Confidence Score: 4/5</h3>

- Mostly safe to merge, but there is a small async-ordering issue in the new onToolResult routing path.
- The change is localized and follows existing patterns for block replies, but `onToolResult` currently fire-and-forgets an async route which can reorder or drop tool-result summaries relative to `waitForIdle()` and subsequent sends.
- src/auto-reply/reply/dispatch-from-config.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** tiny (7+, 0-, 1 files)
- **Age:** 6 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
