---
number: 4667
title: "fix: Auto-discover Ollama models without requiring API key"
author: spiceoogway
created: 2026-01-30T13:51:33Z
updated: 2026-01-30T13:51:45Z
labels: ["agents"]
additions: 12
deletions: 5
changed_files: 2
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4667
fixes_issues: [4544]
related_prs: [4544]
duplicate_of: null
---

## Description

## Problem

Fixes #4544

User reported that locally installed Ollama models (like `deepseek-r1:latest`) show as "missing" in OpenClaw even though they are installed and available via `ollama list`. The CLI command `openclaw models list` shows the model with status "missing" and using it results in "Unknown model" error.

## Root Cause

Ollama is a local service that doesn't require authentication, but the code was only enabling the Ollama provider if an API key was configured. This caused locally installed Ollama models to never be discovered.

## Solution

Modified `resolveImplicitProviders()` to auto-discover Ollama models and add the provider if models are found:

- Always call `buildOllamaProvider()` to attempt discovery
- Add provider if models are discovered OR if API key is explicitly configured
- Use "local" as placeholder API key for local auth (similar to existing patterns like `QWEN_PORTAL_OAUTH_PLACEHOLDER`)
- Respect explicit API key configuration if provided (for future use cases)

## Testing

- ✅ Updated test: `models-config.providers.ollama.test.ts`
- ✅ All existing model tests pass
- ✅ Discovery is gracefully skipped in test environments

## How to Test

1. Install Ollama: `brew install ollama`
2. Pull a model: `ollama pull deepseek-r1:latest`
3. Build and install patched OpenClaw
4. Run: `openclaw models list`
5. Expected: Model shows with "Local: yes" and "Auth: yes" instead of "missing"

## Files Changed

- `src/agents/models-config.providers.ts` - Modified provider resolution logic
- `src/agents/models-config.providers.ollama.test.ts` - Updated test description

## Reviews


## Comments


## Stats

- **Size:** small (12+, 5-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #4544
