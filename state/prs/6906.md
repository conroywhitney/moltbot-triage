---
number: 6906
title: "Add baseline HTTP security headers to gateway responses"
author: QuantumEdu
created: 2026-02-02T05:35:54Z
updated: 2026-02-02T05:36:58Z
labels: ["gateway"]
additions: 20
deletions: 0
changed_files: 2
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6906
fixes_issues: []
related_prs: [6675]
duplicate_of: null
---

## Description

## Summary

- Add a centralized `setSecurityHeaders()` helper in `http-common.ts` that applies four OWASP-recommended headers to every HTTP response
- Call it early in `handleRequest()` in `server-http.ts`, covering all gateway endpoints (hooks, tools, OpenAI, Control UI, etc.)

### Headers added

| Header | Value | Purpose |
|--------|-------|---------|
| `X-Content-Type-Options` | `nosniff` | Prevents MIME-sniffing attacks |
| `X-Frame-Options` | `SAMEORIGIN` | Mitigates clickjacking when CSP is absent |
| `Referrer-Policy` | `same-origin` | Limits referrer leakage to same origin |
| `Permissions-Policy` | `camera=(), microphone=(), geolocation=()` | Disables unused browser features |

All four headers are additive and non-breaking. They follow the baseline set proposed in #6675.

## Test plan

- [ ] Start gateway with `node dist/index.js gateway`
- [ ] `curl -sI http://localhost:18789/` and verify all four headers are present
- [ ] Confirm Control UI, SSE streams, and API endpoints all include the headers
- [ ] Run existing test suite to verify no regressions

Addresses part of #6675.

Generated with [Claude Code](https://claude.com/claude-code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR introduces a centralized `setSecurityHeaders()` helper (`src/gateway/http-common.ts`) and invokes it near the top of the gateway HTTP request handler (`src/gateway/server-http.ts`) so that most gateway endpoints consistently emit a baseline set of OWASP-recommended response headers (nosniff, frame options, referrer policy, and a restrictive permissions policy). This aligns response hardening across the various HTTP handlers (hooks, tools, OpenAI/OpenResponses, Control UI, etc.) without having to duplicate header setting logic in each endpoint.

<h3>Confidence Score: 4/5</h3>

- This PR is generally safe to merge; it adds standard response headers with minimal behavioral impact.
- Changes are small and localized (one helper + one call site). The only notable gap is that the early return for WebSocket upgrades means the new headers won’t cover the 101 handshake, which may conflict with the stated goal of applying headers to every gateway response.
- src/gateway/server-http.ts (WebSocket upgrade early return)

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-02)

<details>
<summary>Additional Comments (1)</summary>

**`src/gateway/server-http.ts`**
[P1] WebSocket upgrade path now skips all response header hardening.

`handleRequest()` returns early for `Upgrade: websocket`, so the baseline security headers won’t be applied to the 101 Switching Protocols handshake. If the intent is “every gateway response”, this is a gap for any WS clients (e.g., Control UI/web sockets) and is easy to miss because the function name/comment says “every response”.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/gateway/server-http.ts
Line: 238:244

Comment:
[P1] WebSocket upgrade path now skips all response header hardening.

`handleRequest()` returns early for `Upgrade: websocket`, so the baseline security headers won’t be applied to the 101 Switching Protocols handshake. If the intent is “every gateway response”, this is a gap for any WS clients (e.g., Control UI/web sockets) and is easy to miss because the function name/comment says “every response”.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** small (20+, 0-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
