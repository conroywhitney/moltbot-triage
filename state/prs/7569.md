---
number: 7569
title: "fix: add null checks to prevent TypeError in subagent spawn"
author: kaigritun
created: 2026-02-03T00:26:23Z
updated: 2026-02-03T00:27:29Z
labels: ["agents"]
additions: 2
deletions: 2
changed_files: 2
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: passing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7569
fixes_issues: [7443]
related_prs: [7443]
duplicate_of: null
---

## Description

Add null coalescing operators to prevent 'Cannot read properties of undefined (reading trim)' errors when spawning subagents:

- lanes.ts: Guard key.trim() with ?? ""
- system-prompt.ts: Guard file.path.trim() with ?? ""

These crashes occur when optional string parameters are undefined, causing subagents to fail immediately on spawn.

Fixes #7443

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds defensive nullish-coalescing guards around `.trim()` calls that can receive `undefined` at runtime, preventing subagent spawn failures (notably when normalizing session lane keys and when scanning injected context file paths for `soul.md`). The change is localized to `resolveSessionLane` in `src/agents/pi-embedded-runner/lanes.ts` and the `hasSoulFile` detection logic inside `buildAgentSystemPrompt` in `src/agents/system-prompt.ts`.

<h3>Confidence Score: 4/5</h3>

- This PR is low-risk and primarily adds defensive guards to prevent runtime crashes.
- Changes are small and localized, but there may be a minor type-safety concern where a function typed to accept `string` is now handling `undefined` at runtime (suggesting an upstream typing mismatch).
- src/agents/pi-embedded-runner/lanes.ts (type signature vs runtime inputs)

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews


## Comments


## Stats

- **Size:** tiny (2+, 2-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #7443
