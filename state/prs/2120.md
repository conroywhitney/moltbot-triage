---
number: 2120
title: "fix(voice-call): check env vars before validation errors"
author: dguido
created: 2026-01-26T07:39:25Z
updated: 2026-02-03T03:57:49Z
labels: ["channel: voice-call"]
additions: 6
deletions: 6
changed_files: 1
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/2120
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

- Fix `validateProviderConfig()` to check environment variables as fallback before reporting missing credentials
- Previously, validation would fail even when `TWILIO_ACCOUNT_SID`, `TWILIO_AUTH_TOKEN`, etc. were set via env vars

## Problem

The voice-call plugin's `runtime.ts` already resolves credentials from env vars as fallback (lines 40-65), but `validateProviderConfig()` in `config.ts` runs first and reports errors without checking env vars.

This meant deployments using env vars for secrets (the recommended secure approach) would see confusing validation errors like:
```
plugins.entries.voice-call.config.twilio.accountSid is required (or set TWILIO_ACCOUNT_SID env)
```
...even when `TWILIO_ACCOUNT_SID` was correctly set.

## Changes

Added `process.env.*` fallback checks for all provider credentials:
- Twilio: `TWILIO_ACCOUNT_SID`, `TWILIO_AUTH_TOKEN`
- Telnyx: `TELNYX_API_KEY`, `TELNYX_CONNECTION_ID`
- Plivo: `PLIVO_AUTH_ID`, `PLIVO_AUTH_TOKEN`

## Test plan

- [ ] Deploy with credentials in env vars only (empty `twilio: {}` in config)
- [ ] Verify no validation errors on startup
- [ ] Verify calls work correctly

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the voice-call extension‚Äôs `validateProviderConfig()` to treat provider credentials as satisfied when they are present via environment variables (Twilio/Telnyx/Plivo), matching the existing runtime provider resolution logic in `extensions/voice-call/src/runtime.ts`.

Net effect: deployments that intentionally keep secrets out of config files and supply `TWILIO_*`, `TELNYX_*`, or `PLIVO_*` env vars will no longer see misleading ‚Äúmissing credential‚Äù validation errors during startup/registration; validation now aligns with how the runtime actually resolves credentials.

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- The change is a small, localized adjustment to config validation logic and matches existing runtime behavior for resolving provider credentials from environment variables. It does not alter provider runtime wiring beyond avoiding false-negative validation errors.
- No files require special attention

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps ‚Äî COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`extensions/voice-call/src/config.ts`**
[P1] `fromNumber` validation ignores env-var fallback

`validateProviderConfig()` now treats provider credentials as satisfied if the corresponding `process.env.*` is set, but `fromNumber` is still required purely from config (`if (!config.fromNumber && config.provider !== "mock")`). If runtime supports reading `fromNumber` from env vars (or otherwise can operate without it when `publicUrl`/inbound-only flows are used), this will still block env-only deployments.

If `fromNumber` is intentionally config-only, consider updating the error string to remove any implication that env-var fallback works for *all* required fields.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: extensions/voice-call/src/config.ts
Line: 401:403

Comment:
[P1] `fromNumber` validation ignores env-var fallback

`validateProviderConfig()` now treats provider credentials as satisfied if the corresponding `process.env.*` is set, but `fromNumber` is still required purely from config (`if (!config.fromNumber && config.provider !== "mock")`). If runtime supports reading `fromNumber` from env vars (or otherwise can operate without it when `publicUrl`/inbound-only flows are used), this will still block env-only deployments.

If `fromNumber` is intentionally config-only, consider updating the error string to remove any implication that env-var fallback works for *all* required fields.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** small (6+, 6-, 1 files)
- **Age:** 7 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
