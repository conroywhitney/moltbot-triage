---
number: 3964
title: "[AI-Assisted] feat(security): add role-based access control (RBAC)"
author: ronit111
created: 2026-01-29T12:38:47Z
updated: 2026-01-29T12:39:01Z
labels: []
additions: 965
deletions: 0
changed_files: 3
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3964
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
- Add authorization layer on top of existing authentication
- 3 predefined roles: admin, operator, viewer
- 31 granular permissions across 8 categories (config, sessions, agents, channels, exec, gateway, nodes, audit)
- Custom roles with inheritance support
- Identity-to-role bindings with conditions (IP range, expiration)
- 34 unit tests

## Predefined Roles

| Role | Description |
|------|-------------|
| admin | Full administrative access (all 31 permissions) |
| operator | Operational access - can execute and monitor, cannot configure |
| viewer | Read-only access - can view status and audit logs |

## Permission Categories
- **config**: read, write, reload
- **sessions**: list, read, delete, export
- **agents**: list, create, delete, execute
- **channels**: list, connect, disconnect, configure
- **exec**: run, elevated, approve
- **gateway**: status, restart, shutdown
- **nodes**: list, register, remove, invoke
- **audit/metrics**: read, export

## Usage
```typescript
import { resolveRbacConfig, checkPermission, createContextFromAuth } from "./security/rbac.js";

const config = resolveRbacConfig({
  bindings: [
    { identity: "*@admin.com", role: "admin" },
    { identity: "service-*", role: "operator" },
  ],
});

const context = createContextFromAuth({ user: "alice@admin.com", method: "token" });
const result = checkPermission(context, "gateway.restart", config);
if (!result.allowed) {
  throw new Error(result.reason);
}
```

## Test plan
- [x] `pnpm lint` passes
- [x] `pnpm build` passes
- [x] `pnpm vitest run src/security/rbac.test.ts` - all 34 tests pass

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** large (965+, 0-, 3 files)
- **Age:** 1 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
