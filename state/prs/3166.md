---
number: 3166
title: "fix(whatsapp): normalize literal newline escape sequences in outbound messages"
author: zerone0x
created: 2026-01-28T06:10:38Z
updated: 2026-01-28T23:25:10Z
labels: []
additions: 58
deletions: 3
changed_files: 4
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/moltbot/moltbot/pull/3166
fixes_issues: [3082]
related_prs: [3082]
duplicate_of: null
---

## Description

## Summary
Fixes #3082

Some LLM providers output literal `\n` characters (the two-character sequence backslash-n) instead of actual newlines. This causes WhatsApp to display the escape sequences as visible text like `Hello\n\nWorld` rather than rendering actual line breaks.

## Changes
- Added `normalizeOutboundTextNewlines()` function to convert literal `\n`, `\r\n`, and `\r` escape sequences to actual newlines
- Applied normalization in the WhatsApp outbound adapter's `sendText` and `sendMedia` functions
- Added comprehensive tests for the new normalization function

## Test Plan
- [x] Unit tests for `normalizeOutboundTextNewlines()` pass
- [x] Existing tests continue to pass
- [x] Lint and build pass

---
ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** medium (58+, 3-, 4 files)
- **Age:** 1 days
- **Last activity:** 2026-01-28

## Links

- Fixes: #3082
