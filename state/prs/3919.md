---
number: 3919
title: "security: harden credential handling, API auth, and archive extraction"
author: VihariKanukollu
created: 2026-01-29T10:40:37Z
updated: 2026-01-29T10:40:48Z
labels: ["docs", "app: android", "app: macos", "app: web-ui", "gateway", "commands"]
additions: 702
deletions: 293
changed_files: 24
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3919
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

- Switched Control UI credential handling from query params to URL fragments (`#token=...`) to prevent server-side logging
- Added Gateway auth requirement for plugin HTTP `/api/**` endpoints (fixes unauthenticated Nostr profile API)
- Hardened Android WebView and A2UI bridge security
- Added defense-in-depth protections for archive extraction

## Changes

### Control UI Credential Handling
- Token/password hydration now uses URL fragments (`#token=...&password=...`) instead of query params
- Auto-strips credentials after first load
- Added security headers: `Referrer-Policy: no-referrer`, `X-Frame-Options: DENY`, `CSP frame-ancestors 'none'`, `X-Content-Type-Options: nosniff`

### Updated Surfaces
- macOS "Open Dashboard" now uses fragments
- CLI + onboarding emit fragment links
- Docs updated to use `#token=...` syntax

### Plugin HTTP Auth
- Gateway now enforces `authorizeGatewayConnect(...)` for plugin HTTP requests under `/api/**`
- Added config toggle `gateway.plugins.http.protectApiPaths` (default: `true`)
- Control UI sends `Authorization: Bearer <token>` for Nostr profile operations

### Android Hardening
- WebView: disabled mixed content, multi-window, reduced file URL privileges
- A2UI bridge: origin validation + 64KB payload cap
- TLS: enabled hostname verification for DNS names

### Archive Extraction
- Tar extraction now blocks path traversal + symlink/hardlink entries

### Dependencies
- Upgraded `tar` → 7.5.7, `hono` → 4.11.7
- Added overrides for `form-data`, `qs`, `tough-cookie` vulnerabilities

## Test Plan

- [x] `pnpm test` passes
- [x] `pnpm lint` passes
- [x] `pnpm audit --prod` reduced to 1 moderate (upstream matrix-bot-sdk dependency)

## Breaking Changes

Old `?token=...` / `?password=...` dashboard links no longer auto-auth. Use `#token=...` / `#password=...` instead.

## Reviews


## Comments


## Stats

- **Size:** large (702+, 293-, 24 files)
- **Age:** 1 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
