---
number: 4109
title: "fix(cli): bypass config guard for tui --url"
author: hopenjin
created: 2026-01-29T17:55:38Z
updated: 2026-02-03T02:52:37Z
labels: ["docs", "cli"]
additions: 51
deletions: 3
changed_files: 3
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 2
reactions_total: 1
ci_status: failing
mergeable: false
draft: false
url: https://github.com/openclaw/openclaw/pull/4109
fixes_issues: [3107]
related_prs: [3107]
duplicate_of: null
---

## Description

Fixes #3107.

Summary:
- Treat `moltbot tui --url ...` as client-only mode.
- Bypass config validation in the CLI preAction hook so a remote TUI client doesn’t require local plugins/config.

Testing:
- pnpm lint
- pnpm build
- pnpm test

AI-assisted: yes (Codex CLI).
Docker: not available locally for `docker run ...` smoke checks.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the CLI preAction hook so `moltbot tui --url …` is treated as a client-only mode and skips `ensureConfigReady`, allowing remote TUI usage without requiring local config/plugins. It also documents the behavior in `docs/cli/tui.md` and adds a focused Vitest to ensure the config guard is bypassed when `--url` is provided and still enforced otherwise.


<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge; changes are small and covered by a targeted unit test.
- The change is localized to the CLI preAction hook and gated on `tui` + `--url`, with a new test asserting both bypass and non-bypass paths. Main remaining risk is edge-case argv ordering/flag forms not covered by tests, and the new test’s reliance on global `process.argv` state.
- src/cli/program/preaction.ts; src/cli/program/preaction.tui-remote-bypass.test.ts

<!-- greptile_other_comments_section -->

<sub>(4/5) You can add custom instructions or style guidelines for the agent [here](https://app.greptile.com/review/github)!</sub>

<details><summary><h4>Context used (3)</h4></summary>

- Context from `dashboard` - docs/cli/agents.md ([source](https://app.greptile.com/review/custom-context?memory=057a11aa-5c5f-48bb-8d53-91b27b0fe3a2))
- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))
</details>


<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>2 files reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @hopenjin (2026-01-31)

CI is currently red due to the `macos-app` jobs timing out while waiting for a runner for 24h.

All Node/Bun/Windows/macOS unit checks have passed; this failure does not appear related to the PR changes.

If/when a macOS app runner becomes available again, re-running the workflow should unblock this.


### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`src/cli/program/preaction.tui-remote-bypass.test.ts`**
[P2] Test mutates `process.argv` but doesn’t restore if the file is imported multiple times

`originalArgv` is captured at module init time; if another test file mutates `process.argv` before this module loads, the “original” snapshot here could already be modified. It’s safer to capture `process.argv.slice()` inside `afterEach`/`beforeEach` (per-test) or use `vi.stubGlobal` to avoid inter-test coupling.


<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/cli/program/preaction.tui-remote-bypass.test.ts
Line: 10:14

Comment:
[P2] Test mutates `process.argv` but doesn’t restore if the file is imported multiple times

`originalArgv` is captured at module init time; if another test file mutates `process.argv` before this module loads, the “original” snapshot here could already be modified. It’s safer to capture `process.argv.slice()` inside `afterEach`/`beforeEach` (per-test) or use `vi.stubGlobal` to avoid inter-test coupling.


How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** medium (51+, 3-, 3 files)
- **Age:** 4 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #3107
