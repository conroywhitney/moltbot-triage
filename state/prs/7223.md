---
number: 7223
title: "Agents: support per-agent thinking defaults"
author: sauerdaniel
created: 2026-02-02T15:38:10Z
updated: 2026-02-02T20:10:45Z
labels: ["app: web-ui", "gateway", "commands", "agents"]
additions: 38
deletions: 5
changed_files: 7
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 3
reactions_total: 1
ci_status: failing
mergeable: false
draft: false
url: https://github.com/openclaw/openclaw/pull/7223
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
- allow agents.list entries to set a thinkingDefault
- merge per-agent thinking defaults into reply and CLI resolution
- apply per-agent defaults when resolving model-based thinking in reply and gateway history

## Testing
- manual: validated in a live instance
- pnpm build

## AI-assisted
- yes (OpenAI)

## Reviews

### @greptile-apps ‚Äî COMMENTED (2026-02-02)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-02)

<details>
<summary>Additional Comments (1)</summary>

**`src/agents/model-selection.ts`**
[P1] Per-agent `thinkingDefault` can be ignored in cfg-level default resolution

`resolveThinkingDefault()` only consults `params.cfg.agents?.defaults?.thinkingDefault` and never considers the per-agent override added in this PR (`agents.list[].thinkingDefault`). In practice, `getReplyFromConfig()` and `agentCommand()` build an `agentCfg` with `thinkingDefault`, but they still pass the unmodified `cfg` into `resolveThinkingDefault()`, so whenever the fallback path runs, the per-agent default has no effect and behavior becomes inconsistent across surfaces.

Also appears in `src/gateway/server-methods/chat.ts:219-231` (chat.history derives `thinkingLevel` from `cfg.agents?.defaults?.thinkingDefault`).

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/agents/model-selection.ts
Line: 376:385

Comment:
[P1] Per-agent `thinkingDefault` can be ignored in cfg-level default resolution

`resolveThinkingDefault()` only consults `params.cfg.agents?.defaults?.thinkingDefault` and never considers the per-agent override added in this PR (`agents.list[].thinkingDefault`). In practice, `getReplyFromConfig()` and `agentCommand()` build an `agentCfg` with `thinkingDefault`, but they still pass the unmodified `cfg` into `resolveThinkingDefault()`, so whenever the fallback path runs, the per-agent default has no effect and behavior becomes inconsistent across surfaces.

Also appears in `src/gateway/server-methods/chat.ts:219-231` (chat.history derives `thinkingLevel` from `cfg.agents?.defaults?.thinkingDefault`).

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>

### @sauerdaniel (2026-02-02)

Addressed review notes:
- prefer per-agent thinkingDefault before cfg defaults in model-selection
- use per-agent thinkingDefault when resolving chat history thinking level

Testing: pnpm build

### @adam91holt (2026-02-02)

üîç **Overlapping PRs Detected**

This PR appears to overlap with 4 other open PRs addressing agents, config, commands:

| Similarity | PR | Author | Title |
|---|---|---|---|
| 95.0% | [#3301](https://github.com/openclaw/openclaw/pull/3301) | @Glucksberg | feat(agents): add per-agent thinkingDefault override |
| 88.7% | [#4200](https://github.com/openclaw/openclaw/pull/4200) | @Glucksberg | feat: persist thinking level default per agent |
| 85.1% | [#7228](https://github.com/openclaw/openclaw/pull/7228) | @sauerdaniel | Thinking: add max level option |
| 85.1% | [#3114](https://github.com/openclaw/openclaw/pull/3114) | @johndowbs | feat(auto-think): Automatic thinking level classification |

<sub>üîç Detected by [OpenClaw PR Tracker](https://openclaw.academy) ‚Äî AI-powered duplicate detection for open source</sub>


## Stats

- **Size:** small (38+, 5-, 7 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
