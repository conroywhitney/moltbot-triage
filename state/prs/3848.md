---
number: 3848
title: "feat(qq): add QQ OneBot v11 extension support / 添加 QQ OneBot v11 支持"
author: constansino
created: 2026-01-29T07:39:40Z
updated: 2026-01-29T08:47:30Z
labels: []
additions: 409
deletions: 0
changed_files: 8
size: large
review_decision: none
reviews: []
comments_count: 2
reactions_total: 2
ci_status: failing
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/3848
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description


<img width="2560" height="1932" alt="PixPin_2026-01-29_15-54-16" src="https://github.com/user-attachments/assets/f12a07d0-789d-415b-96e6-aea0fcabd633" />


# Add QQ OneBot v11 Support

## English Description
This Pull Request introduces a new extension `extensions/qq` that enables Clawdbot to connect to QQ using the OneBot v11 protocol (verified with NapCat).

### Key Features
- **OneBot v11 Integration**: Established connection via WebSocket to OneBot-compatible servers.
- **Message Handling**: Full support for receiving text and image messages in both private and group chats.
- **Reply Dispatching**: Implemented `createReplyDispatcherWithTyping` to handle outgoing text and image responses via the OneBot API.
- **Stability Fixes**: Resolved critical crashes related to `runtime.channel.reply` access by implementing correct `getQQRuntime()` initialization.

### Configuration
Add the following to your `clawdbot.json`:

```json
  "channels": {
    "qq": {
      "wsUrl": "ws://your-napcat-host:3001",
      "accessToken": "your-token"
    }
  },
  "plugins": {
    "entries": {
      "qq": {
        "enabled": true
      }
    }
  }
```

---

<details>
<summary><b>点击查看中文说明 (Chinese Description)</b></summary>

## 中文描述
本 PR 引入了一个全新的扩展 `extensions/qq`，允许 Clawdbot 使用 OneBot v11 协议连接到 QQ（已在 NapCat 环境下通过测试）。

### 主要功能
- **OneBot v11 集成**：通过 WebSocket 实现与 OneBot 兼容服务器的稳定连接。
- **消息处理**：全面支持私聊和群聊场景下的文本及图片消息接收。
- **回复调度**：实现了 `createReplyDispatcherWithTyping` 逻辑，支持通过 OneBot API 发送文本和图片回复。
- **稳定性修复**：通过规范化 `getQQRuntime()` 的初始化，修复了访问 `runtime.channel.reply` 时导致的程序崩溃。

### 配置方法
在您的 `clawdbot.json` 中添加以下配置：

```json
  "channels": {
    "qq": {
      "wsUrl": "ws://your-napcat-host:3001",
      "accessToken": "your-token"
    }
  },
  "plugins": {
    "entries": {
      "qq": {
        "enabled": true
      }
    }
  }
```
</details>

## Reviews


## Comments

### @mastwet (2026-01-29)

I think the display of markdown should be fixed, as QQ does not support markdown.
我认为应该修复一下markdown的表现，QQ不支持markdown

### @constansino (2026-01-29)

> I think the display of markdown should be fixed, as QQ does not support markdown. 我认为应该修复一下markdown的表现，QQ不支持markdown

如果是聊天形式 系统提示词限制字数和格式即可
正在写长文本转图的插件 这样qq读md会很合适 感谢关注


## Stats

- **Size:** large (409+, 0-, 8 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
