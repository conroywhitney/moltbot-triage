---
number: 6432
title: "fix: websocket base path in reverse proxy deployments"
author: arosstale
created: 2026-02-01T17:12:47Z
updated: 2026-02-01T17:30:06Z
labels: ["app: web-ui"]
additions: 13
deletions: 1
changed_files: 1
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6432
fixes_issues: [6247]
related_prs: [6247]
duplicate_of: null
---

## Description

## Problem
WebSocket connections ignore base path configuration, breaking reverse proxy deployments where OpenClaw is not at root.

## Root Cause
URL construction in WebSocket handler doesn't account for configured base path.

## Solution
Fixed URL concatenation in WebSocket handler to properly incorporate the configured base path.

## Testing
✓ Standard deployment (no base path) - works
✓ Reverse proxy deployment (/openclaw prefix) - now works
✓ Deep nesting (/api/v1/openclaw) - now works
✓ Non-standard ports - works

## Fixes Issue
Closes #6247

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the UI’s default WebSocket gateway URL construction in `ui/src/ui/storage.ts` to include a derived “base path” from `location.pathname`, aiming to support reverse-proxy deployments where OpenClaw is served under a path prefix.

The change affects how `loadSettings()` initializes `gatewayUrl` when no user-configured URL is present, so it directly impacts first-run behavior and reset-to-default scenarios in the control UI.

<h3>Confidence Score: 3/5</h3>

- Reasonably safe to merge, but default URL inference may mis-route WebSockets on deep SPA routes.
- The change is localized and addresses a real reverse-proxy issue, but deriving the base path from `location.pathname` can incorporate client-side route segments and break the default gateway URL depending on how routing is configured and where users land/refresh.
- ui/src/ui/storage.ts

<!-- greptile_other_comments_section -->

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-01)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** small (13+, 1-, 1 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: #6247
