---
number: 7479
title: "fix: change default compaction mode from safeguard to default"
author: michael-b-halvorsen
created: 2026-02-02T21:38:47Z
updated: 2026-02-02T21:39:52Z
labels: []
additions: 3
deletions: 3
changed_files: 2
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7479
fixes_issues: [7477]
related_prs: [7477]
duplicate_of: null
---

## Description

## Summary

Changes the default compaction mode from `"safeguard"` to `"default"` to fix silent summarization failures on large contexts.

Fixes #7477

## Problem

Fresh installations default to `compaction.mode: "safeguard"`, but this mode produces `"Summary unavailable due to context limits"` when contexts reach ~180k tokens. Users lose conversation history without any warning.

See issue #7477 for full details and evidence.

## Solution

Change the default in `applyCompactionDefaults()` from `"safeguard"` to `"default"`. 

The `"default"` mode works reliably and matches what the documentation claims is the default.

## Changes

- `src/config/defaults.ts` â€” change default mode from "safeguard" to "default"
- `src/config/config.compaction-settings.test.ts` â€” update test to reflect new default

## Testing

- [x] Verified locally with 200k token context
- [x] Compaction now produces actual AI summaries instead of "Summary unavailable"
- [ ] CI tests (pending)

## Notes

- This aligns the code with the existing documentation (which already says `"default"` is the default)
- Users who want `safeguard` mode can still explicitly set it
- No breaking change for existing users who have already configured their mode

---

ðŸ¤– This PR was AI-assisted (per CONTRIBUTING.md guidelines). I understand the changes and have tested them locally.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the configuration defaults so that `agents.defaults.compaction.mode` falls back to `"default"` (instead of `"safeguard"`) when the user hasnâ€™t explicitly set a mode, and adjusts the corresponding unit test to expect the new default.

The change is localized to `applyCompactionDefaults()` in `src/config/defaults.ts`, which is part of the config normalization pipeline used by `loadConfig()` (tested in `src/config/config.compaction-settings.test.ts`).

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- The change is a single default value flip guarded by an existing `if (compaction?.mode) return cfg;` check, and the related test was updated consistently. No other logic paths or schema changes were introduced.
- No files require special attention

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews


## Comments


## Stats

- **Size:** tiny (3+, 3-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: #7477
