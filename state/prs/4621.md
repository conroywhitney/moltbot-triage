---
number: 4621
title: "Refactor Dockerfile for improved dependency management"
author: ga-it
created: 2026-01-30T12:08:45Z
updated: 2026-02-03T02:26:01Z
labels: ["docker"]
additions: 92
deletions: 22
changed_files: 1
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 3
ci_status: failing
mergeable: false
draft: false
url: https://github.com/openclaw/openclaw/pull/4621
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

Updated Dockerfile to install dependencies and set up environment for pnpm and Bun. Adjusted user permissions and added Homebrew installation.

Hi maintainers,

This PR amends the Dockerfile to make OpenClaw skill installation reliable across Linux platforms and to address recent Go toolchain requirements.

Summary of changes

Replace Debian golang-go with upstream Go tarball (pinned)
Some skills (e.g., blogwatcher) declare go 1.24.0 in go.mod. Debian Bookworm’s golang-go lags and fails with invalid go version '1.24.0'. The Dockerfile now installs Go from the official upstream tarball, pinned via GO_VERSION, and selects the correct archive using dpkg --print-architecture (supports amd64 and arm64).

Ensure tool discovery for skill installers
Adds stable shims:

brew → /usr/local/bin/brew

bun/bunx → /usr/local/bin/bun and /usr/local/bin/bunx
This addresses cases where installers/subprocesses run with a sanitised PATH and incorrectly report “brew not installed” / “go not installed”.

Keep pnpm deterministic via Corepack (enabled as root)
corepack enable must run as root to create /usr/local/bin/pnpm symlinks. Global pnpm bin directory is configured to a stable location (/usr/local/share/pnpm).

Motivation / background

During openclaw-cli onboard, several skills failed with:

go.mod:3: invalid go version '1.24.0' (Go too old)

“brew not installed” (brew present but not discoverable by installer environment)

This PR makes the image resilient by:

providing the required Go toolchain version; and

ensuring brew/bun are discoverable even when PATH is restricted.

Testing

Built and ran onboarding successfully on Linux:

docker build -t openclaw:local .

docker compose run --rm openclaw-cli onboard --no-install-daemon

Verified:

go version reports go1.24.0

brew --version, bun -v, pnpm -v available in the container

Notes

Go is pinned for reproducibility (ARG GO_VERSION=1.24.0).

The arch-selection is portable across amd64 and arm64.

Happy to adjust version pinning strategy (e.g., default to latest patch of 1.24.x) if preferred.

Thanks.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR refactors the Dockerfile to make toolchain/skill installation more reliable across Linux by:

- Installing system dependencies up-front and switching from Debian `golang-go` to an upstream, pinned Go tarball (arch-aware for amd64/arm64).
- Enabling pnpm via corepack, installing Bun into a stable prefix, and adding `/usr/local/bin` shims for bun/bunx.
- Installing Homebrew under the Linux prefix and adding a `/usr/local/bin/brew` shim, plus PATH updates.
- Switching to `COPY --chown=node:node` and running most installs/build steps as the non-root `node` user.

Overall this fits the repo’s “containerized CLI + skill installers” workflow by ensuring `go`, `brew`, and `bun` remain discoverable even when subprocess PATH is sanitized.

<h3>Confidence Score: 4/5</h3>

- This PR looks safe to merge and improves toolchain reliability, with minor reproducibility/compat concerns to consider.
- The Dockerfile changes are straightforward and primarily adjust installation order, user permissions, and toolchain sources. Main concerns are non-deterministic installs (`pnpm@latest`, Bun installer, Homebrew installer from HEAD) and potential downstream breakage from removing the optional apt-packages build ARG; these are unlikely to break core functionality immediately but can cause flaky rebuilds over time.
- Dockerfile (reproducibility of pnpm/Bun/Homebrew installs; whether OPENCLAW_DOCKER_APT_PACKAGES should be preserved)

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>1 file reviewed, 4 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** medium (92+, 22-, 1 files)
- **Age:** 3 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
