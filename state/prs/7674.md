---
number: 7674
title: "feat(discord): enhanced forum post creation with multi-tag support"
author: dongsjoa-byte
created: 2026-02-03T03:24:55Z
updated: 2026-02-03T03:56:33Z
labels: ["channel: discord", "agents"]
additions: 126
deletions: 5
changed_files: 8
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 2
reactions_total: 2
ci_status: passing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7674
fixes_issues: []
related_prs: [3023]
duplicate_of: null
---

## Description

## Summary

Adds enhanced support for creating Discord **Forum posts** using the `thread-create` action, with improved tag handling.

## What changed

### From PR #3023 (by @Solvely-Colin):
- Accept optional initial post `message` content for `thread-create` (required by Discord for forum posts)
- Accept optional `appliedTagIds` to apply forum tags
- Use `POST /channels/{channelId}/threads` when creating a forum post
- Support `embeds` and `components` in message tool send

### Additional improvements:
- **Enhanced `readStringArrayParam`** to support multiple input formats:
  - JSON array strings: `["tag1", "tag2"]`
  - Comma-separated strings: `tag1, tag2`
  - Native arrays (existing)
  - Single values (existing)

## Why

1. Forum channels require an initial message payload. Without it, Discord returns a generic "This field is required" error
2. The original PR #3023 used `Array.isArray()` for tag detection, which doesn't work well with tool parameter passing (often receives JSON strings)
3. Supporting comma-separated format makes it easier for LLMs and users to specify multiple tags

## Usage

```js
// Create forum post with tags (JSON array format)
message({
  action: "thread-create",
  channelId: "forum-channel-id",
  threadName: "Post Title",
  message: "Post content...",
  appliedTagIds: '["tag1", "tag2"]'
})

// Or with comma-separated format
message({
  action: "thread-create",
  channelId: "forum-channel-id",
  threadName: "Post Title",
  message: "Post content...",
  appliedTagIds: 'tag1, tag2'
})
```

## Testing

- ✅ Forum post creation without tags
- ✅ Forum post creation with single tag
- ✅ Forum post creation with multiple tags (JSON format)
- ✅ Forum post creation with multiple tags (comma-separated)

## Related

- Builds upon and improves PR #3023 by @Solvely-Colin

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR extends Discord support for forum post creation via the `thread-create` message action by:
- Allowing an initial post payload (`content`) when creating threads, and adding optional forum tag support (`appliedTagIds`).
- Adding embed/component pass-through on Discord message sends.
- Enhancing `readStringArrayParam` to accept JSON-array strings and comma-separated values in addition to native arrays.

The changes span the message tool schema (tool-facing params), the Discord channel action handler (mapping tool params to Discord actions), and the Discord REST send layer (new `/channels/{id}/threads` posting behavior for forum-style creation).

<h3>Confidence Score: 3/5</h3>

- Mostly safe to merge, but there are a couple of parameter/behavior mismatches that can cause forum thread creation or tag application to fail unexpectedly.
- Core changes are localized and align with Discord API requirements, but (1) `threadCreate` agent tool parsing doesn’t use the new multi-format array parser, and (2) `createThreadDiscord` still allows a forum-channel call path without `message` content, leading to Discord validation errors instead of a clear local error. Tests weren’t runnable in this environment (no npm).
- src/discord/send.messages.ts, src/agents/tools/discord-actions-messaging.ts, src/agents/tools/message-tool.ts

<!-- greptile_other_comments_section -->

<sub>(3/5) Reply to the agent's comments like "Can you suggest a fix for this @greptileai?" or ask follow-up questions!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>3 files reviewed, 4 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @Solvely-Colin (2026-02-03)

Awesome catch, thanks!

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (4)</summary>

**`src/agents/tools/discord-actions-messaging.ts`**
[P1] `appliedTagIds` parsing here only supports a native array, but the PR’s stated goal is to accept JSON-array strings / comma-separated strings. This means `threadCreate` via agent tools will silently drop tags when the input comes in as `'["tag1","tag2"]'` or `'tag1, tag2'`.

Consider reusing the existing `readStringArrayParam(params, "appliedTagIds")` (like the channel action path does) so both entry points accept the same formats.

Also appears in: `src/agents/tools/discord-actions-messaging.ts:292`

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/agents/tools/discord-actions-messaging.ts
Line: 289:294

Comment:
[P1] `appliedTagIds` parsing here only supports a native array, but the PR’s stated goal is to accept JSON-array strings / comma-separated strings. This means `threadCreate` via agent tools will silently drop tags when the input comes in as `'["tag1","tag2"]'` or `'tag1, tag2'`.

Consider reusing the existing `readStringArrayParam(params, "appliedTagIds")` (like the channel action path does) so both entry points accept the same formats.

Also appears in: `src/agents/tools/discord-actions-messaging.ts:292`

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>

---

**`src/discord/send.messages.ts`**
[P1] `createThreadDiscord` only uses the forum-post code path when `payload.content` is truthy. If the caller passes an empty string (or whitespace trimmed elsewhere), Discord forum posts still require a `message` object and this will fall back to the “regular threads” route and likely fail with a confusing API error.

If empty initial messages should be supported, check for `payload.content !== undefined` (or `allowEmpty` at the parameter layer) rather than truthiness.

(Severity depends on whether empty initial content is a valid use case in this codebase.)

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/discord/send.messages.ts
Line: 106:113

Comment:
[P1] `createThreadDiscord` only uses the forum-post code path when `payload.content` is truthy. If the caller passes an empty string (or whitespace trimmed elsewhere), Discord forum posts still require a `message` object and this will fall back to the “regular threads” route and likely fail with a confusing API error.

If empty initial messages should be supported, check for `payload.content !== undefined` (or `allowEmpty` at the parameter layer) rather than truthiness.

(Severity depends on whether empty initial content is a valid use case in this codebase.)

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>

---

**`src/discord/send.messages.ts`**
[P0] When `payload.messageId` is not provided and `payload.content` is also not provided, the code falls back to `POST /channels/{channelId}/threads` with a body that lacks the required `message` field for forum posts. This can make `thread-create` fail for forum channels unless callers always supply `content`.

Given the PR intent (“forum channels require an initial message payload”), it may be better to explicitly error when `messageId` is missing and `content` is missing, so the caller gets a clear message instead of Discord’s generic validation error.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/discord/send.messages.ts
Line: 124:129

Comment:
[P0] When `payload.messageId` is not provided and `payload.content` is also not provided, the code falls back to `POST /channels/{channelId}/threads` with a body that lacks the required `message` field for forum posts. This can make `thread-create` fail for forum channels unless callers always supply `content`.

Given the PR intent (“forum channels require an initial message payload”), it may be better to explicitly error when `messageId` is missing and `content` is missing, so the caller gets a clear message instead of Discord’s generic validation error.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>

---

**`src/agents/tools/message-tool.ts`**
[P2] The message tool schema for `thread-create` doesn’t document/accept the new `appliedTagIds` (and the initial post message is routed via the generic `message` field). This mismatch can prevent clients that rely on the schema from discovering/sending tag ids.

Consider adding `appliedTagIds` (string or string[]) to `buildThreadSchema()` and documenting that `message` is used as the initial forum post content.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/agents/tools/message-tool.ts
Line: 184:188

Comment:
[P2] The message tool schema for `thread-create` doesn’t document/accept the new `appliedTagIds` (and the initial post message is routed via the generic `message` field). This mismatch can prevent clients that rely on the schema from discovering/sending tag ids.

Consider adding `appliedTagIds` (string or string[]) to `buildThreadSchema()` and documenting that `message` is used as the initial forum post content.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** medium (126+, 5-, 8 files)
- **Age:** 0 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
