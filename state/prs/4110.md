---
number: 4110
title: "feat(skills): add cross-platform dependency manager"
author: AdamParker19
created: 2026-01-29T17:55:44Z
updated: 2026-01-30T05:21:28Z
labels: ["agents"]
additions: 374
deletions: 1
changed_files: 5
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4110
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

# feat(skills): Cross-Platform Dependency Abstraction Layer üåç

issue :-  https://github.com/moltbot/moltbot/issues/3319

## Summary

This PR implements a cross-platform **Dependency Abstraction Layer** that extends Moltbot's skill installation system to support multiple package managers beyond Homebrew. Windows and Linux users can now install skill dependencies natively using their preferred package manager.

### New Package Managers Supported

| Platform | Package Manager | Command Format                                                 |
| -------- | --------------- | -------------------------------------------------------------- |
| Linux    | **apt**         | `sudo apt-get install -y <package>`                            |
| Windows  | **winget**      | `winget install --accept-package-agreements -e --id <package>` |
| Windows  | **chocolatey**  | `choco install -y <package>`                                   |
| Windows  | **scoop**       | `scoop install <package>`                                      |

---

## Motivation

Currently, skills are defined in `SKILL.md` files with dependencies often hardcoded as `brew install` commands, breaking compatibility for Windows/Linux users. This PR introduces a declarative system where skills can specify multiple install options and Moltbot automatically selects the appropriate one for the host OS.

---

## Changes

### 1. Extended `SkillInstallSpec.kind` type

**File:** `src/agents/skills/types.ts`

```diff
- kind: "brew" | "node" | "go" | "uv" | "download"
+ kind: "brew" | "apt" | "winget" | "choco" | "scoop" | "node" | "go" | "uv" | "download"
```

### 2. Added command builders for new package managers

**File:** `src/agents/skills-install.ts`

Added cases in `buildInstallCommand()` for each new package manager with appropriate flags:

- **apt:** Uses `sudo apt-get install -y` for non-interactive installs
- **winget:** Uses `--accept-package-agreements --accept-source-agreements -e --id` for silent installs
- **choco:** Uses `-y` flag for unattended installs
- **scoop:** Standard install command

### 3. Added availability checks

**File:** `src/agents/skills-install.ts`

Each new package manager has a corresponding availability check that returns a helpful error message when the package manager is not installed:

```typescript
if (spec.kind === "winget" && !hasBinary("winget")) {
  return {
    ok: false,
    message: "winget not installed (requires Windows 10/11)",
    ...
  };
}
```

### 4. New `dependency-manager.ts` module

**File:** `src/agents/skills/dependency-manager.ts` (NEW)

Created a platform detection and install spec selection utility with the following exports:

| Function                   | Description                                            |
| -------------------------- | ------------------------------------------------------ |
| `detectPlatform()`         | Detects the current OS and available package managers  |
| `selectInstallSpec()`      | Selects the best install spec for the current platform |
| `hasPackageManager()`      | Checks if a specific package manager is available      |
| `getPackageManagerLabel()` | Returns a human-readable name for a package manager    |

**Platform preference logic:**

- macOS ‚Üí prefers Homebrew
- Linux ‚Üí prefers APT
- Windows ‚Üí prefers winget > scoop > choco (in that order)
- Falls back to universal install methods (download, node, go, uv) when no native manager matches

### 5. Added exports

**File:** `src/agents/skills.ts`

Exported the new utility functions and types for use throughout the codebase.

---

## Test Cases

**File:** `src/agents/skills/dependency-manager.test.ts` (NEW)

Added comprehensive unit tests covering:

### `detectPlatform()`

- ‚úÖ Detects available package managers from PATH
- ‚úÖ Detects apt when apt-get is available (Debian/Ubuntu compatibility)
- ‚úÖ Returns correct os from `process.platform`

### `hasPackageManager()`

- ‚úÖ Returns true when brew is available
- ‚úÖ Returns true when apt-get is available (for apt)
- ‚úÖ Checks each package manager correctly (scoop, choco, winget)

### `selectInstallSpec()`

- ‚úÖ Returns undefined when no specs are available
- ‚úÖ Selects spec matching preferred manager
- ‚úÖ Filters by OS when specified in spec
- ‚úÖ Falls back to download spec when no native manager matches
- ‚úÖ Includes specs without OS restriction (universal)

### `getPackageManagerLabel()`

- ‚úÖ Returns human-readable labels for all package managers

---

## Usage Example

Skill authors can now specify cross-platform dependencies in their `SKILL.md`:

```yaml
metadata:
  {
    "moltbot":
      {
        "install":
          [
            {
              "id": "brew",
              "kind": "brew",
              "formula": "himalaya",
              "bins": ["himalaya"],
            },
            {
              "id": "apt",
              "kind": "apt",
              "package": "himalaya",
              "os": ["linux"],
              "bins": ["himalaya"],
            },
            {
              "id": "winget",
              "kind": "winget",
              "package": "himalaya",
              "os": ["win32"],
              "bins": ["himalaya"],
            },
            {
              "id": "scoop",
              "kind": "scoop",
              "package": "himalaya",
              "os": ["win32"],
              "bins": ["himalaya"],
            },
          ],
      },
  }
```

---

## Verification

- [x] TypeScript compilation passes (`npx tsc --noEmit`)
- [x] Lint checks pass (`pnpm run lint` - 0 warnings, 0 errors)
- [x] Unit tests pass for the new module
- [x] Backward compatible - existing skills continue to work unchanged

---

## ü§ñ AI Disclosure

This PR was developed with AI assistance (Claude).

- **Testing level:** Fully tested - TypeScript compilation verified, lint passed, unit tests written and passing
- **Understanding:** I understand what the code does and have reviewed all changes
- **Prompts:** Started with architectural analysis of embedded vs sidecar approaches, then implemented the chosen embedded approach

---

## Related

- Addresses the need for cross-platform skill dependencies
- Aligns with roadmap item: _"Expanding the library of bundled skills and improving the Skill Creation developer experience"_

## Reviews


## Comments


## Stats

- **Size:** large (374+, 1-, 5 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
