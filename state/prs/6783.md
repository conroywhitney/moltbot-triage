---
number: 6783
title: "fix(media): prevent binary audio files from being processed as text"
author: isandom
created: 2026-02-02T02:03:08Z
updated: 2026-02-02T02:45:35Z
labels: []
additions: 110
deletions: 2
changed_files: 2
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6783
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

Description:
What changes: Prevents audio attachment types (like OGG voice notes) from being processed by the  extractFileBlocks function in  apply.ts.

Why: Currently, when receiving an audio file (e.g., from Telegram), OpenClaw attempts to "read" the file content as text if it doesn't match a forced MIME type. This results in the raw binary content of the audio file being appended to the message body as garbled text strings, cluttering the context sent to the LLM.

This fix ensures that while the transcription (via tools.media.audio) continues to work perfectly, the binary content of the audio file itself is ignored and not injected into the chat context as text.

Testing:

 Tested locally with Telegram voice notes.
 Verified that transcription (via gpt-4o-transcribe) still works correctly and the agent responds to the transcribed text.
 Verified that the binary garbage text is no longer present in the agent's context.

 AI-Assisted, Fully tested locally

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates `extractFileBlocks` in `src/media-understanding/apply.ts` to skip attachments classified as `audio` (in addition to `image`/`video`) when no text MIME type is forced from the filename. The goal is to avoid dumping binary audio bytes into the chat context as garbled text while still relying on the audio transcription pipeline (`tools.media.audio`) for usable content.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge and fixes a real UX issue, with a small chance of skipping legitimate text-like audio attachments when transcription isn’t used.
- The change is a single-condition tweak in `extractFileBlocks`, reducing the chance of binary data being treated as text. The main residual risk is behavioral: audio attachments that previously could have been extracted as text (via heuristics) will now be skipped earlier unless their name forces a text MIME.
- src/media-understanding/apply.ts

<!-- greptile_other_comments_section -->

<sub>(3/5) Reply to the agent's comments like "Can you suggest a fix for this @greptileai?" or ask follow-up questions!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** medium (110+, 2-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
