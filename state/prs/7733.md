---
number: 7733
title: "feat(compaction): add Immediate Context section to preserve recency"
author: tsukhani
created: 2026-02-03T04:54:16Z
updated: 2026-02-03T04:54:27Z
labels: ["docs", "commands", "agents"]
additions: 167
deletions: 3
changed_files: 3
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7733
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
Adds an '## Immediate Context' section to compaction summaries that specifically captures what the user was MOST RECENTLY working on or asking about.

## Problem
After compaction, the agent remembers older tasks (from LanceDB memories) but loses the immediate conversation context — the 'what were we just doing?' signal gets lost in the general summary.

## Solution
Enhanced `generateSummary` function with improved prompts that include Immediate Context as the FIRST section. This section reads like a handoff note: *'You were just working on X, the user asked Y, and you were in the middle of Z.'*

Key changes:
- New `ENHANCED_SUMMARIZATION_PROMPT` with Immediate Context section first
- New `ENHANCED_UPDATE_SUMMARIZATION_PROMPT` that REPLACES Immediate Context with newest messages (ensuring it always reflects the latest exchanges, not stale older topics)
- Local `generateSummary` function in OpenClaw's `compaction.ts` replaces upstream pi-coding-agent version

Also includes:
- fix(status): don't show 'unavailable' for external memory plugins (like memory-lancedb)

## Testing
Tested manually — after compaction, the agent correctly identified the most recent conversation topic and continued seamlessly.

## Files Changed
- `src/agents/compaction.ts` — added enhanced prompts and local generateSummary function  
- `src/commands/status.command.ts` — fixed misleading 'unavailable' status for external plugins

## Reviews


## Comments


## Stats

- **Size:** medium (167+, 3-, 3 files)
- **Age:** 0 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
