---
number: 3071
title: "fix: WhatsApp 515 error retry not triggering"
author: rabsef-bicrym
created: 2026-01-28T01:50:36Z
updated: 2026-01-28T23:25:10Z
labels: ["channel: whatsapp-web"]
additions: 7
deletions: 0
changed_files: 1
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3071
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

The WhatsApp QR login auto-retry feature for 515 errors (added in 3b63d1cb) has never worked in production. When WhatsApp returns a 515 "restart required" error after QR pairing, the automatic reconnection logic fails to trigger, causing immediate login failures.

## Root Cause

Baileys wraps disconnect errors in nested structures like:
```
{ lastDisconnect: { error: { output: { statusCode: 515 } } } }
```

However, `getStatusCode()` only checked shallow locations (`err.output.statusCode` and `err.status`), so it returned `undefined` instead of `515`. This caused the retry check (`login.errorStatus === 515`) to never match.

Meanwhile, `formatError()` correctly used `extractBoomDetails()` to check nested error locations, which is why error messages displayed "status=515" even though `login.errorStatus` was `undefined`.

## Solution

Update `getStatusCode()` to use the same `extractBoomDetails()` logic as `formatError()`, ensuring it checks:
- `err.error`
- `err.lastDisconnect.error`

for nested Boom-style status codes.

## Testing

Existing test passes. Verified in production that 515 retry now triggers correctly and WhatsApp login succeeds after automatic reconnection.

## Reviews


## Comments


## Stats

- **Size:** tiny (7+, 0-, 1 files)
- **Age:** 2 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
