---
number: 6128
title: "Fail closed when Telnyx webhook public key is missing (voice-call provider)"
author: yueyueL
created: 2026-02-01T09:27:39Z
updated: 2026-02-01T09:31:35Z
labels: ["docs", "channel: voice-call"]
additions: 162
deletions: 10
changed_files: 6
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"copilot-pull-request-reviewer","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6128
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

The voice-call Telnyx provider currently **skips webhook signature verification** when `telnyx.publicKey` is not configured. This PR changes Telnyx webhook verification to **fail closed by default** and adds config validation to require `telnyx.publicKey` unless `skipSignatureVerification` is explicitly enabled for dev.

## Why this change (security impact)

- **Prevents forged Telnyx webhooks** when the webhook URL is public and the public key is accidentally unset/misconfigured.
- Makes insecure setups **fail fast** with a clear config error instead of silently running without verification.

## Changes

- `TelnyxProvider.verifyWebhook()` now rejects when `publicKey` is missing (unless `skipVerification` is enabled)
- Also rejects invalid (non-numeric) timestamps instead of accidentally passing the age check
- Config validation requires `telnyx.publicKey` when using Telnyx (unless `skipSignatureVerification` is true)
- Docs updated to mention the `telnyx.publicKey` requirement

## Test plan

- [x] `pnpm build` passes
- [x] `pnpm test` passes
- [x] New tests added in `extensions/voice-call/src/providers/telnyx.test.ts`
- [x] Config validation tests updated in `extensions/voice-call/src/config.test.ts`

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

Telnyx voice-call webhook verification is now fail-closed: `TelnyxProvider.verifyWebhook()` rejects when `telnyx.publicKey` is missing unless `skipSignatureVerification` is explicitly enabled for dev. Config resolution/validation was updated to require `TELNYX_PUBLIC_KEY`/`telnyx.publicKey` for Telnyx, and new unit tests cover missing public key, valid Ed25519 signatures, and invalid/old timestamps. Runtime wiring now passes the global `skipSignatureVerification` flag into the Telnyx provider.


<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- Changes are narrowly scoped to Telnyx webhook verification behavior and config validation; behavior is well-covered by new/updated tests and follows a security hardening direction (fail closed). No broad refactors or risky dependencies were introduced.
- No files require special attention

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-01)

<sub>No files reviewed, no comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @copilot-pull-request-reviewer â€” COMMENTED (2026-02-01)

## Pull request overview

This PR enhances security for the Telnyx voice-call provider by enforcing webhook signature verification as fail-closed by default. Previously, when `telnyx.publicKey` was not configured, the provider silently skipped verification, potentially allowing forged webhooks. Now, signature verification is required unless explicitly disabled via `skipSignatureVerification` for development purposes.

**Changes:**
- Modified `TelnyxProvider` to reject webhooks when `publicKey` is missing (unless `skipVerification` is enabled)
- Improved timestamp validation to properly reject invalid non-numeric values
- Added config validation requiring `telnyx.publicKey` when using Telnyx provider (unless `skipSignatureVerification` is true)

### Reviewed changes

Copilot reviewed 6 out of 6 changed files in this pull request and generated no comments.

<details>
<summary>Show a summary per file</summary>

| File | Description |
| ---- | ----------- |
| extensions/voice-call/src/providers/telnyx.ts | Implements fail-closed verification logic and improved timestamp validation |
| extensions/voice-call/src/providers/telnyx.test.ts | Adds comprehensive tests for webhook verification scenarios |
| extensions/voice-call/src/runtime.ts | Passes skipVerification option to TelnyxProvider constructor |
| extensions/voice-call/src/config.ts | Adds validation requiring publicKey when signature verification is enabled |
| extensions/voice-call/src/config.test.ts | Adds tests for publicKey validation logic |
| docs/plugins/voice-call.md | Documents the publicKey requirement for Telnyx |
</details>



<details>
<summary>Comments suppressed due to low confidence (1)</summary>

**extensions/voice-call/src/config.test.ts:175**
* Missing test case for when `connectionId` is missing. For consistency with the Twilio provider tests (lines 90-101 and 103-114), there should be a test verifying that validation fails when `connectionId` is missing while `apiKey` and `publicKey` are provided. This would ensure all required Telnyx configuration fields have proper test coverage.
```
    it("fails validation when apiKey is missing everywhere", () => {
      process.env.TELNYX_CONNECTION_ID = "CONN456";
      process.env.TELNYX_PUBLIC_KEY = "PUBKEY";
      let config = createBaseConfig("telnyx");
      config = resolveVoiceCallConfig(config);

      const result = validateProviderConfig(config);

      expect(result.valid).toBe(false);
      expect(result.errors).toContain(
        "plugins.entries.voice-call.config.telnyx.apiKey is required (or set TELNYX_API_KEY env)",
      );
    });
```
</details>



---

ðŸ’¡ <a href="/openclaw/openclaw/new/main/.github/instructions?filename=*.instructions.md" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Add Copilot custom instructions</a> for smarter, more guided reviews. <a href="https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Learn how to get started</a>.


## Comments


## Stats

- **Size:** medium (162+, 10-, 6 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: (none detected)
