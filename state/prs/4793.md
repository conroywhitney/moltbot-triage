---
number: 4793
title: "hooks: use configured model for slug generator"
author: yoyooyooo
created: 2026-01-30T17:44:05Z
updated: 2026-02-03T02:23:59Z
labels: []
additions: 52
deletions: 0
changed_files: 2
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4793
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

### Summary
`session-memory` can generate a human-friendly slug via an LLM call. When the provider/model is not explicitly specified, the slug generator may fall back to an Anthropic default, which is both noisy and can fail in deployments that only configure OpenAI.

### Changes
- Resolve the provider/model for slug generation from the configured defaults instead of relying on implicit fallback behavior.
- Add a regression test covering model resolution for the slug generator.

### Rationale
This avoids unintended Anthropic usage and prevents `No API key found for provider "anthropic"` errors during `/new` / `session-memory` runs when Anthropic is not configured.

### Testing
- `pnpm vitest run src/hooks/llm-slug-generator.test.ts`

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the session-memory slug generator to explicitly resolve the provider/model from the configured defaults (via `resolveDefaultModelForAgent`) and pass them into `runEmbeddedPiAgent`, avoiding implicit Anthropic fallback behavior. It also adds a regression test to ensure the slug generator honors the configured default model/provider (e.g., OpenAI) when Anthropic is not configured.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge; changes are small and covered by a focused regression test.
- The change is localized to slug generation and uses an existing model-resolution helper that already encodes repo defaults and overrides. Main risk is if callers previously relied on implicit model/provider selection inside `runEmbeddedPiAgent`, but the new behavior aligns with configured defaults and is exercised by a new unit test.
- src/hooks/llm-slug-generator.test.ts (ensuring the config shape used in the test matches supported config schemas) and src/hooks/llm-slug-generator.ts (confirming the new explicit provider/model doesn’t conflict with agent overrides).

<!-- greptile_other_comments_section -->

<sub>(3/5) Reply to the agent's comments like "Can you suggest a fix for this @greptileai?" or ask follow-up questions!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`src/hooks/llm-slug-generator.ts`**
[P2] `runId`/`sessionId` use separate `Date.now()` calls

Because `sessionId` and `runId` are each derived from their own `Date.now()` call, they can differ by 1ms and make log correlation/debugging harder. Consider reusing a single timestamp/id for both fields so they always match for a given slug-generation attempt.

<sub>Note: If this suggestion doesn't match your team's coding style, reply to this and let me know. I'll remember it for next time!</sub>

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/hooks/llm-slug-generator.ts
Line: 43:45

Comment:
[P2] `runId`/`sessionId` use separate `Date.now()` calls

Because `sessionId` and `runId` are each derived from their own `Date.now()` call, they can differ by 1ms and make log correlation/debugging harder. Consider reusing a single timestamp/id for both fields so they always match for a given slug-generation attempt.

<sub>Note: If this suggestion doesn't match your team's coding style, reply to this and let me know. I'll remember it for next time!</sub>

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** medium (52+, 0-, 2 files)
- **Age:** 3 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
