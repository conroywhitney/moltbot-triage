---
number: 4613
title: "security(crypto): replace SHA-1 with SHA-256 in all hash operations"
author: leszekszpunar
created: 2026-01-30T11:49:41Z
updated: 2026-02-03T02:25:12Z
labels: ["agents"]
additions: 5
deletions: 5
changed_files: 5
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4613
fixes_issues: [2994]
related_prs: [2994]
duplicate_of: null
---

## Description

## Summary

- Replace all `crypto.createHash("sha1")` with `crypto.createHash("sha256")` across the codebase
- SHA-1 is cryptographically broken (collision attacks demonstrated since 2017)
- All affected hashes are ephemeral with no persistence impact

## Changed files

| File | Usage | Impact |
|------|-------|--------|
| `src/agents/sandbox/shared.ts` | Session key slugs for sandbox workspace dirs | New sessions get new dir names; old dirs are ephemeral |
| `src/agents/sandbox/config-hash.ts` | Sandbox config change detection | One-time sandbox rebuild after upgrade (normal behavior) |
| `src/agents/tool-call-id.ts` | Tool call ID deduplication | Per-session values, not persisted |
| `src/infra/gateway-lock.ts` | Gateway lock file naming | Old lock cleaned on shutdown; new lock created on start |
| `src/infra/gateway-lock.test.ts` | Test mirror of production code | Matches production change |

## Test plan

- [x] `pnpm vitest run` on affected files -- 10/10 tests pass
- [x] `pnpm lint` -- 0 warnings, 0 errors
- [x] `pnpm format` -- all files formatted correctly

## AI Assistance Disclosure

This PR was AI-assisted. Mechanical replacement following existing patterns. Human reviewed.

Fixes #2994

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR mechanically replaces SHA-1 with SHA-256 in a handful of non-persistent hashing call sites used for sandbox session slugs, sandbox config change detection, tool call ID de-duplication, and gateway lock file naming. The changes keep the existing API surface and behavior (hex digests, truncated to 8/9 chars where applicable), with the expected one-time churn in derived identifiers (e.g., lock filenames / sandbox dir names) but no data migration concerns since these values are session-scoped or ephemeral.

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- All changes are straightforward hash algorithm swaps that preserve output encoding and truncation behavior; no persistence or compatibility contracts appear to rely on SHA-1 specifically, and corresponding tests were updated. No functional logic beyond the hash primitive changed.
- No files require special attention

<!-- greptile_other_comments_section -->

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews


## Comments


## Stats

- **Size:** small (5+, 5-, 5 files)
- **Age:** 3 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #2994
