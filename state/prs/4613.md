---
number: 4613
title: "security(crypto): replace SHA-1 with SHA-256 in all hash operations"
author: leszekszpunar
created: 2026-01-30T11:49:41Z
updated: 2026-01-30T11:49:53Z
labels: ["agents"]
additions: 5
deletions: 5
changed_files: 5
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4613
fixes_issues: [2994]
related_prs: [2994]
duplicate_of: null
---

## Description

## Summary

- Replace all `crypto.createHash("sha1")` with `crypto.createHash("sha256")` across the codebase
- SHA-1 is cryptographically broken (collision attacks demonstrated since 2017)
- All affected hashes are ephemeral with no persistence impact

## Changed files

| File | Usage | Impact |
|------|-------|--------|
| `src/agents/sandbox/shared.ts` | Session key slugs for sandbox workspace dirs | New sessions get new dir names; old dirs are ephemeral |
| `src/agents/sandbox/config-hash.ts` | Sandbox config change detection | One-time sandbox rebuild after upgrade (normal behavior) |
| `src/agents/tool-call-id.ts` | Tool call ID deduplication | Per-session values, not persisted |
| `src/infra/gateway-lock.ts` | Gateway lock file naming | Old lock cleaned on shutdown; new lock created on start |
| `src/infra/gateway-lock.test.ts` | Test mirror of production code | Matches production change |

## Test plan

- [x] `pnpm vitest run` on affected files -- 10/10 tests pass
- [x] `pnpm lint` -- 0 warnings, 0 errors
- [x] `pnpm format` -- all files formatted correctly

## AI Assistance Disclosure

This PR was AI-assisted. Mechanical replacement following existing patterns. Human reviewed.

Fixes #2994

## Reviews


## Comments


## Stats

- **Size:** small (5+, 5-, 5 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #2994
