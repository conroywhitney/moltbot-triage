---
number: 4257
title: "fix(slack): Convert Unicode emojis to Slack shortcodes for ack reactions"
author: rossshannon
created: 2026-01-30T00:00:03Z
updated: 2026-01-30T10:12:25Z
labels: ["channel: slack"]
additions: 62
deletions: 1
changed_files: 4
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4257
fixes_issues: []
related_prs: [3626]
duplicate_of: null
---

## Description

# fix(slack): Convert Unicode emojis to Slack shortcodes for reactions

## Summary

Whereas some channels (e.g., Telegram) allow emojis like ğŸ‘€ for the automatic â€œack reactionâ€, Slack specifically needs its own format.

<img width="455" height="112" alt="Screenshot 2026-01-30 at 1 08 34â€¯a m" src="https://github.com/user-attachments/assets/b88a600f-ac7c-4172-9503-beeca0f09b0b" />


This PR fixes an issue where Unicode emojis (e.g., `ğŸ‘€`) in Slack reaction configurations fail with `invalid_name` errors because Slack's API requires shortcode format (e.g., `:eyes:` â†’ `eyes`).

<img width="328" height="114" alt="Screenshot 2026-01-30 at 1 10 55â€¯a m" src="https://github.com/user-attachments/assets/2b142c32-3fb0-45d5-b87e-ff8482d0f6c1" />

## Problem

When users configure `messages.ackReaction` with a Unicode emoji (which works in Telegram, for example):

```json
{
  "messages": {
    "ackReaction": "ğŸ‘€"
  }
}
```

Slack reactions fail with:
```
Error: invalid_name
```

Because Slack's `reactions.add` API requires the shortcode name (`eyes`), not the Unicode character (`ğŸ‘€`).

## Root Cause

The existing `normalizeEmoji()` function only stripped colons from already-formatted shortcodes (`:eyes:` â†’ `eyes`), but didn't convert Unicode emojis to their shortcode equivalents. To enable interoperability between multiple emoji-reaction formats, we should convert from emojis to shortcodes for Slack.

## The Fix

1. **Added `node-emoji` dependency** for reliable Unicode â†’ shortcode mapping, so a wide range of emojis can be automatically supported.
2. **Updated `normalizeEmoji()`** to:
   - First attempt Unicode â†’ shortcode conversion (ğŸ‘€ â†’ `eyes`)
   - Fall back to existing routine of stripping colons for already-formatted shortcodes (`:eyes:` â†’ `eyes`)

```typescript
function normalizeEmoji(raw: string) {
  const trimmed = raw.trim();
  if (!trimmed) {
    throw new Error("Emoji is required for Slack reactions");
  }
  
  // Try Unicode â†’ shortcode conversion first
  const shortcode = emojiWhich(trimmed);
  if (shortcode) {
    return shortcode;
  }
  
  // Fall back to stripping colons (for already-formatted shortcodes)
  return trimmed.replace(/^:+|:+$/g, "");
}
```

## Testing

Tested with both formats:

âœ… **Unicode emoji** (`ğŸ‘€`):
```javascript
await reactSlackMessage(channelId, messageId, "ğŸ‘€");
// â†’ API call with name: "eyes" â†’ Success
```

âœ… **Shortcode** (`:eyes:`):
```javascript
await reactSlackMessage(channelId, messageId, ":eyes:");
// â†’ API call with name: "eyes" â†’ Success
```

## Impact

Resolves https://github.com/moltbot/moltbot/issues/2462

- âœ… **User-friendly:** Config can use natural Unicode emojis
- âœ… **Backwards compatible:** Existing `:eyes:` configs continue to work
- âœ… **Fixes ack reactions:** No more `invalid_name` errors for Unicode configs

## Related

- **Complementary fix:** PR #3626 fixes a separate issue where ack reactions sometimes don't run due to early return before the ack reaction code

## Reviews


## Comments


## Stats

- **Size:** medium (62+, 1-, 4 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
