---
number: 7392
title: "[AI Assisted] OpenResponses: tool output items, reasoning summary, opt‑in tool data cap + client tools fix"
author: lylepratt
created: 2026-02-02T19:33:37Z
updated: 2026-02-03T01:59:23Z
labels: ["docs", "gateway", "commands", "agents"]
additions: 465
deletions: 65
changed_files: 26
size: large
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"greptile-apps","state":"COMMENTED"},{"author":"lylepratt","state":"COMMENTED"},{"author":"lylepratt","state":"COMMENTED"},{"author":"lylepratt","state":"COMMENTED"},{"author":"lylepratt","state":"COMMENTED"}]
comments_count: 3
reactions_total: 1
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7392
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Why
OpenResponses consumers (e.g., Vercel AI SDK) need tool call/output items and reasoning surfaced in both streaming and final responses. We also need an opt-in path to include base64 tool payloads (screenshots/files) while keeping default behavior safe. Finally, client-supplied tools must reach the embedded runner so tools are actually callable.

## What
- Emit tool calls + tool outputs as `response.output_item.*` items in streaming and non-streaming responses.
- Stream reasoning items and map `reasoning.summary` to the `summary` field when requested.
- Add `gateway.http.responses.toolResultMaxDataBytes` to optionally include base64 tool output data (default stays “omit data”).
- Fix OpenResponses client tool propagation into the embedded runner so client tools are visible to the agent.

## How
- Maintain an output item list for the response and append `function_call`, `function_call_output`, and `reasoning` items as they occur.
- Sanitize tool results with an optional max decoded byte cap; emit `{ bytes, omitted: true }` when data is stripped.
- Extend schema to validate `function_call_output` items.
- Update `/v1/responses` docs to describe tool output items, reasoning output items, and the data cap.
- Add tests for reasoning summary + tool output items and tool result sanitization.

## Compatibility / Risk
- Backwards-compatible by default: tool base64 data remains stripped unless the new config is set.
- Reasoning output items are only emitted when reasoning is requested.

## Testing
- pnpm tsgo ✅
- pnpm format ✅
- pnpm lint ✅
- pnpm build ✅
- pnpm test ✅ (all tests passing)

## AI assistance
- [x] AI-assisted (Codex 5.2 High). I (@lylepratt) understand the changes and heavily tested during development.
- [x] Testing performed (full local suite listed above).

## Formatting-only changes
- CHANGELOG.md: escaped `*` in tool allowlist entry (formatter/lint).
- docs/zh-CN/*: table alignment/whitespace adjustments only (formatter/lint - no semantic changes).

## Companion Vercel AI SDK Provider for OpenClaw
- https://www.npmjs.com/package/@vida-global/openclaw-ai-sdk-provider

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

PR adds richer OpenResponses streaming output by emitting tool call / tool output items and optional reasoning items, plus an opt-in cap for including base64 tool-result `content[].data` via `toolResultMaxDataBytes`. It threads new options through the gateway handler into `agentCommand`, expands Zod schemas/parity tests for the new output item type, and updates docs to describe the new events and config.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge, with a couple of correctness/docs mismatches worth fixing.
- Core changes are additive (new output item emission + optional config) and covered by updated e2e/parity tests, but there’s a real config validation mismatch (`toolResultMaxDataBytes` rejecting 0) and a misleading docs section about `reasoning` being ignored. *(Note from @lylepratt: This has been addressed in a subsequent commit)*
- src/config/zod-schema.ts, docs/gateway/openresponses-http-api.md

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>4 files reviewed, 4 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @greptile-apps — COMMENTED (2026-02-03)

<sub>2 files reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @lylepratt — COMMENTED (2026-02-03)



### @lylepratt — COMMENTED (2026-02-03)



### @lylepratt — COMMENTED (2026-02-03)



### @lylepratt — COMMENTED (2026-02-03)




## Comments

### @greptile-apps (2026-02-02)

<details>
<summary>Additional Comments (1)</summary>

**`CHANGELOG.md`**
[P3] Escaping `*` in changelog entry looks accidental.

The line changed from `"*" tool allowlist` to `"\*" tool allowlist`. Since this is plain markdown prose (not a regex or string literal), the backslash will show up in rendered docs. If the intent was to prevent markdown emphasis, wrapping `*` in backticks (`` `*` ``) is more typical.

<sub>Note: If this suggestion doesn't match your team's coding style, reply to this and let me know. I'll remember it for next time!</sub>

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: CHANGELOG.md
Line: 6:12

Comment:
[P3] Escaping `*` in changelog entry looks accidental.

The line changed from `"*" tool allowlist` to `"\*" tool allowlist`. Since this is plain markdown prose (not a regex or string literal), the backslash will show up in rendered docs. If the intent was to prevent markdown emphasis, wrapping `*` in backticks (`` `*` ``) is more typical.

<sub>Note: If this suggestion doesn't match your team's coding style, reply to this and let me know. I'll remember it for next time!</sub>

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`docs/gateway/openresponses-http-api.md`**
[P2] Docs say `reasoning` is “currently ignored”, but the handler now forwards `reasoningLevel`/`onReasoningStream` and emits `type: "reasoning"` output items.

This list should be updated to avoid misleading clients (either remove `reasoning` from “ignored” or clarify exactly which parts are ignored vs supported).

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: docs/gateway/openresponses-http-api.md
Line: 98:105

Comment:
[P2] Docs say `reasoning` is “currently ignored”, but the handler now forwards `reasoningLevel`/`onReasoningStream` and emits `type: "reasoning"` output items.

This list should be updated to avoid misleading clients (either remove `reasoning` from “ignored” or clarify exactly which parts are ignored vs supported).

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>

### @lylepratt (2026-02-03)

Pushed some changes to address the suggestions of the greptile bot.


## Stats

- **Size:** large (465+, 65-, 26 files)
- **Age:** 0 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
