---
number: 3329
title: "feat: use userTimezone as default for cron schedules"
author: impozzible
created: 2026-01-28T13:03:33Z
updated: 2026-01-28T23:25:09Z
labels: ["gateway"]
additions: 29
deletions: 6
changed_files: 4
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/3329
fixes_issues: [3318]
related_prs: [3318]
duplicate_of: null
---

## Description

## Summary

Fixes #3318

Previously, cron schedules without an explicit `tz` field would use the system timezone, which could cause confusion if the server is in a different timezone than the user.

## Changes

Now, `agents.defaults.userTimezone` from the config is used as the default timezone for cron schedule computations when the schedule doesn't specify its own `tz`.

- Added `defaultTimezone` option to `computeNextRunAtMs()`
- Added `defaultTimezone` to `CronServiceDeps`
- Gateway passes `userTimezone` from config to cron service
- All job computations now respect the default timezone

## Example

```json
{
  "agents": {
    "defaults": {
      "userTimezone": "America/New_York"
    }
  }
}
```

With this config, a cron job with `schedule: { kind: "cron", expr: "0 9 * * *" }` will run at 9am New York time, not 9am UTC.

Individual jobs can still override with their own `tz` field:
```json
{
  "schedule": { "kind": "cron", "expr": "0 9 * * *", "tz": "Europe/London" }
}
```

## Testing

Verified by reviewing code flow and checking that `userTimezone` is correctly passed through the service chain to `computeNextRunAtMs()`.

## Reviews


## Comments


## Stats

- **Size:** small (29+, 6-, 4 files)
- **Age:** 1 days
- **Last activity:** 2026-01-28

## Links

- Fixes: #3318
