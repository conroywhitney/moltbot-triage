---
number: 6546
title: "Reply: avoid typing before text in message mode"
author: aldoeliacim
created: 2026-02-01T19:36:15Z
updated: 2026-02-01T22:42:09Z
labels: []
additions: 6
deletions: 3
changed_files: 2
size: tiny
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"copilot-pull-request-reviewer","state":"COMMENTED"}]
comments_count: 1
reactions_total: 2
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6546
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
- skip typing indicator on tool start when typingMode=message until real text appears
- adjust typing-mode unit test to match new behavior

## Testing
- pnpm test src/auto-reply/reply/typing.test.ts (fails: vitest not installed; node_modules missing)


<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR tweaks the typing indicator behavior for `typingMode="message"`: tool execution no longer triggers typing until the reply has produced the first renderable text, and the associated unit test was updated to assert the new behavior. The change is localized to the auto-reply typing signaler logic (`src/auto-reply/reply/typing-mode.ts`), which coordinates when `TypingController` starts/refreshes the typing loop based on run/message/text/tool events.

<h3>Confidence Score: 4/5</h3>

- This PR is low-risk and likely safe to merge, with one behavioral edge case worth double-checking.
- The change is small and covered by a targeted unit test, but it alters when typing is shown during tool execution and may leave cases where the typing indicator never appears if output is tool-only (no text deltas). That may be intended, but it’s a user-visible behavioral change that depends on runtime event ordering.
- src/auto-reply/reply/typing-mode.ts

<!-- greptile_other_comments_section -->

<sub>(4/5) You can add custom instructions or style guidelines for the agent [here](https://app.greptile.com/review/github)!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-01)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @copilot-pull-request-reviewer — COMMENTED (2026-02-01)

Copilot encountered an error and was unable to review this pull request. You can try again by re-requesting a review.


## Comments

### @greptile-apps (2026-02-01)

<details>
<summary>Additional Comments (1)</summary>

**`src/auto-reply/reply/typing-mode.ts`**
[P1] `typingMode="message"` no longer shows typing for tool-only replies (no renderable text deltas)

With the new early return in `signalToolStart`, message mode will *never* start/refresh typing if the assistant produces only tool calls/results and then a final message is sent without any streamed text deltas (or if text is entirely silent tokens). If your channels still deliver a final message without intermediate deltas, users will see no typing indicator during tool execution. If that’s intentional, a short comment here (or a dedicated test for “tool-only then final send”) would help prevent future regressions/assumptions.

<sub>Note: If this suggestion doesn't match your team's coding style, reply to this and let me know. I'll remember it for next time!</sub>

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/auto-reply/reply/typing-mode.ts
Line: 116:122

Comment:
[P1] `typingMode="message"` no longer shows typing for tool-only replies (no renderable text deltas)

With the new early return in `signalToolStart`, message mode will *never* start/refresh typing if the assistant produces only tool calls/results and then a final message is sent without any streamed text deltas (or if text is entirely silent tokens). If your channels still deliver a final message without intermediate deltas, users will see no typing indicator during tool execution. If that’s intentional, a short comment here (or a dedicated test for “tool-only then final send”) would help prevent future regressions/assumptions.

<sub>Note: If this suggestion doesn't match your team's coding style, reply to this and let me know. I'll remember it for next time!</sub>

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** tiny (6+, 3-, 2 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: (none detected)
