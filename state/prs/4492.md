---
number: 4492
title: "Fix WebSocket 1006 disconnect with ping/pong keepalive"
author: spiceoogway
created: 2026-01-30T08:21:38Z
updated: 2026-01-30T08:21:52Z
labels: ["channel: whatsapp-web"]
additions: 85
deletions: 2
changed_files: 1
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4492
fixes_issues: [4142]
related_prs: [4142]
duplicate_of: null
---

## Description

Fixes #4142

## Summary
Implements WebSocket ping/pong keepalive mechanism to prevent random disconnects with close code 1006 (abnormal closure).

## Changes
- Add 20-second ping interval when WebSocket connection is open  
- Monitor pong responses for connection health
- Enhanced error and close event logging with detailed diagnostics
- Clean up ping interval when connection closes

## Root Cause
WebSocket close code 1006 indicates "Abnormal Closure" - the connection was closed without sending/receiving a proper close frame. The most common cause is network intermediaries (NAT devices, firewalls, proxies) timing out idle WebSocket connections.

## Solution
This PR implements the industry-standard fix for WebSocket 1006 errors:
- Periodic ping frames every 20 seconds to prevent idle timeout
- Monitoring pong responses to detect connection health issues
- Enhanced logging to capture disconnect details for debugging

The 20-second interval is a widely-used standard that prevents most network equipment from timing out the connection while keeping overhead minimal.

## Testing
- âœ… Code compiles successfully  
- Manual testing recommended: Run WhatsApp bot for extended period (&gt;30 minutes idle) and verify no 1006 disconnects
- Monitor logs for "Sent WebSocket ping keepalive" messages every 20s when connected

## References
- RFC 6455 (WebSocket Protocol): https://datatracker.ietf.org/doc/html/rfc6455#section-5.5.2
- Node.js ws library ping/pong documentation
- Research document: `~/clawd/memory/research/2026-01-30-pr-ws-disconnect.md`

## Reviews


## Comments


## Stats

- **Size:** medium (85+, 2-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #4142
