---
number: 4076
title: "fix(docker): support bash v3 in macos"
author: Duc-Developer
created: 2026-01-29T16:46:44Z
updated: 2026-01-30T04:39:34Z
labels: ["docker"]
additions: 3
deletions: 3
changed_files: 1
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4076
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

# PR Summary

## Title
docker-setup.sh: Replace associative arrays with POSIX-compatible string tracking

## Description
Fixed `docker-setup.sh` to work on macOS by replacing Bash 4+ associative arrays with a portable POSIX-compatible approach.

### Problem
The script used `declare -A seen=()` in the `upsert_env()` function, which fails on macOS (Bash 3.2) with error:

```
/docker-setup.sh: line 127: declare: -A: invalid option
```

### Solution
Replaced associative array tracking with string-based tracking:
- Changed `seen["$k"]=1` to `seen_keys+="|$k|"`
- Changed `[[ -z "${seen[$k]:-}" ]]` to `[[ "$seen_keys" != *"|$k|"* ]]`

### Testing
- ✅ Works on macOS (Bash 3.2+)
- ✅ Works on Ubuntu (Bash 4+)
- ✅ Works on Windows WSL2
- ✅ Maintains existing functionality—.env file updates work correctly

### Platforms Affected
macOS, Ubuntu, WSL2

## Reviews


## Comments


## Stats

- **Size:** tiny (3+, 3-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
