---
number: 6379
title: "feat: Comprehensive Security Hardening & Vulnerability Remediation"
author: theBrokenCat
created: 2026-02-01T16:00:38Z
updated: 2026-02-02T23:15:32Z
labels: ["docs", "app: android", "app: ios", "app: macos", "gateway"]
additions: 1964
deletions: 683
changed_files: 35
size: huge
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"ai-fanatic","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/6379
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
This PR implements critical security hardening measures and resolves all identified vulnerabilities.

### Key Changes:
- **Anti-Brute Force**: Added Rate Limiting module (5 attempts/15min block) in Gateway auth.
- **Password Hashing**: Implemented secure hashing module using `scrypt` (OWASP recommended).
- **Vulnerability Fixes**: Resolved 9 vulnerabilities (0 audit issues remaining) via package overrides.
- **Dependency Resilience**: Updated critical packages (hono, tar, playwright-core) and used `pnpm.overrides`.
- **Documentation**: Added comprehensive security documentation in both English (`docs/security/`) and internal Spanish.
- **Verification Tools**: Included [security-verification.sh](cci:7://file:///Users/arturo/Desktop/AI/openclaw/openclaw/security-verification.sh:0:0-0:0) and 23 automated security tests.
- **Safety UX**: Enhanced startup logs with visual warnings and a 5-second pause on insecure configurations.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds gateway-focused security hardening: an in-memory IP-based auth failure limiter, a new scrypt-based password hashing helper, and stronger startup warnings (including a 5s pause when the gateway is exposed without TLS/strong auth). It also updates/pins several dependencies via pnpm overrides and adds a security verification script plus a Node test suite.

Key items to address before merge:
- The scrypt cost parameters are currently defined but not applied, and malformed hashes can crash verification.
- The new async startup warning isn’t awaited at its call site, so the intended pause won’t reliably happen.
- The verification script’s success detection is brittle (grepping for output text), and `resolutions` in package.json is likely ineffective under pnpm.

<h3>Confidence Score: 2/5</h3>

- This PR has meaningful security improvements but includes a few correctness issues that can break the intended protections or cause crashes.
- Score is reduced because (1) scrypt parameters are not actually applied, (2) password verification can throw on malformed hashes, and (3) the async startup warning isn’t awaited so the 5s pause may not happen. The remaining issues are mostly tooling/maintenance concerns (verification script output check, Yarn `resolutions`).
- src/gateway/auth-password.ts, src/gateway/server.impl.ts, src/gateway/server-startup-log.ts, security-verification.sh

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-01)

<sub>4 files reviewed, 6 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @ai-fanatic — COMMENTED (2026-02-01)

## Review Feedback

Thanks for this comprehensive security PR! I found a few issues that need to be addressed:

### 1. Bug: Scrypt parameters not being used (auth-password.ts)

The scrypt parameters `SCRYPT_N`, `SCRYPT_R`, `SCRYPT_P` are declared but never passed to `scryptAsync`:

```typescript
const SCRYPT_N = 16384;
const SCRYPT_R = 8;
const SCRYPT_P = 1;

// ... later:
const derivedKey = (await scryptAsync(password, salt, KEY_LENGTH)) as Buffer;
```

The parameters should be passed as options:
```typescript
const derivedKey = (await scryptAsync(password, salt, KEY_LENGTH, {
  N: SCRYPT_N,
  r: SCRYPT_R,
  p: SCRYPT_P,
})) as Buffer;
```

Without this fix, the default scrypt parameters are used instead of the custom OWASP-recommended values.

### 2. Linting errors in test file (security-test-suite.test.js)

Unused imports:
- `crypto` (line 16)
- `http` (line 17)

Remove these or prefix with underscore if intentionally unused.

### 3. CI Failures

The PR is currently failing:
- `checks (node, format, pnpm format)` - Format check failed
- `checks (node, lint, pnpm build && pnpm lint)` - Lint check failed

Please run `pnpm format && pnpm lint` locally and fix any issues before pushing.

---

The security implementation itself looks solid:
- ✅ Rate limiting with LRU cache and proper TTL
- ✅ Timing-safe password comparison
- ✅ Backward compatibility with plain text passwords
- ✅ Comprehensive test coverage

Just needs the above fixes to pass CI.


## Comments

### @greptile-apps (2026-02-01)

<details>
<summary>Additional Comments (1)</summary>

**`src/gateway/server.impl.ts`**
[P0] `logGatewayStartup` was changed to `async` but its call site isn’t awaiting it. This will delay the 5s warning asynchronously (and any future async work) while the server continues starting, which defeats the “pause on insecure configuration” behavior.

Await the call (and make the surrounding function `async` if it isn’t already) so startup truly pauses when a warning is emitted.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/gateway/server.impl.ts
Line: 482:490

Comment:
[P0] `logGatewayStartup` was changed to `async` but its call site isn’t awaiting it. This will delay the 5s warning asynchronously (and any future async work) while the server continues starting, which defeats the “pause on insecure configuration” behavior.

Await the call (and make the surrounding function `async` if it isn’t already) so startup truly pauses when a warning is emitted.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** huge (1964+, 683-, 35 files)
- **Age:** 1 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
