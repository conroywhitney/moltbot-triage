---
number: 3736
title: "fix: increase Venice discovery timeout and add retry"
author: jonisjongithub
created: 2026-01-29T03:33:13Z
updated: 2026-02-03T03:51:33Z
labels: ["agents"]
additions: 81
deletions: 49
changed_files: 1
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3736
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

Venice model discovery uses a 5-second `AbortSignal.timeout(5000)` with no retry. Users with slower connections or during transient Venice API blips see:

```
[venice-models] Discovery failed: TimeoutError: The operation was aborted due to timeout, using static catalog
```

While the static catalog fallback works, it means those users never get newly added Venice models until the catalog is manually updated.

## Fix

- **Increase timeout** from 5s → 10s per attempt
- **Add one automatic retry** with 1s backoff before falling back to static catalog
- Extract retry logic into `fetchVeniceModelsWithRetry()` for clarity
- Constants (`DISCOVERY_MAX_ATTEMPTS`, `DISCOVERY_TIMEOUT_MS`, `DISCOVERY_RETRY_DELAY_MS`) are easy to tune later

Total worst-case discovery time: ~21s (two 10s timeouts + 1s delay), which is acceptable during startup. In practice, the Venice API responds in <300ms, so this only affects edge cases.

## Testing

- Verified Venice `/models` endpoint returns 26 models in ~287ms
- Fallback to static catalog still works when all retries fail
- Test environment skip (`NODE_ENV=test`) is preserved

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates Venice model discovery (`src/agents/venice-models.ts`) to be more resilient on slow or flaky networks by increasing the per-request timeout from 5s to 10s and adding a single retry with a 1s delay before falling back to the static `VENICE_MODEL_CATALOG`. The retry logic is extracted into `fetchVeniceModelsWithRetry()`, and `discoverVeniceModels()` continues to skip network discovery in test environments and merges API-discovered models with catalog metadata when available.

<h3>Confidence Score: 4/5</h3>

- This PR is low-risk and likely safe to merge; it only changes startup-time discovery behavior and preserves the static fallback.
- Changes are localized to Venice model discovery and primarily adjust timeout/retry behavior without altering model schema. The main concern is reduced diagnostic clarity due to a generic fallback warning, but runtime behavior should remain correct and conservative (still falls back to static catalog).
- src/agents/venice-models.ts

<!-- greptile_other_comments_section -->

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** medium (81+, 49-, 1 files)
- **Age:** 4 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
