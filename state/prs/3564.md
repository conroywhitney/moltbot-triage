---
number: 3564
title: "fix(plugins): follow symlinks in plugin and hook discovery"
author: mollywires
created: 2026-01-28T20:46:24Z
updated: 2026-02-03T03:51:33Z
labels: []
additions: 3
deletions: 3
changed_files: 3
size: tiny
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: passing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3564
fixes_issues: []
related_prs: [2961]
duplicate_of: null
---

## Description

Symlinked extension and hook directories weren't being discovered. `readdir` with `withFileTypes` returns `Dirent` objects where `isDirectory()` is false for symlinks, even when the target is a directory — so they get silently skipped.

Added `isSymbolicLink()` checks in three places:
- `src/plugins/discovery.ts` — plugin/extension discovery
- `src/hooks/workspace.ts` — hook discovery
- `src/security/audit-extra.ts` — extension security audit

Other `isDirectory()` calls in `src/` either use `fs.statSync` (follows symlinks already) or operate on internal state dirs that wouldn't be symlinked. Dangling or non-directory symlinks are handled gracefully by existing null checks downstream (`readPackageManifest` returns null on any failure).

Related: #2961

- [x] AI-assisted
- [x] Tested locally with symlinked extensions

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates plugin/extension and hook discovery to treat symlinked entries returned by `readdir({ withFileTypes: true })` as candidates, since `Dirent.isDirectory()` is `false` for symlinks even when they point at directories. The same adjustment is applied to the security audit’s scan of the extensions directory so symlinked extension directories are counted.

Overall this brings discovery behavior closer to codepaths that already rely on `stat` (which follows symlinks), improving support for monorepos and setups that symlink extension/hook directories into the expected locations.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge and should fix the reported symlinked-directory discovery gap.
- Changes are small and localized (additional `isSymbolicLink()` checks) and align with the stated root cause. The main remaining risk is behavioral edge cases (symlink-to-file vs symlink-to-dir) and a possible false positive in the security audit count, but no obvious runtime-breakers were introduced.
- src/plugins/discovery.ts and src/security/audit-extra.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>2 files reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** tiny (3+, 3-, 3 files)
- **Age:** 5 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
