---
number: 6113
title: "support ipv6"
author: DingProg
created: 2026-02-01T08:58:46Z
updated: 2026-02-01T09:01:06Z
labels: ["gateway", "cli", "commands"]
additions: 34
deletions: 18
changed_files: 15
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6113
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

only ipv6 machine not run

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR introduces a new `gateway.bind` mode (`dualstack`) intended to improve IPv6 support by allowing the gateway to bind to an IPv6 wildcard address, and threads the new enum value through the CLI, onboarding flows, config schema, and related type definitions.

Main concerns are around correctness of “dualstack” semantics: in `src/gateway/net.ts` the mode currently resolves to `::`, which can still be IPv6-only on common Linux configurations, and several caller surfaces (daemon status probing and onboarding/control-UI link generation) still assume IPv4 loopback/IPv4 tailnet, which can lead to false “gateway unreachable” reports or unusable URLs on IPv6-only hosts.

<h3>Confidence Score: 3/5</h3>

- This PR is likely safe to merge, but has functional gaps around IPv6-only vs true dual-stack behavior and a few UX surfaces that may misreport reachability.
- Most changes are enum/threading updates and should be low risk, but the core behavior change (`dualstack` -> `::`) does not guarantee IPv4 reachability on common Linux setups and some related features (status probing, Control UI link generation) still assume IPv4, which can cause real user-facing failures in the targeted IPv6 scenarios.
- src/gateway/net.ts, src/cli/daemon-cli/shared.ts, src/commands/onboard-helpers.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-01)

<sub>4 files reviewed, 4 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-01)

<details>
<summary>Additional Comments (4)</summary>

**`src/gateway/net.ts`**
[P0] `dualstack` bind mode returns `"::"` (IPv6 any), which can still be IPv6-only on platforms where `IPV6_V6ONLY=1` (common on Linux). In that case, IPv4 clients cannot connect and the new mode won’t achieve the stated goal; you likely need to explicitly listen on both `0.0.0.0` and `::` (two servers) or ensure v6only is disabled.

This is especially relevant given the PR description (“only ipv6 machine not run”) and the UI label “Dualstack (IPv4+IPv6)”.


<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/gateway/net.ts
Line: 117:126

Comment:
[P0] `dualstack` bind mode returns `"::"` (IPv6 any), which can still be IPv6-only on platforms where `IPV6_V6ONLY=1` (common on Linux). In that case, IPv4 clients cannot connect and the new mode won’t achieve the stated goal; you likely need to explicitly listen on both `0.0.0.0` and `::` (two servers) or ensure v6only is disabled.

This is especially relevant given the PR description (“only ipv6 machine not run”) and the UI label “Dualstack (IPv4+IPv6)”.


How can I resolve this? If you propose a fix, please make it concise.
`````
</details>

---

**`src/cli/daemon-cli/shared.ts`**
[P1] `pickProbeHostForBind` doesn’t handle `dualstack`, so status probing falls back to `127.0.0.1`. If the gateway is bound to `::` (or otherwise IPv6-only), the daemon status probe URL can be wrong and show the gateway as unreachable even when it’s up.

Also affects `src/cli/daemon-cli/status.gather.ts` where probeUrl is built from this host.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/cli/daemon-cli/shared.ts
Line: 53:65

Comment:
[P1] `pickProbeHostForBind` doesn’t handle `dualstack`, so status probing falls back to `127.0.0.1`. If the gateway is bound to `::` (or otherwise IPv6-only), the daemon status probe URL can be wrong and show the gateway as unreachable even when it’s up.

Also affects `src/cli/daemon-cli/status.gather.ts` where probeUrl is built from this host.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>

---

**`src/commands/onboard-helpers.ts`**
[P1] `resolveControlUiLinks` still hardcodes IPv4-only host selection (only `tailnetIPv4` and `isValidIPv4(customBindHost)`, otherwise `127.0.0.1`). With the new `dualstack` bind mode returning `::`, this can generate Control UI links that don’t work on IPv6-only hosts (or don’t match the actual bind host).

If `dualstack` is meant to support IPv6-only machines, this function likely needs to consider IPv6 (e.g. `::1`, bracketed literals, and/or tailnet IPv6).

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/commands/onboard-helpers.ts
Line: 435:461

Comment:
[P1] `resolveControlUiLinks` still hardcodes IPv4-only host selection (only `tailnetIPv4` and `isValidIPv4(customBindHost)`, otherwise `127.0.0.1`). With the new `dualstack` bind mode returning `::`, this can generate Control UI links that don’t work on IPv6-only hosts (or don’t match the actual bind host).

If `dualstack` is meant to support IPv6-only machines, this function likely needs to consider IPv6 (e.g. `::1`, bracketed literals, and/or tailnet IPv6).

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>

---

**`src/commands/doctor-security.ts`**
[P2] `noteSecurityWarnings` treats any non-loopback bind host as “exposed” via `isLoopbackHost(resolvedBindHost)`, but `resolveGatewayBindHost("dualstack")` returns `"::"`, which is also a wildcard address. This makes `dualstack` always look “network exposed” even if the actual server ends up listening only on loopback in some environments (or if future behavior changes to bind both stacks). 

At minimum the wording for `dualstack` should be explicit that it’s listening on all interfaces (IPv6 any) and can expose the gateway, or the exposure check should be updated to reflect the actual listen hosts.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/commands/doctor-security.ts
Line: 21:31

Comment:
[P2] `noteSecurityWarnings` treats any non-loopback bind host as “exposed” via `isLoopbackHost(resolvedBindHost)`, but `resolveGatewayBindHost("dualstack")` returns `"::"`, which is also a wildcard address. This makes `dualstack` always look “network exposed” even if the actual server ends up listening only on loopback in some environments (or if future behavior changes to bind both stacks). 

At minimum the wording for `dualstack` should be explicit that it’s listening on all interfaces (IPv6 any) and can expose the gateway, or the exposure check should be updated to reflect the actual listen hosts.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** medium (34+, 18-, 15 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: (none detected)
