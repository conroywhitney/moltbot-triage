---
number: 4097
title: "fix: classify AWS SSO token errors as auth for model fallback (AI-assisted)"
author: guyelia
created: 2026-01-29T17:30:38Z
updated: 2026-01-29T17:45:03Z
labels: ["agents"]
additions: 4
deletions: 0
changed_files: 1
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4097
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

AWS SSO auth failures (common with Amazon Bedrock when SSO expires) were not recognized as auth/failover errors, which prevented model fallbacks from triggering.

This change adds a few AWS SSO-specific substrings to the auth failover patterns so these errors are classified as `auth` and will trigger model fallback instead of surfacing as "Agent failed before reply".

## Changes
- Add SSO-related patterns to `ERROR_PATTERNS.auth` in `src/agents/pi-embedded-helpers/errors.ts`:
  - `"sso session token"`
  - `"error loading sso token"`
  - `"was not found or is invalid"`

## Testing
- ✅ `pnpm install --frozen-lockfile`
- ✅ `pnpm run lint`
- ✅ `pnpm run test`

## AI Disclosure

This PR was AI-assisted. The change is minimal, reviewed, and tested locally.

## Reviews


## Comments


## Stats

- **Size:** tiny (4+, 0-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
