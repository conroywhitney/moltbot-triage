---
number: 4545
title: "fix: return clear error when compacting CLI provider sessions"
author: Ayush10
created: 2026-01-30T09:24:27Z
updated: 2026-01-30T13:43:48Z
labels: ["agents"]
additions: 10
deletions: 0
changed_files: 1
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4545
fixes_issues: [3874]
related_prs: [3874]
duplicate_of: null
---

## Description

## Summary

- Adds an early `isCliProvider()` check in `compactEmbeddedPiSessionDirect()` before attempting to resolve the model
- CLI providers (claude-cli, codex-cli, custom backends) don't have models in the standard registry, so compaction would fail with a confusing "Unknown model: claude-cli/opus" error
- Now returns a clear message: "Compaction is not supported for CLI providers"

## Test plan

- [x] Build passes
- [ ] Verify `/compact` with a CLI provider returns the new clear error instead of "Unknown model"

Fixes #3874

## Reviews


## Comments


## Stats

- **Size:** small (10+, 0-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #3874
