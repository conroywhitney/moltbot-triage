---
number: 7219
title: "Agents: cap no-timeout subagent waits"
author: aman-jaglan
created: 2026-02-02T15:35:03Z
updated: 2026-02-02T15:51:19Z
labels: ["agents"]
additions: 23
deletions: 6
changed_files: 4
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"aman-jaglan","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7219
fixes_issues: []
related_prs: [7194]
duplicate_of: null
---

## Description

## Summary
  - Implemented a safe “no timeout” cap to stay under Node’s setTimeout limit, while leaving room for the +10s buffer used in subagent waits (MAX_SET_TIMEOUT_MS - 10_000). 
  - This prevents overflow when runTimeoutSeconds: 0 is used.
  - Clamped the subagent wait timeout and the gateway wait buffer so the combined value never exceeds the setTimeout limit.
  - Added a focused unit test verifying the no-timeout cap behavior.

## Files changed

  - src/agents/timeout.ts (introduce MAX_SET_TIMEOUT_MS, cap no-timeout)
  - src/agents/subagent-registry.ts (clamp timeoutMs and buffer)
  - src/agents/timeout.test.ts (new test)
  - CHANGELOG.md (Fixes entry for #7194)

  Tests

  - pnpm vitest src/agents/timeout.test.ts --run (pass)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adjusts agent/subagent timeout handling to avoid Node.js `setTimeout` overflow warnings when users configure a “no timeout” value (`runTimeoutSeconds: 0`). It introduces a shared `MAX_SET_TIMEOUT_MS` cap in `src/agents/timeout.ts`, uses it to represent “no timeout” as `MAX_SET_TIMEOUT_MS - 10_000` (leaving room for the gateway wait buffer), and clamps both the subagent wait timeout and the gateway RPC timeout in `src/agents/subagent-registry.ts`. A unit test is added to assert the capped no-timeout behavior, and the changelog is updated accordingly.

<h3>Confidence Score: 4/5</h3>

- This PR is generally safe to merge and addresses a real runtime warning/overflow case, with a small edge-case behavior change around maximum waits.
- The changes are localized to timeout calculation and a single call site, and the added test covers the primary regression (overrideSeconds=0). The main remaining concern is an edge case where clamping the RPC timeout to the same maximum as the wait duration can remove the intended buffer at the upper limit, potentially causing premature RPC timeouts under high latency.
- src/agents/subagent-registry.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @aman-jaglan — COMMENTED (2026-02-02)




## Comments


## Stats

- **Size:** small (23+, 6-, 4 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
