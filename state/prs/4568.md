---
number: 4568
title: "fix(signal,windows): preserve group ID case and fix npm spawn ENOENT"
author: ThanhNguyxn
created: 2026-01-30T10:12:34Z
updated: 2026-02-03T02:27:13Z
labels: []
additions: 29
deletions: 3
changed_files: 3
size: small
review_decision: none
reviews: [{"author":"spiceoogway","state":"COMMENTED"},{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4568
fixes_issues: [4537,4557]
related_prs: [4537,4557]
duplicate_of: null
---

## Description

## Summary

- **Signal group ID fix (#4537)**: Preserve case for base64 group IDs - base64 is case-sensitive, so lowercasing broke group message routing
- **Windows npm spawn fix (#4557)**: Add `shell: true` for spawn on Windows to resolve ENOENT when running npm commands

## Changes

### `src/channels/plugins/normalize/signal.ts`
- Removed `.toLowerCase()` for group IDs while keeping it for usernames/UUIDs (which are case-insensitive)

### `src/process/exec.ts`
- Added `shell: process.platform === "win32"` to spawn options to fix npm.cmd resolution on Windows

## Issues Fixed
- Fixes #4537
- Fixes #4557

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR fixes two Windows/Signal regressions and a CI robustness issue: (1) Signal group targets no longer get lowercased so base64-encoded group IDs remain case-sensitive, while other Signal target types continue normalizing to lowercase; (2) Windows process spawning now enables `shell` only for npm-family tools (npm/pnpm/yarn/npx) to avoid ENOENT when invoking these commands; and (3) CI workflow submodule steps now short-circuit when `.gitmodules` is absent.

These changes touch the Signal target normalization plugin (`src/channels/plugins/normalize/signal.ts`) and the shared command runner (`src/process/exec.ts`) that other install/update flows depend on, plus CI workflow scripting.

<h3>Confidence Score: 4/5</h3>

- This PR is generally safe to merge, with a small risk around enabling shell for some Windows commands.
- Changes are narrow and clearly scoped; the only notable concern is that `shell: true` alters command parsing/quoting and should be tightly controlled, and Signal normalization behavior changed without accompanying tests for group/username cases.
- src/process/exec.ts and src/channels/plugins/normalize/signal.ts

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @spiceoogway — COMMENTED (2026-01-30)

Thanks for this fix! The `shell: true` approach is a solid solution for the Windows npm spawn issue.

One suggestion: Instead of enabling shell for ALL commands on Windows, consider only enabling it for commands that are known to be batch files:

```typescript
// Only use shell on Windows for CLI tools that are batch files
const needsShell = process.platform === "win32" && 
  ["npm", "pnpm", "yarn", "npx"].includes(argv[0]);

const child = spawn(argv[0], argv.slice(1), {
  stdio,
  cwd,
  env: resolvedEnv,
  windowsVerbatimArguments,
  shell: needsShell,
});
```

This is more conservative and has slightly better performance, but the current approach is also fine if you prefer simplicity.

Either way, this fixes the issue! ✅

### @greptile-apps — COMMENTED (2026-02-03)

<sub>3 files reviewed, 3 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** small (29+, 3-, 3 files)
- **Age:** 3 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #4537
- Fixes: #4557
