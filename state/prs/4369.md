---
number: 4369
title: "fix: Telegram reconnect, rebrand compat, and update restore step"
author: estackk
created: 2026-01-30T04:35:40Z
updated: 2026-01-30T04:35:49Z
labels: ["channel: telegram", "cli"]
additions: 35
deletions: 18
changed_files: 9
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: passing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4369
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

- **Telegram auto-reconnect**: grammY throws `"timed out after 500 seconds"` on `getUpdates` timeout â€” neither `isNetworkRelatedError()` (checks `"timeout"`) nor `isRecoverableTelegramNetworkError()` matched `"timed out"`, so the error was re-thrown and the channel exited permanently. Added `"timed out"` to both snippet arrays.
- **Rebrand legacy compat**: `LEGACY_CLI_NAME` was set to `"moltbot"` (same as `DEFAULT_CLI_NAME`) instead of `"clawdbot"`, and the regex alternations were duplicated `(moltbot|moltbot)` instead of `(moltbot|clawdbot)`. The embedded agent's `exec` tool failed with `command not found` in environments where only `clawdbot` is in PATH.
- **Update restore step**: `dist/control-ui/` was un-tracked from git (commit `615ccf641`) but the update runner still tried `git checkout -- dist/control-ui/`, causing a failed step. The matching dirty-check exemption in `update-check.ts` was also dead code.

## Changes

| File | Change |
|------|--------|
| `src/telegram/monitor.ts` | Add `"timed out"` to `NETWORK_ERROR_SNIPPETS` |
| `src/telegram/network-errors.ts` | Add `"timed out"` to `RECOVERABLE_MESSAGE_SNIPPETS` |
| `src/telegram/network-errors.test.ts` | Add test for grammY timeout message format |
| `src/cli/cli-name.ts` | Fix `LEGACY_CLI_NAME` to `"clawdbot"`, fix regex alternation |
| `src/cli/command-format.ts` | Fix regex alternation from `(moltbot\|moltbot)` to `(moltbot\|clawdbot)` |
| `src/infra/update-runner.ts` | Remove `restore control-ui` step |
| `src/infra/update-check.ts` | Remove `:!dist/control-ui/` pathspec exclusion |

## Test plan

- [x] `npx vitest run src/telegram/network-errors.test.ts` â€” 8/8 pass (includes new "timed out" test)
- [x] `npx vitest run src/infra/update-runner.test.ts` â€” 8/8 pass
- [x] `pnpm lint` â€” 0 warnings, 0 errors
- [x] `pnpm build` â€” succeeds

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** medium (35+, 18-, 9 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
