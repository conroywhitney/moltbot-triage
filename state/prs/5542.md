---
number: 5542
title: "fix(discord): Add thread archive/lock support to channel-edit action"
author: stumct
created: 2026-01-31T16:24:12Z
updated: 2026-01-31T16:25:43Z
labels: ["channel: discord", "agents"]
additions: 31
deletions: 0
changed_files: 4
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/5542
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

The `channel-edit` action was silently failing to archive Discord threads even when the bot had `ManageThreads` permission. The action was missing support for thread-specific parameters.

## Root Cause

The `DiscordChannelEdit` type and `editChannelDiscord` function only supported channel properties (name, topic, position, etc.) but not thread-specific properties required by Discord's API:
- `archived` (boolean) - Archive/unarchive a thread
- `locked` (boolean) - Lock/unlock a thread
- `auto_archive_duration` (number) - Set auto-archive duration

## Solution

Added support for thread management parameters:
1. Updated `DiscordChannelEdit` type to include `archived`, `locked`, and `autoArchiveDuration`
2. Modified `editChannelDiscord()` to send these fields to Discord's API
3. Updated action handlers to read and pass these parameters through the call chain

## Testing

Verified that:
- Bots with `ManageThreads` permission can now archive threads via `message channel-edit --archived true`
- Thread locking works via `--locked true`
- Existing channel-edit functionality (name, topic, etc.) remains unchanged

## Files Changed

- `src/discord/send.types.ts` - Added thread params to type
- `src/discord/send.channels.ts` - Added params to API request body
- `src/agents/tools/discord-actions-guild.ts` - Read and pass params
- `src/channels/plugins/actions/discord/handle-action.guild-admin.ts` - Read params from tool args

Fixes issue where Discord thread archiving was silently failing despite correct permissions.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR extends the Discord `channelEdit` action to support thread-specific edit fields (`archived`, `locked`, `autoArchiveDuration`) by threading them through the action handlers (`handle-action.guild-admin.ts` and `discord-actions-guild.ts`), widening `DiscordChannelEdit`, and adding the corresponding REST payload fields (`archived`, `locked`, `auto_archive_duration`) in `editChannelDiscord`.

Overall this is a straightforward pass-through change consistent with existing patterns (only include fields when defined), and it should address the previous inability to archive/lock threads via the action surface.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge, with one input-parsing issue that can cause runtime API errors in some invocation paths.
- The change is small and localized and mainly adds optional fields to an existing REST patch payload. The main concern is inconsistent boolean parsing: one call path type-checks booleans, while another uses unchecked casts that can pass non-boolean values to Discord and trigger 400 responses.
- src/agents/tools/discord-actions-guild.ts

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-01-31)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** small (31+, 0-, 4 files)
- **Age:** 2 days
- **Last activity:** 2026-01-31

## Links

- Fixes: (none detected)
