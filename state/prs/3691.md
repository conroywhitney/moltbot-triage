---
number: 3691
title: "fix(voice-call): align OpenAI Realtime STT with GA API format"
author: hclsys
created: 2026-01-29T02:15:47Z
updated: 2026-02-03T02:54:29Z
labels: ["channel: voice-call"]
additions: 18
deletions: 11
changed_files: 1
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3691
fixes_issues: [3447]
related_prs: [3447]
duplicate_of: null
---

## Description

## Summary

Fixes #3447

The OpenAI Realtime STT provider was using an outdated API format that doesn't produce transcriptions. This PR aligns the session configuration with the GA API format:

### Changes
- Event type: `transcription_session.update` â†’ `session.update`
- Session type: Added `type: "transcription"`
- Structure: Flat `session` â†’ nested `session.audio.input`
- Format: `g711_ulaw` â†’ `audio/pcmu` (MIME type)

### Why this fix

The code uses the `?intent=transcription` endpoint (GA API) but was sending a Beta API format. Per [OpenAI Forum discussions](https://community.openai.com/t/realtime-streaming-transcription/1371205), the GA transcription endpoint requires:
1. `session.update` event type (not `transcription_session.update`)
2. `type: "transcription"` in session config
3. Nested structure: `session.audio.input`
4. MIME type format: `audio/pcmu`

### References
- [OpenAI Forum - Bug Report](https://community.openai.com/t/why-does-transcription-session-update-cause-an-error-realtime-transcription-api-bug/1370560)
- [OpenAI Forum - Streaming Transcription](https://community.openai.com/t/realtime-streaming-transcription/1371205)

## Test plan
- [x] TypeScript compiles without errors
- [x] Code passes formatting check

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the OpenAI Realtime STT provider to use the GA transcription session configuration: it sends `session.update` instead of the older `transcription_session.update`, adds `type: "transcription"`, nests config under `session.audio.input`, and switches the audio format from `g711_ulaw` to the MIME-style `audio/pcmu`. This aligns the payload with the `?intent=transcription` Realtime endpoint so transcripts are produced.


<h3>Confidence Score: 3/5</h3>

- This PR is likely safe to merge, but the exact GA schema details for `audio/pcmu` should be validated to avoid silent no-transcription failures.
- The change is small and localized (session config payload), and it matches the stated GA event/type nesting adjustments. However, the new format object shape and lack of explicit sample-rate/format details could still be slightly off vs the GA schema, and the event handler still focuses on legacy session lifecycle events, which can hinder diagnosis if the server rejects or partially applies the config.
- extensions/voice-call/src/providers/stt-openai-realtime.ts

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-03)

<sub>1 file reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`extensions/voice-call/src/providers/stt-openai-realtime.ts`**
[P2] Event handling still logs only legacy `transcription_session.*` events.

With the move to GA `session.update`, the server-side lifecycle events may also have changed (e.g. `session.created/session.updated`). Right now those wonâ€™t be logged or surfaced, which can make debugging config failures harder (youâ€™ll only see `error`). It may be worth adding the GA session event types here (or updating the cases) so you can confirm the session was as expected.


<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: extensions/voice-call/src/providers/stt-openai-realtime.ts
Line: 230:236

Comment:
[P2] Event handling still logs only legacy `transcription_session.*` events.

With the move to GA `session.update`, the server-side lifecycle events may also have changed (e.g. `session.created/session.updated`). Right now those wonâ€™t be logged or surfaced, which can make debugging config failures harder (youâ€™ll only see `error`). It may be worth adding the GA session event types here (or updating the cases) so you can confirm the session was as expected.


How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** small (18+, 11-, 1 files)
- **Age:** 4 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #3447
