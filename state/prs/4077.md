---
number: 4077
title: "feat(whatsapp): subscribe to inbound reaction events"
author: TechNickAI
created: 2026-01-29T16:47:43Z
updated: 2026-01-29T18:53:39Z
labels: ["docs", "channel: whatsapp-web"]
additions: 903
deletions: 21
changed_files: 8
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: unknown
draft: true
url: https://github.com/openclaw/openclaw/pull/4077
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

- Subscribe to Baileys `messages.reaction` events in the WhatsApp inbound monitor
- Parse reaction data (emoji, sender, target message) and forward via new `onReaction` callback
- Wire reactions into the system event pipeline (`enqueueSystemEvent`) so agents see "WhatsApp reaction added: üëç by +1234 msg abc123"
- Follows the existing Signal/Slack/Discord pattern for reaction notifications

## Design notes

- New `WebInboundReaction` type in `src/web/inbound/types.ts`
- Reaction removals (empty emoji) are skipped ‚Äî only additions are surfaced
- Self-reaction attribution uses `reactionKey.fromMe` + captured `selfJid`
- ContextKey deduplication prevents duplicate notifications (matches Signal/Slack format)
- Outer + inner try/catch in the handler for resilience against malformed events
- `onReaction` callback is optional for backward compatibility

## Test plan

- [x] 10 monitor-level tests (`monitor-inbox.inbound-reactions.test.ts`)
- [x] 3 system event wiring tests (`auto-reply.whatsapp-inbound-reaction-system-events.test.ts`)
- [x] Edge cases: missing fields, self-reactions, callback errors, status/broadcast filtering
- [x] Full test suite passes (161 tests), clean build, 0 lint errors

## Files changed

- `src/web/inbound/types.ts` ‚Äî New `WebInboundReaction` type
- `src/web/inbound/monitor.ts` ‚Äî `messages.reaction` handler + `onReaction` callback + cleanup
- `src/web/inbound.ts` ‚Äî Re-export
- `src/web/auto-reply/monitor.ts` ‚Äî Wire `onReaction` ‚Üí `resolveAgentRoute` ‚Üí `enqueueSystemEvent`
- `src/web/monitor-inbox.inbound-reactions.test.ts` ‚Äî 10 tests
- `src/web/auto-reply.whatsapp-inbound-reaction-system-events.test.ts` ‚Äî 3 tests
- `docs/channels/whatsapp.md` ‚Äî Inbound reaction notifications section
- `docs/tools/reactions.md` ‚Äî WhatsApp inbound mention

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** large (903+, 21-, 8 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
