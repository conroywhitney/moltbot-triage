---
number: 4741
title: "Fix issue #4718: Enforce 40-char limit for OpenAI tool call IDs"
author: spiceoogway
created: 2026-01-30T15:57:09Z
updated: 2026-01-30T16:08:03Z
labels: ["docs", "channel: whatsapp-web", "commands", "agents"]
additions: 5192
deletions: 92
changed_files: 36
size: huge
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4741
fixes_issues: [4718]
related_prs: [4718]
duplicate_of: null
---

## Description

## Summary
Fixes #4718

OpenAI's API requires  IDs to be <= 40 characters. After commit 870bfa94e, Clawdbot stopped enforcing this limit for OpenAI providers to "preserve Pi pairing", but this caused HTTP 400 errors when tool call IDs exceeded 40 chars (reported as 438 chars in #4718).

## Root Cause
Commit 870bfa94e disabled tool call ID sanitization for OpenAI to preserve tool_use/tool_result pairing. However, the sanitization logic in `tool-call-id.ts` already preserves pairing correctly via the `resolve()` function's stable mapping.

## Changes
- **`transcript-policy.ts`**: Re-enable tool call ID sanitization for OpenAI (add `isOpenAi` to sanitization condition)
- **`tool-call-id.test.ts`**: Add test case for 439-char ID to verify 40-char limit enforcement
- **`pi-embedded-runner.sanitize-session-history.test.ts`**: Update test expectations to reflect OpenAI now gets sanitized IDs with `toolCallIdMode: "strict"`

## Testing
All existing tests pass, plus new test case "enforces 40-char limit for very long IDs (issue #4718)" verifies the fix works for IDs similar to the reported 438-char case.

## Impact
- ✅ OpenAI tool call IDs are now capped at 40 characters (alphanumeric only)
- ✅ Tool pairing is preserved via the existing stable mapping mechanism
- ✅ Fixes HTTP 400 errors reported in #4718

## Reviews


## Comments


## Stats

- **Size:** huge (5192+, 92-, 36 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #4718
