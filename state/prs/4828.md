---
number: 4828
title: "Avoid exiting the gateway process on non-fatal unhandled promise rejections"
author: gupta-8
created: 2026-01-30T18:25:45Z
updated: 2026-02-03T02:23:49Z
labels: []
additions: 22
deletions: 2
changed_files: 2
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4828
fixes_issues: [4764]
related_prs: [4764]
duplicate_of: null
---

## Description

The gateway now stays running for generic, non-fatal unhandled promise rejections. Fatal and configuration errors still exit the process as before.

Earlier, any unhandled rejection could cause the gateway to exit, even for temporary issues like network failures. This change avoids unnecessary restarts while keeping errors visible in logs.

Fail-fast behavior can still be enabled using the `OPENCLAW_FAIL_FAST_UNHANDLED_REJECTIONS` environment variable. Tests were updated to cover the new behavior.

Fixes #4764

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR changes the gateway’s `unhandledRejection` handling to only `process.exit(1)` for fatal/configuration errors by default, while keeping the process alive for generic unhandled promise rejections (still logging them). A new env var gate (`OPENCLAW_FAIL_FAST_UNHANDLED_REJECTIONS`) re-enables the previous fail-fast behavior for generic rejections. Tests were updated to assert the non-exit default and the opt-in exit behavior.

This fits into the existing infra error classification in `src/infra/unhandled-rejections.ts` by extending the final “generic unhandled rejection” branch to be configurable, while leaving the existing fatal/config/transient-network/abort handling unchanged.

<h3>Confidence Score: 4/5</h3>

- This PR is generally safe to merge; it changes exit behavior only for generic unhandled rejections and keeps strong logging/tests.
- The change is small and localized, and the updated tests cover both default non-exit and the fail-fast opt-in. Main remaining concern is env-var parsing edge cases (whitespace/casing) that could lead to unexpected fail-fast enabling in some deployments.
- src/infra/unhandled-rejections.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** small (22+, 2-, 2 files)
- **Age:** 3 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #4764
