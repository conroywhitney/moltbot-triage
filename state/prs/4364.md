---
number: 4364
title: "fix(github-copilot): use gho_ tokens directly without exchange"
author: RebelSyntax
created: 2026-01-30T04:23:37Z
updated: 2026-01-30T04:38:59Z
labels: ["docs"]
additions: 163
deletions: 13
changed_files: 4
size: medium
review_decision: none
reviews: [{"author":"copilot-pull-request-reviewer","state":"COMMENTED"}]
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4364
fixes_issues: []
related_prs: [3437]
duplicate_of: null
---

## Description

Tokens from the GitHub Copilot CLI (prefixed with `gho_`) can be used directly with the Copilot API without requiring a token exchange via /copilot_internal/v2/token (which returns HTTP 404 for these tokens).

This fixes authentication for users who:
- Installed the Copilot CLI (`npm install -g @github/copilot`)
- Authenticated via `copilot auth login`
- Set COPILOT_GITHUB_TOKEN or GH_TOKEN to their gho_ token

The fix detects gho_ prefixed tokens and skips the exchange, caching them with an 8-hour TTL (matching typical OAuth token lifetimes).

Also adds COPILOT_API_BASE_URL env var support for enterprise users whose proxy blocks api.individual.githubcopilot.com. Set this to your enterprise endpoint (e.g., https://api.business.githubcopilot.com).

[AI-assisted] Tested with GitHub Copilot CLI 0.0.399 on WSL2.

Related to #3437

## Reviews

### @copilot-pull-request-reviewer â€” COMMENTED (2026-01-30)

## Pull request overview

This PR adds support for using GitHub Copilot CLI tokens (prefixed with `gho_`) directly with the Copilot API without requiring token exchange via the `/copilot_internal/v2/token` endpoint. It also introduces the `COPILOT_API_BASE_URL` environment variable to support enterprise users with custom endpoints.

**Changes:**
- Adds detection for `gho_` prefixed tokens and bypasses the token exchange for these tokens
- Introduces `COPILOT_API_BASE_URL` environment variable support for custom/enterprise endpoints
- Adds comprehensive test coverage for the new gho_ token handling and environment variable support

### Reviewed changes

Copilot reviewed 3 out of 3 changed files in this pull request and generated 8 comments.

| File | Description |
| ---- | ----------- |
| src/providers/github-copilot-token.ts | Implements gho_ token detection, direct usage without exchange, environment variable resolution for custom base URLs, and 8-hour TTL caching |
| src/providers/github-copilot-token.test.ts | Adds three new test cases covering gho_ token direct usage, non-gho token exchange, and environment variable support |
| docs/providers/github-copilot.md | Documents the new Copilot CLI token authentication method and COPILOT_API_BASE_URL environment variable usage |





---

ðŸ’¡ <a href="/openclaw/openclaw/new/main/.github/instructions?filename=*.instructions.md" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Add Copilot custom instructions</a> for smarter, more guided reviews. <a href="https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Learn how to get started</a>.


## Comments


## Stats

- **Size:** medium (163+, 13-, 4 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
