---
number: 6885
title: "feat(hooks): add lifecycle events for sessions and agent turns"
author: mverrilli
created: 2026-02-02T04:55:10Z
updated: 2026-02-02T13:38:10Z
labels: ["docs"]
additions: 136
deletions: 5
changed_files: 4
size: medium
review_decision: none
reviews: [{"author":"chatgpt-codex-connector","state":"COMMENTED"},{"author":"greptile-apps","state":"COMMENTED"},{"author":"mverrilli","state":"COMMENTED"},{"author":"mverrilli","state":"COMMENTED"},{"author":"mverrilli","state":"COMMENTED"},{"author":"mverrilli","state":"COMMENTED"},{"author":"mverrilli","state":"COMMENTED"},{"author":"mverrilli","state":"COMMENTED"},{"author":"mverrilli","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/6885
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR introduces additional internal hook lifecycle events for sessions and agent execution, and documents the new event types. On the implementation side, the reply agent now triggers `session:*` events during session resets and (intended) session starts, plus `agent:reply` at the end of each completed turn; the memory flush path triggers an `agent:flush` event when a context-limit flush is about to occur.

These changes extend the existing internal hooks mechanism (`src/hooks/internal-hooks.ts`) by emitting new event/action combinations from the auto-reply runner, enabling hook authors to react to higher-level lifecycle boundaries (session transitions, completed turns, memory flushes) without modifying core agent code.

<h3>Confidence Score: 3/5</h3>

- This PR is generally safe, but lifecycle events have a couple of gating/consistency bugs that will make hooks unreliable.
- Core behavior changes are limited to emitting internal hook events, but `session:start` is currently emitted only under verbose mode and `session:ended` is skipped for most resets, which likely deviates from intended semantics. There‚Äôs also a small unused variable and some edge cases around turn output payloads.
- src/auto-reply/reply/agent-runner.ts (session lifecycle hooks and turn hook output construction)

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->
---

**Note: The above concerns were address (see the thread below or the subsequent commits).**

## Example from testing:
```
2026-02-02T13:07:09.897Z [agent:main:cron:xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx] session:end {"sessionId":"yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy"}
2026-02-02T13:07:09.899Z [agent:main:cron:xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx] session:reset {"oldSessionId":"yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy","newSessionId":"zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzzz"}
2026-02-02T13:07:10.096Z [agent:main:cron:xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx] command:new {"sessionEntry":{"sessionId":"zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzzz","updatedAt":1770037629900,"systemSent":false,"abortedLastRun":false,"chatType":"direct","deliveryContext":{"channel":"webchat"},"las
2026-02-02T13:07:14.557Z [agent:main:cron:xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx] session:start {"sessionId":"zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzzz"}
2026-02-02T13:07:14.640Z [agent:main:cron:xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx] agent:reply {"sessionId":"zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzzz","input":"A new session was started via /new or /reset. Greet the user in your configured persona, if one is provided. Be yourself - use your defined
```


## Reviews

### @chatgpt-codex-connector ‚Äî COMMENTED (2026-02-02)


### üí° Codex Review

Here are some automated review suggestions for this pull request.

**Reviewed commit:** `5cecd487d7`
    

<details> <summary>‚ÑπÔ∏è About Codex in GitHub</summary>
<br/>

[Your team has set up Codex to review pull requests in this repo](http://chatgpt.com/codex/settings/general). Reviews are triggered when you
- Open a pull request for review
- Mark a draft as ready
- Comment "@codex review".

If Codex has suggestions, it will comment; otherwise it will react with üëç.




Codex can also answer questions or update the PR. Try commenting "@codex address that feedback".
            
</details>

### @greptile-apps ‚Äî COMMENTED (2026-02-02)

<sub>2 files reviewed, 5 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @mverrilli ‚Äî COMMENTED (2026-02-02)



### @mverrilli ‚Äî COMMENTED (2026-02-02)



### @mverrilli ‚Äî COMMENTED (2026-02-02)



### @mverrilli ‚Äî COMMENTED (2026-02-02)



### @mverrilli ‚Äî COMMENTED (2026-02-02)



### @mverrilli ‚Äî COMMENTED (2026-02-02)



### @mverrilli ‚Äî COMMENTED (2026-02-02)




## Comments


## Stats

- **Size:** medium (136+, 5-, 4 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
