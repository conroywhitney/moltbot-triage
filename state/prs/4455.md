---
number: 4455
title: "feat(webchat): add image paste support"
author: joeynyc
created: 2026-01-30T07:18:25Z
updated: 2026-01-30T07:18:35Z
labels: ["app: web-ui"]
additions: 276
deletions: 44
changed_files: 9
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: passing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4455
fixes_issues: [1681]
related_prs: [1681,1900]
duplicate_of: null
---

## Description

## Summary
- Adds clipboard image paste to WebChat compose area with thumbnail preview and remove button
- Images rendered in chat history bubbles (fixes image-only messages not rendering)
- Frontend 5 MB size validation matching backend limit
- Empty message fallback for image-only sends to pass NonEmptyString validation

Fixes #1681, supersedes #1900

## Bugs fixed from #1900
1. **Image-only messages failing backend validation** â€” `NonEmptyString` requires minLength 1; image-only sends now use a space fallback
2. **Image content blocks not rendering in chat history** â€” `grouped-render.ts` only extracted `type: "text"` blocks; now handles `type: "image"` with `<img>` tags
3. **Duplicate `ChatAttachment` type** â€” consolidated in `controllers/chat.ts`, imported elsewhere
4. **No frontend size validation** â€” paste handler rejects files >5 MB with a console warning

## Files changed (9)
- `ui/src/ui/controllers/chat.ts` â€” `ChatAttachment` type, attachment-aware `sendChatMessage`
- `ui/src/ui/views/chat.ts` â€” paste handler, attachment preview UI, size validation
- `ui/src/ui/chat/message-extract.ts` â€” `extractImages()` / `extractImagesCached()`
- `ui/src/ui/chat/grouped-render.ts` â€” image block rendering in chat bubbles
- `ui/src/ui/app-chat.ts` â€” attachment wiring through send flow
- `ui/src/ui/app.ts` â€” `chatAttachments` state property
- `ui/src/ui/app-view-state.ts` â€” type addition
- `ui/src/ui/app-render.ts` â€” prop plumbing
- `ui/src/styles/chat/layout.css` â€” attachment preview + chat image styles

## Test plan
- [x] `pnpm lint` â€” 0 warnings, 0 errors
- [x] `pnpm build` â€” clean
- [x] `pnpm test` â€” 5493 passed, 1 skipped
- [ ] Manual: paste screenshot in WebChat compose â†’ thumbnail appears
- [ ] Manual: click remove â†’ thumbnail disappears
- [ ] Manual: paste image + text â†’ send â†’ both render in history
- [ ] Manual: paste image only â†’ send â†’ image renders (with space fallback)
- [ ] Manual: paste >5 MB image â†’ skipped with console warning

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** large (276+, 44-, 9 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #1681
