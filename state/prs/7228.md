---
number: 7228
title: "Thinking: add max level option"
author: sauerdaniel
created: 2026-02-02T15:44:01Z
updated: 2026-02-02T18:58:07Z
labels: ["app: web-ui", "gateway", "commands", "agents"]
additions: 93
deletions: 19
changed_files: 20
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 2
reactions_total: 1
ci_status: failing
mergeable: false
draft: false
url: https://github.com/openclaw/openclaw/pull/7228
fixes_issues: []
related_prs: [7223]
duplicate_of: null
---

## Description

## Summary
- add a max thinking level that resolves to the highest supported tier
- expose max in config and /think choices
- resolve max during reply, CLI, cron, compaction, and gateway flows

## Testing
- pnpm build

## AI-assisted
- yes (OpenAI)

## Depends on
- #7223 (stacked; this PR includes that commit)

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>2 files reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-02)

<details>
<summary>Additional Comments (2)</summary>

**`src/agents/pi-embedded-runner/utils.ts`**
[P1] `max` gets downgraded to `high` even when `xhigh` is supported.

`mapThinkingLevel()` currently maps `"max"` → `"high"` unconditionally (`src/agents/pi-embedded-runner/utils.ts:11-13`). That defeats the purpose of `max` on models that support `xhigh` (and is inconsistent with the new `resolveMaxThinkLevel()` behavior elsewhere). This shows up when passing `thinkLevel: "max"` through the embedded Pi runner path, where it will never reach `xhigh`.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/agents/pi-embedded-runner/utils.ts
Line: 6:14

Comment:
[P1] `max` gets downgraded to `high` even when `xhigh` is supported.

`mapThinkingLevel()` currently maps `"max"` → `"high"` unconditionally (`src/agents/pi-embedded-runner/utils.ts:11-13`). That defeats the purpose of `max` on models that support `xhigh` (and is inconsistent with the new `resolveMaxThinkLevel()` behavior elsewhere). This shows up when passing `thinkLevel: "max"` through the embedded Pi runner path, where it will never reach `xhigh`.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>

---

**`src/config/types.hooks.ts`**
[P1] Hooks config type now blocks `xhigh` but allows `max`.

`HooksGmailConfig.thinking` was widened to include `"max"` but still excludes `"xhigh"` (`src/config/types.hooks.ts:66-70`). Since the rest of the codebase supports `xhigh` (with gating) and now also resolves `max` → `xhigh/high`, this creates an inconsistent public config surface: users can’t explicitly request `xhigh` for Gmail hooks even on supported models, but can request `max` which may resolve to `xhigh` anyway.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/config/types.hooks.ts
Line: 63:70

Comment:
[P1] Hooks config type now blocks `xhigh` but allows `max`.

`HooksGmailConfig.thinking` was widened to include `"max"` but still excludes `"xhigh"` (`src/config/types.hooks.ts:66-70`). Since the rest of the codebase supports `xhigh` (with gating) and now also resolves `max` → `xhigh/high`, this creates an inconsistent public config surface: users can’t explicitly request `xhigh` for Gmail hooks even on supported models, but can request `max` which may resolve to `xhigh` anyway.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>

### @sauerdaniel (2026-02-02)

Addressed review notes:
- resolve max in embedded runner using provider/model (xhigh when supported)
- allow xhigh in HooksGmailConfig.thinking

Testing: pnpm build


## Stats

- **Size:** medium (93+, 19-, 20 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
