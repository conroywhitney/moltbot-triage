---
number: 4441
title: "fix: support Unicode characters in hybrid search FTS query"
author: r266-tech
created: 2026-01-30T06:56:27Z
updated: 2026-01-30T06:56:27Z
labels: []
additions: 1
deletions: 1
changed_files: 1
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4441
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

The `buildFtsQuery` function in `src/memory/hybrid.ts` uses regex `/[A-Za-z0-9_]+/g` which only matches ASCII characters. This causes CJK (Chinese/Japanese/Korean) and other non-ASCII Unicode characters to be completely ignored during hybrid search.

**Example:** When searching for "记忆系统" (Chinese for "memory system"), the function returns `null` because no tokens are matched.

## Solution

Changed the regex to use Unicode property escapes:

```diff
- .match(/[A-Za-z0-9_]+/g)
+ .match(/[\p{L}\p{N}_]+/gu)
```

- `\p{L}` matches all Unicode letters (including CJK)
- `\p{N}` matches all Unicode numbers  
- `u` flag enables Unicode mode

## Testing

Manually verified that Chinese keywords are now properly tokenized:

```typescript
buildFtsQuery('记忆系统')  // Before: null
buildFtsQuery('记忆系统')  // After: '"记忆系统"'

buildFtsQuery('hello 世界') // Before: '"hello"'
buildFtsQuery('hello 世界') // After: '"hello" AND "世界"'
```

## Compatibility

Unicode property escapes are supported in:
- Node.js 10+ (ES2018)
- All modern browsers

## Reviews


## Comments


## Stats

- **Size:** tiny (1+, 1-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
