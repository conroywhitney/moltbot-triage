---
number: 4039
title: "fix: apply default model aliases even when no user models configured"
author: maximveksler
created: 2026-01-29T15:32:57Z
updated: 2026-01-29T15:38:39Z
labels: []
additions: 31
deletions: 5
changed_files: 2
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/moltbot/moltbot/pull/4039
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem

When `cfg.agents.defaults.models` is empty (which is the default), `applyModelDefaults` returned early without adding the default model aliases (`opus`, `sonnet`, `gpt`, etc.).

This caused isolated cron sessions to fail with 'Unknown model' errors when using aliases like `sonnet` instead of the full model name `anthropic/claude-sonnet-4-5`.

## Solution

Remove the early return when `existingModels` is empty, and always iterate through `DEFAULT_MODEL_ALIASES` to add them to the config.

## Testing

- Verified locally that `loadConfig().agents.defaults.models` now includes the default aliases
- Verified that cron jobs with `model: 'sonnet'` now work correctly

## Diff

```diff
-  if (!existingAgent) return mutated ? nextCfg : cfg;
-  const existingModels = existingAgent.models ?? {};
-  if (Object.keys(existingModels).length === 0) return mutated ? nextCfg : cfg;
+  const existingAgent = nextCfg.agents?.defaults;
+  const existingModels = existingAgent?.models ?? {};

   for (const [alias, target] of Object.entries(DEFAULT_MODEL_ALIASES)) {
     const entry = nextModels[target];
-    if (!entry) continue;
-    if (entry.alias !== undefined) continue;
+    if (entry?.alias !== undefined) continue;
     nextModels[target] = { ...entry, alias };
```

## Reviews


## Comments


## Stats

- **Size:** small (31+, 5-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
