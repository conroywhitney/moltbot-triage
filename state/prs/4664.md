---
number: 4664
title: "fix: per-session metadata files to eliminate lock contention"
author: tsukhani
created: 2026-01-30T13:46:51Z
updated: 2026-01-30T13:46:51Z
labels: []
additions: 233
deletions: 11
changed_files: 2
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4664
fixes_issues: [3092]
related_prs: [3092]
duplicate_of: null
---

## Description

## Summary
Instead of all sessions sharing a single `sessions.json` with a global file lock, each session now gets its own `.meta.json` file for frequent updates. This eliminates lock contention when multiple sessions are active simultaneously.

## Problem
When chatting on multiple channels (e.g., Slack and Telegram) simultaneously, sessions would block each other because `updateSessionStoreEntry` required an exclusive lock on the shared `sessions.json` file.

## Solution
- New `per-session-store.ts` with atomic write functions for per-session `.meta.json` files
- `updateSessionStoreEntry` now writes to per-session files without acquiring the global lock
- Background debounced sync keeps `sessions.json` in sync (best-effort, 5s debounce)
- Fallback to locked update for legacy entries without sessionId

## Testing
- [x] Tested locally with concurrent Slack and Telegram sessions
- [x] Linter passes

## AI Assistance ðŸ¤–
This PR was AI-assisted (Claude). The fix was identified by tracing the session update flow and finding the global lock bottleneck reported in #3092.

Fixes #3092

## Reviews


## Comments


## Stats

- **Size:** large (233+, 11-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #3092
