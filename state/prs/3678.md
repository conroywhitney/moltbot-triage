---
number: 3678
title: "TUI: fix /reasoning by supporting stream + normalization-Mark as AI-assisted-lightly tested"
author: AaronWander
created: 2026-01-29T01:38:42Z
updated: 2026-02-03T03:52:59Z
labels: []
additions: 59
deletions: 5
changed_files: 4
size: medium
review_decision: none
reviews: [{"author":"orzelig","state":"APPROVED"},{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3678
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

This change fixes a mismatch between the TUI /reasoning command and the project’s canonical reasoning enum.

What was wrong before

The core enum is ReasoningLevel = "off" | "on" | "stream" ([thinking.ts](https://file+.vscode-resource.vscode-cdn.net/Users/aaron/.vscode/extensions/openai.chatgpt-0.4.67-darwin-arm64/webview/#)), and the Gateway session patch logic validates the same set (on|off|stream).
The TUI, however:
Only advertised /reasoning <on|off> (help text).
Only offered on/off in autocomplete.
Passed the raw argument through to patchSession without normalization/validation.
What this fixes

Adds stream to TUI autocomplete for /reasoning.
Updates /reasoning help text to include stream.
Normalizes user input via normalizeReasoningLevel() so common inputs like streaming become stream before calling patchSession.
If you didn’t make this change, when would it fail and how

If a user tries to enable streaming reasoning in TUI (e.g. /reasoning stream or /reasoning streaming):
The TUI would either not guide them to the correct value (no autocomplete, wrong usage).
For /reasoning streaming specifically, the TUI would send reasoningLevel: "streaming" to the Gateway, which rejects it as invalid (Gateway expects exactly on|off|stream).
Result: the command fails (you’d see a “reasoning failed: …” message in the TUI), and the session would not enter reasoning:stream, so the user cannot enable streaming reasoning from TUI reliably.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the TUI `/reasoning` command to match the canonical `ReasoningLevel` enum (`off|on|stream`). It adds `stream` to `/reasoning` autocomplete, updates the command description, and normalizes user input via `normalizeReasoningLevel()` before calling `client.patchSession`, with tests covering autocomplete and normalization behavior.

The main integration point is `src/tui/tui-command-handlers.ts`, where slash command arguments are parsed and translated into gateway `patchSession` calls; the TUI’s slash command registry in `src/tui/commands.ts` drives help/autocomplete UI.

<h3>Confidence Score: 4/5</h3>

- This PR is low risk and mostly safe to merge; the main remaining issue is a minor documentation mismatch in `/help` output.
- Changes are localized to TUI command wiring and add straightforward normalization using an existing helper (`normalizeReasoningLevel`). New tests cover autocomplete and normalization. I couldn’t run the test/lint/typecheck commands in this environment (npm unavailable), so confidence is slightly reduced.
- src/tui/commands.ts (helpText line for /reasoning)

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @orzelig — APPROVED (2026-01-29)

Good fix! The normalization of reasoning levels ensures TUI aligns with the canonical enum. Adding 'stream' to autocomplete and help text improves UX. Test coverage validates the normalization properly. LGTM!

### @greptile-apps — COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`src/tui/commands.ts`**
[P1] `/help` text still documents `/reasoning <on|off>`

`getSlashCommands` now advertises `stream`, and the handler accepts/normalizes it, but `helpText()` still prints `"/reasoning <on|off>"` (so `/help` contradicts autocomplete/behavior). This will confuse users trying to discover the feature.

```suggestion
    "/reasoning <on|off|stream>",
```

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/tui/commands.ts
Line: 142:151

Comment:
[P1] `/help` text still documents `/reasoning <on|off>`

`getSlashCommands` now advertises `stream`, and the handler accepts/normalizes it, but `helpText()` still prints `"/reasoning <on|off>"` (so `/help` contradicts autocomplete/behavior). This will confuse users trying to discover the feature.

```suggestion
    "/reasoning <on|off|stream>",
```

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** medium (59+, 5-, 4 files)
- **Age:** 4 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
