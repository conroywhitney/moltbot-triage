---
number: 4139
title: "feat(whatsapp): subscribe to inbound reaction events"
author: TechNickAI
created: 2026-01-29T19:11:46Z
updated: 2026-01-30T16:44:07Z
labels: ["docs", "channel: whatsapp-web"]
additions: 918
deletions: 3
changed_files: 9
size: large
review_decision: none
reviews: [{"author":"chatgpt-codex-connector","state":"COMMENTED"},{"author":"TechNickAI","state":"COMMENTED"}]
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4139
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

Subscribes to Baileys `messages.reaction` events and surfaces them as system events for agent sessions.

### What this does

When someone reacts to a message on WhatsApp, the agent now receives a system event with the emoji, sender, and target message. This enables reaction-aware agent behaviors (acknowledgment workflows, sentiment signals, etc).

The implementation follows the same pattern already used by Signal and Slack: listen ‚Üí parse ‚Üí route ‚Üí enqueue system event. Reactions flow through `resolveAgentRoute` and respect the existing DM/group access controls (allowlists, dmPolicy). Self-reactions bypass access checks since they're our own actions, not inbound events.

Reaction removals (when someone un-reacts) emit events with `isRemoval: true` rather than being silently dropped‚Äîthe agent can decide what to do with that information.

### Implementation notes

- `WebInboundReaction` type added to `src/web/inbound/types.ts`
- `onReaction` callback added to `monitorWebInbox` options
- Outer + inner try/catch for resilience against malformed Baileys events
- Pairing messages suppressed for reactions (pairing is for messages, not emoji taps)

### Testing

655 lines of new tests across two files covering monitor-level parsing and system event wiring. All existing tests pass.

```
src/web/monitor-inbox.inbound-reactions.test.ts      (468 lines, 13 test cases)
src/web/auto-reply.whatsapp-inbound-reaction-system-events.test.ts (187 lines)
```

### Docs

Updated `docs/channels/whatsapp.md` with the new event structure and `docs/tools/reactions.md` noting WhatsApp support.

## Reviews

### @chatgpt-codex-connector ‚Äî COMMENTED (2026-01-29)


### üí° Codex Review

Here are some automated review suggestions for this pull request.

**Reviewed commit:** `7d7b171b91`
    

<details> <summary>‚ÑπÔ∏è About Codex in GitHub</summary>
<br/>

[Your team has set up Codex to review pull requests in this repo](http://chatgpt.com/codex/settings/general). Reviews are triggered when you
- Open a pull request for review
- Mark a draft as ready
- Comment "@codex review".

If Codex has suggestions, it will comment; otherwise it will react with üëç.




Codex can also answer questions or update the PR. Try commenting "@codex address that feedback".
            
</details>

### @TechNickAI ‚Äî COMMENTED (2026-01-29)

Re: [Codex comment on line 215](https://github.com/moltbot/moltbot/pull/4139#discussion_r2743128533)

Excellent catch! Fixed in 27d060a56.

Reactions now use `resolveReactionPeerId()` which applies the same E.164 normalization as `resolvePeerId()` for messages. DM reactions with `senderE164` now route to the same session key as the message thread.

Added a test case verifying that reactions land in the E.164-normalized session, not the JID-based one.


## Comments


## Stats

- **Size:** large (918+, 3-, 9 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
