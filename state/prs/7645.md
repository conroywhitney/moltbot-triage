---
number: 7645
title: "feat(agents): add system event type filtering with config-based suppression"
author: briancolinger
created: 2026-02-03T02:33:17Z
updated: 2026-02-03T03:51:24Z
labels: ["gateway", "agents"]
additions: 154
deletions: 6
changed_files: 8
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"briancolinger","state":"COMMENTED"},{"author":"briancolinger","state":"COMMENTED"}]
comments_count: 2
reactions_total: 1
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7645
fixes_issues: [7532]
related_prs: [2804,3589,5349,7065,7532]
duplicate_of: null
---

## Description

## Problem

OpenClaw routes all system activity (exec completions, heartbeat prompts, sub-agent announcements) into the main chat session with no way to suppress specific event types. 20+ users have reported this across 40+ GitHub issues, with exec completions and cron summaries being the noisiest culprits.

## Related Issues
- Closes #7532 - System event messages (exec logs) cluttering chat ‚Äî need suppression option
- Related to #2804, #3589, #5349, #7065 - Various cron and system event noise issues

## Solution

This PR implements **Phase 1** of system event filtering with a backward-compatible, incremental approach:

### üîß What's Added
- **SystemEventType enum**: Categorizes events as `exec-completion`, `cron`, `heartbeat`, `subagent-announce`, `channel`, or `system`
- **Event type filtering**: `enqueueSystemEvent()` now accepts optional `eventType` parameter and checks suppression list
- **Agent configuration**: New `systemEvents.suppress` array in `AgentDefaultsConfig`
- **Backward compatibility**: Untyped events pass through unchanged (existing behavior preserved)

### üéØ Tagged Event Sources
- **Exec completions** ‚Üí `exec-completion` type (bash-tools.exec.ts)
- **Cron summaries** ‚Üí `cron` type (cron/service/timer.ts)

### üìù Usage Example
```json5
{
  "agents": {
    "defaults": {
      "systemEvents": {
        "suppress": ["exec-completion", "heartbeat"]
      }
    }
  }
}
```

### ‚úÖ Tested
- All existing tests pass
- New comprehensive filtering tests added
- TypeScript compilation clean
- Linting passes

## Architecture Notes

- **Incremental approach**: Only highest-noise callers tagged initially (exec + cron)
- **Global config**: Simple implementation for Phase 1, can be enhanced to per-agent later
- **40+ other callers**: Left untyped to maintain current behavior
- **Future enhancement**: Per-agent configuration via sessionKey ‚Üí agentId resolution

## CI Status
Branch pushed, waiting ~2 min for CI results. Will address any format/lint failures with force-push.

## What's Next
This is Phase 1 of a larger system event routing plan. Future PRs can:
- Add per-agent configuration support  
- Tag additional event sources
- Add UI controls for configuration
- Implement event routing to different channels

---
*Built as part of the broader effort to reduce system noise and improve signal-to-noise ratio in OpenClaw conversations.*

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

Adds a `SystemEventType` taxonomy and a global suppression list to allow selectively dropping noisy system events. `enqueueSystemEvent()` now accepts an optional `eventType` and skips enqueuing when the type is configured as suppressed, while untyped events remain backward-compatible. Exec completion notifications and cron-related system events are tagged, agent defaults gain a `systemEvents.suppress` configuration field, and a new vitest suite covers suppression behavior.

<h3>Confidence Score: 4/5</h3>

- This PR is reasonably safe to merge; changes are localized and covered by new tests, with minor type-safety/test-isolation concerns.
- Core behavior is gated behind an optional `eventType`, preserving existing untyped event behavior. New tests validate suppression logic. Remaining concerns are mostly around global mutable suppression state (test isolation) and an unnecessary cast in the cron gateway wrapper that could hide type mismatches in the future.
- src/infra/system-events.ts (global suppression state) and src/gateway/server-cron.ts (eventType cast)

<!-- greptile_other_comments_section -->

<sub>(3/5) Reply to the agent's comments like "Can you suggest a fix for this @greptileai?" or ask follow-up questions!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps ‚Äî COMMENTED (2026-02-03)

<sub>2 files reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @briancolinger ‚Äî COMMENTED (2026-02-03)



### @briancolinger ‚Äî COMMENTED (2026-02-03)




## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`src/infra/system-events.ts`**
[P2] `resetSystemEventsForTest()` doesn't reset global suppression state

The new `globalSuppressedEvents` set is global process state, but `resetSystemEventsForTest()` only clears `queues`. Existing tests work because `system-events-filtering.test.ts` calls `setSuppressedSystemEventTypes([])` manually, but other tests that call only `resetSystemEventsForTest()` (e.g. `src/infra/system-events.test.ts`) could become order-dependent if suppression is set elsewhere in the test suite.

Also appears: `src/infra/system-events-filtering.test.ts` works around this by resetting suppression explicitly.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/infra/system-events.ts
Line: 151:153

Comment:
[P2] `resetSystemEventsForTest()` doesn't reset global suppression state

The new `globalSuppressedEvents` set is global process state, but `resetSystemEventsForTest()` only clears `queues`. Existing tests work because `system-events-filtering.test.ts` calls `setSuppressedSystemEventTypes([])` manually, but other tests that call only `resetSystemEventsForTest()` (e.g. `src/infra/system-events.test.ts`) could become order-dependent if suppression is set elsewhere in the test suite.

Also appears: `src/infra/system-events-filtering.test.ts` works around this by resetting suppression explicitly.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>

### @briancolinger (2026-02-03)

Addressed both Greptile findings in latest push:

**P1** (unsafe cast): Removed `as SystemEventType` cast in `server-cron.ts` ‚Äî the `CronServiceDeps` interface already types `eventType` correctly, so the compiler enforces the contract without it. Also removed the now-unused `SystemEventType` import.

**P2** (test reset): Added `globalSuppressedEvents.clear()` to `resetSystemEventsForTest()` so suppression state doesn't leak between test files.


## Stats

- **Size:** medium (154+, 6-, 8 files)
- **Age:** 0 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #7532
