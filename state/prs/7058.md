---
number: 7058
title: "feat(telegram): add channel_post handler for broadcast channels"
author: waifu7498173
created: 2026-02-02T10:29:23Z
updated: 2026-02-02T16:13:07Z
labels: ["channel: telegram"]
additions: 174
deletions: 11
changed_files: 5
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: passing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/7058
fixes_issues: [7027]
related_prs: [7027]
duplicate_of: null
---

## Description

## Summary
Adds support for receiving posts from Telegram broadcast channels.

## Changes
- Add `channel_post` handler in `bot-handlers.ts`
- Add `TelegramChannelSchema` config schema
- Add `channelPolicy` and `channelAllowFrom` config options  
- Update `bot-message-context.ts` to handle channel peer type
- Route channel posts to sessions like `agent:main:telegram:channel:<id>`

## Config Example
```json
{
  "channels": {
    "telegram": {
      "channelPolicy": "allowlist",
      "channelAllowFrom": ["435522423"],
      "channels": {
        "-1001397847758": {
          "enabled": true
        }
      }
    }
  }
}
```

## Testing
- Added bot as channel admin
- Channel posts now route to separate sessions per channel
- Supports per-channel config (enabled, allowFrom, systemPrompt)

Closes #7027

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds support for Telegram broadcast channels by wiring a new `channel_post` update handler and extending Telegram config to include per-channel settings (policy/allowFrom plus per-channel overrides). Channel posts are routed into distinct sessions (via a `channel:<id>` peer id) and `bot-message-context` is updated to treat channel chats as a separate peer type for envelope/session metadata.

Main things to double-check before merge are (a) the routing `peer.kind` type for channels (so bindings/session keys behave as intended) and (b) consistency between the new config schema vs the documented example (schema currently requires fields that the example omits), plus making sure the intended default policy source is used for channels.

<h3>Confidence Score: 3/5</h3>

- Moderately safe, but there are a couple of routing/config mismatches that could break channel support in real deployments.
- Core implementation is straightforward, but the channel peer kind is currently cast away when calling the routing layer (risking incorrect session routing/bindings), and the new config schema appears inconsistent with the provided example (risking config validation failures). The remaining concern is whether channels should inherit group defaults for policy decisions.
- src/telegram/bot-message-context.ts, src/telegram/bot-handlers.ts, src/config/zod-schema.providers-core.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-02)

<sub>3 files reviewed, 3 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @waifu7498173 (2026-02-02)

Hey @steipete @thewilloftheshadow ðŸ‘‹

This PR adds `channel_post` support for Telegram broadcast channels (closes #7027). CI is waiting for first-time contributor approval.

Would appreciate a review when you have a moment! The changes follow existing patterns:
- Handler mirrors the `message` handler structure  
- Config schema mirrors `TelegramGroupSchema`
- Routing uses the existing `RoutePeerKind = "channel"` support

Thanks! ðŸ¦ž


## Stats

- **Size:** medium (174+, 11-, 5 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: #7027
