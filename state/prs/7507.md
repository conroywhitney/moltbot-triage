---
number: 7507
title: "test(ci): make tests cross-platform (Windows) + add basic sanitization util"
author: ThinkIbrokeIt
created: 2026-02-02T22:20:42Z
updated: 2026-02-02T23:38:25Z
labels: ["agents"]
additions: 36
deletions: 2
changed_files: 4
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 2
reactions_total: 1
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7507
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

This PR makes a few tests more cross-platform-friendly (Windows PowerShell) and adds a small `sanitizeUserInput` helper for security-related flows:

- Replace `printf` usage in agent tests with a Node-based `process.stdout.write` command so tests run on Windows PowerShell
- Skip symlink test on Windows where creating symlinks often requires elevated privileges
- Add `src/security/sanitization.ts` with `sanitizeUserInput` and unit tests

All modified tests pass locally on Windows. This should reduce CI flakes on Windows runners and also provide the missing sanitization utility required by other changes.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adjusts a couple of tests to be more Windows-friendly (switching a shell `printf` to a `node -e process.stdout.write(...)` invocation, and skipping a symlink-related test on `win32`), and introduces a new `src/security/sanitization.ts` helper with accompanying unit tests.

The changes are localized to tests plus the new sanitization utility under `src/security/`, and are aimed at reducing Windows CI flakes while providing a reusable sanitization function for security-sensitive flows.

<h3>Confidence Score: 4/5</h3>

- This PR looks safe to merge; changes are mostly test-only plus a small new helper, with a few minor behavior/coverage concerns to consider.
- No obvious runtime-breaking changes were introduced; the main concerns are around the sanitization helper’s API semantics (dead type-check / potentially over-broad redaction) and reduced Windows security test coverage due to unconditional skipping.
- src/security/sanitization.ts; src/media/server.test.ts

<!-- greptile_other_comments_section -->

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>2 files reviewed, 3 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @ThinkIbrokeIt (2026-02-02)

Requesting review from @steipete and @joshp123 for Windows CI fixes and the new `sanitizeUserInput` helper. All modified tests pass locally on Windows; these changes should reduce CI flakes and unblock other PRs.

### @ThinkIbrokeIt (2026-02-02)

Auto-merge check: Not ready yet.

CI status: `pending` for commit `298b900...` (checks not all successful).
Reviews: 0 approved reviews (1 comment review).

I will poll again up to 12 attempts every 5 minutes and try to merge when CI is green and at least one approval is present.


## Stats

- **Size:** small (36+, 2-, 4 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
