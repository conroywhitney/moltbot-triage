---
number: 2812
title: "feat(providers): add ANTHROPIC_BASE_URL environment variable support"
author: gmcouto
created: 2026-01-27T15:06:52Z
updated: 2026-01-28T23:25:11Z
labels: ["scripts", "agents"]
additions: 24
deletions: 2
changed_files: 3
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 4
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/2812
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

**Summary**

This pull request introduces support for overriding the default Anthropic API base URL using the `ANTHROPIC_BASE_URL` environment variable. This enhancement allows for easier testing and integration with alternate or proxy endpoints for Anthropic services. The changes ensure that both usage fetching and provider configuration respect the environment variable across the codebase.

**Anthropic API base URL override support:**

* Updated the usage-fetching logic in both `scripts/debug-claude-usage.ts` and `src/infra/provider-usage.fetch.claude.ts` to use the `ANTHROPIC_BASE_URL` environment variable if set, falling back to the default Anthropic endpoint otherwise. [[1]](diffhunk://#diff-568ab818edd926481fc74c82144e169145fd64ea3202d49cc50ea666eb28940fL70-R72) [[2]](diffhunk://#diff-dec56fcb6110e21e5c4c0174cba5c0c25428c81fd83f2a8f715c9627973ea88fR102-R105)

**Provider configuration enhancements:**

* Modified `normalizeProviders` in `src/agents/models-config.providers.ts` to override the Anthropic provider's `baseUrl` with the value from `ANTHROPIC_BASE_URL` if present.
* Enhanced `resolveImplicitProviders` in `src/agents/models-config.providers.ts` to automatically add an Anthropic provider with the specified `baseUrl` if `ANTHROPIC_BASE_URL` is set.
 
**Testing**

- [x] Built app and pushed to personal docker hub
- [x] Run container with `ANTHROPIC_BASE_URL`

 
Closes https://github.com/moltbot/moltbot/issues/2086

## Reviews


## Comments


## Stats

- **Size:** small (24+, 2-, 3 files)
- **Age:** 2 days
- **Last activity:** 2026-01-28

## Links

- Fixes: (none detected)
