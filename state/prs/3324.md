---
number: 3324
title: "Update Dockerfile to support Homebrew and Go for skill execution"
author: nnnet
created: 2026-01-28T12:53:07Z
updated: 2026-02-03T03:56:23Z
labels: ["docker"]
additions: 25
deletions: 0
changed_files: 1
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 2
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3324
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

Description:

This PR introduces changes to the Dockerfile to include the installation of Homebrew and the Go programming language. These additions are required to ensure compatibility with specific skills that depend on the Go runtime or binaries managed via Homebrew.

Motivation:

Currently, the environment lacks the necessary tooling to run . 
To support the installation and execution of these skills, we need to:

Integrate Homebrew as a package manager.
Install the Go compiler and toolchain.
Technical Details:

Since Homebrew strictly refuses to run as the root user for security reasons, the installation process required the following structural changes:

User Creation: A dedicated user (linuxbrew) is created with a home directory and bash shell.
Sudo Privileges: The user is granted NOPASSWD sudo access. This is necessary because Homebrew scripts often require elevated permissions to create directories and symlinks in system locations during the installation process, even if the core installation happens in the user's home folder.
Installation: Homebrew is bootstrapped via the official install script, running under the linuxbrew user context.
Environment Setup: The PATH environment variable is updated to include /home/linuxbrew/.linuxbrew/bin and /home/linuxbrew/.linuxbrew/sbin, making brew and installed binaries (like go) globally accessible.
Go Installation: The go formula is installed via Homebrew.
Root Restoration: The Dockerfile switches back to the root user at the end. This ensures that any subsequent system-level configurations or the main container process can run with the expected default permissions.
Changes:

Added linuxbrew user setup.
Integrated Homebrew installation logic.
Installed Go (brew install go).
Configured environment variables for the new paths.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the Docker build environment to support skills that rely on Homebrew-managed binaries and the Go toolchain. It installs additional Debian packages, creates a dedicated `linuxbrew` user to satisfy Homebrew’s non-root requirement, bootstraps Homebrew, adds brew paths to `PATH`, installs Go via brew, and then switches back to `root` before continuing the existing Node/Bun/corepack build steps.

The changes are confined to the `Dockerfile` and primarily affect image security posture (sudoers), reproducibility (unpinned `brew update`/installer), and image size/build determinism (apt layer cleanup).

<h3>Confidence Score: 3/5</h3>

- Moderate risk to merge due to security/reproducibility concerns in the Docker build steps.
- The functional intent is clear and limited to the Dockerfile, but the new passwordless sudo entry and unpinned Homebrew installer/update reduce security hardening and make builds non-deterministic; these are fixable with small Dockerfile adjustments.
- Dockerfile

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>1 file reviewed, 4 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (2)</summary>

**`Dockerfile`**
[P1] Installing Homebrew via `curl ... | bash` from a moving target (`HEAD/install.sh`) is not reproducible and increases supply-chain exposure for Docker builds (any upstream change affects all future builds). It also makes debugging build failures harder.

If possible, pin to a specific commit/tag or vendor a known-good installer checksum, and/or prefer an OS package or official Go tarball if the goal is just `go`.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: Dockerfile
Line: 18:18

Comment:
[P1] Installing Homebrew via `curl ... | bash` from a moving target (`HEAD/install.sh`) is not reproducible and increases supply-chain exposure for Docker builds (any upstream change affects all future builds). It also makes debugging build failures harder.

If possible, pin to a specific commit/tag or vendor a known-good installer checksum, and/or prefer an OS package or official Go tarball if the goal is just `go`.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>

---

**`Dockerfile`**
[P1] `brew update` + `brew install go` makes the image build non-deterministic (formulae change over time) and can break older builds. It also adds significant build time/network variability.

If you stick with Homebrew, consider pinning Homebrew/core revisions (or using `HOMEBREW_NO_AUTO_UPDATE=1` with a pinned brew checkout) and pinning Go to a specific version.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: Dockerfile
Line: 23:25

Comment:
[P1] `brew update` + `brew install go` makes the image build non-deterministic (formulae change over time) and can break older builds. It also adds significant build time/network variability.

If you stick with Homebrew, consider pinning Homebrew/core revisions (or using `HOMEBREW_NO_AUTO_UPDATE=1` with a pinned brew checkout) and pinning Go to a specific version.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** small (25+, 0-, 1 files)
- **Age:** 5 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
