---
number: 5044
title: "fix(browser): prevent stdio buffer blocking in Docker environments"
author: stephenschoettler
created: 2026-01-31T00:19:20Z
updated: 2026-02-03T02:25:34Z
labels: ["docs", "docker"]
additions: 30
deletions: 2
changed_files: 3
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: passing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/5044
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary
Fixes browser automation failures in Docker by resolving two issues preventing Chrome/Playwright from launching properly in containerized environments.

## Changes Made

### 1. Code Fix: Prevent stdio Buffer Blocking
**File:** `src/browser/chrome.ts`

Changed Chrome spawn configuration from `stdio: "pipe"` to `stdio: ["ignore", "ignore", "ignore"]`.

**Problem:** When using `stdio: "pipe"`, Chrome's stdout/stderr buffers were filling up (~64KB limit) and blocking the process, preventing CDP from becoming reachable within the 15-second timeout.

**Solution:** Discarding Chrome's output instead of piping it allows the process to run without blocking.

**Result:** CDP becomes reachable within 500ms of Chrome startup in Docker.

### 2. Documentation: Docker Headless Configuration
**Files:** `docs/install/docker.md`, `CHANGELOG.md`

Added new "Browser configuration (Docker)" section explaining that Docker environments require `browser.headless: true` since containers have no display.

Includes:
- CLI configuration command
- Config file example
- Notes on `noSandbox` setting
- Changelog entry

## Test Plan
- âœ… Tested manually in Docker with Playwright Chromium
- âœ… Chrome launches successfully with stdio fix
- âœ… CDP becomes reachable in ~500ms
- âœ… Screenshot capture works end-to-end
- âœ… Lint passed (`pnpm lint`)
- âœ… Build successful

## Testing Environment
- Docker (host network mode)
- Playwright Chromium v1208 (145.0.7632.6)
- Debian 12 (bookworm) base image
- Node v22.22.0

## Fixes
Resolves browser automation timeout issues in Docker deployments where Chrome would fail to start with "Failed to start Chrome CDP on port 18800" error.

---

ðŸ¤– First-time contributor - feedback welcome!

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adjusts Chrome process spawning in `src/browser/chrome.ts` to avoid stdout/stderr pipe backpressure in containerized environments by switching `stdio` from `"pipe"` to `"ignore"`. It also documents Docker-specific browser configuration in `docs/install/docker.md` (headless + noSandbox) and adds a corresponding changelog entry.

Within the codebase, `launchClawdChrome` is responsible for starting a local Chrome instance for CDP-driven automation; changing stdio affects only process IO wiring (the code doesnâ€™t read Chrome output today), while the CDP readiness path remains HTTP/WebSocket-based.

<h3>Confidence Score: 4/5</h3>

- This PR is low risk and likely safe to merge.
- The behavioral change is narrow (Chrome spawn stdio wiring) and matches the observed failure mode in Docker; the codebase does not currently consume Chrome stdout/stderr, so ignoring stdio should not affect functionality. Main remaining concerns are maintainability/documentation clarity (misleading ChildProcess type cast; Docker CLI example prerequisites; missing PR reference in changelog).
- src/browser/chrome.ts (stdio/type cast), docs/install/docker.md (CLI/config-path clarity)

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-03)

<sub>3 files reviewed, 4 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** small (30+, 2-, 3 files)
- **Age:** 2 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
