---
number: 7180
title: "feat: add support for Moonshot API key for Other endpoint"
author: waynelwz
created: 2026-02-02T14:13:48Z
updated: 2026-02-02T15:31:19Z
labels: ["docs", "gateway", "cli", "commands"]
additions: 143
deletions: 12
changed_files: 13
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"waynelwz","state":"COMMENTED"},{"author":"waynelwz","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7180
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

Add Moonshot AI .ai and .cn endpoint support with improved model picker filtering

Moonshot AI provides two separate API endpoints: the international
endpoint (.ai) and endpoint (.cn), each with its own base URL
and API key. This commit adds support for distinguishing between these
two endpoints during onboarding and configuration.

Changes:
- Added `moonshot-api-key-cn` auth choice option
- Added `MOONSHOT_CN_BASE_URL` constant (https://api.moonshot.cn/v1)
- Updated onboarding flow to support both .ai and .cn API keys
- Added `preferredProvider` parameter to `promptModelAllowlist` to
  automatically filter models by provider after auth selection
- Fixed model name display: `kimi-k2.5` now shows "Kimi K2.5" instead
  of "Kimi K2 0905 Preview"
- Updated default alias for `moonshot/kimi-k2.5` from "Kimi K2" to "Kimi"
- Updated auth choice labels for clarity:
  - "Moonshot AI" → "Moonshot AI (Kimi K2.5)"
  - "Kimi K2 + Kimi Coding" → "Kimi K2.5 + Kimi Coding"
  - Added "Moonshot AI API key (.cn)" option

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds a new onboarding/auth choice (`moonshot-api-key-cn`) intended to support Moonshot’s Other endpoint (`https://api.moonshot.cn/v1`), updates Moonshot defaults to `kimi-k2.5` (and fixes its display name), and adjusts auth choice labels/docs accordingly. It also introduces a preferred-provider mapping so the model picker can filter to the provider chosen during auth.

Key concern: while the config can now set the Moonshot baseUrl to `.cn`, the CN and non-CN flows still share the same credential sources/storage (`MOONSHOT_API_KEY` / `--moonshot-api-key` / `setMoonshotApiKey`), so users cannot maintain separate `.ai` vs `.cn` API keys as described. If separate keys are truly required, the CN flow needs a distinct env var/flag/credential store key; otherwise the docs/UX should state that only the endpoint differs.

<h3>Confidence Score: 3/5</h3>

- This PR is mostly safe to merge, but has a functional mismatch with its stated goal around separate `.ai` vs `.cn` API keys.
- Main risk is behavioral/UX: the new `moonshot-api-key-cn` path sets a different baseUrl but still uses the same env var/flag/credential storage as the existing Moonshot flow, so distinct keys can’t coexist and users may be confused. Changes are otherwise localized to onboarding/config and model metadata.
- src/commands/auth-choice.apply.api-providers.ts; src/commands/onboard-non-interactive/local/auth-choice.ts; docs/gateway/configuration.md

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>2 files reviewed, 3 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @waynelwz — COMMENTED (2026-02-02)



### @waynelwz — COMMENTED (2026-02-02)




## Comments


## Stats

- **Size:** medium (143+, 12-, 13 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
