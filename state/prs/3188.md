---
number: 3188
title: "fix: detect context_overflow error for auto-compaction"
author: hclsys
created: 2026-01-28T07:09:28Z
updated: 2026-01-30T03:19:22Z
labels: ["agents"]
additions: 15
deletions: 0
changed_files: 2
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3188
fixes_issues: [3154]
related_prs: [3154]
duplicate_of: null
---

## Description

Fixes #3154

## Problem
Users experience context overflow errors that don't trigger auto-compaction because `isContextOverflowError()` only checks for `"context overflow"` (space), but some providers return `"context_overflow"` (underscore).

## Solution
- Add `context_overflow` (underscore) pattern to error detection
- Maintain backward compatibility with existing `"context overflow"` (space) pattern
- Both patterns now correctly trigger auto-compaction as configured

## Changes
- `src/agents/pi-embedded-helpers/errors.ts`: Add underscore pattern check (1 line)
- `src/agents/pi-embedded-helpers.iscontextoverflowerror.test.ts`: Add test coverage (14 lines)

## Test Coverage
Added test case with 3 sample error messages covering underscore format variants.

## Review
- Reviewed by Codex (threadId: `019c036c-d6b7-7281-a654-93a2f1776997`)
- Verdict: OK - No issues found
- Backward compatibility: Confirmed

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** small (15+, 0-, 2 files)
- **Age:** 2 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #3154
