---
number: 4577
title: "Docker: publish arch-specific tags"
author: ManojINaik
created: 2026-01-30T10:33:16Z
updated: 2026-02-03T02:25:57Z
labels: []
additions: 0
deletions: 8
changed_files: 1
size: tiny
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4577
fixes_issues: [4566]
related_prs: [4566]
duplicate_of: null
---

## Description

## Summary
- Restrict each Docker job to its own arch suffix tags
- Prevent arm64 tags from being overwritten by amd64 builds

## Testing
- Not run (workflow change)

## Issues
- Closes #4566

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adjusts the Docker publish workflow so the per-architecture build jobs only emit arch-suffixed tags (`-amd64` / `-arm64`), with the intent of preventing one architecture build from overwriting the other’s tags. The workflow still has a `create-manifest` job that aggregates the two build outputs into a multi-platform manifest and publishes unsuffixed tags (branch and semver).

<h3>Confidence Score: 3/5</h3>

- Probably safe to merge, but the manifest creation step may fail depending on what `image-digest` outputs in CI.
- Change is small and scoped to tag generation, but the workflow relies on passing `${{ steps.build.outputs.digest }}` into `imagetools create`; if those are bare digests (common), the manifest step can break and you’d silently stop producing unsuffixed multi-arch tags.
- .github/workflows/docker-release.yml (manifest creation + tag strategy)

<!-- greptile_other_comments_section -->

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>1 file reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`.github/workflows/docker-release.yml`**
[P0] `create-manifest` likely uses digests without image names

`docker buildx imagetools create` expects refs like `ghcr.io/org/repo@sha256:...` (or tags), but the workflow passes `${{ needs.*.outputs.image-digest }}` directly. `docker/build-push-action`’s `digest` output is typically just `sha256:...`, so this will fail unless Buildx implicitly accepts bare digests in your environment.

This existed before, but with the new arch-specific tags it’s worth re-validating: if this step fails, you’ll publish `*-amd64`/`*-arm64` tags but not the unsuffixed multi-arch tags.

Clarification: are `needs.build-*.outputs.image-digest` values full refs (e.g. `${IMAGE}@sha256:...`) in your runs, or just `sha256:...`?

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: .github/workflows/docker-release.yml
Line: 131:133

Comment:
[P0] `create-manifest` likely uses digests without image names

`docker buildx imagetools create` expects refs like `ghcr.io/org/repo@sha256:...` (or tags), but the workflow passes `${{ needs.*.outputs.image-digest }}` directly. `docker/build-push-action`’s `digest` output is typically just `sha256:...`, so this will fail unless Buildx implicitly accepts bare digests in your environment.

This existed before, but with the new arch-specific tags it’s worth re-validating: if this step fails, you’ll publish `*-amd64`/`*-arm64` tags but not the unsuffixed multi-arch tags.

Clarification: are `needs.build-*.outputs.image-digest` values full refs (e.g. `${IMAGE}@sha256:...`) in your runs, or just `sha256:...`?

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** tiny (0+, 8-, 1 files)
- **Age:** 3 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #4566
