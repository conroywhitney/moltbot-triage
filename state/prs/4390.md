---
number: 4390
title: "fix(whatsapp): allow media from allowlisted groups without groupAllowâ€¦"
author: Sarang19114
created: 2026-01-30T05:17:11Z
updated: 2026-01-30T07:29:23Z
labels: ["channel: whatsapp-web"]
additions: 247
deletions: 22
changed_files: 3
size: large
review_decision: none
reviews: []
comments_count: 2
reactions_total: 0
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4390
fixes_issues: [3375]
related_prs: [3375]
duplicate_of: null
---

## Description

## Summary
Fixes #3375 - WhatsApp media from group members not downloaded when using groupPolicy: allowlist

## Problem
When a group is in the `groups` allowlist with `requireMention: false`, media from group members was silently ignored unless they were also in `groupAllowFrom`.

## Solution
Modified `checkInboundAccessControl` to first check if a group is explicitly in the `groups` allowlist. When it is, messages from all participants are now allowed (bypassing the `groupAllowFrom` check for that group).

## Changes
- `src/web/inbound/access-control.ts` - Added groups allowlist check before groupAllowFrom filtering
- `src/web/inbound/monitor.ts` - Pass groupId to access control function
- `src/web/inbound/access-control.groups-allowlist.test.ts` - 6 new test cases

## Testing
- [x] All 6 new tests pass

## Reviews


## Comments

### @Sarang19114 (2026-01-30)

I've fixed the formatting issue with my changes. The remaining CI failures are **pre-existing issues** unrelated to this PR:

| Check | Status | Cause |
|-------|--------|-------|
| `pnpm format` | Fixed | Formatting applied |
| `paths.test.ts` |  Pre-existing | Test expects 1 config candidate but gets 16 |
| `install-smoke` | Pre-existing | Network issue: `Could not resolve host: clawd.bot` |

These failures also occur on the `main` branch and are not introduced by my changes.

**My changes only modify:**
- [src/web/inbound/access-control.ts](cci:7://file:///c:/Users/rasto/Desktop/f/moltbot/src/web/inbound/access-control.ts:0:0-0:0)
- [src/web/inbound/monitor.ts](cci:7://file:///c:/Users/rasto/Desktop/f/moltbot/src/web/inbound/monitor.ts:0:0-0:0)
- [src/web/inbound/access-control.groups-allowlist.test.ts](cci:7://file:///c:/Users/rasto/Desktop/f/moltbot/src/web/inbound/access-control.groups-allowlist.test.ts:0:0-0:0) (new)

All 6 new tests pass locally. Happy to make any adjustments if needed!

### @Sarang19114 (2026-01-30)

**Note:** This PR also includes a minor formatting fix for [src/commands/onboard-helpers.ts](moltbot/src/commands/onboard-helpers.ts) (indentation in the wizard header array). This was a pre-existing formatting issue I noticed while running the format check.


## Stats

- **Size:** large (247+, 22-, 3 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #3375
