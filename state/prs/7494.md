---
number: 7494
title: "feat(completion): PowerShell automated install & uninstall"
author: ThinkIbrokeIt
created: 2026-02-02T22:08:12Z
updated: 2026-02-02T23:35:32Z
labels: ["docs", "cli", "scripts", "commands", "agents"]
additions: 2458
deletions: 710
changed_files: 12
size: huge
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 3
reactions_total: 1
ci_status: failing
mergeable: false
draft: false
url: https://github.com/openclaw/openclaw/pull/7494
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

Splits out the PowerShell automated install & uninstall work into its own PR. This branch applies the cleaned/squashed commit from the previous rework and contains:

- docs/cli/completion.md
- scripts/postinstall.js
- CLI wiring for PowerShell completion
- completion installer tests

Tests for the completion installer pass locally (`src/completion-install.test.ts`, `src/postinstall-completion.test.ts`).

Notes & concerns:
- A Greptile review flagged sanitization behavior mismatch (sanitization reported but not applied) and brittle PowerShell profile targeting/uninstall logic — please pay attention to `src/agents/session-tool-result-guard.ts` and the completions uninstall flow.
- Backup branch with original commits: `backup/feat/pwsh-completion-install-uninstall-before-reset`.

If you prefer, I can split out the sanitization changes for separate review.

/cc @steipete

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>3 files reviewed, 4 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-02)

<details>
<summary>Additional Comments (1)</summary>

**`src/cli/program/command-registry.ts`**
[P1] New `bmad` command registration may break builds if the import target isn’t present in this repo.

This PR adds `import { registerBMadCommand } from "../../bmad-cli/register-bmad.js";` and registers it, but if `src/bmad-cli/register-bmad.js` (or its built output) isn’t part of the repository/package, this will be a runtime/build failure. Worth double-checking the file exists in-tree and is included in build outputs.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/cli/program/command-registry.ts
Line: 20:23

Comment:
[P1] New `bmad` command registration may break builds if the import target isn’t present in this repo.

This PR adds `import { registerBMadCommand } from "../../bmad-cli/register-bmad.js";` and registers it, but if `src/bmad-cli/register-bmad.js` (or its built output) isn’t part of the repository/package, this will be a runtime/build failure. Worth double-checking the file exists in-tree and is included in build outputs.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>

### @ThinkIbrokeIt (2026-02-02)

Requesting review from @steipete for CLI completion behavior and sanitization checks; tests pass locally for completion installer. Also: please pay attention to PowerShell profile uninstall behavior and session sanitization logic noted in the PR description.

### @ThinkIbrokeIt (2026-02-02)

Auto-merge attempt blocked: this PR's mergeable_state is `dirty` (merge conflicts) and cannot be merged automatically. Please rebase or resolve conflicts against `main` and reopen for auto-merge. Marking this PR as **blocked** for auto-merge.

@steipete — FYI.


## Stats

- **Size:** huge (2458+, 710-, 12 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
