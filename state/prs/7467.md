---
number: 7467
title: "feat(webchat): file uploads + inline tool result images"
author: rwfresh
created: 2026-02-02T21:22:14Z
updated: 2026-02-02T23:24:36Z
labels: ["app: web-ui"]
additions: 776
deletions: 49
changed_files: 13
size: large
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7467
fixes_issues: [2721,6525]
related_prs: [2721,6525]
duplicate_of: null
---

## Description

## Summary

Adds file attachment support to webchat and renders images from tool results inline.

### Features

1. **File uploads in compose area**
   - Drag & drop files onto the compose area
   - Paste images from clipboard
   - Attach button (üìé) with file picker
   - Preview thumbnails for images, file icons for others
   - 25MB max, allowed types: images, PDF, txt, md, csv, json

2. **Inline tool result images**
   - Images from Read tool (and other tools) now render inline in chat
   - Tool results with images are shown even when "Show Thinking" is off

3. **Sidebar image rendering**
   - Click tool card to view images in sidebar
   - Images rendered as `<img>` elements (not markdown) to avoid truncation

### Related Issues

- Closes #2721 (webchat images from tool results not rendering inline)
- Closes #6525 (drag/drop opens new tab bug)

### Testing

- Added unit tests for `extractToolCards()` (image extraction from 3 formats)
- Added unit tests for `hasToolResultImages()`
- Added unit tests for `isAllowedFileType()` and `formatFileSize()`

### AI-Assisted

Built with Claude. Tested manually in webchat.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

Adds webchat file attachments (drag/drop, paste, file picker) with previews and size/type gating, and extends tool-result rendering to extract/display images inline and in the sidebar (including when ‚ÄúShow Thinking‚Äù is off). Also updates tool cards to carry image metadata and adds unit tests for image extraction and file-type helpers.

Key codepaths touched: chat compose area in `ui/src/ui/views/chat.ts`, tool card extraction/rendering in `ui/src/ui/chat/tool-cards.ts`, and grouped message rendering/image extraction in `ui/src/ui/chat/grouped-render.ts`, with sidebar plumbing through `ui/src/ui/app-render.ts`/`ui/src/ui/app.ts` into `ui/src/ui/views/markdown-sidebar.ts`.

<h3>Confidence Score: 3/5</h3>

- This PR is reasonably safe to merge, with a couple of UX/behavior edge cases worth addressing.
- Changes are mostly UI-only and covered by new unit tests, but there are a few behavioral mismatches (file type allowlist vs runtime acceptance, and a globally-scoped file input id) that can cause inconsistent UX or incorrect element targeting in multi-instance scenarios. I couldn‚Äôt run the full pnpm test suite in this environment due to missing package manager/deps.
- ui/src/ui/views/chat.ts (upload handling + file input wiring)

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps ‚Äî COMMENTED (2026-02-02)

<sub>1 file reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** large (776+, 49-, 13 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: #2721
- Fixes: #6525
