---
number: 6608
title: "fix: preserve iMessage accountId across config-triggered restarts"
author: tollebrandon
created: 2026-02-01T21:32:40Z
updated: 2026-02-01T21:34:35Z
labels: ["gateway"]
additions: 1
deletions: 0
changed_files: 1
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6608
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

- Pass `accountId` from delivery context to `agentCommand` in restart sentinel wake
- Fixes issue where messages sent after config-triggered gateway restarts were routed through the wrong iMessage account (defaulting to personal instead of configured bot account)

## Testing

- Tested locally by triggering config changes via agent and verifying restart notification messages land in the correct iMessage account
- All existing tests pass (`pnpm test`)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR preserves the configured iMessage `accountId` when the gateway wakes from a restart sentinel by passing the resolved delivery contextâ€™s `accountId` through to `agentCommand`. Without this, the post-restart notification could be delivered via a default (personal) iMessage account instead of the intended bot account.

Changes are localized to the restart-sentinel wake path (`src/gateway/server-restart-sentinel.ts`), aligning it with other announcement flows (e.g., subagent announce) that already forward `accountId` alongside `channel` and `to`. A changelog entry records the fix.

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- The change is a one-line propagation of an existing optional field (`accountId`) through an established command path, and it matches patterns used elsewhere in the gateway for outbound delivery context. No behavioral changes occur unless multi-account routing is in use, where this fixes incorrect account selection.
- No files require special attention

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews


## Comments


## Stats

- **Size:** tiny (1+, 0-, 1 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: (none detected)
