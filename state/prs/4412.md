---
number: 4412
title: "fix(telegram): skip native commands in regular message handler"
author: ai-fanatic
created: 2026-01-30T05:59:30Z
updated: 2026-01-30T16:12:22Z
labels: ["channel: telegram"]
additions: 382
deletions: 1
changed_files: 3
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4412
fixes_issues: [4385]
related_prs: [4385]
duplicate_of: null
---

## Description

## Summary
- Fixed issue where `/new` on a non-default Telegram agent was resetting both that agent's session AND the default agent's session
- When native commands are enabled, the regular message handler now skips messages that match registered native commands (e.g., `/new`, `/commands`)
- This prevents duplicate processing where both `bot.command()` and `bot.on("message")` handlers would process the same command

## Root Cause
Grammy triggers both the native command handler (`bot.command()`) and the regular message handler (`bot.on("message")`) for command messages. The native handler correctly targets the bound agent via `CommandTargetSessionKey`, but the regular handler was also processing it, leading to unexpected behavior.

## Test plan
- [ ] Run `/new` on a secondary Telegram bot account - only that agent's session should be reset
- [ ] Run `/new` on the default Telegram bot account - only the default agent's session should be reset
- [ ] Run `/commands` on any account - should be handled only by native handler
- [ ] Send regular messages - should be processed normally by the regular handler
- [ ] Send non-native slash commands (e.g., `/customcmd`) - should be processed by regular handler

Fixes #4385

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** large (382+, 1-, 3 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #4385
