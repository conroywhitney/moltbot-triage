---
number: 4337
title: "fix(signal): add group-level allowlist support via groups config"
author: derekross
created: 2026-01-30T03:14:48Z
updated: 2026-02-03T02:52:37Z
labels: ["docs", "channel: signal"]
additions: 231
deletions: 3
changed_files: 5
size: large
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 2
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4337
fixes_issues: [4336]
related_prs: [4336]
duplicate_of: null
---

## Description

## Summary

Fixes #4336

- Add `channels.signal.groups.<groupId>` config to allow specific Signal groups by ID
- Groups listed in this config bypass the sender-level `groupAllowFrom` check
- Matches the pattern used by Telegram and iMessage for group allowlists

## Changes

- Add `SignalGroupConfig` type and `groups` property to Signal config schema
- Add `SignalGroupSchema` to Zod validation
- Add `resolveChannelGroupPolicy` check in Signal event handler
- Add tests for group-level allowlist functionality  
- Update docs to explain `groupAllowFrom` (senders) vs `groups` (group IDs)

## Usage

```json5
{
  channels: {
    signal: {
      groupPolicy: "allowlist",
      groups: {
        "your-signal-group-id": {}  // Allow this specific group
      }
    }
  }
}
```

## Testing

- Added unit tests for group-level allowlist
- Manually tested on live Signal instance

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds a per-group allowlist for Signal via `channels.signal.groups.<groupId>`, updates Signal config types/Zod schema, adds a group allowlist check in the Signal event handler, and documents the difference between sender allowlists (`groupAllowFrom`) vs group-ID allowlists (`groups`).

The new behavior plugs into the shared `resolveChannelGroupPolicy` mechanism (already used by Telegram/iMessage/WhatsApp) so Signal can allow or block groups by ID (including `"*"` wildcard) before applying sender-level `groupAllowFrom` gating.

<h3>Confidence Score: 3/5</h3>

- Reasonably safe to merge once the Signal groups schema mismatch is fixed.
- Core logic is small and follows existing group-policy patterns, but the current Zod schema likely rejects the documented/expected config shape (`groups: { id: {} }`), which would break the feature at runtime. Also, command authorization may not align with the new group-level allowlist semantics.
- src/config/zod-schema.providers-core.ts; src/signal/monitor/event-handler.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>2 files reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @derekross (2026-01-30)

Just to add that I've actively been using this since last night configured as such and it's been working great in my family chat. So this proof of concept fix actually does work, following the Telegram structure. 

### @greptile-apps (2026-02-03)

<details>
<summary>Additional Comments (1)</summary>

**`src/signal/monitor/event-handler.ts`**
[P1] Group-level allowlisting is checked for message delivery, but `commandGate` still uses `effectiveGroupAllow` (sender allowlist) and ignores `channels.signal.groups`. That means a group explicitly allowed via `groups` can send normal messages, but control commands may still be blocked (since `groupAllowedForCommands` is based on sender allowlist).

If the intent is “explicitly allowed groups bypass sender-level allowlist checks”, you may want to incorporate `groupExplicitlyAllowed` into the `authorizers`/`commandAuthorized` path (or document that `groups` only affects message delivery, not command authorization).

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/signal/monitor/event-handler.ts
Line: 469:482

Comment:
[P1] Group-level allowlisting is checked for message delivery, but `commandGate` still uses `effectiveGroupAllow` (sender allowlist) and ignores `channels.signal.groups`. That means a group explicitly allowed via `groups` can send normal messages, but control commands may still be blocked (since `groupAllowedForCommands` is based on sender allowlist).

If the intent is “explicitly allowed groups bypass sender-level allowlist checks”, you may want to incorporate `groupExplicitlyAllowed` into the `authorizers`/`commandAuthorized` path (or document that `groups` only affects message delivery, not command authorization).

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** large (231+, 3-, 5 files)
- **Age:** 3 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #4336
