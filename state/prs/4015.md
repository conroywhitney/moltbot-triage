---
number: 4015
title: "fix: handle PID reuse in container restart scenarios"
author: zhengtxecon
created: 2026-01-29T14:38:27Z
updated: 2026-01-29T19:37:18Z
labels: ["agents"]
additions: 128
deletions: 3
changed_files: 2
size: medium
review_decision: none
reviews: [{"author":"chatgpt-codex-connector","state":"COMMENTED"},{"author":"zhengtxecon","state":"COMMENTED"}]
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4015
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

  ## Summary
  - Detects stale locks from a previous process incarnation when PID gets reused (common in Docker container restarts)
  - Adds `hostname` and `instanceId` to the lock payload to distinguish process instances
  - Only reclaims locks from the same hostname (prevents multi-container conflicts on shared volumes)
  - Adds 5-second grace period to prevent race conditions

  ## Problem
  When a container restarts, the new process may get the same PID as the old one. If the old process left a lock file behind, the new process sees a lock held by its "own" PID but not tracked in `HELD_LOCKS` map.

  **Additional concern (from review):** Multiple containers sharing a volume may have the same PID (e.g., both PID 1). Without hostname checking, container B could incorrectly reclaim container A's lock.

  ## Solution
  - `instanceId = hostname-pid-startTime` uniquely identifies each process instance
  - Only reclaim when `hostname` matches (same machine) but `instanceId` differs (different incarnation)
  - Different containers have different hostnames ‚Üí won't interfere

  ## Test plan
  - [x] `reclaims stale lock from same PID (container restart scenario)` - verifies lock reclaim works
  - [x] `does NOT reclaim lock from different hostname (multi-container scenario)` - verifies no cross-container interference
  - [x] All existing tests pass
  - [x] Lint passes

## Reviews

### @chatgpt-codex-connector ‚Äî COMMENTED (2026-01-29)


### üí° Codex Review

Here are some automated review suggestions for this pull request.

**Reviewed commit:** `c803bfc000`
    

<details> <summary>‚ÑπÔ∏è About Codex in GitHub</summary>
<br/>

[Your team has set up Codex to review pull requests in this repo](http://chatgpt.com/codex/settings/general). Reviews are triggered when you
- Open a pull request for review
- Mark a draft as ready
- Comment "@codex review".

If Codex has suggestions, it will comment; otherwise it will react with üëç.




Codex can also answer questions or update the PR. Try commenting "@codex address that feedback".
            
</details>

### @zhengtxecon ‚Äî COMMENTED (2026-01-29)




## Comments


## Stats

- **Size:** medium (128+, 3-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
