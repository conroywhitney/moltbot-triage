---
number: 2530
title: "fix(gateway): improve auth error for native apps"
author: Episkey-G
created: 2026-01-27T03:02:01Z
updated: 2026-01-28T23:25:11Z
labels: ["gateway"]
additions: 15
deletions: 6
changed_files: 2
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/2530
fixes_issues: [2268]
related_prs: [2268]
duplicate_of: null
---

## Description

## Summary
Fixes #2268

Improves authentication error messages for macOS/iOS/Android apps to clearly indicate where to set `gateway.remote.token`.

## Problem
When native apps (macOS/iOS/Android) fail to connect due to missing auth credentials, they received a generic error message:
```
unauthorized: gateway token missing (provide gateway auth token)
```

This was confusing because it didn't specify:
- Where to set the token (`~/.clawdbot/clawdbot.json`)
- What config key to use (`gateway.remote.token`)
- That it must match the server's `gateway.auth.token`

## Solution
Enhanced `formatGatewayAuthFailureMessage` in [message-handler.ts:76-96](https://github.com/clawdbot/clawdbot/blob/main/src/gateway/server/ws-connection/message-handler.ts#L76-L96) to detect native apps and provide specific guidance:

**Before:**
```
unauthorized: gateway token missing (provide gateway auth token)
```

**After:**
```
unauthorized: gateway token missing (set gateway.remote.token in ~/.clawdbot/clawdbot.json to match gateway.auth.token on the server)
```

## Changes
- Added detection for `MACOS_APP`, `IOS_APP`, and `ANDROID_APP` client IDs
- Provided platform-specific error hints that include:
  - Config file path
  - Exact config key name
  - Requirement to match server config
- Applies to both token and password auth modes

## Testing
- Code review: logic correctly identifies native app client IDs
- Error message format matches existing CLI/Control UI patterns
- Backward compatible: other clients continue to receive appropriate hints

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

## Reviews


## Comments


## Stats

- **Size:** small (15+, 6-, 2 files)
- **Age:** 3 days
- **Last activity:** 2026-01-28

## Links

- Fixes: #2268
