---
number: 4610
title: "security(web): sanitize WhatsApp accountId to prevent path traversal"
author: leszekszpunar
created: 2026-01-30T11:41:47Z
updated: 2026-01-30T14:54:44Z
labels: ["channel: whatsapp-web"]
additions: 51
deletions: 2
changed_files: 2
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4610
fixes_issues: [2692]
related_prs: [2692]
duplicate_of: null
---

## Description

## Summary

- Sanitize WhatsApp `accountId` in `resolveDefaultAuthDir()` to prevent path traversal via malicious config values (e.g. `../../../etc`)
- Reuse existing `normalizeAccountId()` from `src/routing/session-key.ts` which strips all characters except `[a-z0-9_-]`
- Add unit tests covering traversal, special characters, empty and valid inputs

## Problem

`resolveDefaultAuthDir()` in `src/web/accounts.ts` passes the `accountId` parameter directly to `path.join()` without sanitization. A malicious config with `accountId: "../../../etc"` escapes the intended directory structure. Risk increases in multi-user deployments, shared configs, and plugin systems.

## Solution

Import and apply `normalizeAccountId()` (already exported from `routing/session-key.ts`) which:
- Strips all non-alphanumeric characters except `_` and `-`
- Falls back to `"default"` for empty values
- Caps length at 64 characters

This follows the same defense-in-depth pattern already used by Telegram (`src/telegram/update-offset-store.ts`).

## Test plan

- [x] `pnpm lint` -- 0 warnings, 0 errors
- [x] `pnpm format` -- all files formatted correctly
- [x] `pnpm build` -- TypeScript compiles without errors
- [x] `pnpm vitest run src/web/accounts.test.ts` -- 4/4 tests pass
  - Path traversal `../../../etc/passwd` is sanitized
  - Special characters `/` and `\` are stripped
  - Empty accountId falls back to `"default"`
  - Valid accountId `my-account-1` is preserved

## AI Assistance Disclosure

This PR was AI-assisted. Fix follows existing codebase patterns. Human reviewed.

Fixes #2692

## Reviews


## Comments


## Stats

- **Size:** medium (51+, 2-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #2692
