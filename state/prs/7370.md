---
number: 7370
title: "feat(tools): add Tavily as native web_search provider"
author: lailoo
created: 2026-02-02T19:12:26Z
updated: 2026-02-02T19:42:44Z
labels: ["agents"]
additions: 256
deletions: 10
changed_files: 6
size: large
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: passing
mergeable: false
draft: false
url: https://github.com/openclaw/openclaw/pull/7370
fixes_issues: [7344]
related_prs: [7344]
duplicate_of: null
---

## Description

## Summary

Fixes #7344

Add Tavily as a native `web_search` provider alongside Brave and Perplexity.

## Motivation

Tavily is a popular AI-optimized search API specifically designed for AI agents and RAG applications:
- 1000 free searches/month (generous free tier)
- AI-synthesized answers with citations
- Content extraction optimized for LLMs
- Supports news and finance topic filters

## Changes

- Add `tavily` as third provider option in `SEARCH_PROVIDERS`
- Implement `runTavilySearch()` with full Tavily API support
- Add `resolveTavilyConfig()`, `resolveTavilyApiKey()`, `resolveTavilySearchDepth()` helpers
- Update `types.tools.ts` with `TavilyConfig` type definition
- Update `zod-schema.agent-runtime.ts` with tavily validation schema
- Update `schema.ts` with tavily config descriptions
- Add 3 new unit tests for tavily searchDepth resolution

## Configuration

```json5
{
  tools: {
    web: {
      search: {
        provider: "tavily",
        tavily: {
          apiKey: "tvly-xxx",  // or TAVILY_API_KEY env var
          searchDepth: "basic", // basic, advanced, fast, ultra-fast
          includeAnswer: true,
          includeImages: false,
          topic: "general"     // general, news, finance
        }
      }
    }
  }
}
```

Or via environment variable: `TAVILY_API_KEY=tvly-xxx`

## Testing

- ✅ 15/15 unit tests pass (`pnpm vitest run src/agents/tools/web-search.test.ts`)
- ✅ Lint passes (`pnpm lint`)
- ✅ TypeScript type check passes
- ✅ Manual API test with real Tavily API key successful

## API Response Format

```json
{
  "query": "OpenClaw AI",
  "provider": "tavily",
  "searchDepth": "basic",
  "count": 3,
  "tookMs": 2000,
  "answer": "OpenClaw is an open-source AI assistant...",
  "results": [
    {
      "title": "OpenClaw - Wikipedia",
      "url": "https://en.wikipedia.org/wiki/OpenClaw",
      "content": "...",
      "score": 0.93
    }
  ]
}
```

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

Adds Tavily as a third `web_search` provider alongside Brave and Perplexity, including runtime config/zod schema updates and unit tests for Tavily searchDepth normalization. The tool implementation introduces Tavily-specific request options (depth/answer/images/topic) and wires them through `createWebSearchTool` into a new `runTavilySearch` call path, while updating config UI help and TS types to expose the new provider.

<h3>Confidence Score: 3/5</h3>

- Mostly safe to merge, with one correctness issue around caching behavior for Tavily options.
- Core integration is straightforward and follows existing patterns, but the cache key construction doesn’t incorporate Tavily-specific knobs, which can return incorrect cached data when those options change between calls. Remaining items are minor maintainability/UI clarity issues.
- src/agents/tools/web-search.ts (cache key + Tavily path), src/config/schema.ts (provider-agnostic help text).

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>2 files reviewed, 3 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-02)

<details>
<summary>Additional Comments (1)</summary>

**`src/agents/tools/web-search.ts`**
[P1] Tavily cache key ignores Tavily-specific params.

`runWebSearch` builds a cache key that only varies by query/count/country/search_lang/ui_lang for non-Brave providers, so Tavily requests with different `searchDepth`/`includeAnswer`/`includeImages`/`topic` can incorrectly reuse cached results from a different configuration. This shows up when users toggle images or change depth/topic between calls.

Also affects Tavily because it currently shares the non-Brave cache-key path.

Other affected locations: `src/agents/tools/web-search.ts:503-507`.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/agents/tools/web-search.ts
Line: 503:507

Comment:
[P1] Tavily cache key ignores Tavily-specific params.

`runWebSearch` builds a cache key that only varies by query/count/country/search_lang/ui_lang for non-Brave providers, so Tavily requests with different `searchDepth`/`includeAnswer`/`includeImages`/`topic` can incorrectly reuse cached results from a different configuration. This shows up when users toggle images or change depth/topic between calls.

Also affects Tavily because it currently shares the non-Brave cache-key path.

Other affected locations: `src/agents/tools/web-search.ts:503-507`.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** large (256+, 10-, 6 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: #7344
