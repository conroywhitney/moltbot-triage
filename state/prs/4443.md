---
number: 4443
title: "feat: include token usage data in chat final events (#4159)"
author: openperf
created: 2026-01-30T06:58:21Z
updated: 2026-01-30T06:58:33Z
labels: ["app: web-ui", "gateway"]
additions: 7
deletions: 0
changed_files: 2
size: tiny
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4443
fixes_issues: [4159]
related_prs: [4159]
duplicate_of: null
---

## Description

## Problem
Fixes #4159

External monitoring tools need to track token usage and API costs. Currently, 
they have no way to get this information from chat final events.

## Solution
Add token usage information to chat final events by:
- Extracting usage data from message objects
- Passing usage through the event pipeline
- Maintaining full backward compatibility

## Changes
- Add `usage` parameter to `broadcastChatFinal()` function
- Add `usage` parameter to `emitChatFinal()` function
- Extract usage from message objects and agent event data

## Benefits
- ✅ Enable cost tracking for API usage
- ✅ Support external monitoring tools (e.g., Crabwalk)
- ✅ Maintain backward compatibility (usage is optional)
- ✅ Minimal code changes (7 lines across 2 files)
- ✅ No new dependencies or schema changes required

## Testing
- [x] `pnpm lint` passes
- [x] `pnpm build` passes
- [x] No TypeScript errors
- [x] No breaking changes
- [x] Backward compatible with existing clients

## Type of Change
- [x] New feature (non-breaking change which adds functionality)
- [ ] Bug fix
- [ ] Breaking change

## Related Issues
Closes #4159

## Reviews


## Comments


## Stats

- **Size:** tiny (7+, 0-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #4159
