---
number: 5819
title: "fix: Clawdbot gateway compatibility for Android app"
author: abra5umente
created: 2026-02-01T01:15:26Z
updated: 2026-02-02T06:35:10Z
labels: ["app: android"]
additions: 133
deletions: 18
changed_files: 7
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"abra5umente","state":"COMMENTED"},{"author":"abra5umente","state":"COMMENTED"}]
comments_count: 3
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/5819
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

Fixes several compatibility issues when connecting the OpenClaw Android app to a Clawdbot gateway instance.

## Changes

### 1. Use BouncyCastle for Ed25519 cryptography
Android's native JCA providers don't reliably support Ed25519 across all devices. Tested on Pixel 9 Pro Fold (Android 16) where native provider threw "Not initialized" errors from `AndroidKeyStoreKeyPairGeneratorSpi`. BouncyCastle provides consistent cross-device support.

### 2. Update client IDs for Clawdbot
- `openclaw-android` → `clawdbot-android`
- `openclaw-control-ui` → `clawdbot-control-ui`

### 3. Update canvas/A2UI path
- `/__openclaw__/a2ui/` → `/__clawdbot__/a2ui/`

### 4. Fix Tailscale serve compatibility
Strip explicit port from `.ts.net` hostnames since Tailscale serve proxies on port 443.

## Notes
- BouncyCastle adds ~2MB to APK size
- Client IDs and paths could potentially be made configurable via build flavours in a future PR

## Testing
Tested on Pixel 9 Pro Fold (Android 16):
- ✅ Node connection
- ✅ Operator connection  
- ✅ Chat
- ✅ Canvas/A2UI

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the Android client’s gateway compatibility by (1) switching Ed25519 keygen/signing to BouncyCastle for consistent support across devices, (2) renaming Android/control-ui client IDs to their Clawdbot equivalents, (3) updating the A2UI path under the canvas host, and (4) adjusting canvas host normalization to better support Tailscale Serve (`.ts.net` → HTTPS on 443).

The changes are primarily in the Android gateway/session and identity code paths: `DeviceIdentityStore` now ensures a BC provider is registered and uses it for Ed25519 operations, while `GatewaySession` tweaks canvas host URL handling and adds more connection/TLS debug logs. The UI/prefs additions expose a manual token override for gateway connections and thread it through `NodeRuntime` → `GatewaySession` connect.

<h3>Confidence Score: 3/5</h3>

- This PR is likely safe to merge but has a couple of edge-case correctness and privacy concerns worth addressing.
- Core changes are straightforward and localized, but the `.ts.net` URL normalization can fail for schemeless advertised URLs, and additional logcat logging may leak sensitive connection details. The global JCA provider reordering could also impact other crypto consumers in-process.
- apps/android/app/src/main/java/ai/openclaw/android/gateway/GatewaySession.kt; apps/android/app/src/main/java/ai/openclaw/android/gateway/DeviceIdentityStore.kt; apps/android/app/src/main/java/ai/openclaw/android/NodeRuntime.kt

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-01)

<sub>3 files reviewed, 3 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @abra5umente — COMMENTED (2026-02-02)



### @abra5umente — COMMENTED (2026-02-02)




## Comments

### @greptile-apps (2026-02-01)

<details>
<summary>Additional Comments (1)</summary>

**`apps/android/app/src/main/java/ai/openclaw/android/NodeRuntime.kt`**
[P1] Debug logging may leak sensitive connection details

`resolveA2uiHostUrl` logs the raw canvas host URL and computed A2UI URL (`nodeRaw`/`operatorRaw`/`result`). If the gateway advertises URLs containing tokens, internal hostnames/IPs, or other sensitive data, this will end up in logcat (and potentially crash reports). Consider gating these logs behind a debug flag/build type and/or redacting values.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: apps/android/app/src/main/java/ai/openclaw/android/NodeRuntime.kt
Line: 1117:1126

Comment:
[P1] Debug logging may leak sensitive connection details

`resolveA2uiHostUrl` logs the raw canvas host URL and computed A2UI URL (`nodeRaw`/`operatorRaw`/`result`). If the gateway advertises URLs containing tokens, internal hostnames/IPs, or other sensitive data, this will end up in logcat (and potentially crash reports). Consider gating these logs behind a debug flag/build type and/or redacting values.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>

### @abra5umente (2026-02-02)

All three code review comments addressed in 7f9d6d7:

1. **P0 - schemeless .ts.net URLs**: Added handling in `normalizeCanvasHostUrl` to detect .ts.net in raw URL even when URI parsing leaves host blank
2. **P1 - Debug logging**: All `Log.d()` calls now gated behind `BuildConfig.DEBUG` in both NodeRuntime.kt and GatewaySession.kt
3. **P1 - BouncyCastle provider**: Added existence check to avoid unnecessary removal + documentation explaining Android <13 requirement

### @abra5umente (2026-02-02)

## CI Failures - Pre-existing Issues

The  CI failures are unrelated to this PR's changes.

### 1. `checks (node, format)` 
Failing on `.github/workflows/formal-conformance.yml` - a workflow file not touched by this PR. Likely needs formatting from a recent merge to main.

### 2. `formal_conformance` 
```
SyntaxError: Identifier 'aliases' has already been declared
    at clawdbot-formal-models/scripts/extract-tool-groups.mjs:53
```
This is a JS syntax error in the `clawdbot-formal-models` submodule - completely unrelated to Android changes.

### 3. `checks-windows (node, test)` 
Logs unavailable - likely flaky test infrastructure.

---

All three Greptile review comments have been addressed in commit 7f9d6d7. Happy to rebase once the upstream issues are resolved and test further.


## Stats

- **Size:** medium (133+, 18-, 7 files)
- **Age:** 1 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
