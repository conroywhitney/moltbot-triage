---
number: 3857
title: "feat(cron): add direct message payload type for lightweight channel notifications"
author: gustavbotichelli
created: 2026-01-29T07:56:55Z
updated: 2026-01-29T07:57:05Z
labels: ["app: web-ui", "gateway"]
additions: 423
deletions: 5
changed_files: 8
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: passing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3857
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Summary

Adds a new `message` payload type for cron jobs that sends messages directly to a channel without spinning up an agent session. This is ideal for:

- Simple reminders (e.g., birthday notifications)
- Periodic status messages
- Scheduled notifications that don't need AI processing

## Motivation

Currently, cron has two payload types:
- `systemEvent` - For main session (but broken for notifications)
- `agentTurn` - Works but overkill for simple reminders since it spins up a full agent session

The new `message` payload type provides a lightweight alternative that uses the existing message infrastructure directly.

## Changes

- Added `message` payload kind with `text`, `channel`, and optional `to` fields
- Added `direct` session target that bypasses agent infrastructure
- Implemented `sendDirectMessage` dependency using existing `runMessageAction`
- Added comprehensive tests for the new payload type

## Usage

```json
{
  "name": "Birthday reminder",
  "sessionTarget": "direct",
  "wakeMode": "now",
  "schedule": { "kind": "at", "atMs": 1734048000000 },
  "payload": {
    "kind": "message",
    "text": "ðŸŽ‚ Emma's birthday tomorrow!",
    "channel": "telegram",
    "to": "6450265544"
  }
}
```

## Testing

- All existing cron tests pass (52 tests)
- Added 5 new tests for the direct message payload:
  - âœ… Sends message without spinning up an agent
  - âœ… Reports error when `sendDirectMessage` is not configured
  - âœ… Rejects invalid session/payload combinations
  - âœ… Handles message send failures gracefully
  - âœ… Supports recurring direct message jobs

## Files Changed

- `src/cron/types.ts` - Added message payload type and direct session target
- `src/cron/service/state.ts` - Added sendDirectMessage dependency
- `src/cron/service/jobs.ts` - Updated validation and merge logic
- `src/cron/service/timer.ts` - Added direct message execution handler
- `src/cron/service/normalize.ts` - Handle message payload in normalization
- `src/gateway/protocol/schema/cron.ts` - Added schema for new types
- `src/gateway/server-cron.ts` - Wired up sendDirectMessage using runMessageAction
- `src/cron/service.direct-message.test.ts` - New test file

## Reviews


## Comments


## Stats

- **Size:** large (423+, 5-, 8 files)
- **Age:** 1 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
