---
number: 3704
title: "Feature[https://github.com/moltbot/moltbot/issues/3694] Public WebChat route /public/chat (UI shell)"
author: NickNYU
created: 2026-01-29T02:40:04Z
updated: 2026-01-29T05:24:08Z
labels: ["app: web-ui", "gateway"]
additions: 207
deletions: 10
changed_files: 10
size: large
review_decision: none
reviews: []
comments_count: 7
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: true
url: https://github.com/openclaw/openclaw/pull/3704
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

Implements PR1 of the Public WebChat proposal: add a new UI route /public/chat that renders a minimal, shareable chat shell (no nav/sidebar) and basic layout styling.\n\nNotes:\n- AI-assisted change (Codex)\n- Testing: not fully tested (local build/test deps not installed on this machine yet).\n- No gateway security changes in this PR; this is UI-only groundwork.\n\nFollow-ups planned:\n- Parameterize GatewayBrowserClient for non-operator usage\n- Gateway role/method allowlist for public webchat

## Reviews


## Comments

### @NickNYU (2026-01-29)

Update: added PR2 groundwork\n\n- Parameterized GatewayBrowserClient role/scopes (defaults unchanged)\n- When on /public/chat, UI now connects with clientName=webchat-ui (still operator role for now; gateway-side role allowlist will be follow-up PR)\n\nNote: I couldn't run ui:build/lint locally because pnpm/oxlint aren't installed on this machine (ui:build currently requires pnpm).

### @NickNYU (2026-01-29)

Update (PR3): gateway-side security for public webchat\n\n- Added a new connect role:  (handshake now accepts operator|node|webchat)\n- Gateway method authz now allows role=webchat but *only* a strict allowlist: agent.identity.get, chat.history, chat.send, chat.abort\n- Public UI (/public/chat) now connects with role=webchat + empty scopes, and client id webchat-ui\n- Added an e2e test asserting webchat can connect but sessions.list is denied\n\nTesting note: could not run tests locally because repo scripts currently invoke pnpm (not installed on this machine), so this is untested in CI only.

### @NickNYU (2026-01-29)

Update (PR3): gateway-side security for public webchat

- Added a new connect role: webchat (handshake now accepts operator|node|webchat)
- Gateway method authz now allows role=webchat but *only* a strict allowlist: agent.identity.get, chat.history, chat.send, chat.abort
- Public UI (/public/chat) now connects with role=webchat + empty scopes, and client id webchat-ui
- Added an e2e test asserting webchat can connect but sessions.list is denied

Testing note: could not run tests locally because repo scripts currently invoke pnpm (not installed on this machine), so this is untested pending CI.

### @NickNYU (2026-01-29)

Pushed a small follow-up commit to address formatting CI: wrapped the webchat authz errorShape call to match oxfmt line wrapping.

### @NickNYU (2026-01-29)

CI format fix: ran oxfmt locally and it rewrote src/gateway/server/ws-connection/message-handler.ts (role check formatting). Pushed commit 5222fddde. Also verified pnpm format + pnpm lint pass locally.

### @NickNYU (2026-01-29)

CI follow-up: fixed Windows test failure in src/media-understanding/apply.test.ts (Windows cannot create filenames containing < or >). The test now uses a platform-appropriate filename on win32 and asserts escaping accordingly.\n\nAlso rebased the branch onto latest upstream main before applying the fix; force-pushed the updated branch.

### @NickNYU (2026-01-29)

Another Windows CI fix: filenames also cannot contain '>' on win32. Updated the XML escaping test to use 'file&test.txt' on Windows and assert &amp; escaping in the name attribute. Force-pushed commit c10e3d88b.


## Stats

- **Size:** large (207+, 10-, 10 files)
- **Age:** 1 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
