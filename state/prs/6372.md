---
number: 6372
title: "fix: pass actual filename for WhatsApp document sends (#5781)"
author: TheWildHustle
created: 2026-02-01T15:51:04Z
updated: 2026-02-01T15:52:28Z
labels: ["channel: whatsapp-web", "agents"]
additions: 103
deletions: 21
changed_files: 6
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: passing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6372
fixes_issues: [5781]
related_prs: [5781]
duplicate_of: null
---

## Description

## Summary
- Adds `fileName` to `ActiveWebSendOptions` type so callers can pass a filename through to the send API
- Replaces hard-coded `"file"` in `send-api.ts` with `sendOptions?.fileName ?? "file"`
- Passes `media.fileName` from `loadWebMedia()` through `outbound.ts` into `sendOptions`

Fixes #5781

## Test plan
- [x] `pnpm lint` passes (0 warnings, 0 errors)
- [x] `pnpm test -- --run src/web/outbound.test.ts` â€” all 9 tests pass
- [ ] Manual: send a document via WhatsApp Web and verify the recipient sees the original filename

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR threads a document filename through the WhatsApp Web send pipeline by (1) extending `ActiveWebSendOptions` with `fileName`, (2) using that value in `createWebSendApi` when constructing a `document` payload, and (3) propagating `media.fileName` from `loadWebMedia()` through `sendMessageWhatsApp()` to the active listener. It also exports `discoverOllamaModels()` and adds unit tests to ensure Ollama model discovery skips invalid model names and fails closed.

Overall the change fits cleanly into the existing web outbound/inbound split: outbound gathers/normalizes media metadata and inbound constructs the Baileys `AnyMessageContent` payload.

<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge and narrowly scoped, with minor edge cases to consider.
- Core behavior change is straightforward (pass through filename for document sends) and is covered by an updated outbound unit test. The only notable risks are subtle accountId/activity attribution behavior in multi-account setups and the env-mutation strategy in the new Ollama tests potentially affecting other tests in unusual runner configurations.
- src/web/outbound.ts; src/agents/models-config.providers.ollama.test.ts

<!-- greptile_other_comments_section -->

<sub>(3/5) Reply to the agent's comments like "Can you suggest a fix for this @greptileai?" or ask follow-up questions!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps â€” COMMENTED (2026-02-01)

<sub>2 files reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** medium (103+, 21-, 6 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: #5781
