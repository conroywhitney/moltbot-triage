---
number: 4713
title: "fix: accept legacy client IDs for backward compatibility"
author: spiceoogway
created: 2026-01-30T15:09:17Z
updated: 2026-01-30T15:54:23Z
labels: ["app: web-ui", "gateway"]
additions: 85
deletions: 4
changed_files: 3
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4713
fixes_issues: [4590]
related_prs: [4590]
duplicate_of: null
---

## Description

Fixes #4590

During the rebranding from 'clawdbot' to 'moltbot' to 'openclaw', companion apps were updated to send new client IDs (`openclaw-macos`, `openclaw-ios`, etc.), but older gateway versions still required the legacy IDs in the validation schema.

This caused WebSocket handshake failures when connecting companion apps in Direct mode to older gateways, particularly when proxied via Tailscale Serve.

## Problem
Users with gateway version 2026.1.24-3 got this error when connecting companion apps:
```
invalid connect params: at /client/id: must be equal to cons...
```

The gateway's `validateConnectParams` rejected the new client IDs because the schema only accepted the literal values from the current `GATEWAY_CLIENT_IDS` constant.

## Solution
This PR adds backward compatibility by:
- Adding `LEGACY_GATEWAY_CLIENT_IDS` with both `clawdbot-*` and `moltbot-*` variants
- Merging legacy IDs into `ALL_GATEWAY_CLIENT_IDS` for validation
- Updating `GatewayClientIdSchema` to accept all current and legacy IDs
- Adding e2e tests to verify legacy client IDs are accepted

## Benefits
- ✅ Backward compatibility: gateways accept old and new client IDs
- ✅ Gradual rollout: apps and gateways can upgrade independently
- ✅ No breaking changes: existing connections continue working
- ✅ Future-proof: similar rebranding won't break connections again

## Testing
Added e2e tests for:
- `clawdbot-ios` (legacy)
- `clawdbot-android` (legacy)
- `moltbot-macos` (intermediate rebrand)

These tests verify that legacy client IDs pass schema validation just like the current `openclaw-*` IDs do.

## Migration Path
Legacy IDs can be deprecated and removed after 1-2 major versions, once all users have upgraded their companion apps and gateways to versions that support the new `openclaw-*` IDs.

## Reviews


## Comments


## Stats

- **Size:** medium (85+, 4-, 3 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #4590
