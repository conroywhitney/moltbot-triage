---
number: 7439
title: "fix(canvas): auto-present on snapshot if canvas not shown"
author: aidencullo
created: 2026-02-02T20:42:52Z
updated: 2026-02-02T23:12:53Z
labels: ["agents"]
additions: 37
deletions: 5
changed_files: 1
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: pending
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7439
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

## Problem
Canvas snapshot was failing with 'Canvas not presented' error when trying to capture a snapshot before calling present.

## Solution
When snapshot is called before present, the tool now automatically presents the canvas with a default target ('clawd-canvas') and retries the snapshot.

## Changes
- Added auto-present logic to snapshot action that detects 'canvas not presented' error
- Auto-presents with default target and retries the snapshot
- Respects delayMs parameter to allow canvas initialization time after auto-presenting
- Allows snapshot to work standalone without requiring explicit present call first

## Testing
Tested locally - snapshot now works without requiring a prior present call.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the `canvas` agent tool’s `snapshot` action to handle the common failure case where a snapshot is requested before the canvas has been presented. On a detected “canvas not presented” error, it automatically calls `canvas.present` (defaulting the target to `clawd-canvas` when none is supplied) and retries the snapshot, optionally waiting `delayMs` after the implicit present.

Overall, this makes `snapshot` usable as a standalone action without requiring an explicit `present` call first, while keeping existing gateway invocation patterns intact.

<h3>Confidence Score: 4/5</h3>

- This PR is reasonably safe to merge; the change is localized and adds a sensible retry path.
- The new behavior is confined to the `snapshot` action and only triggers on a specific error message, with otherwise unchanged code paths. Main risk is semantic: `delayMs` is now interpreted as a post-auto-present delay rather than a general snapshot delay, which could surprise callers relying on it to avoid initialization races.
- src/agents/tools/canvas-tool.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** small (37+, 5-, 1 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
