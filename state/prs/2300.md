---
number: 2300
title: "[AI-assisted] fix(mattermost): ensure replies create threads in channels"
author: blizzy78
created: 2026-01-26T17:20:14Z
updated: 2026-02-03T03:57:38Z
labels: ["channel: mattermost"]
additions: 1
deletions: 1
changed_files: 1
size: tiny
review_decision: none
reviews: []
comments_count: 3
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/2300
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

This PR ensures that Clawdbot starts a new thread when replying to a message in a Mattermost channel, instead of sending a top-level message.

- Fallback to `post.id` as `threadRootId` if `post.root_id` is missing. Posts in a channel don't have a `root_id` until there are actual answers in a thread.
- Excludes DMs to maintain standard direct messaging behavior (unthreaded unless already in a thread).

Reviewed and tested by actual humans.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adjusts Mattermost inbound handling so that for channel/group posts without a `root_id`, the bot treats the postâ€™s own `id` as the thread root (while leaving DMs unchanged). This ensures replies are sent as threaded replies in channels/groups rather than as top-level posts, by flowing the derived `threadRootId` through session key derivation, typing indicators, and `sendMessageMattermost(..., { replyToId })`.

<h3>Confidence Score: 4/5</h3>

- This PR appears safe to merge and is unlikely to introduce regressions beyond threading behavior.
- The change is a one-line adjustment to `threadRootId` derivation scoped to non-DM messages, and the resulting value is already used consistently across reply/typing/session plumbing. I did not find additional call sites that would conflict with using `post.id` as a synthetic thread root for channel/group messages lacking `root_id`. Confidence is slightly reduced because Mattermost thread semantics can vary by server/version and the debounce key still uses `root_id` only.
- extensions/mattermost/src/mattermost/monitor.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews


## Comments

### @damoahdominic (2026-01-27)

Cool

### @damoahdominic (2026-01-28)

Happy to test with you

### @blizzy78 (2026-01-28)

Thanks, but we've patched our local installation, and it's working just fine :)


## Stats

- **Size:** tiny (1+, 1-, 1 files)
- **Age:** 7 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
