---
number: 2990
title: "fix: Re-arm cron service timer with a delay if already running to prevent missed events."
author: KuzeyC
created: 2026-01-27T22:09:53Z
updated: 2026-01-29T11:24:00Z
labels: []
additions: 130
deletions: 1
changed_files: 2
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/2990
fixes_issues: []
related_prs: [2813]
duplicate_of: null
---

## Description

## Summary
Schedules a retry timer when onTimer() is called while another cron operation is in progress (state.running = true). The retry occurs after 500ms, ensuring the timer is eventually re-armed even when concurrent operations overlap.

## Problem
The cron timer mechanism had a race condition where when onTimer() was called but state.running was already true, the function returned immediately without re-arming the timer. This caused:
- The event loop to go completely silent
- Scheduled cron jobs to never fire
- No log activity during the window when jobs should have executed
- Mission-critical healthcare cron jobs to be missed

Solution
In onTimer(), when state.running is true:
- Schedule a 500ms retry timer instead of returning silently
- The retry timer is also unref()'ed to avoid keeping the process alive unnecessarily
- Retry logic recursively calls 
- onTimer()
-  which will eventually succeed when state.running becomes false

## Test Plan
Added service.timer-rearm-on-running.test.ts with 2 tests:
- Verifies retry is scheduled when state.running is true
- Verifies normal execution when no concurrent operation
- All existing cron tests pass (789/790 total; 1 unrelated failure in canvas-host)
- Lint passes

---

- [x] AI-assisted

Fixes [#2813](https://github.com/moltbot/moltbot/issues/2813)

## Reviews


## Comments


## Stats

- **Size:** medium (130+, 1-, 2 files)
- **Age:** 2 days
- **Last activity:** 2026-01-29

## Links

- Fixes: (none detected)
