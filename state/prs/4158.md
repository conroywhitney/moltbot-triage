---
number: 4158
title: "fix(slack): support multiple file attachments in messages"
author: HirokiKobayashi-R
created: 2026-01-29T19:44:27Z
updated: 2026-01-29T19:44:40Z
labels: ["channel: slack"]
additions: 145
deletions: 22
changed_files: 3
size: medium
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4158
fixes_issues: [2348]
related_prs: [148,2348,3864,3868]
duplicate_of: null
---

## Description

## Summary
- Add `resolveSlackMediaAll()` function that returns all successfully downloaded files
- Update `prepareSlackMessage` to use `MediaPaths`, `MediaUrls`, `MediaTypes` for multiple files
- Maintain backward compatibility by keeping `MediaPath`/`MediaType`/`MediaUrl` for first file

Fixes #2348

Also related to metelix/rin-agent#148 (thread image attachments not working)

## Changes
- `src/slack/monitor/media.ts`: New `resolveSlackMediaAll()` function, deprecate single-file `resolveSlackMedia()`
- `src/slack/monitor/message-handler/prepare.ts`: Use new multi-file API
- `src/slack/monitor/media.test.ts`: Add tests for multi-file handling

## Test plan
- [x] New unit tests for `resolveSlackMediaAll()`
- [x] All existing Slack tests pass (129 tests)
- [x] `pnpm lint && pnpm build` passes

---
Supersedes #3868 (rebased to remove unrelated changes from #3864)

## Reviews


## Comments


## Stats

- **Size:** medium (145+, 22-, 3 files)
- **Age:** 0 days
- **Last activity:** 2026-01-29

## Links

- Fixes: #2348
