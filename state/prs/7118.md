---
number: 7118
title: "feat(imessage): add markdown.strip config option"
author: PeterRosdahl
created: 2026-02-02T12:17:58Z
updated: 2026-02-02T16:29:36Z
labels: []
additions: 403
deletions: 2
changed_files: 5
size: large
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"},{"author":"PeterRosdahl","state":"COMMENTED"}]
comments_count: 0
reactions_total: 3
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/7118
fixes_issues: [3846]
related_prs: [3846]
duplicate_of: null
---

## Description

## Summary

Adds a new `strip` option to the markdown config that allows stripping markdown formatting from outbound messages.

This is useful for channels like iMessage and SMS that don't render markdown - raw asterisks and hashes look ugly to recipients.

## Usage

```yaml
channels:
  imessage:
    markdown:
      strip: true
```

The option can be set at channel level or per-account.

## Changes

- Added `strip?: boolean` to `MarkdownConfig` type
- Added `strip` to `MarkdownConfigSchema` zod schema
- Updated iMessage outbound to apply `stripMarkdown()` when enabled
- Added tests for the new functionality

Since SMS goes through the same iMessage channel (Apple Messages handles both), this also covers SMS.

Closes #3846

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

Adds a `markdown.strip` option to the shared markdown config (types + Zod schema) and wires it into the iMessage outbound adapter so outbound text/captions can have markdown formatting removed when enabled. Includes a new Vitest suite covering default behavior, channel-level enablement, per-account overrides, header stripping, and media caption stripping.

<h3>Confidence Score: 3/5</h3>

- Mostly safe to merge, with one likely runtime edge case in media sending when captions are omitted.
- The change is small and covered by tests, but `sendMedia` applies markdown stripping unconditionally to `text`, which may be optional; if undefined, it can throw at runtime depending on adapter contract.
- src/channels/plugins/outbound/imessage.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>

### @PeterRosdahl — COMMENTED (2026-02-02)




## Comments


## Stats

- **Size:** large (403+, 2-, 5 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: #3846
