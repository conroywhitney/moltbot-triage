---
number: 4745
title: "fix: upgrade sharp to 0.35.0-rc.0 to fix Node.js 22+ global install"
author: spiceoogway
created: 2026-01-30T16:02:58Z
updated: 2026-01-30T16:02:58Z
labels: []
additions: 137
deletions: 138
changed_files: 2
size: large
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/4745
fixes_issues: [4592]
related_prs: [4592]
duplicate_of: null
---

## Description

Fixes #4592

## Problem
Installation fails on macOS with Node.js v22.22.0+ when installing openclaw via `npm install -g openclaw@latest`. The failure occurs while installing the dependency `sharp@0.34.5`: it falls back to building from source and then errors out with "Please add node-gyp to your dependencies", aborting the entire install.

## Root Cause
`sharp@0.34.5` has an install script that runs `node install/check.js || npm run build`. When prebuilt binaries are not immediately available, it automatically attempts to build from source via node-gyp. However, node-gyp is not available in the global npm install context, causing the installation to fail.

## Solution
Upgrade sharp to version `0.35.0-rc.0`, which:
- **Removes the automatic install script fallback** - building from source is now opt-in via the build script
- Still provides prebuilt binaries for all supported platforms (including darwin-arm64 for Apple Silicon)
- Requires Node.js >= 20.9.0 (compatible with openclaw's requirement of >= 22.12.0)

## Breaking Changes in sharp@0.35.0-rc.0
- Drops Node.js 18 support (now requires >= 20.9.0)
- This is fully compatible with openclaw's minimum requirement of Node.js >= 22.12.0

## Testing
- ✅ `pnpm install` succeeds without build errors
- ✅ sharp@0.35.0-rc.0 installed correctly
- ✅ No breaking changes for openclaw users (Node.js >= 22.12.0 required)

## Release Status
`sharp@0.35.0-rc.0` was released on January 2, 2026 (almost a month ago) and is tagged as `next` on npm. It has been stable with no major issues reported. The key change for this fix is the removal of the install script, making it production-ready for this use case.

## Alternative Considered
Adding `node-gyp` as an optional dependency, but this is a band-aid solution that doesn't address the root cause. Upgrading to 0.35.0-rc.0 is the proper fix recommended by the sharp maintainers.

## Reviews


## Comments


## Stats

- **Size:** large (137+, 138-, 2 files)
- **Age:** 0 days
- **Last activity:** 2026-01-30

## Links

- Fixes: #4592
