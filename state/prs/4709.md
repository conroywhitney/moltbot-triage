---
number: 4709
title: "fix(daemon): include user bin dirs in macOS LaunchAgent PATH"
author: ekson73
created: 2026-01-30T15:06:30Z
updated: 2026-02-03T02:24:54Z
labels: ["gateway"]
additions: 11
deletions: 7
changed_files: 1
size: small
review_decision: none
reviews: [{"author":"copilot-pull-request-reviewer","state":"COMMENTED"},{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/4709
fixes_issues: [4699]
related_prs: [4699]
duplicate_of: null
---

## Description

## Summary

The LaunchAgent plist was missing user bin directories on macOS, causing skills that depend on binaries installed via user package managers (volta, pnpm, bun, cargo, etc.) to show as 'blocked' in the UI.

## Root Cause

The function `resolveLinuxUserBinDirs` already had all the logic to resolve user bin directories, but it was only being called for Linux:

```typescript
// Before (bug):
const linuxUserDirs =
  platform === "linux" ? resolveLinuxUserBinDirs(options.home, options.env) : [];
```

## Changes

- Rename `resolveLinuxUserBinDirs` ‚Üí `resolvePosixUserBinDirs` (more accurate name)
- Apply user bin dir resolution for both `linux` and `darwin` platforms
- Add macOS-specific pnpm path (`~/Library/pnpm`)
- Add cargo bin path (`~/.cargo/bin`)

## After

```typescript
// After (fixed):
const posixUserDirs =
  platform === "linux" || platform === "darwin"
    ? resolvePosixUserBinDirs(options.home, options.env)
    : [];
```

## Testing

1. Run `clawdbot gateway install` on macOS
2. Check `~/Library/LaunchAgents/com.clawdbot.gateway.plist`
3. Verify PATH includes user bin dirs (volta, pnpm, bun, etc.)
4. Confirm skills using those binaries show as 'ready' instead of 'blocked'

## Related

Fixes #4699

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR updates the daemon‚Äôs service PATH construction to include common *user* bin directories on macOS (in addition to Linux), so launchd-launched processes can find binaries installed via user-scoped package managers (volta/pnpm/bun/cargo/etc.). It does so by renaming the helper to `resolvePosixUserBinDirs`, adding a couple of additional paths, and using it for both `linux` and `darwin` in `getMinimalServicePathParts`.


<h3>Confidence Score: 4/5</h3>

- This PR is likely safe to merge and should improve launchd PATH behavior on macOS.
- Changes are localized to PATH construction and primarily add additional candidate directories plus a rename; the main risk is whether the added pnpm directory matches real-world macOS pnpm setups, but incorrect extra PATH entries are generally low impact.
- src/daemon/service-env.ts

<!-- greptile_other_comments_section -->

<sub>(3/5) Reply to the agent's comments like "Can you suggest a fix for this @greptileai?" or ask follow-up questions!</sub>

<!-- /greptile_comment -->

## Reviews

### @copilot-pull-request-reviewer ‚Äî COMMENTED (2026-01-30)

## Pull request overview

Updates the daemon‚Äôs ‚Äúminimal PATH‚Äù construction so macOS LaunchAgents include common user-level bin directories, preventing skills that rely on user-installed tooling (pnpm/volta/bun/cargo, etc.) from being flagged as blocked.

**Changes:**
- Rename `resolveLinuxUserBinDirs` to `resolvePosixUserBinDirs`.
- Apply user bin dir resolution to both `linux` and `darwin`.
- Add pnpm (macOS) and cargo bin directories to the resolved PATH parts.





---

üí° <a href="/openclaw/openclaw/new/main/.github/instructions?filename=*.instructions.md" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Add Copilot custom instructions</a> for smarter, more guided reviews. <a href="https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Learn how to get started</a>.

### @greptile-apps ‚Äî COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** small (11+, 7-, 1 files)
- **Age:** 3 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #4699
