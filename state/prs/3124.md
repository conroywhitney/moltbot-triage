---
number: 3124
title: "Fix: avoid double replies in Signal"
author: travisp
created: 2026-01-28T04:12:33Z
updated: 2026-01-30T14:34:45Z
labels: []
additions: 32
deletions: 1
changed_files: 2
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: pending
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/3124
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

 ## Summary
  This fixes a double‑reply bug for inline slash commands like `/help` when the inbound message body is wrapped with an envelope/
  sender prefix (e.g. `T: /help`).

  ## Bug
  When the body includes an envelope prefix, the inline command path matches `/help` and sends an inline reply. However, the cleaned
  body still contains only structural text (`T:` / `[Signal]`), so the normal command handler runs as well. That results in two identical replies for a single inbound message.

I noticed the following when using signal: regular messages were processed normally. In addition a message that said something like "I need /help" would be processed. However, a message that said "/help" would receive duplicate identical responses. Looking through the code, it seemed the reason was this envelope prefix that caused it to be processed twice.

I'm unsure if this affected other channels, but it replicated in Signal. The test added fails unless the fix is applied.

  ## Root Cause
  `extractInlineSimpleCommand` strips the `/help` token but leaves envelope scaffolding behind. The inline handler only
  short‑circuited when the cleaned body was empty, so envelope‑only leftovers caused a second command pass.

  ## Fix
  Before deciding whether to short‑circuit, the inline handler now strips structural prefixes from the cleaned body. If only envelope
  text remains, it is treated as empty and the handler returns the inline reply immediately, avoiding the second command path.

  ## Tests
  Added an e2e test that simulates an envelope‑prefixed `/help` and asserts:
  - only one reply is produced
  - no agent run is triggered
  
  Note: coded with assistance of gpt-5.2-codex. Tested by running the e2e test, and also by installing my branch into a VM and verifying that `/help` only returned one reply and not two after the change. Nothing else seemed affected. 

## Reviews


## Comments


## Stats

- **Size:** small (32+, 1-, 2 files)
- **Age:** 2 days
- **Last activity:** 2026-01-30

## Links

- Fixes: (none detected)
