---
number: 6895
title: "feat(completion): PowerShell install/uninstall for completion"
author: ThinkIbrokeIt
created: 2026-02-02T05:17:03Z
updated: 2026-02-02T05:20:09Z
labels: ["docs", "cli", "scripts", "commands", "agents"]
additions: 2458
deletions: 710
changed_files: 12
size: huge
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6895
fixes_issues: []
related_prs: [6888]
duplicate_of: null
---

## Description

Adds PowerShell automated install & uninstall support for the completion subsystem.

Files changed include installer script updates, tests, and docs. Split from original combined PR #6888 into a focused change.

This branch was created from the original work: `feat/pwsh-completion-only`.

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds PowerShell support to the completion subsystem, including `openclaw completion --install` and the new `--remove` flow, plus onboarding defaults to PowerShell on Windows. It also adds tests around completion install/uninstall and postinstall completion setup, and introduces new security-oriented helpers for sanitizing session history and validating tool outputs.

However, there are a few correctness issues worth addressing before merge:
- Completion uninstall logic can remove unrelated profile content due to loose block delimiting.
- PowerShell profile detection defines a WindowsPowerShell path but never uses it.
- New history sanitization reports sanitization but doesn’t actually apply it to returned content.
- Tool-result security transform mutates message objects in-place, which can cause transcript/persistence side effects.

Additionally, the PR includes large, likely-unintentional `package.json`/lockfile churn (including version/dependency downgrades) that seems out of scope for “PowerShell completion install/uninstall” and may indicate the branch isn’t based on current `main`.

<h3>Confidence Score: 2/5</h3>

- This PR is not safe to merge as-is due to a few functional correctness issues and large out-of-scope dependency/version churn.
- Score reflects multiple concrete correctness problems (uninstall can delete unrelated shell profile content; history sanitization doesn’t apply sanitization; tool-result transform mutates objects in-place) plus `package.json`/lockfile changes that look like an accidental rebase/merge mismatch and could impact releases and runtime dependencies.
- src/cli/completion-cli.ts, src/agents/pi-embedded-runner/history.ts, src/agents/session-tool-result-guard.ts, package.json, pnpm-lock.yaml

<!-- greptile_other_comments_section -->

<sub>(5/5) You can turn off certain types of comments like style [here](https://app.greptile.com/review/github)!</sub>

<details><summary><h4>Context used (3)</h4></summary>

- Context from `dashboard` - docs/cli/agents.md ([source](https://app.greptile.com/review/custom-context?memory=057a11aa-5c5f-48bb-8d53-91b27b0fe3a2))
- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))
</details>


<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>4 files reviewed, 10 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** huge (2458+, 710-, 12 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
