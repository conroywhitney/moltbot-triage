---
number: 6265
title: "feat(whatsapp): add pairing owner notification"
author: zote
created: 2026-02-01T13:30:25Z
updated: 2026-02-01T20:52:21Z
labels: ["channel: whatsapp-web"]
additions: 88
deletions: 2
changed_files: 5
size: medium
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 1
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6265
fixes_issues: [6261]
related_prs: [6261]
duplicate_of: null
---

## Description

## Summary
When `dmPolicy` is `pairing`, owners can now be notified when someone requests to pair with the bot. This allows owners to be aware of incoming requests without having to manually check the CLI.

## Configuration
```json
{
  "channels": {
    "whatsapp": {
      "dmPolicy": "pairing",
      "pairing": {
        "notifyOwner": true,
        "ownerChat": "554788703000@s.whatsapp.net",
        "includeMessage": true
      }
    }
  }
}
```

## Notification Format
```
üì© *New pairing request*

From: Jo√£o (+5547999999999)
Code: `ABC123`

üìù Message:
"Oi, quanto custa a consultoria?"

To approve: `openclaw pairing approve whatsapp ABC123`
```

## Changes
- Added `WhatsAppPairingConfig` type with `notifyOwner`, `ownerChat`, and `includeMessage` options
- Added Zod schema validation (ownerChat required when notifyOwner is true)
- Modified `checkInboundAccessControl` to send notifications when pairing requests are created
- Added `messageBody` parameter to include original message in notifications

## Testing
- Existing access-control tests pass
- TypeScript compiles without errors

Fixes #6261

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds a WhatsApp pairing owner-notification feature gated by new `channels.whatsapp.pairing` config (and per-account overrides), validates it via Zod, threads message text into inbound access control, and sends a formatted notification to an owner chat when a new pairing request is created.

The changes integrate into the existing WhatsApp web inbound pipeline by extracting the inbound text early in `monitorWebInbox()` and passing it into `checkInboundAccessControl()`, which already creates pairing requests and replies to the requester when `dmPolicy` is `pairing`.

<h3>Confidence Score: 3/5</h3>

- Reasonably safe to merge, but has a functional config bug affecting multi-account dmPolicy behavior.
- The feature is self-contained and guarded by config, and notification send failures are handled. However, `checkInboundAccessControl` currently ignores per-account dmPolicy despite resolving it, which can lead to incorrect access behavior in multi-account setups (and makes the new per-account pairing config feel inconsistent).
- src/web/inbound/access-control.ts

<!-- greptile_other_comments_section -->

<sub>(3/5) Reply to the agent's comments like "Can you suggest a fix for this @greptileai?" or ask follow-up questions!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps ‚Äî COMMENTED (2026-02-01)

<sub>1 file reviewed, 2 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments

### @greptile-apps (2026-02-01)

<details>
<summary>Additional Comments (1)</summary>

**`src/web/inbound/access-control.ts`**
[P0] Account-level dmPolicy is ignored in access control.

`resolveWhatsAppAccount()` already resolves `account.dmPolicy`, but `checkInboundAccessControl()` uses `const dmPolicy = cfg.channels?.whatsapp?.dmPolicy ?? "pairing";`, which means per-account `channels.whatsapp.accounts.<id>.dmPolicy` has no effect. This PR threads `pairing` config per-account, so this mismatch is more likely to surprise multi-account users.

Also appears: the new owner-notification code keys off `account.pairing`, but DM gating is still driven by root dmPolicy, making it possible to configure account-specific pairing/owner notification while dmPolicy remains effectively global.

<details><summary>Prompt To Fix With AI</summary>

`````markdown
This is a comment left during a code review.
Path: src/web/inbound/access-control.ts
Line: 43:45

Comment:
[P0] Account-level dmPolicy is ignored in access control.

`resolveWhatsAppAccount()` already resolves `account.dmPolicy`, but `checkInboundAccessControl()` uses `const dmPolicy = cfg.channels?.whatsapp?.dmPolicy ?? "pairing";`, which means per-account `channels.whatsapp.accounts.<id>.dmPolicy` has no effect. This PR threads `pairing` config per-account, so this mismatch is more likely to surprise multi-account users.

Also appears: the new owner-notification code keys off `account.pairing`, but DM gating is still driven by root dmPolicy, making it possible to configure account-specific pairing/owner notification while dmPolicy remains effectively global.

How can I resolve this? If you propose a fix, please make it concise.
`````
</details>
</details>


## Stats

- **Size:** medium (88+, 2-, 5 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: #6261
