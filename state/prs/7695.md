---
number: 7695
title: "feat: add agent mem using lancedb"
author: Jay-ju
created: 2026-02-03T03:52:25Z
updated: 2026-02-03T04:51:39Z
labels: []
additions: 13226
deletions: 1951
changed_files: 9
size: huge
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7695
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR introduces a new pluggable memory storage layer (`MemoryStore`) with a LanceDB backend and a SQLite backend, and refactors the memory indexing manager to use the store abstraction. It also updates `sync-memory-files` to operate on the store interface rather than direct SQLite access, and adds standalone scripts for LanceDB testing/comparison.

Main concerns are around correctness of the refactor in `src/memory/manager.ts` (several stubs/debug notes and a throwing `status()`), and safety of LanceDB filter construction (string interpolation in `.where()`/`.delete()` expressions). The SQLite store implementation largely ports existing logic, but the hybrid merge currently wipes IDs, and the comparison script doesn’t match the new `StoredChunk` schema.


<h3>Confidence Score: 1/5</h3>

- This PR is not safe to merge as-is due to runtime-breaking stubs in the memory manager and unsafe query filter construction in the LanceDB store.
- `src/memory/manager.ts` contains an unconditional throw in `status()` plus several placeholder/stubbed methods and debug notes indicating the refactor is incomplete, which is very likely to break core memory functionality at runtime. In addition, `lancedb-store.ts` builds filter expressions via string interpolation for deletes/queries, which can lead to incorrect matches/deletes (and potential injection depending on LanceDB’s expression parsing).
- src/memory/manager.ts, src/memory/storage/lancedb-store.ts, src/memory/storage/sqlite-store.ts, src/memory/storage/compare-stores.ts

<!-- greptile_other_comments_section -->

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>5 files reviewed, 7 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** huge (13226+, 1951-, 9 files)
- **Age:** 0 days
- **Last activity:** 2026-02-03

## Links

- Fixes: (none detected)
