---
number: 6699
title: "fix(signal): preserve case for Base64 group IDs in target normalization"
author: NSEvent
created: 2026-02-01T23:42:00Z
updated: 2026-02-01T23:42:49Z
labels: []
additions: 22
deletions: 2
changed_files: 2
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/6699
fixes_issues: [5578]
related_prs: [5578]
duplicate_of: null
---

## Description

## Summary

Fixes #5578 - Signal group IDs were being lowercased during target normalization, breaking group allowlist matching.

### Root Cause

Signal group IDs are Base64-encoded and case-sensitive (e.g., `aBcDeFgHiJkLmNoPqRsTuVwXyZ...`). The `normalizeSignalMessagingTarget()` function was lowercasing the entire group target:

```typescript
// Before (broken)
return id ? `group:${id}`.toLowerCase() : undefined;
```

This caused allowlist matching to fail because:
- Config stores: `group:aBcDeFgHiJ...` (proper case)
- Runtime comparison: `group:abcdefghij...` (lowercased)

### Fix

Preserve the original case for group IDs while keeping other target types (UUIDs, usernames, phone numbers) lowercase as they are case-insensitive:

```typescript
// After (fixed)
const id = normalized.slice("group:".length).replace(/\s+/g, "");
return id ? `group:${id}` : undefined;
```

Also strips all whitespace from group IDs since Base64 shouldn't contain spaces (handles copy-paste errors where users might paste formatted text with newlines/spaces).

## Test plan

- [x] Added test cases for Base64 group ID case preservation
- [x] Added test cases for whitespace stripping in group IDs
- [x] `pnpm test src/channels/plugins/normalize/signal.test.ts` - all pass
- [x] `pnpm lint` - 0 warnings, 0 errors
- [x] `pnpm build` - success

ðŸ¤– Generated with [Claude Code](https://claude.ai/code)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

Preserves case for Signal `group:` targets during normalization so Base64 group IDs remain intact for allowlist matching, while keeping existing lowercasing behavior for case-insensitive target types. Also strips all whitespace from group IDs to tolerate copy/paste formatting. Adds Vitest coverage for case preservation (with/without `signal:` prefix) and whitespace stripping.

This fits into the channel plugin normalization utilities under `src/channels/plugins/normalize/`, which standardize user-provided targets before routing/allowlist comparison.

<h3>Confidence Score: 5/5</h3>

- This PR is safe to merge with minimal risk.
- The change is narrowly scoped to `group:` normalization, aligns with Signal group ID semantics (Base64 case sensitivity), and is covered by targeted unit tests; it does not affect other normalization paths beyond removing whitespace in group IDs.
- No files require special attention

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews


## Comments


## Stats

- **Size:** small (22+, 2-, 2 files)
- **Age:** 1 days
- **Last activity:** 2026-02-01

## Links

- Fixes: #5578
