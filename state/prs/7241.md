---
number: 7241
title: "feat(matrix): add read_thread tool for agent to resolve full content of threads"
author: peetzweg
created: 2026-02-02T15:53:32Z
updated: 2026-02-02T20:32:01Z
labels: ["docs", "channel: matrix"]
additions: 443
deletions: 69
changed_files: 11
size: large
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: true
draft: false
url: https://github.com/openclaw/openclaw/pull/7241
fixes_issues: []
related_prs: []
duplicate_of: null
---

## Description

When the bot receives a message in a Matrix thread, it now fetches the full thread history (root + replies) and includes it in the message context. This enables the bot to summarize threads, create issues from discussions, and act on full thread context.

Configuration:
- channels.matrix.threadContext.enabled (default: true)
- channels.matrix.threadContext.maxMessages (default: 50)

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR adds optional “thread context” support for the Matrix extension: when an inbound message is part of a thread, the monitor fetches the thread root + replies via the Matrix relations API and prefixes the inbound message body with a formatted thread transcript. It also threads this through config (`channels.matrix.threadContext.{enabled,maxMessages}`) and exposes `ThreadStarterBody` in the inbound context for downstream logic.

Most of the change is localized to the Matrix monitor (`extensions/matrix/src/matrix/monitor/*`) and docs (`docs/channels/matrix.md`). The main risks are around the new in-process caching behavior and bounding the amount of fetched context.

<h3>Confidence Score: 3/5</h3>

- Reasonably safe to merge, but the new thread-context cache behavior could cause memory growth and stale context in long-lived processes.
- Core behavior is straightforward (fetch thread root + relations and prepend to inbound body) and gated by config. However, the module-level Map cache has no eviction/invalidation, which can lead to unbounded memory usage and returning stale thread history over time; `maxMessages` is also not bounded, which can increase API/prompt size unexpectedly.
- extensions/matrix/src/matrix/monitor/threads.ts; extensions/matrix/src/matrix/monitor/index.ts

<!-- greptile_other_comments_section -->

<sub>(2/5) Greptile learns from your feedback when you react with thumbs up/down!</sub>

**Context used:**

- Context from `dashboard` - CLAUDE.md ([source](https://app.greptile.com/review/custom-context?memory=fd949e91-5c3a-4ab5-90a1-cbe184fd6ce8))
- Context from `dashboard` - AGENTS.md ([source](https://app.greptile.com/review/custom-context?memory=0d0c8278-ef8e-4d6c-ab21-f5527e322f13))

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-02)

<sub>2 files reviewed, 3 comments</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** large (443+, 69-, 11 files)
- **Age:** 0 days
- **Last activity:** 2026-02-02

## Links

- Fixes: (none detected)
