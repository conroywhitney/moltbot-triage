---
number: 2772
title: "fix: search WhatsApp account subdirs for LID mapping files"
author: impozzible
created: 2026-01-27T13:40:33Z
updated: 2026-01-28T23:25:11Z
labels: []
additions: 22
deletions: 1
changed_files: 1
size: small
review_decision: none
reviews: []
comments_count: 0
reactions_total: 0
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/2772
fixes_issues: [2771]
related_prs: [2771]
duplicate_of: null
---

## Description

## Summary

Fixes #2771

When `jidToE164()` is called without `opts.authDir` (e.g., from `extract.ts` in `describeReplyContext()`), the LID reverse mapping lookup fails because `resolveLidMappingDirs()` only searches the top-level credentials directory, not the `whatsapp/<accountId>/` subdirectories where the mapping files are actually stored.

This causes the reply-to-bot trigger in groups to fail when the bot's JID uses the WhatsApp LID format, as the implicit mention comparison can't resolve the LID to an E164 phone number.

## Changes

Updated `resolveLidMappingDirs()` in `src/utils.ts` to also search WhatsApp account subdirectories (`~/.clawdbot/credentials/whatsapp/*/`).

## Testing

1. Set up WhatsApp with a number using LID format
2. Join a group with `/activation mention`
3. Reply to bot's message without @mentioning
4. Bot now correctly responds (implicit mention via reply-to-bot)

Verified working on Clawdbot 2026.1.24-3.

## Reviews


## Comments


## Stats

- **Size:** small (22+, 1-, 1 files)
- **Age:** 2 days
- **Last activity:** 2026-01-28

## Links

- Fixes: #2771
