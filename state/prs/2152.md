---
number: 2152
title: "fix(whatsapp): apply humanDelay to block streaming replies"
author: ThanhNguyxn
created: 2026-01-26T09:21:13Z
updated: 2026-02-03T03:58:06Z
labels: ["channel: whatsapp-web", "app: macos"]
additions: 25
deletions: 5
changed_files: 3
size: small
review_decision: none
reviews: [{"author":"greptile-apps","state":"COMMENTED"}]
comments_count: 0
reactions_total: 1
ci_status: failing
mergeable: unknown
draft: false
url: https://github.com/openclaw/openclaw/pull/2152
fixes_issues: [2116]
related_prs: [2116]
duplicate_of: null
---

## Description

## Summary
- Add `humanDelay` to WhatsApp's `dispatcherOptions` so block streaming replies respect the configured delay

## Problem
WhatsApp was missing `humanDelay` in `process-message.ts`, causing block streaming to have inconsistent timing based on model generation speed instead of the configured delay (2000-4500ms).

## Changes
- Added `resolveHumanDelayConfig` import from `../../../agents/identity.js`
- Added `humanDelay: resolveHumanDelayConfig(params.cfg, params.route.agentId)` to `dispatcherOptions`

Fixes #2116

<!-- greptile_comment -->

<h2>Greptile Overview</h2>

<h3>Greptile Summary</h3>

This PR makes WhatsApp web auto-replies respect the configured `humanDelay` by wiring `resolveHumanDelayConfig(cfg, agentId)` into the reply dispatcher options in `src/web/auto-reply/monitor/process-message.ts`. It also includes small CI workflow hardening around submodule checkout (skip when `.gitmodules` is missing), and a refactor in the macOS app to build an SSH target string using a Swift `if` expression.

<h3>Confidence Score: 3/5</h3>

- Generally safe, but the macOS Swift change may introduce a compilation/toolchain compatibility failure unrelated to the PR’s stated goal.
- The WhatsApp change is a small, consistent wiring change (matches other channels’ usage of `resolveHumanDelayConfig`). The CI tweak is low risk. The macOS `if` expression syntax is the main concern because it can break builds depending on the Swift/Xcode version used outside this repo’s CI.
- apps/macos/Sources/OpenClaw/AppState.swift

<!-- greptile_other_comments_section -->

<!-- /greptile_comment -->

## Reviews

### @greptile-apps — COMMENTED (2026-02-03)

<sub>1 file reviewed, 1 comment</sub>

<sub>[Edit Code Review Agent Settings](https://app.greptile.com/review/github) | [Greptile](https://greptile.com?utm_source=greptile_expert&utm_medium=github&utm_campaign=code_reviews)</sub>


## Comments


## Stats

- **Size:** small (25+, 5-, 3 files)
- **Age:** 7 days
- **Last activity:** 2026-02-03

## Links

- Fixes: #2116
