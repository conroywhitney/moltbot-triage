---
number: 5996
title: "DM topic threading: replies land in General chat instead of topic thread"
author: 0xgaia
created: 2026-02-01T05:35:14Z
updated: 2026-02-02T00:17:01Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 4
url: https://github.com/openclaw/openclaw/issues/5996
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug

When using Telegram DM topics (private chat with bot topics enabled), automatic agent replies land in the General/main chat instead of the source topic thread. Manual sends with `--thread-id` work correctly.

## Version

openclaw 2026.1.30

## Root Cause

In `dist/telegram/bot-message-dispatch.js`, the `deliverReplies` call uses `resolvedThreadId` which is always `undefined` for DM (private) chats.

`resolveTelegramForumThreadId()` in `bot/helpers.js` explicitly returns `undefined` when `isForum` is `false` — which it always is for private chats. This function was designed only for forum supergroups.

Meanwhile, `ctxPayload.MessageThreadId` correctly has the raw `message_thread_id` value for DMs (set at `bot-message-context.js:455`), but `dispatchTelegramMessage` never uses it.

### Flow

1. DM arrives with `message_thread_id: 1489`
2. `resolveTelegramForumThreadId({ isForum: false, messageThreadId: 1489 })` → `undefined`
3. `ctxPayload.MessageThreadId` correctly gets `1489` (line 455 handles DMs separately)
4. `dispatchTelegramMessage` passes `resolvedThreadId` (`undefined`) to `deliverReplies`
5. `sendMessage` called without `message_thread_id` → reply lands in General chat

### Affected lines in `bot-message-dispatch.js`

- Line ~198: `messageThreadId: resolvedThreadId` (main delivery)
- Line ~256: `messageThreadId: resolvedThreadId` (fallback empty-response delivery)
- Line ~40: `typeof resolvedThreadId === "number"` (draft streaming condition)
- Line ~48: `messageThreadId: resolvedThreadId` (draft stream creation)

## Fix

Add a fallback after the destructuring:

```js
const effectiveThreadId = resolvedThreadId ?? (typeof ctxPayload.MessageThreadId === "number" ? ctxPayload.MessageThreadId : undefined);
```

Then replace `resolvedThreadId` with `effectiveThreadId` in the four locations above.

This preserves the existing forum group behavior (where `resolvedThreadId` is defined) while adding DM topic support.

## Reproduction

1. Configure Telegram bot with `dmPolicy: "pairing"` and `streamMode: "partial"`
2. Open a DM topic/thread with the bot
3. Send a message in the topic
4. Observe: bot reply appears in General/main chat, not in the topic
5. Manual `openclaw message send --target "<userId>" --thread-id <topicId>` works correctly

## Comments


## Links

- None detected yet
