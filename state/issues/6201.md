---
number: 6201
title: "Gateway crashes with TLS setSession null error (undici)"
author: 13967186047lee-maker
created: 2026-02-01T11:32:27Z
updated: 2026-02-01T21:04:19Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6201
duplicate_of: null
related_issues: [4425]
blocks: []
blocked_by: []
---

## Description

## Description

The gateway process crashes with an uncaught exception when the undici HTTP client encounters a TLS connection issue.

## Error log

```
[openclaw] Uncaught exception: TypeError: Cannot read properties of null (reading 'setSession')
    at TLSSocket.setSession (node:_tls_wrap:1132:16)
    at Object.connect (node:_tls_wrap:1826:13)
    at Client.connect (/usr/lib/node_modules/openclaw/node_modules/undici/lib/core/connect.js:70:20)
    at connect (/usr/lib/node_modules/openclaw/node_modules/undici/lib/dispatcher/client.js:444:21)
    at _resume (/usr/lib/node_modules/openclaw/node_modules/undici/lib/dispatcher/client.js:619:7)
    at resume (/usr/lib/node_modules/openclaw/node_modules/undici/lib/dispatcher/client.js:553:3)
    at Client.<computed> (/usr/lib/node_modules/openclaw/node_modules/undici/lib/dispatcher/client.js:277:31)
    at TLSSocket.onHttpSocketClose (/usr/lib/node_modules/openclaw/node_modules/undici/lib/dispatcher/client-h1.js:937:18)
    at TLSSocket.emit (node:events:531:35)
    at node:net:346:12
```

## Impact

- Gateway process exits immediately
- All connected clients (Telegram, WhatsApp, etc.) get disconnected
- Returns HTTP 502 errors until systemd restarts the service
- Requires manual restart or waiting for systemd auto-restart

## Steps to reproduce

This appears to happen intermittently when:
1. Network conditions cause a TLS connection to close unexpectedly
2. undici tries to resume/reconnect using a cached session
3. The session object is null, causing the crash

## Environment

- OpenClaw version: latest (2026-02-01)
- Node.js: v22.22.0
- OS: Linux 6.8.0-55-generic (x64)

## Related

This is related to #4425 (Gateway crashes on unhandled fetch rejection) - both are caused by unhandled errors in the undici HTTP client.

## Suggested fix

1. Add try/catch around TLS connection handling
2. Or add a global uncaughtException handler that logs but does not crash for recoverable network errors
3. Consider upgrading undici or adding connection pool error handling

## Comments


## Links

- None detected yet
