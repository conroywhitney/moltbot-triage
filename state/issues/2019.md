---
number: 2019
title: "[Bug]: iMessage groupPolicy=\"disabled\" not blocking group messages"
author: Teyymour
created: 2026-01-26T01:23:14Z
updated: 2026-01-30T21:38:44Z
labels: ["bug"]
assignees: []
comments_count: 3
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/2019
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

Group messages are reaching the agent despite `channels.imessage.groupPolicy: "disabled"` being set in config.

## Current Behavior

With this config:
```json
"imessage": {
  "enabled": true,
  "dmPolicy": "open",
  "allowFrom": ["*"],
  "groupPolicy": "disabled"
}
```

Group chat messages still arrive at the agent. The agent receives messages formatted as:
```
[iMessage +19733692175 ...] message text
```

There's no indication whether this came from a DM or group chat - only the sender's phone number is shown.

## Expected Behavior

Per the docs (concepts/groups.md):
```
groupPolicy? disabled -> drop
```

Group messages should be **dropped entirely** before reaching the agent.

Additionally, per the docs, group messages should include `ChatType=group` in the payload, but this metadata is not visible to the agent.

## Evidence

Chat list shows clear distinction:
- Group chats: `identifier: "chat102124743504420113"` (starts with "chat")
- DMs: `identifier: "+19733692175"` (phone number)

But inbound messages only show sender phone number, not the chat identifier, making it impossible for the agent to distinguish.

## Impact

1. Agent cannot distinguish group vs DM messages
2. groupPolicy enforcement appears broken for iMessage
3. Agent may inadvertently respond to/act on group chat content when only DM permission was granted

## Environment

- Clawdbot version: 2026.1.24-3
- macOS with native iMessage channel (imsg CLI)

## Suggested Fix

1. Ensure groupPolicy filtering happens before messages reach the agent
2. Include chat type metadata in the message format presented to agents
3. Alternatively, include the chat identifier (not just sender) so agents can distinguish

## Comments

### @amro-discountmoulding (2026-01-28)

+1 on the "group messages should include ChatType=group in the payload, but this metadata is not visible to the agent." This also causes the agent to respond 1:1 instead of to the group. So if I send a message to the group, the bot responds to me privately rather than in the group.

Tried fiddling with it, chatID is not being propagated properly so the target is falling back to the sender. Messed around with hard-coding chatID to be a proper iMsg group chat identifier, "chat:<ID NUMBER>" and got errors. Seems the AppleScript is not configured to handle group sends properly.


### @bibbycodes (2026-01-30)

Not sure if this is connected, but I faced a similar issue where the bot was acting as an intermediary between me and external contacts. Content routing worked fine (all messages related to a conversation remained within that conversation), but status messages like "Confirmed, they replied" and error messages would get sent to the external contact instead of to me. The bot seemed to  confuse "message FOR the contact" vs "message ABOUT the contact (for me)." Feels like the same missing recipient metadata problem but for message type/purpose rather than just DM vs group.

### @Teyymour (2026-01-30)

Thanks for the additional reports @amro-discountmoulding and @bibbycodes.

This is connected to #2047 (which was auto-closed for inactivity) — same root cause. The missing chat metadata means:

1. **Group vs DM indistinguishable** — groupPolicy can't enforce because the agent never sees chat type
2. **Routing confusion** — bot conflates "message FOR contact" vs "message ABOUT contact" (bibbycodes's point)
3. **Error/status messages leak** — internal notifications follow active channel context to external contacts

All three symptoms trace back to: **inbound iMessage messages don't include chat identifier, only sender phone number.**

The AppleScript/imsg layer knows the distinction (chat identifiers start with `chat` for groups vs phone number for DMs) but this metadata isn't surfacing to the agent or being used for policy enforcement.

Suggested fix path:
1. Include `chatId` or `chatType` in the message payload visible to agents
2. Enforce groupPolicy filtering in the provider layer before messages reach the agent
3. Route error/diagnostic messages to admin channel, not active context

Happy to test patches if there's a branch.


## Links

- None detected yet
