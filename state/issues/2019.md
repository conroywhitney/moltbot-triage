---
number: 2019
title: "[Bug]: iMessage groupPolicy=\\"disabled\\" not blocking group messages"
author: Teyymour
created: 2026-01-26T01:23:14Z
updated: 2026-01-28T14:40:54Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/2019
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

Group messages are reaching the agent despite `channels.imessage.groupPolicy: "disabled"` being set in config.

## Current Behavior

With this config:
```json
"imessage": {
  "enabled": true,
  "dmPolicy": "open",
  "allowFrom": ["*"],
  "groupPolicy": "disabled"
}
```

Group chat messages still arrive at the agent. The agent receives messages formatted as:
```
[iMessage +19733692175 ...] message text
```

There's no indication whether this came from a DM or group chat - only the sender's phone number is shown.

## Expected Behavior

Per the docs (concepts/groups.md):
```
groupPolicy? disabled -> drop
```

Group messages should be **dropped entirely** before reaching the agent.

Additionally, per the docs, group messages should include `ChatType=group` in the payload, but this metadata is not visible to the agent.

## Evidence

Chat list shows clear distinction:
- Group chats: `identifier: "chat102124743504420113"` (starts with "chat")
- DMs: `identifier: "+19733692175"` (phone number)

But inbound messages only show sender phone number, not the chat identifier, making it impossible for the agent to distinguish.

## Impact

1. Agent cannot distinguish group vs DM messages
2. groupPolicy enforcement appears broken for iMessage
3. Agent may inadvertently respond to/act on group chat content when only DM permission was granted

## Environment

- Clawdbot version: 2026.1.24-3
- macOS with native iMessage channel (imsg CLI)

## Suggested Fix

1. Ensure groupPolicy filtering happens before messages reach the agent
2. Include chat type metadata in the message format presented to agents
3. Alternatively, include the chat identifier (not just sender) so agents can distinguish

## Comments

### @amro-discountmoulding (2026-01-28)

+1 on the "group messages should include ChatType=group in the payload, but this metadata is not visible to the agent." This also causes the agent to respond 1:1 instead of to the group. So if I send a message to the group, the bot responds to me privately rather than in the group.

Tried fiddling with it, chatID is not being propagated properly so the target is falling back to the sender. Messed around with hard-coding chatID to be a proper iMsg group chat identifier, "chat:<ID NUMBER>" and got errors. Seems the AppleScript is not configured to handle group sends properly.



## Links

- None detected yet
