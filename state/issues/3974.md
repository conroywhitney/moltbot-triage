---
number: 3974
title: "Gateway crashes on fetch failure (unhandled promise rejection)"
author: hypervaimika-web
created: 2026-01-29T13:04:17Z
updated: 2026-01-29T14:30:49Z
labels: []
assignees: []
comments_count: 2
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/3974
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description
The gateway process crashes when a network request (fetch) fails, instead of handling the error gracefully. This causes the entire gateway to restart.

## Environment
- **Moltbot version:** 2026.1.24-3
- **OS:** Windows 11 (10.0.26200)
- **Node:** v24.13.0
- **Network:** WiFi connection

## Error Log
```
[2026-01-29T12:53:27.713Z] ERROR
[clawdbot] Unhandled promise rejection: TypeError: fetch failed
    at node:internal/deps/undici/undici:16416:13
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
```

## What happened
1. Gateway was running normally
2. Network briefly dropped (WiFi instability)
3. A fetch request failed with TypeError
4. Gateway crashed due to unhandled promise rejection
5. Scheduled Task auto-restarted the gateway at 12:54:00

## Expected behavior
Network failures should be caught and handled gracefully (retry, log warning, etc.) rather than crashing the entire gateway process.

## Impact
- Any in-flight agent work is interrupted
- Cron jobs may be missed during the restart window
- Users experience temporary disconnection

## Suggested fix
Wrap fetch calls in try/catch or add a global unhandled rejection handler that logs but does not crash for transient network errors.

## Comments

### @zerone0x (2026-01-29)

## üîç Analysis Complete

Thank you for the detailed bug report! After investigating, I found that this issue **has already been fixed** in the current codebase.

### Root Cause
The crash was happening because transient network errors from `fetch` were not being caught by the global unhandled rejection handler.

### The Fix
Commit [`3b879fe52`](https://github.com/clawdbot/clawdbot/commit/3b879fe52421e9c17a82baca1899d0084ce78ae4) (merged on Jan 27, 2026) added:
- `isTransientNetworkError()` function to detect network-related errors
- Handling for `TypeError: fetch failed` errors from Node's undici
- Support for error cause chains (nested errors)

The fix now:
1. Detects transient network errors (ECONNRESET, ENOTFOUND, ETIMEDOUT, etc.)
2. Detects `TypeError: fetch failed` from undici 
3. Logs a warning instead of crashing: `[moltbot] Non-fatal unhandled rejection (continuing):`

### Resolution
**Update to version 2026.1.27-beta.1 or later:**
```bash
npm install -g moltbot@latest
# or
npm install -g moltbot@beta
```

Your current version (2026.1.24-3) predates this fix. After updating, transient network failures will be logged as warnings but won't crash the gateway.

---
ü§ñ Analyzed with [Claude Code](https://claude.ai/claude-code) (issue-hunter-pro)

### @TechWizard9999 (2026-01-29)

Hi @hypervaimika-web , Closes #3974
This PR fixes the crash by handling unhandled promise rejections from `fetch` as transient network errors.


## Links

- None detected yet
