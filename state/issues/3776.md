---
number: 3776
title: "Support better-sqlite3 as alternative to node:sqlite for FTS5 and extension loading"
author: marcmeezy
created: 2026-01-29T05:20:36Z
updated: 2026-01-29T05:20:36Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/3776
duplicate_of: null
related_issues: [56951]
blocks: []
blocked_by: []
---

## Description

## Problem

Node.js built-in `node:sqlite` doesn't compile FTS5 (see [nodejs/node#56951](https://github.com/nodejs/node/issues/56951)) and extension loading via `enableLoadExtension` doesn't work properly with sqlite-vec.

This means:
- **FTS5 unavailable**: No hybrid keyword+semantic search
- **sqlite-vec unavailable**: No accelerated vector search

## Proposed Solution

Support `better-sqlite3` as an alternative SQLite backend. It has FTS5 compiled in by default and extension loading works out of the box.

### Implementation

I've tested a working patch locally:

1. Install better-sqlite3:
```bash
npm install better-sqlite3
```

2. Create a wrapper in `dist/memory/sqlite.js` that makes better-sqlite3 look like node:sqlite's `DatabaseSync`:
```javascript
class DatabaseSyncWrapper {
    constructor(path, options = {}) {
        const Database = require('better-sqlite3');
        this._db = new Database(path, {
            readonly: options.readOnly ?? false,
        });
    }
    prepare(sql) { return this._db.prepare(sql); }
    exec(sql) { return this._db.exec(sql); }
    close() { return this._db.close(); }
    loadExtension(path, entryPoint) { return this._db.loadExtension(path, entryPoint); }
    enableLoadExtension(allow) { /* no-op, better-sqlite3 always allows */ }
    // ... other method proxies
}
```

3. Update `sqlite-vec.js` to use the underlying db when calling `sqliteVec.load()`

### Results after patch

```
Memory Search (main)
Vector: ready ✅
FTS: ready ✅
```

Hybrid search works with both semantic and keyword matching.

## Configuration Option

Could be a config toggle like:
```json
{
  "agents": {
    "defaults": {
      "memorySearch": {
        "sqliteBackend": "better-sqlite3" // or "node:sqlite"
      }
    }
  }
}
```

This would let users choose based on their needs (better-sqlite3 requires native compilation, node:sqlite is built-in).

## Environment

- macOS arm64
- Node.js v22.12.0
- Clawdbot 2026.1.24-3

## Comments


## Links

- None detected yet
