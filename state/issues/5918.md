---
number: 5918
title: "[Bug]: WebChat UI Streaming/Rendering Bugs + Cron Scheduler enabled: undefined Issue\""
author: cjguitar
created: 2026-02-01T03:33:22Z
updated: 2026-02-01T03:33:22Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 1
url: https://github.com/openclaw/openclaw/issues/5918
duplicate_of: null
related_issues: [1690,4418,4446]
blocks: []
blocked_by: []
---

## Description

# OpenClaw Bug Report: WebChat UI + Cron Scheduler Issues (v2026.1.30)

**Environment:**
*   **Operating System:** macOS Sonoma 14.8.4 (via OpenCore-Patcher on Mac Pro 6,1)
*   **CPU:** Intel Xeon
*   **GPU/Metal:** Known issues due to OpenCore-Patcher (potential factor for browser-related problems)
*   **Node.js Version:** v24.13.0 (with punycode deprecation warning)
*   **OpenClaw Version:** 2026.1.30
*   **Working Directory:** `/Users/user/clawd`
*   **OpenClaw Config:** `~/.openclaw/openclaw.json`
*   **Logs:** `/tmp/openclaw/openclaw-YYYY-MM-DD.log` (JSON format)
*   **Gateway Binding:** `lan` (`192.168.68.9:18789`), `controlUi.allowInsecureAuth: true` enabled for HTTP access
*   **Primary Communication Channel:** Telegram (`@claud5bot`, User ID `8254646438`)
*   **Browser for Automation:** Dedicated Chrome profile (`chrome-cdp`) running with `--remote-debugging-port=9222` and `--disable-gpu`

---

## Issue 1: WebChat UI Real-time Streaming & Rendering Failures

**Summary:** The OpenClaw WebChat UI consistently fails to stream new messages in real-time. New messages (often agent and sometimes user) only appear after a manual refresh, often leading to duplicated messages and a broken conversational flow. This issue was reproduced across multiple machines and browser configurations, ruling out client-side environment as the root cause.

**Steps to Reproduce:**
1.  Open the OpenClaw WebChat UI in a browser (Safari and Chrome tested).
2.  Send a message to the agent.
3.  Observe that the agent's reply does not appear.
4.  Send another message.
5.  Observe that sometimes neither the agent reply nor the new user message appear.
6.  Manually refresh the browser page (or use the refresh button at the top of the chat interface).
7.  Observe that sometimes missed messages (both agent and user) appear, often duplicated.

**Observed Behavior:**
*   Messages do not stream in real-time.
*   Manual refresh is required to see new messages.
*   Messages frequently appear duplicated after refresh.
*   Safari exhibits `WebSocket is closed due to suspension (code=1006)` errors after ~3-5 minutes of idle time.
*   This behavior occurs regardless of the underlying hardware (Mac Pro 6,1 vs. M3 MacBook Pro).

**Troubleshooting Steps Taken (and their outcomes):**
*   **Tried different browsers:** Safari, Chrome. (Issue persists)
*   **Tried different machines:** Mac Pro 6,1, M3 MacBook Pro with server still on Mac Pro 6,1. (Issue persists)
*   **Reduced `web.heartbeatSeconds` to 10 seconds:** Attempted to keep WebSocket alive. (No improvement)
*   **Configured `gateway.bind: "lan"` and `allowInsecureAuth: true`:** For remote access and testing. (Confirmed connectivity, but issue persists)
*   **Rebuilt WebChat assets globally:** `npm install -g openclaw`. (No improvement)
*   **Searched OpenClaw GitHub Issues:** Found existing, unaddressed issues potentially related:
    *   #1690 (token auth breaking after 30 mins, though our token auth worked)
    *   #4446 (slash commands not showing up in chat)
    *   #4418 (error display issue)
*   **Conclusion:** This appears to be a fundamental client-side rendering or WebSocket handling bug within the OpenClaw WebChat UI, not fixable via configuration.

---

## Issue 2: Cron Scheduler Not Triggering Jobs (`nextWakeAtMs: null`)

**Summary:** The OpenClaw cron scheduler failed to trigger any scheduled jobs, consistently reporting `nextWakeAtMs: null` despite correctly defined recurring cron jobs. This prevented automated tasks like daily briefs and nightly research from executing.

**Steps to Reproduce:**
1.  Add cron jobs using `openclaw cron add` (e.g., recurring jobs with `schedule.kind: "cron"` and one-shot jobs with `schedule.kind: "at"`).
2.  Run `openclaw cron status`.
3.  Observe that `nextWakeAtMs` is `null` or `undefined`.
4.  Wait for scheduled times.
5.  Observe that jobs do not execute.

**Observed Behavior:**
*   `openclaw cron status` consistently showed `nextWakeAtMs: null`.
*   Neither one-shot (`at`) nor recurring (`cron`) jobs were executing.
*   Logs showed no explicit cron subsystem activity or errors related to job scheduling.

**Root Cause (Identified and Fixed):**
The root cause was traced to the `enabled` field within cron job definitions. When jobs were added via the `cron` tool (or potentially created in the configuration without explicit `enabled` set), the `enabled` field was implicitly `undefined` in the `jobs.json` store (`~/.openclaw/cron/jobs.json`).

The OpenClaw scheduler's internal logic (`dist/cron/service/jobs.js`, specifically `nextWakeAtMs()` and `recomputeNextRuns()`) treats `undefined` for the `enabled` field as `falsy` (i.e., disabled). This caused all jobs to be filtered out from consideration by the scheduler.

*   `nextWakeAtMs()` filter: `j.enabled && typeof j.state.nextRunAtMs === "number"`
*   `recomputeNextRuns()` condition: `if (!job.enabled)`

Since `j.enabled` was `undefined`, it evaluated to `false` in the `nextWakeAtMs` filter, and `true` in the `recomputeNextRuns` condition, effectively disabling all jobs and setting their `nextRunAtMs` to `undefined`.

**Solution Implemented:**
1.  **Patched existing jobs:** Explicitly updated all active cron jobs to set `enabled: true`.
    ```bash
    openclaw cron update <jobId> --patch '{"enabled": true}'
    ```
2.  **Removed expired one-shot jobs:** Cleaned up irrelevant one-shot jobs that had already passed their `atMs` timestamps.
3.  **Verified functionality:** `openclaw cron status` now correctly reports `nextWakeAtMs` with a valid timestamp, and a test cron job successfully executed and delivered a message to Telegram.

**Recommendation:** The `createJob` function in OpenClaw should default the `enabled` field to `true` if it's not explicitly provided during job creation, to prevent this silent disabling of jobs.

---

**Current Status:**
*   WebChat UI issue remains **unresolved** at a configuration level; requires developer intervention.
*   Cron scheduler bug is **resolved**, and scheduled jobs are now functioning as expected.

## Comments


## Links

- None detected yet
