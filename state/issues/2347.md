---
number: 2347
title: "Feature: onContextThreshold hook for pre-compaction actions"
author: iamjimmytherobot-glitch
created: 2026-01-26T19:31:21Z
updated: 2026-01-28T06:02:30Z
labels: ["enhancement"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/2347
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Problem

When a session hits context limits and compacts, valuable conversation history can be lost before the agent has a chance to save it. The current "pre-compaction memory flush" prompt fires too late — by that point, the summary may already be unavailable.

## Proposed Solution

Add a configurable `onContextThreshold` hook that triggers actions when context usage reaches a specified percentage (e.g., 75%, 90%). This would allow agents to:

1. **Save conversation summaries** to memory files before compaction
2. **Trigger transcript indexing** to preserve searchable history
3. **Alert the user** that context is getting full
4. **Run custom scripts** for any pre-compaction cleanup

## Suggested Config Format

```yaml
session:
  contextHooks:
    - threshold: 75%
      action: notify  # or: save, index, script
    - threshold: 90%
      action: save
      savePath: memory/{{date}}.md
    - threshold: 95%
      action: script
      script: ./scripts/pre-compaction.sh
```

## Why This Matters

- **Context windows are finite** — proactive saving beats reactive recovery
- **Memory continuity** — agents can maintain better long-term context
- **User experience** — no more "I lost that, can you paste it again?"

## Current Workaround

Added context size checking to heartbeat tasks, but this only helps during heartbeat intervals — not during active conversations that hit limits between beats.

---

Filed via Jimmy the Robot on behalf of @ssmccul

## Comments


## Links

- None detected yet
