---
number: 5421
title: "Signal daemon doesn't wait for signal-cli to exit during restart, causing lock conflicts"
author: JohnBethancourt
created: 2026-01-31T13:29:56Z
updated: 2026-02-02T00:19:10Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5421
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary
During gateway restart (SIGUSR1), the signal daemon sends SIGTERM to signal-cli but does not wait for the process to exit. This causes a race condition where the new signal-cli instance starts before the old one releases its config file lock.

## Symptoms
- Gateway restart fails silently
- Log shows: `signal-cli: Config file is in use by another instance, waitingâ€¦`
- Orphaned signal-cli processes accumulate (PPID=1)
- Manual `clawdbot gateway stop` + `clawdbot gateway` required to recover

## Root Cause
In `src/signal/daemon.ts`:
```typescript
stop: () => {
    if (!child.killed) {
        child.kill("SIGTERM");
    }
}
```

The `stop()` function sends SIGTERM but returns immediately without waiting for the child process to exit.

## Suggested Fix
Make `stop()` async and wait for the process to exit (with timeout):
```typescript
stop: async () => {
    if (!child.killed) {
        child.kill("SIGTERM");
        await new Promise<void>((resolve) => {
            const timeout = setTimeout(() => {
                child.kill("SIGKILL");
                resolve();
            }, 3000);
            child.on("exit", () => {
                clearTimeout(timeout);
                resolve();
            });
        });
    }
}
```

Or alternatively, add a delay between shutdown and restart in the run-loop.

## Workaround
Kill orphaned signal-cli processes before restart:
```bash
pgrep -f "signal-cli.*daemon" | while read pid; do
  ppid=$(ps -o ppid= -p $pid | tr -d " ")
  [ "$ppid" = "1" ] && kill $pid
done
```

## Environment
- Clawdbot version: 2026.1.24-3
- signal-cli version: 0.13.23
- Platform: macOS (Darwin arm64)

## Comments


## Links

- None detected yet
