---
number: 3113
title: "Browser snapshot hangs and causes unhandled promise rejection (screenshot works fine)"
author: youngamerican68
created: 2026-01-28T03:45:20Z
updated: 2026-01-29T13:10:30Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/3113
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

Summary

Browser snapshot endpoint hangs indefinitely and causes unhandled promise rejections, destabilizing the gateway.

Steps to reproduce

1. Start gateway with headless Chrome browser profile (clawd)
2. Open any URL: browser open https://example.com
3. Attempt snapshot: browser snapshot
4. Wait 20 seconds — times out
5. Try browser screenshot on same tab — works fine
Expected behavior

Snapshot should return DOM content within a reasonable time, or fail gracefully with a proper error.

Actual behavior

Snapshot hangs for 20 seconds then times out. Gateway logs show:
[clawdbot] Unhandled promise rejection: TypeError: fetch failed
at node:internal/deps/undici/undici:14902:13
The unhandled rejection can destabilize the gateway.

Environment

• Clawdbot version: 2026.1.24-3
• OS: Linux (Ubuntu VPS), 1.9GB RAM
• Install method: npm global install
• Browser: Headless Playwright Chromium
Logs or screenshots
[tools] browser failed: Can't reach the clawd browser control server at http://127.0.0.1:18791/snapshot?format=ai&targetId=...&maxChars=5000&profile=clawd (timed out after 20000ms)
Screenshot works fine on the same tab. Only snapshot is affected.

## Comments

### @nydamon (2026-01-29)

Adding more data points from my testing:

**Same behavior confirmed** on Clawdbot 2026.1.24-3 (Ubuntu 24.04, Node 22.22.0)

### Additional findings:
- `browser act` also hangs (not just snapshot)
- CDP direct via WebSocket works perfectly as workaround
- Tested on multiple sites (example.com, keepersecurity.com, amazon.com) - all hang

### Workaround:
Connect directly to CDP via WebSocket:
```javascript
const ws = new WebSocket('ws://127.0.0.1:9223/devtools/page/<targetId>');
ws.send(JSON.stringify({ id: 1, method: 'Page.captureScreenshot', params: {} }));
```

Screenshot, navigation, clicks all work via CDP. Only the Clawdbot browser tool's snapshot/act wrapper is affected.


## Links

- None detected yet
