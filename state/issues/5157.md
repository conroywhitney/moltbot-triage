---
number: 5157
title: "Sub-agents have session tools in system prompt but no actual API tool bindings"
author: gevertex
created: 2026-01-31T04:09:36Z
updated: 2026-02-02T00:20:07Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5157
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

Sub-agents spawned via `sessions_spawn` see `sessions_list`, `sessions_history`, and `sessions_send` mentioned in their system prompt, but these tools are not actually bound to the Anthropic API call. When the model tries to use them, it outputs text that looks like a tool call instead of triggering a real `tool_use` block.

## Config

```json
"tools": {
  "subagents": {
    "tools": {
      "allow": [
        "sessions_spawn",
        "sessions_list",
        "sessions_history",
        "sessions_send"
      ]
    }
  }
}
```

## Expected Behavior

Sub-agents should be able to call `sessions_list` and `sessions_history` and get actual results, enabling cross-session visibility as documented.

## Actual Behavior

1. Sub-agent sees tools listed in system prompt
2. Sub-agent attempts to call `sessions_list`
3. Instead of a `tool_use` block, the model outputs text like:
   ```
   {"name": "sessions_list", "parameters": {}}
   ```
4. `stopReason` is `"stop"` not `"tool_use"`
5. No actual tool execution occurs

## Evidence

From transcript inspection:
- Sub-agent thinking: "From the system prompt, I can see the following tools mentioned..."
- Response contains only `thinking` + `text` blocks, no `tool_use` blocks
- `stopReason: "stop"` confirms no tools were invoked

## Environment

- OpenClaw version: 2026.1.29
- Model: claude-opus-4-5
- OS: macOS (Darwin arm64)

## Root Cause Hypothesis

The `tools.subagents.tools.allow` config injects tool names into the sub-agent's system prompt, but does not add corresponding tool definitions to the Anthropic API `tools` parameter. The model hallucinates tool calls based on prompt text.

## Workaround

None known. Sub-agents cannot currently use session tools despite config allowing them.

## Comments


## Links

- None detected yet
