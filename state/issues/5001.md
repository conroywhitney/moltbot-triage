---
number: 5001
title: "[Bug]: Gemini 3 thoughtSignature field causes \"Thought signature is not   valid\" error in multi-turn conversations"
author: vergilsilverhand
created: 2026-01-30T23:05:23Z
updated: 2026-01-30T23:05:23Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5001
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

When using google/gemini-3-flash-preview model via OpenRouter, multi-turn conversations fail with a 400 error after the first tool call. The error occurs because Gemini 3 models now include a thoughtSignature field in tool call responses, and OpenClaw includes this field when sending conversation history back to the API, causing Google to reject the request with signature validation failure.

  Environment

  - OpenClaw version: 2026.1.29
  - Provider: OpenRouter
  - Model: google/gemini-3-flash-preview

  Steps to Reproduce

  1. Configure OpenClaw to use openrouter/google/gemini-3-flash-preview as default model
  2. Start a conversation that triggers a tool call
  3. After the tool result returns, the next API request fails

  Error Message

  {
    "error": {
      "code": 400,
      "message": "Unable to submit request because Thought signature is not valid.. Learn more: https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/gemini",
      "status": "INVALID_ARGUMENT"
    }
  }

  Root Cause

  From session history (.jsonl), the assistant message contains:

  {
    "type": "toolCall",
    "id": "tool_exec_BUUMvPBjGgWMyeFgTA7H",
    "name": "exec",
    "arguments": {...},
    "thoughtSignature":
  "{\"index\":0,\"id\":\"tool_exec_...\",\"type\":\"reasoning.encrypted\
  ",\"data\":\"...\",\"format\":\"google-gemini-v1\"}"
  }

When OpenClaw sends the next request, this thoughtSignature field is included in the conversation history. Google's API then attempts to validate the signature, which fails.

Expected Behavior

OpenClaw should strip thoughtSignature (and potentially other provider-specific metadata fields) from message history before sending requests to the API.

Suggested Fix

When building the messages array for API requests, filter out the thoughtSignature field from tool call content blocks:

  // Pseudo-code
  messages = messages.map(msg => ({
    ...msg,
    content: msg.content.map(block => {
      if (block.type === 'toolCall') {
        const { thoughtSignature, ...rest } = block;
        return rest;
      }
      return block;
    })
  }));

Workaround

Start a new conversation (/new) after encountering the error, or use a non-Gemini model.

## Comments


## Links

- None detected yet
