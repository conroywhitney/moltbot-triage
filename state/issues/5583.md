---
number: 5583
title: "llm-slug-generator uses hardcoded DEFAULT_PROVIDER instead of config"
author: msl2246
created: 2026-01-31T17:44:27Z
updated: 2026-02-02T00:18:36Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5583
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Problem

When `llm-slug-generator` (used by session-memory hook) calls `runEmbeddedPiAgent`, it doesn't pass `provider` or `model` parameters explicitly. This causes it to fall back to the hardcoded defaults in `src/agents/defaults.ts`:

```typescript
export const DEFAULT_PROVIDER = "anthropic";
export const DEFAULT_MODEL = "claude-opus-4-5";
```

Even though the user has configured `google-antigravity/claude-opus-4-5-thinking` as their primary model in `openclaw.json`, the slug-generator still tries to use `anthropic` provider and fails with:

```
FailoverError: No API key found for provider "anthropic".
Auth store: ~/.openclaw/agents/executor/agent/auth-profiles.json
```

## Root Cause

In `src/hooks/llm-slug-generator.ts`:

```typescript
const result = await runEmbeddedPiAgent({
  sessionId: \`slug-generator-${Date.now()}\`,
  sessionKey: "temp:slug-generator",
  sessionFile: tempSessionFile,
  workspaceDir,
  agentDir,
  config: params.cfg,
  prompt,
  timeoutMs: 15_000,
  runId: \`slug-gen-${Date.now()}\`,
  // ‚ùå Missing: provider and model parameters!
});
```

And in `src/agents/pi-embedded-runner/run.js` (line ~47):

```typescript
const provider = (params.provider ?? DEFAULT_PROVIDER).trim() || DEFAULT_PROVIDER;
const modelId = (params.model ?? DEFAULT_MODEL).trim() || DEFAULT_MODEL;
```

Since `params.provider` is undefined, it falls back to `DEFAULT_PROVIDER` ("anthropic").

## Suggested Fix

Option 1: Make `llm-slug-generator` extract provider/model from config and pass them explicitly:

```typescript
import { resolveAgentModelPrimary } from "../agents/agent-scope.js";
import { parseModelRef } from "../agents/model-selection.js";

const modelPrimary = resolveAgentModelPrimary(params.cfg, agentId) 
  ?? params.cfg.agents?.defaults?.model?.primary;
const parsed = parseModelRef(modelPrimary, "anthropic");

const result = await runEmbeddedPiAgent({
  // ...existing params...
  provider: parsed?.provider,
  model: parsed?.model,
});
```

Option 2: Update `runEmbeddedPiAgent` to read defaults from config before falling back to hardcoded values.

## Environment

- OpenClaw version: dev channel (2026.1.29)
- Config uses `google-antigravity` provider exclusively
- No `anthropic` auth profile configured

## Comments

### @finderstrategy-cyber (2026-02-01)

Confirming this issue. I am using MiniMax as my default model (minimax/MiniMax-M2.1) with no Anthropic API key configured, and I see the same error in my logs: FailoverError No API key found for provider anthropic when the slug-generator tries to generate session slugs. The error appears but does not affect normal operation. Looking forward to the fix!


## Links

- None detected yet
