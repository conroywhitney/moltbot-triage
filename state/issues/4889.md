---
number: 4889
title: "[Bug]: OpenClaw routes Anthropic API calls to OpenAI endpoint (Telegram channel)"
author: tdm21m
created: 2026-01-30T20:34:58Z
updated: 2026-01-31T10:27:08Z
labels: ["bug"]
assignees: []
comments_count: 3
reactions_total: 1
url: https://github.com/openclaw/openclaw/issues/4889
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

# Bug: OpenClaw routes Anthropic API calls to OpenAI endpoint

## Environment
- **Version:** 2026.1.29 (a5b4d22)
- **OS:** macOS 26.2 (arm64)
- **Node:** 22.22.0
- **Channel:** Telegram
- **Gateway Mode:** local

## Summary

OpenClaw is configured to use Anthropic's Claude API but is actually making HTTP requests to OpenAI's API endpoint, resulting in 404 errors with OpenAI request IDs (`req_011CXe...`).

## Configuration

**Main config** (`~/.openclaw/openclaw.json`):
```json
{
  "models": {
    "providers": {
      "anthropic": {
        "baseUrl": "https://api.anthropic.com/v1",
        "apiKey": "sk-ant-[REDACTED]...",
        "api": "anthropic-messages",
        "models": [
          {
            "id": "claude-3-haiku-20240307",
            "name": "claude-3-haiku-20240307",
            "contextWindow": 200000,
            "maxTokens": 4096
          }
        ]
      }
    }
  },
  "agents": {
    "defaults": {
      "model": {
        "primary": "anthropic/claude-3-haiku-20240307"
      }
    }
  },
  "channels": {
    "telegram": {
      "enabled": true,
      "botToken": "..."
    }
  }
}
```

**Agent-level config** (`~/.openclaw/agents/main/agent/models.json`):
```json
{
  "providers": {
    "anthropic": {
      "baseUrl": "https://api.anthropic.com/v1",
      "apiKey": "sk-ant-[REDACTED]...",
      "api": "anthropic-messages",
      "models": [...]
    }
  }
}
```

## Expected Behavior

OpenClaw should make API calls to `https://api.anthropic.com/v1/messages` and receive Anthropic-formatted responses.

## Actual Behavior

1. OpenClaw logs claim to use Anthropic:
```json
{
  "provider": "anthropic",
  "model": "claude-3-haiku-20240307",
  "api": "anthropic-messages"
}
```

2. But the actual HTTP error comes from OpenAI's API:
```json
{
  "type": "error",
  "error": {
    "type": "not_found_error",
    "message": "Not Found"
  },
  "request_id": "req_011CXeCEwqRN9vEmV8kvaX5a"
}
```

Note: The `req_` prefix is OpenAI's request ID format, not Anthropic's.

## Reproduction Steps

1. Configure OpenClaw with only Anthropic provider
2. Set primary model to `anthropic/claude-3-haiku-20240307`
3. Send message via Telegram bot
4. Observe 404 error with OpenAI request ID format

## Verification

Direct API call to Anthropic works perfectly:
```bash
curl -s https://api.anthropic.com/v1/messages \
  -H "x-api-key: sk-ant-[REDACTED]..." \
  -H "anthropic-version: 2023-06-01" \
  -H "content-type: application/json" \
  -d '{"model":"claude-3-haiku-20240307","max_tokens":10,"messages":[{"role":"user","content":"hi"}]}'
```

Returns: `{"model":"claude-3-haiku-20240307","id":"msg_017LRed...","type":"message",...}`

## Session Log Evidence

From `~/.openclaw/agents/main/sessions/[session-id].jsonl`:
```json
{
  "type": "message",
  "message": {
    "role": "assistant",
    "api": "anthropic-messages",
    "provider": "anthropic",
    "model": "claude-3-haiku-20240307",
    "stopReason": "error",
    "errorMessage": "404 {\"type\":\"error\",\"error\":{\"type\":\"not_found_error\",\"message\":\"Not Found\"},\"request_id\":\"req_011CXeCEwqRN9vEmV8kvaX5a\"}"
  }
}
```

## Root Cause

OpenClaw appears to be routing API calls to OpenAI's endpoint even when configured for Anthropic. The API abstraction layer may be:
1. Ignoring the `baseUrl` configuration
2. Using a hardcoded OpenAI URL
3. Incorrectly mapping `anthropic-messages` API type to OpenAI endpoints

## Impact

- Telegram bots cannot function with Anthropic models
- Configuration is ignored at runtime
- No errors or warnings indicate the routing issue

## Comments

### @ThiloHettmer (2026-01-30)

Took me some time but it works without the "api": "anthropic-messages"

```  
"models": {
    "providers": {
      "anthropic": {
        "baseUrl": "https://api.anthropic.com/v1",
        "apiKey": "KEY",
        "models": [
          {
            "id": "claude-haiku-4.5",
            "name": "claude-haiku-4.5",
            "contextWindow": 200000,
            "maxTokens": 4096
          }
        ]
      }
    }
  },
  "agents": {
    "defaults": {
      "maxConcurrent": 4,
      "subagents": {
        "maxConcurrent": 8
      },
      "workspace": "/home/node/.openclaw/workspace",
      "model": {
        "primary": "anthropic/claude-4.5-haiku"
      }
    }
  },
```  

### @bentleymi (2026-01-30)

lost a day of my life and then i found this issue and workaround... thank you!

### @ThiloHettmer (2026-01-31)

Yes with the latest change it does not work anymore. I get a 404 not found on my solution from earlier and with "api": "anthropic-messages" I get the previous error.

/edit: its just a mess with the config file. Be really careful how you structure the config.

```
  "models": {
    "providers": {
      "anthropic": {
        "baseUrl": "https://api.anthropic.com/v1",
        "apiKey": "KEY",
        "models": [
          {
            "id": "claude-haiku-4-5",
            "name": "claude-haiku-4-5",
            "contextWindow": 200000,
            "maxTokens": 4096,
            "reasoning": false,
            "input": ["text"],
            "cost": {
              "input": 0,
              "output": 0,
              "cacheRead": 0,
              "cacheWrite": 0
            }
          }
        ]
      }
    }
  },
  "agents": {
    "defaults": {
      "model": {
        "primary": "anthropic/claude-haiku-4-5"
      },
      "models": {
        "anthropic/claude-haiku-4-5": {}
      },
      "workspace": "/home/node/.openclaw/workspace",
      "maxConcurrent": 4,
      "subagents": {
        "maxConcurrent": 8
      }
    }
  },
```

Somehow "anthropic/claude-haiku-4-5" changed from yesterday to today


## Links

- None detected yet
