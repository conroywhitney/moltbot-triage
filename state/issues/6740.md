---
number: 6740
title: "Tool call ID format errors cause agent non-responsiveness (\"Cloud Code Assist format error\")"
author: jmkl009
created: 2026-02-02T00:58:07Z
updated: 2026-02-02T02:57:17Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6740
duplicate_of: null
related_issues: [821,8942]
blocks: []
blocked_by: []
---

## Description

### Description
When session history contains tool call IDs that don't match Anthropic's required pattern `^[a-zA-Z0-9_-]+$`, the agent becomes non-responsive and logs:

```
[agent/embedded] Profile anthropic:default hit Cloud Code Assist format error. Tool calls will be sanitized on retry.
```

The synthetic tool result message `[openclaw] missing tool result in session history; inserted synthetic error result for transcript repair.` often appears before this issue manifests.

### Root Cause
Anthropic's API rejects `tool_use.id` values containing invalid characters. When the transcript repair system (`session-transcript-repair.js`) runs, it copies the original `toolCallId` — if the original ID was malformed, this perpetuates the issue.

### Relevant Code
- Error detection: `dist/agents/pi-embedded-helpers/errors.js` (`isCloudCodeAssistFormatError()`)
- Transcript repair: `dist/agents/session-transcript-repair.js` (`makeMissingToolResult()`)
- Runner: `dist/agents/pi-embedded-runner/run.js`

### Related
- `badlogic/pi-mono#821` - Tool call ID normalization fix
- `cline/cline#8942` - Same pattern error across providers
- `@mariozechner/pi-ai` v0.50.7 (current) → v0.51.0 may contain fix

### Workaround
Run `/compact` in webchat to reduce context and clear problematic history.

Note: `openclaw gateway restart` does **not** resolve this issue.

### Environment
- OpenClaw 2026.1.30
- macOS arm64 (Darwin 24.3.0)
- Model: anthropic/claude-opus-4-5

## Comments


## Links

- None detected yet
