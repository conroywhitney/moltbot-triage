---
number: 1922
title: "Android node app disconnects before completing WebSocket handshake"
author: Yellowfish23
created: 2026-01-25T19:35:47Z
updated: 2026-01-27T09:10:31Z
labels: ["bug"]
assignees: []
comments_count: 2
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/1922
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary
Android node app connects to gateway but immediately disconnects (code 1000, reason 'bye') before completing the protocol handshake.

## Environment
- **Gateway version:** 2026.1.24-0
- **Android app version:** 2026.1.24-dev (built from source)
- **Device:** Samsung SM-F966B (Z Fold7)
- **Gateway OS:** Windows 10 (DESKTOP-9IMKOHD)
- **Connection:** LAN (192.168.1.101:18789 -> 192.168.1.104)

## Steps to Reproduce
1. Start gateway with \ind: 'lan'\ and auth token configured
2. Open Android Clawdbot app
3. Discover gateway via mDNS or enter manual connection (host/port)
4. Tap Connect
5. App shows 'Gateway error: Not initialized'

## Gateway Logs
\\\
[gateway/ws] closed before connect conn=2cd1349e-c94b-4ee4-af46-edd1dbcb4b07 remote=192.168.1.104 fwd=n/a origin=n/a host=192.168.1.101:18789 ua=okhttp/5.3.2 code=1000 reason=bye
[gateway/ws] closed before connect conn=630c15af-ff8c-4315-a102-0f71ce8d54c2 remote=192.168.1.104 fwd=n/a origin=n/a host=192.168.1.101:18789 ua=okhttp/5.3.2 code=1000 reason=bye
\\\

Multiple connection attempts, all with:
- \handshake: 'pending'\ (connect request never received)
- \code: 1000\ (normal close)
- \eason: 'bye'\

## Observations
- Gateway is listening on 0.0.0.0:18789 (confirmed via netstat)
- Firewall rule added for port 18789
- TCP connections from phone reach gateway (TIME_WAIT entries visible)
- WebSocket upgrade succeeds (gateway logs the connection)
- App disconnects ~15-25ms after connecting, before sending connect request

## Expected Behavior
App should send \connect\ request after receiving \connect.challenge\ from gateway.

## Actual Behavior
App immediately disconnects with 'bye' before protocol handshake completes.

## Workarounds Tried
- Disabled TLS requirement in app
- Disabled gateway auth (same result)
- Tried auto-discovery and manual connection
- Restarted phone and gateway multiple times
- Added Windows Firewall exception

## Comments

### @systemcaller (2026-01-27)

I'm also having this issue, docker deployment, connection refused.

The configuration file is as follows:

  "gateway": {
    "mode": "local",
    "auth": {
      "mode": "token",
      "token": "...  ...."
    },
    "port": 18789,
    "bind": "loopback",
    "tailscale": {
      "mode": "off",
      "resetOnExit": false
    }
  },

Try adding the following configuration, but it still doesn't work:

   "trustedProxies": [
      "172.18.0.0/16"
    ],

Log Display :

Proxy headers detected from untrusted address. Connection will not be treated as local. Configure gateway.trustedProxies to restore local client detection behind your proxy.
2026-01-27T08:53:34.045Z [ws] closed before connect conn=81bd5372-d170-4b06-9a9f-235e385a625d remote=172.18.0.1 fwd=180.173.122.134 origin=https://bot.systemcaller.online host= bot.systemcaller.online ua=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36 Edg/144.0.0.0 code=1008 reason=pairing required     


### @systemcaller (2026-01-27)

I've solved the problem, you should try this too
Add this to your profile, reboot and the connection is successful.

```
"controlUi": {
  "allowInsecureAuth": true
}
```

<img width="983" height="394" alt="Image" src="https://github.com/user-attachments/assets/cf5b0c46-1b25-4ed4-89c0-1e9d36bd6ed6" />


## Links

- None detected yet
