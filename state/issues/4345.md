---
number: 4345
title: "[Bug]: Model generates tool_use without input field for optional-args tools — causes permanent session corruption"
author: dan3093
created: 2026-01-30T03:48:57Z
updated: 2026-01-30T03:48:57Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4345
duplicate_of: null
related_issues: [4277,4281]
blocks: []
blocked_by: []
---

## Description

## Bug: Model generates tool_use without `input` field for optional-args tools — causes permanent session corruption

### Summary
When the model calls a tool that has only optional parameters (like `session_status`), it sometimes generates a `tool_use` block **without the `input` field entirely**. The API requires `input` to be present (even if empty `{}`), so subsequent requests fail with:

```
messages.X.content.Y.tool_use.input: Field required
```

Unlike mid-stream termination bugs (#4277, #4281), this happens on **successful generation** — `stopReason: "toolUse"`, not `"error"`. The model simply produces invalid output.

### Reproduction

1. Have a conversation that leads to calling `session_status` (or another optional-args tool)
2. Model generates:
   ```json
   {"type":"toolCall","id":"toolu_vrtx_xxx","name":"session_status"}
   ```
   Note: **no `arguments` or `input` field**
3. This gets saved to session transcript
4. Next API call replays history → 400 error
5. Session is permanently stuck until `/new` or `/reset`

### Evidence from Session Transcript

```json
{
  "type": "message",
  "id": "1b8e744f",
  "message": {
    "role": "assistant",
    "content": [
      {"type": "text", "text": ""},
      {"type": "thinking", "thinking": "..."},
      {"type": "toolCall", "id": "toolu_vrtx_01DKmDeWmZY4TTtBUa4MF3pp", "name": "session_status"},
      {"type": "toolCall", "id": "toolu_vrtx_01E9ZERmv6MdspKnRB41QfN6", "name": "sessions_list", "arguments": {"limit": 10, "messageLimit": 1}},
      {"type": "text", "text": ""}
    ],
    "stopReason": "toolUse"
  }
}
```

Note the first tool call has no `arguments`, while the second does. Both were generated in the same response.

### Subsequent Error

```json
{
  "stopReason": "error",
  "errorMessage": "Cloud Code Assist API error (400): {\"type\":\"error\",\"error\":{\"type\":\"invalid_request_error\",\"message\":\"messages.9.content.1.tool_use.input: Field required\"}}"
}
```

Every retry hits the same error because the malformed tool call is in the session history.

### Root Cause

1. Model generates tool call without `input`/`arguments` for tools with all-optional params
2. Clawdbot saves this verbatim to session transcript
3. When building API request, the missing field isn't injected
4. Anthropic API rejects: `tool_use.input: Field required`

### Proposed Fix

In the request builder or transcript sanitizer, normalize tool calls:

```javascript
// Before sending to API
if (toolCall.type === 'tool_use' && toolCall.input === undefined) {
  toolCall.input = {};
}
```

Or in transcript repair:
```javascript
// Detect and fix malformed tool_use blocks
for (const block of message.content) {
  if (block.type === 'toolCall' && !('arguments' in block)) {
    block.arguments = {};
  }
}
```

### Why Existing Fixes Don't Catch This

- #4277/#4281 fixes target `stopReason: "error"` — this has `stopReason: "toolUse"`
- The tool call is syntactically valid JSON, just missing a required field
- No stream interruption occurred — model completed successfully

### Environment

- Clawdbot: 2026.1.24 (npm)
- Provider: google-antigravity 
- Model: claude-opus-4-5-thinking
- Tool: `session_status` (all optional params)
- OS: macOS

### Workaround

`/new` or `/reset` to clear session and start fresh. But this loses conversation context.

## Comments


## Links

- None detected yet
