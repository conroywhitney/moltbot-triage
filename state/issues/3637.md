---
number: 3637
title: "[Bug] clawdhub CLI: HTTP/2 + undici fails to decompress API responses"
author: Paul-Simpson
created: 2026-01-28T23:46:29Z
updated: 2026-01-28T23:46:29Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/3637
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

The `clawdhub` CLI fails with JSON parse errors when making API requests because responses are not being decompressed.

## Error

```
âœ– Unexpected token '',"..."... is not valid JSON
```

The response body contains compressed binary data instead of JSON.

## Root Cause

In `http.js`, the CLI sets up undici with HTTP/2 enabled:

```js
setGlobalDispatcher(new Agent({
  allowH2: true,
  connect: { timeout: REQUEST_TIMEOUT_MS },
}));
```

When the server responds with compressed content over HTTP/2, undici is not automatically decompressing it.

## Reproduction

```js
import { Agent, setGlobalDispatcher } from 'undici';
setGlobalDispatcher(new Agent({ allowH2: true, connect: { timeout: 15000 } }));

const response = await fetch('https://clawdhub.com/api/v1/skills/self-improving-agent');
const text = await response.text();
// text contains binary garbage instead of JSON
```

## Workaround

Setting `allowH2: false` fixes the issue:

```js
setGlobalDispatcher(new Agent({ allowH2: false, ... }));
```

## Fix Options

1. Disable HTTP/2 in the CLI (`allowH2: false`)
2. Add explicit `Accept-Encoding: identity` header to disable compression
3. Upgrade undici if this is a known bug in the current version

## Environment

- clawdhub CLI: 0.3.0
- Node.js: 25.2.1
- OS: macOS (arm64)

## Comments


## Links

- None detected yet
