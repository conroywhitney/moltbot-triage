---
number: 4652
title: "gateway authentication interruption"
author: frankentini
created: 2026-01-30T13:32:00Z
updated: 2026-01-30T13:32:00Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4652
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

CLAWBOT INCIDENT REPORT + SELF-HEALING INSTRUCTIONS

INCIDENT SUMMARY
A gateway authentication interruption occurred while a tool call was in progress. The dashboard temporarily lost its gateway token and reconnected mid-execution.

During the reconnect, a tool_result message was persisted to the session history without its corresponding tool_use message. This created an orphaned tool result and permanently corrupted the session transcript.

As a result, all subsequent LLM requests for that session were rejected by the provider with the error:

"unexpected tool_use_id found in tool_result blocks
Each tool_result block must have a corresponding tool_use block"

The failure was session-scoped, persisted across reconnects, and was not recoverable without starting a new session.

ROOT CAUSE
Tool calls were not persisted atomically. A partial tool execution state (tool_result without tool_use) was committed during a gateway reconnect or authentication refresh.

REQUIRED BEHAVIORAL FIXES

1. DETECTION (MANDATORY)
If an LLM request fails with any error indicating:
- orphaned tool_result
- missing or unexpected tool_use_id
- tool_result without a matching tool_use

Treat the current session as irrecoverably corrupted.

This error class is NOT transient and MUST NOT be retried in the same session.

2. AUTOMATIC SELF-HEALING (MANDATORY)
On detecting this condition:

- Immediately mark the current session as invalid
- Create a new session with a fresh session key
- Retry the userâ€™s request in the new session
- Notify the user that the previous session was reset due to tool-call desynchronization

Do NOT retry, patch, or continue in the corrupted session.

3. ATOMIC TOOL PERSISTENCE (CRITICAL PREVENTION RULE)
Tool calls must be persisted atomically.

- Never persist a tool_result unless its corresponding tool_use has already been successfully committed
- If either write fails, persist neither
- Partial tool state must never be replayed into an existing session

4. RECONNECT SAFETY RULE (STRONGLY RECOMMENDED)
On gateway reconnect, authentication refresh, or websocket reattachment:

- Discard all in-flight tool executions
- Do not replay or recover partial tool calls
- Resume only from a clean message boundary

EXECUTIVE SUMMARY
A gateway reconnect during an active tool call caused a tool_result to be recorded without its matching tool_use, permanently corrupting the session. The correct response is to detect this error as non-recoverable, automatically reset the session, retry in a new session, and enforce atomic persistence of tool calls to prevent recurrence.

## Comments


## Links

- None detected yet
