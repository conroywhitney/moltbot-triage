---
number: 3231
title: "Feature: Track rate-limit cooldowns per model+profile, not just per profile"
author: oabdelmaksoud
created: 2026-01-28T08:45:27Z
updated: 2026-01-28T15:09:25Z
labels: ["enhancement"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/3231
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Problem

Currently, when a model (e.g., `gemini-2.5-flash`) hits a rate limit on a profile (e.g., `google-antigravity:om.abdelmaksoud@gmail.com`), the **entire profile** goes into cooldown. This means all other models on that same profile (`gemini-2.5-pro`, `gemini-2.0-flash`, etc.) are also blocked—even though they have **separate rate limits** on the provider side.

## Current Behavior

- Cooldown is tracked at `profileId` level in `auth-profiles.json` → `usageStats[profileId].cooldownUntil`
- When `gemini-2.5-flash` rate-limits on account A, the failover skips **all models** on account A

## Expected Behavior

- Cooldown should be tracked at `profileId:modelId` granularity
- Example: `usageStats["google-antigravity:om@gmail.com"].cooldownByModel["gemini-2.5-flash"] = 1706412345678`
- When `gemini-2.5-flash` rate-limits on account A, `gemini-2.5-pro` on account A should still be available

## Why This Matters

Most providers (Google, OpenAI, Anthropic) have **per-model rate limits**, not per-account. A user with:
- 2 Google accounts
- 5 models in fallback chain

...currently has poor failover because one model's rate limit blocks the entire account.

## Suggested Implementation

1. Change `usageStats` structure to include `cooldownByModel: Record<string, number>`
2. Update `isProfileInCooldown()` to accept an optional `modelId` parameter
3. Update failover logic to check model-specific cooldowns first

## Workarounds Attempted

- Set explicit profile rotation order (helps spread load, but doesn't fix the core issue)
- Multiple accounts (helps, but still affected when one model rate-limits)

## Environment

- Clawdbot 2026.1.24-3
- Multiple Google Antigravity + Gemini CLI profiles

## Comments


## Links

- None detected yet
