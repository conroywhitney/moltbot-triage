---
number: 1913
title: "Feature request: gateway:shutdown hook event"
author: andrewchen
created: 2026-01-25T19:10:47Z
updated: 2026-01-28T15:46:24Z
labels: ["enhancement"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/1913
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

Add a `gateway:shutdown` hook event that fires when the gateway is about to shut down (catching SIGTERM/SIGINT), allowing users to run cleanup logic or send notifications before the process exits.

## Use Case

I want to notify myself (via WhatsApp/Telegram/etc.) when my Clawdbot instance goes offline. Currently there's `gateway:startup` but no corresponding shutdown event.

**Workaround**: Using a heartbeat check to detect "back online" after being offline, but a proactive "going offline" notification would be more helpful.

## Proposed Solution

1. Add `gateway:shutdown` event to the hooks system
2. Fire it when the gateway receives SIGTERM/SIGINT
3. Allow a short grace period (e.g., 5 seconds) for hooks to complete before exit

## Example Hook

```typescript
const shutdownHandler: HookHandler = async (event) => {
  if (event.type !== 'gateway' || event.action !== 'shutdown') return;
  
  // Send notification before going offline
  await sendMessage('Going offline! ðŸ”´');
};
```

Thanks! ðŸ™

## Comments

### @fmangot (2026-01-28)

## Additional Use Case: Pre-shutdown State Checkpoint

+1 for this feature. Beyond notifications, `gateway:shutdown` would enable **saving session state before shutdown/restart**.

### The Problem

When the gateway restarts (config change, update, SIGUSR1), any in-flight context or "working memory" that hasn't been persisted can be lost or become stale. We noticed context dropping from 111k â†’ 58k after a config-triggered restart â€” the session reloaded but context recalculation changed.

### Proposed Solution Extension

A `gateway:beforeShutdown` or `gateway:shutdown` hook could trigger:

```typescript
const checkpointHandler: HookHandler = async (event) => {
  if (event.type !== 'gateway' || event.action !== 'shutdown') return;
  
  // Spawn a lightweight agent to checkpoint state
  await spawnCheckpointServant({
    topics: getCurrentTopics(),
    decisions: getRecentDecisions(),
    context: getKeyContext()
  });
  
  // Write to memory/context-checkpoints/
  event.messages.push('ðŸ“¸ State checkpointed before shutdown');
};
```

### Why This Matters

For users building "context-lean" architectures with sub-agents, pre-shutdown checkpoints ensure continuity across restarts. The hook system already has the infrastructure â€” just needs the event.

**Grace period note:** 5 seconds may be tight for spawning a checkpoint agent. Consider making the grace period configurable or allowing hooks to signal "I need more time" (with a hard cap).


## Links

- None detected yet
