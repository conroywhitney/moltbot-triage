---
number: 5430
title: "üêõ Session Corruption Bug: Terminated Tool Calls Break All Subsequent Requests"
author: LeLe1110
created: 2026-01-31T13:43:19Z
updated: 2026-02-02T00:19:07Z
labels: ["bug"]
assignees: []
comments_count: 2
reactions_total: 2
url: https://github.com/openclaw/openclaw/issues/5430
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

# üêõ Session Corruption Bug: Terminated Tool Calls Break All Subsequent Requests

## Summary
When a tool call is abnormally terminated (e.g., process killed, timeout), it leaves a corrupted record in the session history file (`.jsonl`). This corrupted record causes **ALL subsequent API requests to fail** with error code 2013, completely breaking chat functionality for that session.

## Severity
**Critical** - Renders the entire chat session unusable. User sees only truncated responses (e.g., single letter "A") with no error indication in the UI.

## Steps to Reproduce
1. Start a chat session that triggers a tool call
2. Forcefully terminate the process during tool execution (e.g., `pkill -9 openclaw-gateway`)
3. Restart the gateway service
4. Try sending any new message in the same session

## Expected Behavior
- The system should gracefully handle incomplete tool calls
- Corrupted session data should be auto-repaired or isolated
- Error messages should be clearly displayed to the user

## Actual Behavior
- Every API request fails with: `invalid params, tool result's tool id(call_function_w2bitop211ji_1) not found (2013)`
- UI shows only first character of error ("A") instead of actual response
- Session becomes permanently broken until manual cleanup

## Error Details

### From session file (`.jsonl`):
```json
{
  "type": "message",
  "id": "29c9121d",
  "message": {
    "role": "assistant",
    "content": [
      {
        "type": "toolCall",
        "id": "call_function_w2bitop211ji_1",
        "name": "write",
        "arguments": {
          "path": "/Users/macmini_no1/clawd/HEARTBEAT.md",
          "content": "# Heartbeat.md\n\nKeep this file empty (or with only comments) to skip heartbeat API calls.\nAdd"
        },
        "partialJson": "{\"path\": \"/Users/macmini_no1/clawd/HEARTBEAT.md\", \"content\": \"# Heartbeat.md\\n\\nKeep this file empty (or with only comments) to skip heartbeat API calls.\\nAdd"
      }
    ],
    "stopReason": "error",
    "errorMessage": "terminated"
  }
}
```

### From gateway logs:
```
[feishu] deliver called: text=LLM request rejected: invalid params, tool result's tool id(call_function_w2bitop211ji_1) not found
```

### From API response:
```json
{
  "type": "error",
  "error": {
    "type": "invalid_request_error",
    "message": "invalid params, tool result's tool id(call_function_w2bitop211ji_1) not found (2013)"
  }
}
```

## Impact
- **User Experience**: Completely broken chat with no clear error indication
- **Data Loss**: Users may lose entire conversation history when forced to delete session file
- **Debugging**: Extremely difficult to diagnose without examining session `.jsonl` files

## Environment
- **OpenClaw Version**: 2026.1.29
- **Provider**: MiniMax (api.minimax.io/anthropic)
- **Model**: MiniMax-M2.1
- **OS**: macOS Darwin 25.2.0
- **Session File**: `~/.openclaw/agents/main/sessions/*.jsonl`

## Current Workaround
```bash
# 1. Backup the corrupted session file
cd ~/.openclaw/agents/main/sessions
mv <session-id>.jsonl <session-id>.jsonl.backup

# 2. Restart gateway
pkill -9 openclaw-gateway
openclaw-gateway &

# 3. System creates new clean session (loses conversation history)
```

## Suggested Fixes

### 1. **Session Validation on Load** (Recommended)
- Validate session `.jsonl` file on startup
- Remove or quarantine corrupted entries
- Log warning about data corruption

### 2. **Tool Call Cleanup**
- Detect incomplete tool calls in conversation history
- Remove orphaned tool_use blocks before sending to API
- Add timeout handling for tool execution

### 3. **Error Handling Improvements**
- Catch error 2013 specifically and trigger session repair
- Display meaningful error in UI instead of truncated "A"
- Provide user option to reset session from UI

### 4. **Session Health Check**
- Add periodic validation of active sessions
- Auto-repair or flag corrupted sessions
- Implement session recovery mechanism

## Related Files
- Session history: `~/.openclaw/agents/main/sessions/*.jsonl`
- Session state: `~/.openclaw/agents/main/sessions/sessions.json`
- Gateway logs: `~/.openclaw/logs/gateway.log`

## Additional Context
This bug was discovered after:
1. User reported "chat‰∏çÂìçÂ∫î" (chat not responding)
2. Git diff showed last operation was terminated write tool call
3. Analysis of session file revealed corrupted tool call record
4. Every subsequent message failed with error 2013
5. Only fix was to delete session file and restart

The UI displaying only "A" (first character) instead of the full error message made this extremely difficult to diagnose.

---

**Reproduction Rate**: 100% when tool call is terminated abnormally
**Priority**: High - Breaks core functionality with no user-facing error handling

## Comments

### @sebslight (2026-02-01)

OpenClaw Maintainer Triage // Issue Closure

Hi ‚Äî this is a joint maintainer effort to keep the repo moving. We‚Äôre currently seeing ~30 new issues per hour, and we can‚Äôt review every future request without slowing down critical stabilization work. This issue is unlikely to be considered in the near term, so we‚Äôre closing it to keep the pipeline moving while we focus on stability.

We‚Äôre very sorry this is happening, but we won‚Äôt be able to look at the comments on this issue.

Want to make your request stand out? Submit a PR and report to #pr-thunderdome-dangerzone on Discord ‚Äî READ THE TOPIC. Give us a clear briefing: what it fixes, who it helps, and why it‚Äôs worth shipping.

Thanks for understanding and for contributing.

![](https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExeXFramtnZWo1ZWM4YmYzcG1zcXE1NWV1eTl3MDZodnk4aWhvM2tqbCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/RWUqVYucDBD4A/giphy.gif)


### @henryjrobinson (2026-02-01)

Related fix submitted: #5738 ‚Äî adds detection and removal of orphaned toolResult messages after history truncation. This addresses the root cause where truncated history leaves tool results without matching tool calls, causing API rejection.

cc @henryjrobinson


## Links

- None detected yet
