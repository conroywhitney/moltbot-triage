---
number: 4099
title: "Session unexpectedly reset mid-conversation when heartbeat arrives during exec notification"
author: jayclawson
created: 2026-01-29T17:34:35Z
updated: 2026-01-31T02:33:59Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4099
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary
During an active Telegram conversation, a new session was spawned instead of continuing the existing one. This caused loss of conversation context including images that had been shared.

## Environment
- Clawdbot/Moltbot version: 2026.1.24-3
- Platform: Windows 11
- Channel: Telegram

## Steps to Reproduce
1. Have an active conversation with images and tool usage
2. Run an exec command that takes time or fails
3. Have a heartbeat poll arrive at nearly the same moment as an exec system notification

## What Happened
At 9:17 AM PST, during an active conversation:
1. User asked about images that had been discussed
2. A system exec notification arrived (`Exec failed (clear-br, code 1)`)
3. A heartbeat poll arrived immediately after
4. The assistant responded "conversation history got truncated"
5. A **new session** was created instead of continuing the existing session

The user's subsequent messages went to the new session, which had no context from the previous ~45 minutes of conversation (including image analysis, Google login flow, image generation research, etc).

## Evidence from Transcripts

**Old session** (`c71327eb-861b-4cad-a277-6fdc801da364.jsonl`):
- 1.6 MB, last updated 9:17:10 AM
- Contains full conversation including image generation research, Google AI Studio login, etc.
- Final messages show assistant saying "conversation history got truncated"

**New session** (`e44c7689-909d-4370-a310-6fbb41a7b35c.jsonl`):
- 227 KB, started fresh at 9:17 AM
- User messages about earlier conversation went here with no context

## Expected Behavior
The heartbeat should not cause a new session to be created when there's already an active conversation. The existing session should continue, or at minimum, context should be preserved/migrated.

## Impact
- Lost ~45 minutes of conversation context
- Images shared by user are no longer accessible
- User had to explain what they were talking about
- Trust in conversation continuity is affected

## Possible Causes
- Race condition between exec notification and heartbeat poll
- Session routing logic incorrectly deciding to create new session
- Context size threshold being hit at an inopportune moment

## Suggested Fix
- Ensure heartbeat polls don't create new sessions when one is already active
- Add session continuity protection during system notifications
- Consider logging session creation decisions for debugging

## Comments


## Links

- None detected yet
