---
number: 3009
title: "Media attachments not downloaded before agent processing - ENOENT errors on Matrix and Discord"
author: pmac25
created: 2026-01-27T22:25:03Z
updated: 2026-01-28T05:55:56Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 2
url: https://github.com/moltbot/moltbot/issues/3009
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

When images are sent via Matrix or Discord channels, the agent receives only the filename/attachment ID instead of the actual downloaded file path. This causes ENOENT errors when the agent's image tool tries
   to open the file.

  Clawdbot version: 2026.1.24-3

  Affected channels: Matrix, Discord (likely others too)

  Error logs:

  Matrix:
  [tools] image failed: ENOENT: no such file or directory, open 'image.png'

  Discord:
  [tools] image failed: ENOENT: no such file or directory, open '1465832431897809214'

  Expected behavior

  The channel plugin should:
  1. Download the media attachment (from mxc:// URL for Matrix, CDN URL for Discord)
  2. Save it to a temp file in the workspace (e.g., media/inbound/)
  3. Pass the full file path to the agent

  Actual behavior

  The channel plugin passes only the identifier (filename for Matrix, attachment ID for Discord) without downloading the actual file. The agent then fails with ENOENT when trying to read the non-existent file.

  Configuration

  {
    "agents": {
      "defaults": {
        "model": { "primary": "anthropic/claude-sonnet-4-20250514" },
        "imageModel": { "primary": "anthropic/claude-sonnet-4-20250514" }
      }
    },
    "tools": {
      "media": {
        "image": {
          "enabled": true,
          "maxBytes": 20971520,
          "attachments": { "mode": "all", "maxAttachments": 10 }
        }
      }
    },
    "channels": {
      "matrix": { "enabled": true, "mediaMaxMb": 20 },
      "discord": { "enabled": true, "mediaMaxMb": 20 }
    }
  }

  Steps to reproduce

  1. Configure Matrix or Discord channel
  2. Send an image to the bot via that channel
  3. Observe ENOENT error in logs
  4. Bot responds saying it can't access the image

  Additional context

  - The media/inbound/ directory exists in workspace with proper permissions
  - Matrix uses authenticated media endpoints (Matrix 1.11+)
  - The E2EE media fix in v2026.1.24 doesn't seem to apply to non-E2EE rooms
  - Primary model (Claude Sonnet 4) supports native vision, so "skip image understanding when model supports vision" logic may be relevant

## Comments


## Links

- None detected yet
