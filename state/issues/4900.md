---
number: 4900
title: "[Bug]: Context overflow error messages delivered to Telegram while actual reply is lost"
author: jayclawson
created: 2026-01-30T20:44:15Z
updated: 2026-01-31T02:25:58Z
labels: ["bug"]
assignees: []
comments_count: 2
reactions_total: 2
url: https://github.com/openclaw/openclaw/issues/4900
duplicate_of: null
related_issues: [1627,3154,4409]
blocks: []
blocked_by: []
---

## Description

## Summary
Context overflow triggers error messages that get delivered to Telegram, but the actual agent reply (which shows up in webchat) never reaches Telegram.

## Environment
- Clawdbot version: 2026.1.24-3 (885167d)
- OS: Windows 10
- Channel: Telegram (bot)

## Steps to Reproduce
1. Have an active session with moderate context (~30-40%)
2. Send a message that triggers tool calls (e.g., checking cron jobs, reading files)
3. Observe that the reply appears in webchat but NOT in Telegram
4. Telegram receives raw error messages instead: "Context overflow: prompt too large for the model"

## Expected Behavior
- Auto-compaction should trigger (per #1627)
- If recovery fails, a graceful error should appear
- Error messages should not bypass the normal channel delivery path
- If reply succeeds (visible in webchat), it should also reach Telegram

## Actual Behavior
- Reply is generated and visible in webchat ✅
- Reply never delivered to Telegram ❌
- Raw error messages (2x) delivered to Telegram ❌
- Context was only at ~29% (58k/200k), not near limit
- No compaction occurred (0 compactions in session)

## Key Questions
1. Why is "context overflow" triggered at 29% context?
2. Why do error messages reach Telegram but the actual reply doesn't?
3. Is there a race condition in the retry/recovery path?

## Related Issues
- #1627 - auto-compact on context overflow (supposed to handle this)
- #3154 - Context overflow no auto-recovery
- #4409 - Telegram empty message handling

## Comments

### @jayclawson (2026-01-30)

## Update: Bug Reproduced

Successfully reproduced this bug intentionally:

**Test conditions:**
- Context at 56% (112k/200k) - still well under limit
- Sent message from Telegram: "how did your overnight activities go?"
- Agent performed 3 tool calls (cron list, file read, stock quote)
- Generated substantial reply

**Result:**
- Telegram received: 2x "Context overflow: prompt too large for the model" error messages
- Telegram did NOT receive: the actual agent reply
- Webchat shows: the full agent reply (correctly)

**Key observation:**
The "context overflow" error is NOT related to total session context (which was only 56%). Something else is triggering this - possibly the size of the individual request payload (message + tool results), or a race condition in the retry path.

The bug appears to be:
1. Some operation triggers a "context overflow" error
2. Error messages get delivered to Telegram via a different path
3. The actual successful reply (visible in webchat) never reaches Telegram
4. No compaction is triggered despite the error

### @jayclawson (2026-01-30)

## Update: Extended Testing - Bug is Intermittent

Conducted more extensive testing to characterize the failure rate.

### Test Results

| Time | Context | Tool Calls | Result |
|------|---------|------------|--------|
| 12:20 PM | 29% | 3 (cron, file, stock) | ❌ FAILED - errors to Telegram |
| 12:53 PM | 56% | 3 (cron, file, stock) | ❌ FAILED - errors to Telegram |
| 1:07 PM | 69% | 3 (cron, file, stock) | ✅ Worked |
| 1:08 PM | 70% | 1 (email poll) | ✅ Worked |
| 1:08 PM | 70% | 1 (stock quote) | ✅ Worked |
| 1:09 PM | 72% | 3 (stock, cron, session) | ✅ Worked |
| 1:10 PM | 75% | 1 (large file read) | ✅ Worked |

### Also Confirmed
- **Non-tool messages always work** - Simple text replies (no tool calls) delivered to Telegram 100% of the time
- **Bug is tool-call specific** - Only occurs when agent performs tool calls

### Key Finding
**Failure rate: ~30% (2/7) for tool-heavy requests**

The bug is intermittent, not deterministic. This suggests:
1. A race condition in the request/response pipeline
2. Timing-sensitive behavior (possibly related to parallel processing)
3. NOT related to total context size (failed at 29%, succeeded at 75%)

### Pattern
When the bug triggers:
- Error messages ("Context overflow: prompt too large") get delivered to Telegram
- The actual agent reply does NOT get delivered to Telegram
- The actual reply IS visible in webchat
- No compaction occurs despite the "overflow" error

The error path and success path appear to be different code paths, and only the error path is reaching Telegram in failure cases.


## Links

- None detected yet
