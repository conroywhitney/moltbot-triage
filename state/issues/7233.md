---
number: 7233
title: "üî¥ BUG: Telegram DM Topics ‚Äî message tool & subagent sends land in General Topic (threadId not auto-injected)"
author: Lukavyi
created: 2026-02-02T15:48:05Z
updated: 2026-02-02T15:48:05Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7233
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

# üî¥ BUG: Telegram DM Topics ‚Äî message tool & subagent sends land in General Topic (threadId not auto-injected)

## Severity
**Critical / P0** ‚Äî breaks Telegram ‚ÄúDM topics‚Äù (forum topics) routing. Any tool-sent media/buttons (and some agent/subagent followups) land in **General Topic** instead of the **active topic**, causing confusing and incorrect UX.

## What‚Äôs broken
When chatting with OpenClaw in Telegram where the conversation is inside a **topic** (forum topic / message_thread_id), any message sent via the **`message` tool** (especially media + inline buttons) is delivered into **General Topic** rather than the user‚Äôs current topic.

### Repro (generic)
1. Open a Telegram chat that supports topics.
2. Enter a non-General topic.
3. Prompt the agent to send a message via the `message` tool that includes media/buttons.
4. Observe the message lands in General Topic.

## Root cause
Slack has explicit auto-threading injection:
- `src/infra/outbound/message-action-runner.ts` uses `resolveSlackAutoThreadId(...)` when `threadId` is not provided.

Telegram has **no equivalent auto-threadId injection**.
- Telegram session context stores the topic id as `MessageThreadId`.
- However `To` / `OriginatingTo` are stored as `telegram:<chatId>` **without** any `:topic:<id>` suffix.
- The `message` tool‚Äôs Telegram action handler (`src/channels/plugins/actions/telegram.ts`) expects `params.threadId` to be set to route messages into a topic.
- Since agents typically don‚Äôt explicitly pass `threadId`, tool sends default to the General Topic.

## Expected behavior
When the active Telegram context includes a topic (`MessageThreadId`), tool sends should automatically inherit that topic unless the agent explicitly overrides it.

## Fix approach
Mirror Slack‚Äôs pattern for Telegram:
- If `channel === "telegram"`
- and `params.threadId` is empty
- and `toolContext.currentThreadTs` is set
- and the target matches the originating chat
‚Üí auto-inject `params.threadId = toolContext.currentThreadTs`.

## Code pointers
- Slack reference: `src/infra/outbound/message-action-runner.ts` ‚Üí `resolveSlackAutoThreadId` and its usage in the `send` action path.
- Telegram send action reads threadId: `src/channels/plugins/actions/telegram.ts` ‚Üí `readTelegramSendParams()` ‚Üí `threadId` ‚Üí `messageThreadId`.
- Telegram session context does not embed topic in `To`: `src/telegram/bot-message-context.ts` sets `To: telegram:<chatId>`, topic only in `MessageThreadId`.

## Labels
- bug
- p0
- high priority
- telegram
- threading

## Comments


## Links

- None detected yet
