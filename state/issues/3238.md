---
number: 3238
title: "[Bug]: Bonjour hostname conflict loop causes thousands of mDNS re-registrations"
author: Djelibeybi
created: 2026-01-28T08:58:28Z
updated: 2026-01-28T15:07:20Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/3238
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

# Summary

The gateway's Bonjour/ciao module enters an endless hostname conflict loop, incrementing the hostname counter every few seconds indefinitely. In my case, it reached 780+ conflicts in ~5 hours before I disabled Bonjour entirely.

## Environment

- **Clawdbot version**: 2026.1.24-3
- **OS**: macOS 15 (Sequoia), Apple Silicon (M4 Pro)
- **Node.js**: v22.22.0
- **Installation**: Homebrew (`/opt/homebrew/lib/node_modules/clawdbot`)

## Steps to Reproduce

1. Install Clawdbot on macOS with default configuration
2. Start the gateway via launchd
3. Observe `gateway.err.log` ‚Äî hostname conflicts appear every 3-5 seconds

## Actual Behavior

The error log fills with messages like:

```
2026-01-28T03:24:54.272Z [bonjour] gateway hostname conflict resolved; newHostname="MyMac-(2)"
2026-01-28T03:25:12.690Z [bonjour] gateway hostname conflict resolved; newHostname="MyMac-(3)"
2026-01-28T03:25:16.096Z [bonjour] gateway hostname conflict resolved; newHostname="MyMac-(4)"
...
2026-01-28T08:46:26.309Z [bonjour] gateway hostname conflict resolved; newHostname="MyMac-(747)"
```

The counter increments indefinitely (~4000+ entries over 5 hours). Each "resolution" triggers another conflict within seconds.

## Expected Behavior

- Hostname should be registered once successfully
- If a conflict occurs, it should resolve once and stabilize
- No continuous loop of conflicts

## Root Cause Analysis

The ciao library is configured with:
```js
hostname: os.hostname().replace(/\.local$/i, "").split(".")[0].trim()
```

On macOS, this evaluates to the system's LocalHostName (e.g., `MyMac`). However, **macOS's built-in mDNSResponder already owns this hostname** for system services.

When ciao probes for the hostname, mDNSResponder responds (correctly ‚Äî it owns it), ciao sees a "conflict," increments to `(2)`, probes again, and the cycle continues. The incremented hostnames may also conflict due to mDNS caching or probing timing issues.

Verification:
```bash
$ /usr/sbin/scutil --get LocalHostName
MyMac

$ dns-sd -Q "MyMac.local" A
# Returns the Mac's IP addresses (mDNSResponder responding)
```

## Workaround

Set `CLAWDBOT_DISABLE_BONJOUR=1` in the launchd plist:

```xml
<key>CLAWDBOT_DISABLE_BONJOUR</key>
<string>1</string>
```

Then reload the service:
```bash
launchctl unload ~/Library/LaunchAgents/com.clawdbot.gateway.plist
launchctl load ~/Library/LaunchAgents/com.clawdbot.gateway.plist
```

## Suggested Fixes

1. **Don't register a custom hostname** ‚Äî Let ciao use the system's existing A/AAAA records instead of trying to claim the hostname. Remove or omit the `hostname` option from `createService()`.

2. **Use a unique hostname** ‚Äî If a custom hostname is required, use something that won't conflict with the system hostname, e.g., `clawdbot-gw-${randomSuffix}`.

3. **Detect macOS mDNSResponder** ‚Äî On macOS, skip hostname registration entirely since mDNSResponder already handles it.

4. **Add conflict loop detection** ‚Äî If more than N conflicts occur in a short period, stop trying and log a warning instead of continuing indefinitely.

## Impact

- Log file bloat (thousands of lines per hour)
- Potential mDNS network spam
- Unnecessary CPU/IO overhead
- Confusing diagnostics when investigating other issues

## Additional Context

The `CLAWDBOT_DISABLE_BONJOUR` workaround works perfectly ‚Äî after applying it, zero hostname conflict messages appear. This suggests Bonjour advertising is not critical for basic gateway operation.

---

**Reported by**: Avi Miller (@Djelibeybi)
**Written by**: DjeliClaude (Claude, via Moltbot/Clawdbot) üïØÔ∏è
**Date**: 2026-01-28

## Comments


## Links

- None detected yet
