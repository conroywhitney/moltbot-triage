---
number: 5261
title: "[Bug]: Telegram sticker cache grows unbounded on disk with no TTL or size limit"
author: coygeek
created: 2026-01-31T07:56:01Z
updated: 2026-02-02T00:19:48Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5261
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description


## Summary

**Severity:** P1/High (Score: 85/150)
**CWE:** [CWE-770](https://cwe.mitre.org/data/definitions/770.html) - Allocation of Resources Without Limits or Throttling
**OWASP:** [A05:2021](https://owasp.org/Top10/A05_2021-Security_Misconfiguration/) - Security Misconfiguration
**File:** `src/telegram/sticker-cache.ts:17-67`

The Telegram sticker cache writes every unique sticker to a JSON file on disk with no TTL or max size, causing disk exhaustion and degraded performance as the cache grows.

**Why this is P1:** Disk-based cache with unbounded growth affects system stability. JSON parsing on every read makes performance degrade with cache size.

## Triage Assessment

| Factor | Value | Score |
|--------|-------|-------|
| **Reachability** | Internal cache, grows with Telegram sticker usage | 15/40 |
| **Impact** | Disk exhaustion + performance degradation | 25/50 |
| **Exploitability** | Automatic over time | 20/30 |
| **Verification** | file:line ✓, code ✓, attack steps ✓ | 30/30 |
| **Total** | — | **85/150** |

## Steps to reproduce
1. Deploy OpenClaw with Telegram integration on a sticker-heavy channel
2. Monitor the sticker cache file size: `~/.openclaw/telegram/sticker-cache.json`
3. Observe file grows with every unique sticker seen
4. As cache grows, `searchStickers()` becomes slower (O(n) scan)
5. Eventually disk space exhausted or JSON parsing becomes prohibitively slow

## Expected behavior
Sticker cache should have a max entry count and/or TTL-based expiration.

## Actual behavior
Every unique sticker is cached permanently with no eviction policy.

### Affected code location:
**File** (`src/telegram/sticker-cache.ts:17-67`):
```typescript
// Line 17: Disk-based cache with no size limits
const CACHE_FILE = path.join(STATE_DIR, "telegram", "sticker-cache.json");

// Lines 35-46: Load without any size bounds
function loadCache(): StickerCache {
  const data = loadJsonFile(CACHE_FILE);
  // ... no max entries check, no TTL check
  return cache;
}

// Lines 63-67: Add without pruning
export function cacheSticker(sticker: CachedSticker): void {
  const cache = loadCache();
  cache.stickers[sticker.fileUniqueId] = sticker;  // No limit check
  saveCache(cache);  // Grows indefinitely
}
```

**File** (`src/telegram/sticker-cache.ts:72-114`) - O(n) search:
```typescript
export function searchStickers(query: string, limit = 10): CachedSticker[] {
  const cache = loadCache();  // Parse entire JSON on every search
  // ... O(n) iteration over all stickers
  for (const sticker of Object.values(cache.stickers)) {
    // ... scoring logic
  }
}
```

## Environment
- Version: latest (main branch)
- OS: Any
- Install method: Any

## Logs or screenshots
N/A - disk exhaustion over time

## Impact
- **Disk Space Exhaustion**: Sticker-heavy channels can generate thousands of unique stickers
- **Performance Degradation**: JSON5.parse on every read; `searchStickers()` is O(n)
- **Cascading Failures**: Disk full affects entire system, not just sticker cache
- **I/O Amplification**: Every sticker add reads and rewrites entire cache file

## Recommended fix
1. **Add max size and LRU eviction**:
```typescript
const MAX_CACHED_STICKERS = 5000;

export function cacheSticker(sticker: CachedSticker): void {
  const cache = loadCache();

  // Evict oldest entries if at capacity
  const entries = Object.entries(cache.stickers);
  if (entries.length >= MAX_CACHED_STICKERS) {
    // Sort by cachedAt timestamp, remove oldest 10%
    entries.sort((a, b) =>
      new Date(a[1].cachedAt).getTime() - new Date(b[1].cachedAt).getTime()
    );
    const toRemove = entries.slice(0, Math.floor(entries.length * 0.1));
    for (const [key] of toRemove) {
      delete cache.stickers[key];
    }
  }

  cache.stickers[sticker.fileUniqueId] = sticker;
  saveCache(cache);
}
```

## Comments

### @coygeek (2026-02-01)

## CVSS Assessment

| Metric | Value |
|--------|-------|
| **Score** | 6.2 / 10.0 |
| **Severity** | Medium |
| **Vector** | CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |

> [CVSS v3.1 Calculator](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H)



## Links

- None detected yet
