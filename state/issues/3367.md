---
number: 3367
title: "Sessions navigation fix + DM thread display + DM thread delivery regression"
author: Lukavyi
created: 2026-01-28T14:14:54Z
updated: 2026-01-28T20:49:12Z
labels: ["bug", "app: web-ui"]
assignees: []
comments_count: 0
reactions_total: 1
url: https://github.com/moltbot/moltbot/issues/3367
duplicate_of: null
related_issues: [3368]
blocks: []
blocked_by: []
---

## Description

## Problem 1: Navigation

Clicking a session link in the Sessions tab navigates to the Main session instead of the clicked session.

**Steps to reproduce:**
1. Open Sessions tab in Control UI
2. Click on any non-main session (e.g., a Telegram DM topic)
3. Expected: opens that session's chat
4. Actual: opens Main session

**Root cause:** `syncTabWithLocation()` is called before `applySettingsFromUrl()`, overwriting the URL `?session=` param with the old localStorage value.

## Problem 2: Display

Telegram DM topic sessions all appear with the same display name — impossible to distinguish between them.

## Problem 3: DM Thread Delivery (regression)

After commit 9154971 (`fix(telegram): ignore message_thread_id for non-forum group sessions`), bot replies in DM threads go to General instead of the originating thread.

**Steps to reproduce:**
1. Enable Topics in a DM with the bot (requires Telegram Premium)
2. Send a message in a DM thread/topic
3. Bot replies in General instead of the thread

**Root cause:** `resolveTelegramForumThreadId()` returns `undefined` when `is_forum` is false. Telegram Bot API never sets `is_forum=true` for private chats (only supergroups). The returned `context.resolvedThreadId` is used by `bot-message-dispatch.ts` for draft streaming, typing indicators, and reply delivery — all become `undefined` for DM threads.

## Fix

PR #3368 addresses all three issues:
1. Call `applySettingsFromUrl()` before `syncTabWithLocation()`
2. Set `ThreadLabel` for DM topic sessions
3. Introduce `effectiveThreadId = isGroup ? resolvedThreadId : messageThreadId` for correct outbound delivery

## Comments


## Links

- None detected yet
