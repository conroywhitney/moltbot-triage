---
number: 7613
title: "[Bug] Heartbeat repeatedly triggers at irregular intervals, conflicts with cron jobs"
author: zohan724
created: 2026-02-03T01:23:14Z
updated: 2026-02-03T01:52:33Z
labels: []
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7613
duplicate_of: null
related_issues: [2804,3181,7588]
blocks: []
blocked_by: []
---

## Description

## Summary

Heartbeat mechanism repeatedly triggers within short intervals (seconds to minutes) instead of respecting the configured `every` interval, even after switching to cron-based scheduling.

## Environment
- OpenClaw version: 2026.2.1 (ed4529e)
- OS: macOS (Darwin 23.2.0 arm64)
- Channels: Telegram
- Node: v25.4.0

## Expected Behavior
Heartbeats should fire according to the configured interval (initially `1h`, then `30m`).

## Actual Behavior
Heartbeat repeatedly triggered at irregular intervals:

**Timeline (2026-02-03, Asia/Taipei):**
```
08:01 → Heartbeat fired (message 2064)
08:01 → Heartbeat fired again (message 2066) ❌ Duplicate within seconds
08:53 → Heartbeat fired (52 minutes later, seems normal)
09:24 → Heartbeat fired (31 minutes later, close to expected 30m)
09:54 → Heartbeat fired (30 minutes later, correct)
10:02 → Heartbeat fired (8 minutes later) ❌ Only 8 minutes!
```

**Suspicious observation at 10:02:**
System message prefix showed `[2026-02-03 09:01:26 GMT+8] Cron: 我來執行每日推特趨勢報告` (about a different cron job), but the actual prompt received was the heartbeat prompt.

## Logs Analysis

From `openclaw.log`:
```
01:01:10 - embedded run start: heartbeat
01:01:26 - lane task done: cron (durationMs=86274)
01:01:49 - embedded run start: heartbeat ❌ Only 39 seconds later!
```

The heartbeat re-triggered immediately after a cron job completion, despite no code path that should cause this.

## Configuration History

**Initial config (caused issue):**
```json
{
  "agents": {
    "defaults": {
      "heartbeat": {
        "every": "1h",
        "activeHours": { "start": "08:00", "end": "02:00" },
        "model": "anthropic/claude-sonnet-4-5"
      }
    }
  }
}
```

**After first fix attempt:**
```json
{
  "heartbeat": { "every": "30m" }
}
```
Issue persisted (10:02 irregular trigger).

**Current workaround:**
Disabled heartbeat entirely, replaced with cron:
```json
{
  "heartbeat": { "every": null }
}
```

Cron job (isolated session):
```json
{
  "schedule": { "kind": "cron", "expr": "15,45 8-23 * * *", "tz": "Asia/Taipei" },
  "sessionTarget": "isolated",
  "wakeMode": "now",
  "payload": { "kind": "agentTurn", "message": "[heartbeat prompt]" }
}
```

## Impact
- High token usage (repeated heartbeat executions)
- User confusion (duplicate status messages)
- Unpredictable behavior

## Related Issues
- #2804 - System events trigger rapid heartbeat re-runs
- #3181 - Runaway heartbeat loop
- #7588 - Cron scheduler never fires jobs

## Reproduction
1. Configure heartbeat with `every: "1h"` and multiple cron jobs scheduled at the same time (e.g., 08:00)
2. Wait for both to fire
3. Observe heartbeat triggering multiple times within minutes

## Questions
1. Should cron job completions trigger heartbeat re-evaluation?
2. Is there a race condition between heartbeat timer and cron execution?
3. Why does the system message show a cron job name but inject the heartbeat prompt?

## Additional Context
- All 4 cron jobs use `sessionTarget: "isolated"` and `wakeMode: "now"`
- The user manually tested heartbeat execution multiple times to diagnose, which may have contributed to additional triggers

## Comments

### @zohan724 (2026-02-03)

## Update: Issue Persists Even After Disabling Heartbeat

**New Finding (2026-02-03 09:50 GMT+8):**

Even after completely disabling the built-in heartbeat mechanism (`heartbeat.every: null`), the system continues to inject heartbeat prompts into the main session when exec commands fail.

**Evidence:**

```
09:41 - System: Exec failed (nimble-o, signal SIGKILL)
       → Heartbeat prompt injected
       → Heartbeat report sent

09:46 - System: Exec failed (nimble-w, signal SIGKILL)
       → Heartbeat prompt injected
       → Heartbeat report sent
```

**Configuration at time of issue:**

```json
{
  "agents": {
    "defaults": {
      "heartbeat": {
        "every": null,  // ← Heartbeat DISABLED
        "activeHours": { "start": "08:00", "end": "02:00" },
        "model": "anthropic/claude-sonnet-4-5",
        "target": "telegram",
        "prompt": "[heartbeat prompt]"
      }
    }
  }
}
```

**What triggered the exec failures:**

Moltbook API operations (posting, commenting) that exceeded timeout and were killed by SIGKILL.

**Critical Issue:**

The system appears to have a code path that injects heartbeat prompts on exec failures **regardless of whether heartbeat is enabled or disabled**. This means:

1. Disabling heartbeat does NOT prevent heartbeat triggers
2. Any failed exec operation can trigger a heartbeat
3. The workaround (switching to cron) is ineffective if the main session still receives heartbeat prompts from exec failures

**Impact:**

- Unpredictable heartbeat execution
- Token usage cannot be controlled by configuration
- Agent operations that involve exec (common use case) will inevitably trigger heartbeats

**Request:**

Please investigate the exec failure → heartbeat prompt injection code path and add a check to respect the `heartbeat.every: null` configuration.

**Related code locations to check:**

Based on #2804 comments:
- `bash-tools.exec.js` - Lines ~153, ~171 (`requestHeartbeatNow({ reason: "exec:..." })`)
- `heartbeat-runner.js` - May need additional guards to skip when `every: null`



## Links

- None detected yet
