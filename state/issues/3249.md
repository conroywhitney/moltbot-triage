---
number: 3249
title: "Plugin hooks register but never fire"
author: FahedSamaya
created: 2026-01-28T09:25:02Z
updated: 2026-01-28T15:08:07Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/3249
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

# Bug Report: Plugin hooks registered but never fire

## Environment
- Clawdbot version: 2026.1.24-3
- OS: Arch Linux (kernel 6.18.7-2-cachyos)
- Node: v22.22.0

## Description
Plugin hooks are registered successfully (logs confirm "hook runner initialized with 2 registered hooks"), but the hooks never actually fire when messages arrive.

## Steps to Reproduce

1. Create a simple plugin at `~/.clawdbot/extensions/whisper-stt/index.ts`:

```typescript
export default function register(api: any) {
  console.log('[whisper-stt] Plugin loaded');

  api.registerHook('message_received', async (event: any) => {
    console.log('[whisper-stt] MESSAGE_RECEIVED FIRED');
    api.logger.info('[whisper-stt] message_received triggered');
  }, { name: 'whisper-stt-message', description: 'Test hook' });

  api.registerHook('before_agent_start', async (event: any) => {
    console.log('[whisper-stt] BEFORE_AGENT_START FIRED');
    api.logger.info('[whisper-stt] before_agent_start triggered');
    return {};
  }, { name: 'whisper-stt-agent', description: 'Test hook' });

  console.log('[whisper-stt] Hooks registered');
}
```

2. Create `clawdbot.plugin.json`:
```json
{
  "id": "whisper-stt",
  "name": "Test Plugin",
  "version": "1.0.0"
}
```

3. Restart gateway: `clawdbot gateway restart`

4. Send a message via Telegram (or any channel)

## Expected Behavior
- Logs should show "MESSAGE_RECEIVED FIRED" or "BEFORE_AGENT_START FIRED"
- Hook handler should execute

## Actual Behavior
- Logs show plugin loaded and hooks registered:
  ```
  [whisper-stt] Plugin loaded
  [whisper-stt] Hooks registered
  [plugins] hook runner initialized with 2 registered hooks
  ```
- But hooks NEVER fire when messages arrive
- No error messages in logs

## Investigation

Looking at the code:
- `dispatch-from-config.js` line 104-119 checks `hookRunner?.hasHooks("message_received")` and calls `runMessageReceived`
- The hookRunner IS initialized (logs confirm it)
- Hooks ARE in `registry.typedHooks` (count shows 2)

Possible issues:
1. `hasHooks()` might be checking wrong property
2. `typedHooks` might store hookName differently than expected
3. Timing issue - hooks registered after runner initialization?

## Workaround
Manual transcription works, just not automatic via hooks.

## Additional Context
- Telegram channel is working (messages arrive, agent responds)
- Other plugins (telegram, memory-core) work fine
- Only custom plugin hooks don't fire

## Comments


## Links

- None detected yet
