---
number: 4165
title: "[Bug]: google-antigravity model fails due to outdated @mariozechner/pi-agent-core version"
author: PlayerNeo
created: 2026-01-29T19:56:06Z
updated: 2026-01-30T14:08:59Z
labels: ["bug"]
assignees: []
comments_count: 6
reactions_total: 2
url: https://github.com/openclaw/openclaw/issues/4165
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

Please upgrade @mariozechner/pi-agent-core to the latest version. The latest release includes a fix for this issue.

## Comments

### @troggieboi-cmyk (2026-01-29)

how do i do this?



### @Jarmck-Cai (2026-01-29)

You can ask Clawdbot to do this. But I am unsure if upgrading pi-ai would induce compatibility issue.

### @ammartaha (2026-01-29)

> how do i do this?

that message to the developer of bot to upgrade its code so it support the new pi and fix antigravity 

### @2jungg (2026-01-29)

I updated @mariozechner/pi-agent-core, got same error.
Is there any other solution?

### @null-runner (2026-01-30)

Investigated this. The fix isn't just bumping @mariozechner/pi-agent-core — version 0.50.3 has a breaking change: discoverAuthStorage and
   discoverModels were removed and replaced with AuthStorage (class) and ModelRegistry (class).                                            
                                                                                                                                           
  4 files need updating:                                                                                                                   
  1. src/media-understanding/providers/image.ts (L3, L15-16)                                                                               
  2. src/commands/models/list.registry.ts (L2, L44-45)                                                                                     
  3. src/agents/model-catalog.ts (L67-68)                                                                                                  
  4. src/agents/context.ts (L13, L17-18)                                                                                                   
                                                                                                                                           
  Migration: discoverAuthStorage(agentDir) → new AuthStorage(), discoverModels(authStorage, agentDir) → new ModelRegistry(authStorage).    
                                                                                                                                           
  Confirmed the bump alone causes SyntaxError: does not provide an export named 'discoverAuthStorage' without these code changes.

### @null-runner (2026-01-30)

## Fix: Antigravity "no longer supported" Error

Two separate issues cause this:

### 1. pi-* packages 0.49.3 → 0.50.3 migration
`discoverAuthStorage()` and `discoverModels()` were removed in 0.50.3, replaced by `AuthStorage` and `ModelRegistry` classes:

```ts
// Before (0.49.3)
import { discoverAuthStorage, discoverModels } from "@mariozechner/pi-coding-agent";
const authStorage = discoverAuthStorage(agentDir);
const registry = discoverModels(authStorage, agentDir);

// After (0.50.3)
import { AuthStorage, ModelRegistry } from "@mariozechner/pi-coding-agent";
import path from "node:path";
const authStorage = new AuthStorage(path.join(agentDir, "auth.json"));
const registry = new ModelRegistry(authStorage, path.join(agentDir, "models.json"));
```

**Files needing changes:** `image.ts`, `list.registry.ts`, `model-catalog.ts`, `context.ts`, `pi-embedded-runner/model.ts`, `run/types.ts`, `tools/image-tool.ts`, `test-helpers.mocks.ts`

**Type suppressions needed:** `systemPrompt` removed from `CreateAgentSessionOptions` in 0.50.3 — use `@ts-expect-error` in `compact.ts` and `attempt.ts`.

### 2. User-Agent version block (the actual "no longer supported" error)
Google's Antigravity server enforces minimum client version via User-Agent header. pi-ai hardcodes `"antigravity/1.11.5 darwin/arm64"` which is now blocked.

**Fix:** Change to `"antigravity/1.15.8 linux/amd64"` in `@mariozechner/pi-ai/dist/providers/google-gemini-cli.js` → `ANTIGRAVITY_HEADERS`.

For pnpm, persist with `pnpm.patchedDependencies`:
```json
"pnpm": {
  "patchedDependencies": {
    "@mariozechner/pi-ai@0.50.3": "patches/@mariozechner__pi-ai@0.50.3.patch"
  }
}
```

Tested working with 8 Google accounts across all Antigravity profiles.


## Links

- None detected yet
