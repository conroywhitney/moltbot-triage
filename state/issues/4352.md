---
number: 4352
title: "[Feature]: Attachments not passed to AI model in Feishu channel integration"
author: Fijileijun
created: 2026-01-30T03:58:13Z
updated: 2026-01-30T03:58:13Z
labels: ["enhancement"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4352
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

When using the Feishu channel integration, image attachments are successfully downloaded and prepared but are not being passed to the AI model. The AI model only receives text content with the image_key, not the actual image data.

## Environment

Clawdbot version: 2026.1.24-3
Channel: Feishu (飞书)
Model: Claude Opus 4.5 (configured with "input": ["text", "image"])
Platform: macOS (Darwin 25.2.0)

## Steps to Reproduce

Configure Feishu channel with WebSocket connection
Enable image input in model configuration (models.json)
Implement image download using client.im.messageResource.get() API
Prepare attachments array with downloaded image data
Pass attachments via Attachments field in ctxPayload
Send an image message from Feishu client

## Expected Behavior

The AI model should receive the image data and be able to analyze the image content.

## Actual Behavior

The AI model only receives text content like:

"[User sent an image] {\"image_key\":\"img_v3_02ue_...\"}  "
The actual image data in the Attachments field is not passed to the AI model.

## Evidence

Gateway logs show successful image download and attachment preparation:
[feishu] downloaded image: img_v3_02ue_050f8a8e-6851-4ad9-b304-4f6ae69ee72g, size: 126394 bytes
[feishu] passing 1 attachment(s) to agent
[feishu] attachment 0: type=image, size=126394 bytes, mimeType=image/jpeg
Agent session logs show only text content, no image data:
{
  "role": "user",
  "content": [{
    "type": "text",
    "text": "[User sent an image] {\"image_key\":\"img_v3_02ue_050f8a8e-6851-4ad9-b304-4f6ae69ee72g\"}"
  }]
}

## Code Implementation

Attachment preparation in bot.ts:

const attachments: Array<{ type: "image"; data: Buffer; mimeType: string }> = [];
if (currentImageData) {
  attachments.push({
    type: "image",
    data: currentImageData,
    mimeType: "image/jpeg",
  });
}

const ctxPayload = core.channel.reply.finalizeInboundContext({
  Body: combinedBody,
  // ... other fields ...
  Attachments: attachments.length > 0 ? attachments : undefined,
} as any);

## Investigation

Image download from Feishu API works correctly using client.im.messageResource.get()
Attachments array is properly constructed with Buffer data
Attachments field is passed to core.channel.reply.finalizeInboundContext()
However, the attachments are not included in the API call to the AI model
Only the Feishu extension uses the Attachments field (no other channels use it)

## Questions

Is the Attachments field the correct way to pass images to the AI model?
Is there additional configuration needed to enable attachment support?
Should attachments be passed in a different format or through a different mechanism?

## Workaround

Currently, users must upload images to external image hosting services (like imgur.com) and send the URL instead of sending images directly through Feishu.

## Comments


## Links

- None detected yet
