---
number: 6659
title: "File watcher causes FD exhaustion when watching directories with many files (e.g., Python venvs)"
author: sherly-techtree
created: 2026-02-01T22:51:35Z
updated: 2026-02-02T00:16:10Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6659
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

OpenClaw's file watcher (chokidar) watches `skills/` and `agents/` directories. If a user creates a Python virtualenv inside these directories, every file in the venv gets a file descriptor held open — causing rapid FD exhaustion and `spawn EBADF` errors.

## Reproduction

1. Create a skill that uses a Python venv:
   ```bash
   cd ~/clawd/skills/my-skill
   python3 -m venv .venv
   pip install requests  # adds ~1000+ files
   ```

2. Restart the gateway

3. Check FD count:
   ```bash
   lsof -p $(pgrep -f openclaw-gateway) | wc -l
   # Shows 1000+ FDs
   ```

## Symptoms

- `spawn EBADF` errors on exec calls
- Discord message processing slows to 35-200 seconds
- Gateway becomes unresponsive
- Health monitor may show FD count above threshold

## Current Workaround

Move venvs outside watched directories:
```bash
# Bad: ~/clawd/skills/my-skill/.venv/
# Good: ~/.openclaw/.venv-my-skill/
```

## Possible Fixes

1. **Add default ignore patterns** — Have chokidar ignore common large directories like `.venv`, `node_modules`, `__pycache__`, `.git` by default

2. **Document the footgun** — Add a warning in docs about not putting venvs/node_modules in watched directories

3. **Support `.clawdignore` or similar** — Let users specify patterns to exclude from watching

## Environment

- OpenClaw version: latest (npm global install)
- OS: macOS 15 (Sequoia)
- Node: v22.22.0

## Related

This caused hours of debugging as the symptoms (EBADF, slow processing) pointed at other things first. The venv was a leftover from skill development and wasn't obvious as the cause.

## Comments


## Links

- None detected yet
