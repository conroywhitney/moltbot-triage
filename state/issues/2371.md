---
number: 2371
title: "iOS: Chat gateway discovery doesn't work over Tailscale — need manual gateway option"
author: yanda
created: 2026-01-26T20:31:51Z
updated: 2026-01-28T06:02:14Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/2371
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

The iOS node connects successfully over Tailscale, but the Chat feature cannot find gateways because it relies on Bonjour/mDNS discovery, which doesn't traverse across networks.

## Current behavior

- Node connection works perfectly over Tailscale (camera, canvas, location, screen, voiceWake all available)
- Chat feature shows "No gateways found yet" and stays stuck on "Searching..."
- Gateway discovery broadcasts mDNS queries locally, which won't reach the gateway over Tailscale

## Expected behavior

Chat should either:
1. Reuse the existing node connection endpoint (already configured and working), or
2. Provide a "Manual Gateway" option to specify the gateway URL/port for chat (similar to the existing Manual Host option for node connection)

## Environment

- iOS app version: 2026.1.25
- iOS: 26.3.0
- Gateway exposed via Tailscale Serve (HTTPS on port 443)
- Node connection: working via `http://[tailscale-hostname]:443`

## Screenshots

Settings shows:
- Status: Connected ✓
- Discovery: Searching...
- "No gateways found yet."

## Workaround

None currently — chat is unusable over Tailscale/cross-network setups.

## Comments

### @yanda (2026-01-26)

## Code Analysis

Traced through the iOS app source to understand the issue:

### What exists (and works)
- Manual gateway settings exist in `GatewaySettingsStore.swift`:
  ```swift
  private static let manualEnabledDefaultsKey = "gateway.manual.enabled"
  private static let manualHostDefaultsKey = "gateway.manual.host"
  private static let manualPortDefaultsKey = "gateway.manual.port"
  private static let manualTlsDefaultsKey = "gateway.manual.tls"
  ```

- UI exists in `SettingsTab.swift` under **Settings → Gateway → Advanced**:
  ```swift
  Toggle("Use Manual Gateway", isOn: self.$manualGatewayEnabled)
  TextField("Host", text: self.$manualGatewayHost)
  TextField("Port", value: self.$manualGatewayPort, format: .number)
  Toggle("Use TLS", isOn: self.$manualGatewayTLS)
  Button { ... } label: { Text("Connect (Manual)") }
  ```

- `GatewayConnectionController.connectManual(host:port:useTLS:)` works and connects the node

### The bug
The "No gateways found yet" message in Settings comes from Bonjour discovery only:

```swift
// SettingsTab.swift
private func gatewayList(showing: GatewayListMode) -> some View {
    if self.gatewayController.gateways.isEmpty {  // ← Only checks Bonjour-discovered gateways
        Text("No gateways found yet.")
    } else { ... }
}
```

`gatewayController.gateways` is populated by `GatewayDiscoveryModel` which uses `NWBrowser` for Bonjour only. Manual connections don't add to this list.

### The chat issue
`ChatSheet.swift` initializes with the active gateway session:
```swift
init(gateway: GatewayNodeSession, sessionKey: String, ...) {
    let transport = IOSGatewayChatTransport(gateway: gateway)
    ...
}
```

And `RootCanvas.swift` passes the app's gateway:
```swift
ChatSheet(
    gateway: self.appModel.gatewaySession,  // ← This IS connected via manual
    sessionKey: self.appModel.mainSessionKey,
    ...)
```

So the chat SHOULD work when manually connected — the `gatewaySession` is connected. But the chat UI was stuck on "Connecting...". This might be because:
1. The chat UI is waiting for something from the discovery list
2. Or there's a race condition where chat tries to connect before manual connection completes

### Suggested fix
1. When manually connected, the gateway should appear in the gateway list (or the "No gateways found yet" message should be suppressed)
2. Ensure the chat transport uses the active `gatewaySession` state, not the discovery list
3. Consider auto-opening the Advanced section when no Bonjour gateways are found over Tailscale

### Environment details
- The node connection works fine over Tailscale via manual settings
- `Status: Connected` shows correctly
- But `Discovery: Searching...` and "No gateways found yet" persist (expected — Bonjour won't cross Tailscale)
- Chat stuck on "Connecting..." despite node being connected


## Links

- None detected yet
