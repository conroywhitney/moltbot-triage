---
number: 7551
title: "Punycode deprecation warning from transitive dependencies (tr46, whatwg-url)"
author: rmichalaq
created: 2026-02-03T00:01:30Z
updated: 2026-02-03T00:01:30Z
labels: []
assignees: []
comments_count: 0
reactions_total: 1
url: https://github.com/openclaw/openclaw/issues/7551
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

OpenClaw shows a Node.js deprecation warning on every command execution:

```
(node:36930) [DEP0040] DeprecationWarning: The punycode module is deprecated. Please use a userland alternative instead.
```

This is caused by outdated transitive dependencies that still use the deprecated Node.js built-in `punycode` module instead of the userland `punycode` npm package.

## Root Cause

**Dependency chain:**
```
openclaw@2026.1.30
└─ grammy@1.39.3
   └─ node-fetch@2.7.0
      └─ whatwg-url@5.0.0 (uses deprecated punycode)
         └─ tr46@0.0.3 (uses deprecated punycode)
```

**Affected files:**
- `/node_modules/tr46/index.js:3` - `var punycode = require("punycode");`
- `/node_modules/whatwg-url/lib/url-state-machine.js:2` - `const punycode = require("punycode");`

## Proposed Solution

Add a pnpm override to force newer versions that use the userland `punycode.js` package:

```json
{
  "pnpm": {
    "overrides": {
      "whatwg-url": "^14.0.0"
    }
  }
}
```

This will automatically pull in:
- `whatwg-url@14.0.0` (uses userland punycode.js)
- `tr46@4.1.1+` (uses userland punycode.js)

## Why This Is Safe

1. **Node.js requirement already met**: OpenClaw requires Node.js ≥22.12.0, and whatwg-url@14.0.0 requires Node.js ≥20
2. **API compatibility**: High-level URL parsing API remains unchanged (only internal record structure modified)
3. **Widely adopted fix**: This is the standard solution for punycode deprecation across the ecosystem
4. **No breaking changes**: The userland `punycode.js` is functionally identical to the deprecated module

## Impact

- **Current**: Cosmetic warning, no functional impact
- **After fix**: Warning eliminated, cleaner console output
- **Risk**: Very low - maintains full backward compatibility

## Environment

- OpenClaw version: 2026.1.30 (76b5208)
- Node.js: v22+ (as required by OpenClaw)
- Platform: macOS (also affects Linux/Windows)

## Steps to Reproduce

Run any OpenClaw command:
```bash
openclaw gateway
openclaw doctor
openclaw security audit
```

All show the deprecation warning.

## Alternative Solutions

1. **Wait for grammy update**: grammy could update to node-fetch v3 (which doesn't use whatwg-url)
2. **Suppress warning**: Users can add `--no-deprecation` flag, but this hides the issue rather than fixing it

## References

- [Node.js punycode deprecation](https://nodejs.org/api/punycode.html)
- [whatwg-url v14 changelog](https://github.com/jsdom/whatwg-url/releases/tag/v14.0.0)
- [tr46 v4 changelog](https://github.com/jsdom/tr46/releases/tag/v4.0.0)

## Comments


## Links

- None detected yet
