---
number: 6758
title: "[Bug]: Voice call processedEventIds Set grows unbounded without cleanup"
author: coygeek
created: 2026-02-02T01:31:36Z
updated: 2026-02-02T02:57:14Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6758
duplicate_of: null
related_issues: [5258,5260,5261,5264,6019,6026,6034,6036,6037,6629]
blocks: []
blocked_by: []
---

## Description

## CVSS Assessment

| Metric | Value |
|--------|-------|
| **Score** | 7.5 / 10.0 |
| **Severity** | High |
| **Vector** | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |

> [CVSS v3.1 Calculator](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H)


## Summary

The `processedEventIds` Set in the voice call manager accumulates event IDs for idempotency checking but never removes them, causing memory exhaustion during extended voice call sessions.

## Affected Code

**File:** `extensions/voice-call/src/manager.ts:45`

```typescript
export class CallManager {
  private activeCalls = new Map<CallId, CallRecord>();
  private providerCallIdMap = new Map<string, CallId>();
  private processedEventIds = new Set<string>();  // Never cleaned up

  processEvent(event: NormalizedEvent): void {
    // Idempotency check
    if (this.processedEventIds.has(event.id)) {
      return;
    }
    this.processedEventIds.add(event.id);  // Added but never removed
    // ... process event
  }
}
```

## Attack Surface

**How is this reached?**
- [x] Network (HTTP/WebSocket endpoint, API call)
- [ ] Adjacent Network (same LAN, requires network proximity)
- [ ] Local (local file, CLI argument, environment variable)
- [ ] Physical (requires physical access to machine)

**Authentication required?**
- [x] None (unauthenticated/public access)
- [ ] Low (any authenticated user)
- [ ] High (admin/privileged user only)

**Entry point:** Voice call webhook events from telephony provider (e.g., Twilio, Vonage).

## Exploit Conditions

**Complexity:**
- [x] Low (no special conditions, works reliably)
- [ ] High (requires race condition, specific config, or timing)

**User interaction:**
- [x] None (automatic, no victim action needed)
- [ ] Required (victim must click, visit, or perform action)

**Prerequisites:** Voice call extension must be enabled and receiving webhook events.

## Impact Assessment

**Scope:**
- [x] Unchanged (impact limited to vulnerable component)
- [ ] Changed (can affect other components, escape sandbox)

**What can an attacker do?**

| Impact Type | Level | Description |
|-------------|-------|-------------|
| Confidentiality | None | No data disclosure |
| Integrity | None | No data modification |
| Availability | High | Memory exhaustion crashes the voice call manager |

## Steps to Reproduce

1. Enable the voice call extension
2. Initiate voice calls that generate webhook events
3. Each event adds a unique ID to `processedEventIds`
4. Voice calls generate many events (call state, transcripts, marks)
5. Over 24 hours of continuous calling, Set can grow to millions of entries
6. Process eventually crashes with OOM

## Recommended Fix

Implement time-based cleanup for processed event IDs:

```typescript
private processedEventIds = new Map<string, number>();  // eventId -> timestamp
private readonly EVENT_ID_TTL = 60 * 60 * 1000;  // 1 hour

processEvent(event: NormalizedEvent): void {
  this.pruneExpiredEventIds();

  if (this.processedEventIds.has(event.id)) {
    return;
  }
  this.processedEventIds.set(event.id, Date.now());
  // ... process event
}

private pruneExpiredEventIds(): void {
  const now = Date.now();
  for (const [id, timestamp] of this.processedEventIds) {
    if (now - timestamp > this.EVENT_ID_TTL) {
      this.processedEventIds.delete(id);
    }
  }
}
```

## References

- **CWE:** [CWE-770](https://cwe.mitre.org/data/definitions/770.html) - Allocation of Resources Without Limits or Throttling
- **Related (CWE-770):** #6019, #6026, #5264, #5260, #5258, #6629, #6036, #5261, #6037, #6034

## Comments


## Links

- None detected yet
