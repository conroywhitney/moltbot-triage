---
number: 7189
title: "[Bug]:  Commands Not Working in Control UI"
author: karlisbergmanis-lv
created: 2026-02-02T14:41:15Z
updated: 2026-02-02T14:41:15Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7189
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description


## üìã PROBLEM SUMMARY

The `/new` command does not work in the **Control UI (webchat)**, while it functions correctly in WhatsApp. The command appears briefly in the chat interface then disappears without being sent to the gateway.

## üîç SYMPTOMS

1. **User types `/new` in Control UI**
2. **Message appears for ~1 second** 
3. **Message disappears from chat**
4. **No network request sent to gateway**
5. **No session reset occurs**
6. **No feedback to user**

## ‚úÖ EXPECTED BEHAVIOR

1. User types `/new` in Control UI
2. Message is sent to gateway  
3. Session is reset (new sessionId generated)
4. User receives confirmation response
5. Chat history is cleared

## ‚ùå ACTUAL BEHAVIOR

The Control UI intercepts the `/new` command locally and removes it from the interface without forwarding it to the gateway server.

## üß™ EVIDENCE & TESTING

### Test Results
| Channel | `/new` Command | Result |
|---------|----------------|--------|
| WhatsApp | ‚úÖ Works | Session reset, hook triggered, response sent |
| Control UI | ‚ùå Failed | Message disappears, no gateway call |
| Control UI with space | ‚ùå Failed | ` /new` also intercepted |
| Control UI with text | ‚ùå Failed | `/new hello` also intercepted |

### Gateway Logs Analysis
**WhatsApp `/new` execution (working):**
```log
[session-memory] Hook triggered for /new command
Current sessionId: aa0630eb-67ed-4165-90c3-c0ce795e43bb
sessionFile: /root/.clawdbot/agents/main/sessions/aa0630eb-67ed-4165-90c3-c0ce795e43bb.jsonl
auto-reply sent (text)
```

**Control UI `/new` attempt (not working):**
```log
# No logs generated - command never reaches gateway
# Only webchat connection events visible:
webchat connected conn=ec8ab40a-a9f9-4c13-8045-c9eff8d78574
```

### Network Analysis
- WhatsApp messages generate `web-auto-reply` and `inbound web message` log entries
- Control UI `/new` generates **no gateway communication logs**
- Regular Control UI messages work normally and appear in logs

## üõ† WORKAROUND

**CLI Manual Reset:**
```bash
clawdbot gateway call sessions.reset --params '{"key": "agent:main:main"}'
```

**Result:**
- Successfully resets session
- Generates new sessionId  
- Clears token counters
- Requires page refresh to see effect in UI

## üèó TECHNICAL ANALYSIS

### Root Cause
The Control UI implements **local command interception** for `/new` and `/reset` commands rather than forwarding them to the gateway. This creates inconsistent behavior between channels.

### Code Flow Issue
1. Control UI recognizes `/new` as special command
2. Instead of sending to gateway API, processes locally  
3. Attempts to clear local chat view
4. Does not trigger server-side session reset
5. No confirmation response generated

### Session Architecture Context
- **Session Key:** `agent:main:main` (webchat uses main session)
- **Session Scope:** `dmScope: "per-channel-peer"`  
- **Reset Triggers:** `["/new", "/reset"]` (configured correctly)
- **Gateway API:** `sessions.reset` method exists and works

## üéØ PROPOSED FIX

**Option 1: Forward to Gateway (Recommended)**
- Modify Control UI to send `/new` commands to gateway API
- Let gateway handle session reset logic consistently  
- Return response to UI for display

**Option 2: Implement Local Reset Properly**
- Control UI calls `sessions.reset` API when intercepting `/new`
- Refresh local session state
- Display confirmation message
- Maintain consistent UX

**Option 3: Configuration Option**
- Add setting to disable local command interception
- Allow users to choose gateway vs local handling

## üìä IMPACT ASSESSMENT

**Severity:** Medium  
**Affected Users:** All Control UI users  
**Workaround Available:** Yes (CLI command)  
**Channel Consistency:** Broken (WhatsApp works, Control UI doesn't)

## üß™ REPRODUCTION STEPS

1. Open Control UI at `http://localhost:18789/`
2. Type `/new` in chat input
3. Press Enter
4. Observe message disappears without effect
5. Check gateway logs - no `/new` processing
6. Session continues with same sessionId

## üìã CONFIGURATION DETAILS

```json5
{
  "session": {
    "dmScope": "per-channel-peer",
    "resetTriggers": ["/new", "/reset"]
  },
  "commands": {
    "native": "auto",
    "nativeSkills": "auto"
  }
}
```

## üîß ENVIRONMENT DETAILS

- **Gateway:** local mode, port 18789
- **UI Client:** clawdbot-control-ui webchat vdev
- **Sessions:** 4 active sessions
- **Memory:** Vector ready, FTS ready
- **Channels:** WhatsApp enabled and working

## üìé RELATED FILES

- Control UI source code (command interception logic)
- Gateway session reset implementation (`sessions.reset`)
- Configuration schema for `resetTriggers`
- WebSocket message handling in Control UI

---

**Reporter Notes:**  
This bug creates significant UX inconsistency between channels and breaks expected command behavior. Users expect `/new` to work the same way across all interfaces. The workaround using CLI is not user-friendly for non-technical users.

**Verification:** Bug confirmed through testing, log analysis, and successful CLI workaround.

## Comments


## Links

- None detected yet
