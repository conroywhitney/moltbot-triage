---
number: 1062
title: "[Feature]: More Granular Tool Permissions for Sandboxed Sessions"
author: humanwritten
created: 2026-01-17T01:34:17Z
updated: 2026-01-28T19:46:05Z
labels: ["enhancement"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/1062
duplicate_of: null
related_issues: [0]
blocks: []
blocked_by: []
---

## Description

CC generated summary below, happy to discuss and explore some more, i'd prefer some kind of user based approach and I think it sets up for the future better, but open to whatever direction makes the most sense and excited to discuss and explore :) 

Thanks all! 

<p class="p3"><span class="s2"><h2><b>Summary</b></h2></span></p>
<p class="p2"><br></p>
<p class="p1">Add granular tool/command permissions for sandboxed sessions, allowing specific users to execute specific commands (e.g. <span class="s3">openhue</span>, <span class="s3">shortcuts</span>) without full elevated access. This enables safe home automation and shared group chat use cases while maintaining security boundaries.</p>
<p class="p2"><br></p>
<p class="p1">Two approaches were considered:</p>
<p class="p3"><span class="s2"><ol start="1"><li>
<p class="p1"><span class="s1"><b>Session/Group-based</b></span> — Assign tool permissions to a group/channel (simpler, per Peter’s suggestion)</p>
</li><li>
<p class="p1"><span class="s1"><b>User-based</b></span> — Assign tool permissions to specific user IDs (more secure, audit-friendly)</p>
</li></ol></span></p>
<p class="p2"><br></p>
<p class="p1"><span class="s1"><b>Recommendation:</b></span> user-based permissions for stronger security guarantees and auditability.</p>
<p class="p3"><span class="s2"><hr></span></p>
<p class="p3"><span class="s2"><h2><b>Background</b></h2></span></p>
<p class="p2"><br></p>
<p class="p1">From Discord discussion with @steipete :</p>
<p class="p2"><br></p>
<blockquote style="margin: 0.0px 0.0px 0.0px 15.0px; font: 14.0px '.AppleSystemUIFont'; color: #0e0e0e"><span class="s1"><b>Peter:</b></span> “I’d add sth like a tool-based allow-list where vetted binaries can be added instead of changing the elevation concept.”</blockquote>
<p class="p2"><br></p>
<blockquote style="margin: 0.0px 0.0px 0.0px 15.0px; font: 14.0px '.AppleSystemUIFont'; color: #0e0e0e"><span class="s1"><b>Peter:</b></span> “There’s no concept for untrusted users. I’d see this more as a channel/group session based config. I’d steer away from ‘some rights for some’ in a group — that seems messy.”</blockquote>
<p class="p2"><br></p>
<p class="p1"><span class="s1"><b>Concern raised:</b></span> group-based permissions introduce an expansion risk — anyone added to the group inherits permissions. While acceptable for low-risk automations (e.g. lights), this becomes a security issue for more sensitive actions.</p>
<p class="p3"><span class="s2"><hr></span></p>
<p class="p3"><span class="s2"><h2><b>Current State</b></h2></span></p>



Layer | Behavior | Limitation
-- | -- | --
Elevated | Boolean host access | All-or-nothing
Sandbox | Docker container, default tool deny | Same restrictions for all users
Agent bindings | Route groups → agents | No per-user differentiation




<p class="p1">For a project growing rapidly with security-sensitive integrations, establishing a proper permissions model now avoids retrofitting later.</p>
<p class="p2"><span class="s1"><hr></span></p>
<p class="p2"><span class="s1"><h2><b>Suggested Implementation</b></h2></span></p>
<p class="p3"><br></p>
<p class="p2"><span class="s1"><h3><b>Minimal v1</b></h3></span></p>
<p class="p2"><span class="s1"><ul><li>
<p class="p1">userPermissions<span class="s1"> config with </span>commandAllowlist</p>
</li><li>
<p class="p1">Global scope (user has same permissions everywhere)</p>
</li><li>
<p class="p1">Hooks into existing <span class="s1">pi-tools.ts</span> policy pipeline as an additional filter stage</p>
</li><li>
<p class="p1">No permissions entry ⇒ default sandbox (no exec)</p>
</li></ul></span></p>
<p class="p3"><br></p>
<p class="p2"><span class="s1"><h3><b>Future Enhancements</b></h3></span></p>
<p class="p2"><span class="s1"><ul><li>
<p class="p1">Scoped permissions (per-group, per-channel)</p>
</li><li>
<p class="p1"><span class="s1">toolAllowlist</span> beyond just exec commands</p>
</li><li>
<p class="p1">Permission inheritance / layering</p>
</li><li>
<p class="p1">Expiring grants</p>
</li></ul></span></p>
<p class="p2"><span class="s1"><hr></span></p>
<p class="p2"><span class="s1"><h2><b>Key Files (Implementation Reference)</b></h2></span></p>
<p class="p2"><span class="s1"><ul><li>
<p class="p1">src/agents/bash-tools.exec.ts:147–176<span class="s1"> — Elevated gating logic</span></p>
</li><li>
<p class="p1">src/agents/pi-tools.ts:242–263<span class="s1"> — Tool filtering pipeline</span></p>
</li><li>
<p class="p1">src/agents/sandbox/tool-policy.ts<span class="s1"> — Sandbox policy defaults</span></p>
</li><li>
<p class="p1">src/config/types.tools.ts<span class="s1"> — Config schema</span></p>
</li></ul></span></p>
<p class="p2"><span class="s1"><hr></span></p>
<p class="p2"><span class="s1"><h2><b>Use Case</b></h2></span></p>
<p class="p3"><br></p>
<p class="p1"><span class="s2"><b>Home automation:</b></span> Allow housemates in a WhatsApp group to control lights (<span class="s3">openhue</span>) and run shortcuts, without granting shell access or elevated permissions.</p>
<p class="p3"><br></p>
<p class="p1">If a friend is temporarily added to the group, they <span class="s2"><b>do not</b></span> automatically inherit automation permissions. This is potentially a larger attack vector dependent on the permissions granted.</p>
<p class="p2"><span class="s1"><hr></span></p>
<p class="p1">Happy to discuss further or adjust based on project direction.</p>
<p class="p1">Understand if group-based is preferred for simplicity — this issue is mainly to flag the longer-term security considerations.</p>
<p class="p2"><span class="s1"><hr></span></p>

</body>
</html>

## Comments

### @VACInc (2026-01-28)

**Additional use case: Disposable agents for untrusted content review**

This would also enable spinning up isolated, locked-down agents to handle potentially malicious content — like reviewing community skills before loading them.

Currently, spawned subagents inherit the same tool access as the parent. If a skill contains prompt injection ("ignore previous instructions..."), a reviewer agent could be compromised and exfiltrate data via exec, message, etc.

With per-session tool restrictions, you could spawn a reviewer with only `read` access (or no tools at all), get a summary, then decide whether to trust the content — without risking the main agent or system.

Not a full prompt injection solution, but a meaningful step toward defense in depth.

Related: #3532 (transparent skill hosting)


## Links

- None detected yet
