---
number: 2476
title: "[Bug]: web_search: Brave API returns 422 due to missing Cache-Control header"
author: ch-en-hyphen
created: 2026-01-27T00:53:59Z
updated: 2026-01-27T00:53:59Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/2476
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

The `web_search` tool fails with Brave Search API returning a 422 error when `Cache-Control: no-cache` header is not explicitly set.

## Error
Brave Search API error (422): {
"error": {
"code": "VALIDATION",
"detail": "Unable to validate request parameter(s)",
"meta": {
"errors": [{
"loc": ["header", "cache-control"],
"msg": "Input should be 'no-cache'",
"input": "max-stale=0"
}]
}
}
}

## Root Cause

In `src/agents/tools/web-search.ts` (line ~374-380), the fetch request to Brave API does not include the `Cache-Control: no-cache` header:

```typescript
const res = await fetch(url.toString(), {
  method: "GET",
  headers: {
    Accept: "application/json",
    "X-Subscription-Token": params.apiKey,
    // Missing: "Cache-Control": "no-cache"
  },
  signal: withTimeout(undefined, params.timeoutSeconds * 1000),
});
In some environments (possibly due to system-level HTTP proxies or caching tools), a different Cache-Control value (e.g., max-stale=0) may be automatically added, causing Brave API to reject the request.

Suggested Fix
Add the Cache-Control: no-cache header explicitly:

headers: {
  Accept: "application/json",
  "X-Subscription-Token": params.apiKey,
  "Cache-Control": "no-cache",
},
Environment
Clawdbot version: 2026.1.24-3
Node.js: v25.2.1
OS: macOS (Darwin 25.2.0 arm64)
Workaround
Using curl directly with explicit Cache-Control: no-cache header works:

curl -s "https://api.search.brave.com/res/v1/web/search?q=test&count=5" \
  -H "Accept: application/json" \
  -H "Cache-Control: no-cache" \
  -H "X-Subscription-Token: $BRAVE_API_KEY"

---

## Comments


## Links

- None detected yet
