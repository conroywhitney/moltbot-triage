---
number: 3106
title: "Discord: Session unexpectedly reset during gateway reconnection (INTERACTION_CREATE replay?)"
author: fdsouvenir
created: 2026-01-28T03:29:55Z
updated: 2026-01-28T05:54:39Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/3106
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

Session was unexpectedly reset while actively responding to a user message. The reset occurred during a period of Discord gateway instability (repeated WebSocket code 1005 disconnections).

## Timeline

- **20:05:54** — User asks "Show me tools.md"
- **20:06:05** — Assistant completes response (`stopReason: "stop"`)
- **20:05:10 to 20:09:38** — Discord gateway flapping: repeated "Attempting resume" → "WebSocket connection closed with code 1005"
- **20:07:41** — New session created (96 seconds after last response)
- **20:07:45** — Log shows: `Slow listener detected: InteractionEventListener took 4503ms for event INTERACTION_CREATE`

## Logs

```
Jan 27 20:05:10 node[43079]: [discord] gateway: Attempting resume with backoff: 1000ms
Jan 27 20:05:10 node[43079]: [discord] gateway: WebSocket connection closed with code 1005
Jan 27 20:05:47 node[43079]: [discord] gateway: Attempting resume with backoff: 1000ms
Jan 27 20:05:47 node[43079]: [discord] gateway: WebSocket connection closed with code 1005
[... repeated through 20:09:38 ...]
Jan 27 20:07:41 node[43079]: [discord] gateway: Attempting resume with backoff: 1000ms
Jan 27 20:07:41 node[43079]: [discord] gateway: WebSocket connection closed with code 1005
Jan 27 20:07:45 node[43079]: [EventQueue] Slow listener detected: InteractionEventListener took 4503ms for event INTERACTION_CREATE
```

## Evidence

- New session JSONL starts at `2026-01-28T02:07:41.357Z` with system message "A new session was started via /new or /reset"
- User confirms they did **not** type /new or /reset
- Previous session transcript shows completed response at `02:06:05` — only 96 seconds before reset
- No gateway restart occurred (same PID 43079 throughout)

## Suspected Cause

During the gateway reconnection cycle, an `INTERACTION_CREATE` event was processed that triggered a session reset. This could be:
1. A stale/replayed slash command (/new or /reset) re-delivered during reconnection
2. An interaction mishandled during the unstable connection period
3. Deduplication not working correctly for interactions received during resume attempts

## Expected Behavior

Session should not reset unless user explicitly sends /new or /reset. Interactions received during gateway instability should be deduplicated or validated before triggering session-affecting actions.

## Environment

- Clawdbot version: 2026.1.24-3
- Channel: Discord
- Node: v22.22.0
- OS: Linux 6.14.0-37-generic (x64)

## Comments


## Links

- None detected yet
