---
number: 1989
title: "[Bug]: Audio-only messages on Telegram not triggering agent response"
author: monsterkil
created: 2026-01-25T23:05:29Z
updated: 2026-01-29T09:32:35Z
labels: ["bug"]
assignees: []
comments_count: 2
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/1989
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary
Audio-only voice messages sent via Telegram do not trigger the Clawdbot agent to process or respond. The agent only responds when text content is present alongside the audio file.

## Steps to reproduce
1. Send a voice message (audio-only .ogg file) via Telegram to Clawdbot
2. Wait for agent response
3. Observe: No response from agent
4. Send the same audio file with text (e.g., "?" + voice message)
5. Observe: Agent responds immediately with transcription and answer

## Expected behavior
The agent should automatically detect voice message attachments and:
1. Trigger Whisper transcription
2. Process the transcribed text
3. Generate and send a response

This should work the same as text-only messages or mixed media messages.

## Actual behavior
- Voice-only messages are received but ignored by the agent
- No transcription attempt is made
- No response is sent to the user
- The message appears in logs/history but doesn't trigger message handler
- Only when text accompanies the audio does the agent process it

## Environment
- Clawdbot version: 2026.1.24-2
- OS: Linux 6.8.0-90-generic (x64)
- Install method: Clawdbot Gateway (Tailscale bound)
- Channel: Telegram
- Skill: openai-whisper-api (configured and working)

## Configuration
```json
{
  "channels": {
    "telegram": {
      "enabled": true,
      "dmPolicy": "pairing",
      "botToken": "...",
      "streamMode": "partial"
    }
  },
  "skills": {
    "entries": {
      "openai-whisper-api": {
        "apiKey": "..."
      }
    }
  }
}

## Comments

### @jarvis2017 (2026-01-27)

I am experiencing the same issue.  

Clawdbot version: 2026.1.24-3
Description:  Ubuntu 24.04.3 LTS
Release:        24.04
Codename:   noble

Channel: Telegram
Skill: openai-whisper-api (configured and working)

Chat in Clawdbot shows TTS successful, and file created as MEDIA:/tmp/tts-ZjAzbK/voice-1769496556804.opus
Then: "I've sent you a voice note saying hello again: Listen here. Let me know if you can hear it" The "Listen here" is underlined as if it is supposed to be a hyperlink, but there is no address associated with it, doesn't open/play the file. 

See image:
<img width="918" height="467" alt="Image" src="https://github.com/user-attachments/assets/42323919-6d9e-4363-8753-96454412d3b5" />


Config:


  "meta": {
    "lastTouchedVersion": "2026.1.24-3",
    "lastTouchedAt": "2026-01-27T06:52:49.783Z"
  },
  "wizard": {
    "lastRunAt": "2026-01-27T06:52:49.770Z",
    "lastRunVersion": "2026.1.24-3",
    "lastRunCommand": "doctor",
    "lastRunMode": "local"
  },
  "agents": {
    "defaults": {
      "model": {
        "primary": "openai/gpt-4o-mini"
      },
      "models": {},
      "workspace": "/root/clawdbot-workspace",
      "memorySearch": {
        "fallback": "openai"
      },
      "compaction": {
        "mode": "safeguard"
      },
      "maxConcurrent": 4,
      "subagents": {
        "maxConcurrent": 8
      }
    }
  },
  "messages": {
    "ackReactionScope": "group-mentions"
  },
  "commands": {
    "native": "auto",
    "nativeSkills": "auto"
  },
  "channels": {
    "telegram": {
      "enabled": true,
      "dmPolicy": "pairing",
      "botToken": "****************************",
      "allowFrom": [
        "6680606903"
      ],
      "groupPolicy": "allowlist",
      "streamMode": "partial"
    }
  },
  "talk": {
    "voiceId": "21m00Tcm4TlvDq8ikWAM",
    "modelId": "eleven_multilingual_v2",
    "outputFormat": "mp3_44100_128",
    "apiKey": "**********************"
  },
  "gateway": {
    "port": 18789,
    "mode": "local",
    "bind": "loopback",
    "auth": {
      "mode": "token",
      "token": "*******************************"
    },
    "tailscale": {
      "mode": "off",
      "resetOnExit": false
    }
  },
  "skills": {
    "entries": {
      "voice-call": {
        "enabled": true
      },
      "openai-whisper-api": {
        "enabled": true,
        "apiKey": ""
      }
    }
  },
  "plugins": {
    "entries": {
      "telegram": {
        "enabled": true
      },
      "voice-call": {
        "enabled": true
      }
    }
  }
}

Here's the log : 

The logs show that the TTS tool is finishing successfully (taking about 1 second to generate the audio), but there is no follow-up log indicating that the Telegram channel is actually attempting to upload or send the file.


06:49:14 debug diagnostic {"subsystem":"diagnostic"} lane enqueue: lane=session:agent:main:main queueSize=1
06:49:14 debug diagnostic {"subsystem":"diagnostic"} lane dequeue: lane=session:agent:main:main waitMs=14 queueSize=0
06:49:14 debug diagnostic {"subsystem":"diagnostic"} lane enqueue: lane=main queueSize=1
06:49:14 debug diagnostic {"subsystem":"diagnostic"} lane dequeue: lane=main waitMs=1 queueSize=0
06:49:14 debug agent/embedded {"subsystem":"agent/embedded"} embedded run start: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10 sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9 provider=openai model=gpt-4o-mini thinking=off messageChannel=telegram
06:49:14 debug diagnostic {"subsystem":"diagnostic"} session state: sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9 sessionKey=unknown prev=idle new=processing reason="run_started" queueDepth=0
06:49:14 debug diagnostic {"subsystem":"diagnostic"} run registered: sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9 totalActive=1
06:49:14 debug agent/embedded {"subsystem":"agent/embedded"} embedded run prompt start: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10 sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9
06:49:14 debug agent/embedded {"subsystem":"agent/embedded"} embedded run agent start: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10
06:49:15 debug agent/embedded {"subsystem":"agent/embedded"} embedded run tool start: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10 tool=tts toolCallId=call_P5ooUf5mJmzuHk7wmgpRMWgi|fc_054f0ebd54ffe7bb0069785feb7914819783360ac6b31934c5
06:49:16 debug agent/embedded {"subsystem":"agent/embedded"} embedded run tool end: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10 tool=tts toolCallId=call_P5ooUf5mJmzuHk7wmgpRMWgi|fc_054f0ebd54ffe7bb0069785feb7914819783360ac6b31934c5
06:49:18 debug agent/embedded {"subsystem":"agent/embedded"} embedded run agent end: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10
06:49:18 debug agent/embedded {"subsystem":"agent/embedded"} embedded run prompt end: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10 sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9 durationMs=4263
06:49:18 debug diagnostic {"subsystem":"diagnostic"} session state: sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9 sessionKey=unknown prev=processing new=idle reason="run_completed" queueDepth=0
06:49:18 debug diagnostic {"subsystem":"diagnostic"} run cleared: sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9 totalActive=0
06:49:18 debug agent/embedded {"subsystem":"agent/embedded"} embedded run done: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10 sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9 durationMs=4279 aborted=false
06:49:18 debug diagnostic {"subsystem":"diagnostic"} lane task done: lane=main durationMs=4280 active=0 queued=0
06:49:18 debug diagnostic {"subsystem":"diagnostic"} lane task done: lane=session:agent:main:main durationMs=4282 active=0 queued=0

### @hclsys (2026-01-29)

I've encountered this issue as well and investigated the root cause:

**My Environment**:
- macOS M2 MacBook
- moltbot local installation
- Telegram voice messages (OGG Opus)

**Symptoms I observed**:
1. Voice-only messages: no response
2. Consecutive voice messages: only received reply for the second one
3. Session file bloated to 2.3MB (should be <100KB)
4. Token overflow: 208K > 200K limit

**Root Cause**: The `extractFileBlocks()` function in `apply.ts` misidentifies OGG audio files as text:

1. `looksLikeUtf8Text()` returns `true` for OGG files because OGG headers contain >85% printable ASCII bytes ("OggS" magic + Vorbis/Opus metadata)
2. `guessDelimitedMime()` finds tab characters in the OGG metadata → misidentifies as `text/tab-separated-values`
3. Audio binary gets embedded as text in the session → token overflow

**Evidence from my logs**:
\`\`\`
media: MIME override from "audio/ogg; codecs=opus" to "text/tab-separated-values" for index=0
\`\`\`

**Proposed Fix**: Add an early MIME type check in `extractFileBlocks()` to skip text detection for `audio/*` and `video/*` files (while respecting `forcedTextMimeResolved` from filename extension).

I'm working on a PR to fix this.


## Links

- None detected yet
