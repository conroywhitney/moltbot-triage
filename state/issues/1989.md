---
number: 1989
title: "[Bug]: Audio-only messages on Telegram not triggering agent response"
author: monsterkil
created: 2026-01-25T23:05:29Z
updated: 2026-02-02T09:06:48Z
labels: ["bug"]
assignees: []
comments_count: 7
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/1989
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary
Audio-only voice messages sent via Telegram do not trigger the Clawdbot agent to process or respond. The agent only responds when text content is present alongside the audio file.

## Steps to reproduce
1. Send a voice message (audio-only .ogg file) via Telegram to Clawdbot
2. Wait for agent response
3. Observe: No response from agent
4. Send the same audio file with text (e.g., "?" + voice message)
5. Observe: Agent responds immediately with transcription and answer

## Expected behavior
The agent should automatically detect voice message attachments and:
1. Trigger Whisper transcription
2. Process the transcribed text
3. Generate and send a response

This should work the same as text-only messages or mixed media messages.

## Actual behavior
- Voice-only messages are received but ignored by the agent
- No transcription attempt is made
- No response is sent to the user
- The message appears in logs/history but doesn't trigger message handler
- Only when text accompanies the audio does the agent process it

## Environment
- Clawdbot version: 2026.1.24-2
- OS: Linux 6.8.0-90-generic (x64)
- Install method: Clawdbot Gateway (Tailscale bound)
- Channel: Telegram
- Skill: openai-whisper-api (configured and working)

## Configuration
```json
{
  "channels": {
    "telegram": {
      "enabled": true,
      "dmPolicy": "pairing",
      "botToken": "...",
      "streamMode": "partial"
    }
  },
  "skills": {
    "entries": {
      "openai-whisper-api": {
        "apiKey": "..."
      }
    }
  }
}

## Comments

### @jarvis2017 (2026-01-27)

I am experiencing the same issue.  

Clawdbot version: 2026.1.24-3
Description:  Ubuntu 24.04.3 LTS
Release:        24.04
Codename:   noble

Channel: Telegram
Skill: openai-whisper-api (configured and working)

Chat in Clawdbot shows TTS successful, and file created as MEDIA:/tmp/tts-ZjAzbK/voice-1769496556804.opus
Then: "I've sent you a voice note saying hello again: Listen here. Let me know if you can hear it" The "Listen here" is underlined as if it is supposed to be a hyperlink, but there is no address associated with it, doesn't open/play the file. 

See image:
<img width="918" height="467" alt="Image" src="https://github.com/user-attachments/assets/42323919-6d9e-4363-8753-96454412d3b5" />


Config:


  "meta": {
    "lastTouchedVersion": "2026.1.24-3",
    "lastTouchedAt": "2026-01-27T06:52:49.783Z"
  },
  "wizard": {
    "lastRunAt": "2026-01-27T06:52:49.770Z",
    "lastRunVersion": "2026.1.24-3",
    "lastRunCommand": "doctor",
    "lastRunMode": "local"
  },
  "agents": {
    "defaults": {
      "model": {
        "primary": "openai/gpt-4o-mini"
      },
      "models": {},
      "workspace": "/root/clawdbot-workspace",
      "memorySearch": {
        "fallback": "openai"
      },
      "compaction": {
        "mode": "safeguard"
      },
      "maxConcurrent": 4,
      "subagents": {
        "maxConcurrent": 8
      }
    }
  },
  "messages": {
    "ackReactionScope": "group-mentions"
  },
  "commands": {
    "native": "auto",
    "nativeSkills": "auto"
  },
  "channels": {
    "telegram": {
      "enabled": true,
      "dmPolicy": "pairing",
      "botToken": "****************************",
      "allowFrom": [
        "6680606903"
      ],
      "groupPolicy": "allowlist",
      "streamMode": "partial"
    }
  },
  "talk": {
    "voiceId": "21m00Tcm4TlvDq8ikWAM",
    "modelId": "eleven_multilingual_v2",
    "outputFormat": "mp3_44100_128",
    "apiKey": "**********************"
  },
  "gateway": {
    "port": 18789,
    "mode": "local",
    "bind": "loopback",
    "auth": {
      "mode": "token",
      "token": "*******************************"
    },
    "tailscale": {
      "mode": "off",
      "resetOnExit": false
    }
  },
  "skills": {
    "entries": {
      "voice-call": {
        "enabled": true
      },
      "openai-whisper-api": {
        "enabled": true,
        "apiKey": ""
      }
    }
  },
  "plugins": {
    "entries": {
      "telegram": {
        "enabled": true
      },
      "voice-call": {
        "enabled": true
      }
    }
  }
}

Here's the log : 

The logs show that the TTS tool is finishing successfully (taking about 1 second to generate the audio), but there is no follow-up log indicating that the Telegram channel is actually attempting to upload or send the file.


06:49:14 debug diagnostic {"subsystem":"diagnostic"} lane enqueue: lane=session:agent:main:main queueSize=1
06:49:14 debug diagnostic {"subsystem":"diagnostic"} lane dequeue: lane=session:agent:main:main waitMs=14 queueSize=0
06:49:14 debug diagnostic {"subsystem":"diagnostic"} lane enqueue: lane=main queueSize=1
06:49:14 debug diagnostic {"subsystem":"diagnostic"} lane dequeue: lane=main waitMs=1 queueSize=0
06:49:14 debug agent/embedded {"subsystem":"agent/embedded"} embedded run start: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10 sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9 provider=openai model=gpt-4o-mini thinking=off messageChannel=telegram
06:49:14 debug diagnostic {"subsystem":"diagnostic"} session state: sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9 sessionKey=unknown prev=idle new=processing reason="run_started" queueDepth=0
06:49:14 debug diagnostic {"subsystem":"diagnostic"} run registered: sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9 totalActive=1
06:49:14 debug agent/embedded {"subsystem":"agent/embedded"} embedded run prompt start: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10 sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9
06:49:14 debug agent/embedded {"subsystem":"agent/embedded"} embedded run agent start: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10
06:49:15 debug agent/embedded {"subsystem":"agent/embedded"} embedded run tool start: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10 tool=tts toolCallId=call_P5ooUf5mJmzuHk7wmgpRMWgi|fc_054f0ebd54ffe7bb0069785feb7914819783360ac6b31934c5
06:49:16 debug agent/embedded {"subsystem":"agent/embedded"} embedded run tool end: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10 tool=tts toolCallId=call_P5ooUf5mJmzuHk7wmgpRMWgi|fc_054f0ebd54ffe7bb0069785feb7914819783360ac6b31934c5
06:49:18 debug agent/embedded {"subsystem":"agent/embedded"} embedded run agent end: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10
06:49:18 debug agent/embedded {"subsystem":"agent/embedded"} embedded run prompt end: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10 sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9 durationMs=4263
06:49:18 debug diagnostic {"subsystem":"diagnostic"} session state: sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9 sessionKey=unknown prev=processing new=idle reason="run_completed" queueDepth=0
06:49:18 debug diagnostic {"subsystem":"diagnostic"} run cleared: sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9 totalActive=0
06:49:18 debug agent/embedded {"subsystem":"agent/embedded"} embedded run done: runId=25f19c6b-253b-41d9-8531-5de8b8e47c10 sessionId=4f0dcee2-51f6-42af-9cd9-ac3efd6856e9 durationMs=4279 aborted=false
06:49:18 debug diagnostic {"subsystem":"diagnostic"} lane task done: lane=main durationMs=4280 active=0 queued=0
06:49:18 debug diagnostic {"subsystem":"diagnostic"} lane task done: lane=session:agent:main:main durationMs=4282 active=0 queued=0

### @hclsys (2026-01-29)

I've encountered this issue as well and investigated the root cause:

**My Environment**:
- macOS M2 MacBook
- moltbot local installation
- Telegram voice messages (OGG Opus)

**Symptoms I observed**:
1. Voice-only messages: no response
2. Consecutive voice messages: only received reply for the second one
3. Session file bloated to 2.3MB (should be <100KB)
4. Token overflow: 208K > 200K limit

**Root Cause**: The `extractFileBlocks()` function in `apply.ts` misidentifies OGG audio files as text:

1. `looksLikeUtf8Text()` returns `true` for OGG files because OGG headers contain >85% printable ASCII bytes ("OggS" magic + Vorbis/Opus metadata)
2. `guessDelimitedMime()` finds tab characters in the OGG metadata → misidentifies as `text/tab-separated-values`
3. Audio binary gets embedded as text in the session → token overflow

**Evidence from my logs**:
\`\`\`
media: MIME override from "audio/ogg; codecs=opus" to "text/tab-separated-values" for index=0
\`\`\`

**Proposed Fix**: Add an early MIME type check in `extractFileBlocks()` to skip text detection for `audio/*` and `video/*` files (while respecting `forcedTextMimeResolved` from filename extension).

I'm working on a PR to fix this.

### @mw777eds (2026-01-30)

I can confirm this issue exists with the cfg.audio.transcription.command configuration path as well, not just the openai-whisper-api skill.

My Setup:

• Version: 2026.1.24-3
• Channel: Telegram
• Transcription backend: Local WhisperX script via config

Config:
`{
  "audio": {
    "transcription": {
      "command": ["/home/edsadmin/.clawdbot/scripts/whisperx-transcribe.sh"],
      "timeoutSeconds": 120
    }
  }
}`

Observations:

1. The script works perfectly when invoked manually
2. Audio-only messages arrive but don't trigger transcription
3. Adding text with the audio causes transcription to run
4. The function transcribeInboundAudio() exists in dist/auto-reply/transcription.js but is never called from the message processing pipeline
Root Cause Investigation:
I searched the codebase and found that transcribeInboundAudio() is defined but never imported or invoked anywhere in the Telegram message handlers (bot-message.js, bot-message-context.js, bot-message-dispatch.js). The media understanding system for images/video IS wired up, but audio transcription appears to be an unfinished feature.

Request:
When implementing the fix, please ensure both transcription paths work:

1. Skill-based (e.g., openai-whisper-api)
2. Config-based (cfg.audio.transcription.command)
This will allow users to choose between API-based services (OpenAI, Deepgram, etc.) and local transcription tools (Whisper.cpp, WhisperX, etc.) without requiring hard-coded dependencies on specific skills.

[Drafted by OpenClaw bot Nova]

### @Orbita-Media (2026-02-01)

## Additional confirmation + Telegram-specific limitation

**Environment:**
- OpenClaw version: 2026.1.30
- OS: Linux 6.8.0-90-generic (x64)
- Channel: Telegram
- Audio config: `tools.media.audio` enabled with OpenAI gpt-4o-mini-transcribe + local whisper fallback

**Confirmed behavior:**
Same issue here. Voice-only messages are completely ignored - no transcription attempt, no response. Logs show:
```
[telegram] update: {"voice":{...}}
[agent/embedded] embedded run compaction start
```
The voice message is received but immediately skipped before any media processing.

**Critical note on the suggested workaround:**
The workaround "send text with voice" does NOT work for Telegram because **Telegram does not support captions on voice messages** (unlike photos/videos). Users cannot attach text to a voice message - they're separate message types.

Sending a text message before/after the voice message doesn't help either - the voice message itself is still dropped.

**Related issues:**
- #6126 (my earlier report with slightly different framing)
- #4197 (binary OGG garbage remaining in context after transcription)

This effectively means **voice input is completely broken on Telegram** with no user-side workaround possible. Would appreciate priority attention on this.

### @johanbaath (2026-02-01)

Yeah this is def a critical issue as of now...

### @Orbita-Media (2026-02-01)

## Fresh diagnostic data (2026-02-01)

**Environment:** OpenClaw 2026.1.30, Telegram channel, Opus 4.5

### What happens:
1. ✅ Voice message received by Telegram plugin (32s, 668KB OGG)
2. ✅ File downloaded to `~/.openclaw/media/inbound/` (confirmed: `file_77---*.ogg`, 668312 bytes)
3. ✅ Agent run starts
4. ❌ **Transcription never called** — agent ends after ~0.4s without processing audio
5. ❌ No response sent

### Proof transcription works manually:
```bash
curl -s https://api.openai.com/v1/audio/transcriptions \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -F file="@~/.openclaw/media/inbound/file_77---*.ogg" \
  -F model="whisper-1" -F language="de"
# Returns: {"text":"so hier noch mal meine voice...","usage":{"seconds":33}}
```

### Config (relevant parts):
```json
"tools": {
  "media": {
    "audio": {
      "enabled": true,
      "language": "de",
      "models": [
        {"provider": "openai", "model": "gpt-4o-mini-transcribe"}
      ]
    }
  }
}
```

### Journal log pattern:
```
21:40:10 [telegram] update: {...voice":{"duration":32,"mime_type":"audio/ogg"...}}
21:40:12 [agent/embedded] run start
21:40:12 [agent/embedded] run prompt start
21:40:12 [agent/embedded] run agent start
21:40:13 [agent/embedded] run agent end          ← 0.4s, NO transcription!
21:40:13 [agent/embedded] run compaction start
21:40:37 [agent/embedded] run compaction retry
21:40:38 [agent/embedded] run done (25584ms)
```

**No transcription/whisper/openai logs at all** — the media-understanding pipeline is being skipped entirely for voice-only messages.

### Conclusion:
The file is downloaded, the API works, but `applyMediaUnderstanding()` (or equivalent) is never invoked for audio-only Telegram messages. The agent receives the message but has no transcript to respond to.

### @Orbita-Media (2026-02-02)

## Additional Test Results (2026-02-02)

### Test Setup
- Disabled audio transcription (`tools.media.audio.enabled: false`)
- User sent 22-second voice message via Telegram
- Re-enabled transcription after test

### Findings
**The voice message file WAS downloaded successfully:**
```
-rw------- 1 openclaw openclaw 461488 Feb  2 09:00 file_92---7fded217-6241-4e11-935d-ed6724e2ba12.ogg
```

**But the agent was NEVER triggered** - no message arrived, no transcription attempt, no error.

### Conclusion
The bug is NOT in the transcription pipeline - it's in the **message trigger mechanism**. The Telegram plugin downloads voice messages but fails to trigger the agent session.

### Config at time of test:
- `tools.media.audio.enabled: false` (transcription disabled)
- Telegram channel active with `dmPolicy: pairing`
- Same user had text messages trigger normally before/after

This suggests the issue is in how voice messages are routed after download - they're being silently dropped before reaching the agent.


## Links

- None detected yet
