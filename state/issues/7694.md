---
number: 7694
title: "Message ordering conflict when user sends message during active tool execution"
author: liuwenyong1985
created: 2026-02-03T03:51:29Z
updated: 2026-02-03T03:51:29Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7694
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

When a user sends a new message while the agent is actively executing tool calls (exec, gateway, etc.), a "Message ordering conflict" error is triggered. This happens even on a fresh session with the default Anthropic model (Claude Opus 4.5).

## Root Cause (Hypothesis)

During tool execution, the session transcript is being actively modified (appending `tool_use` â†’ `tool_result` message pairs). When a new user message arrives concurrently, both the tool execution pipeline and the inbound message handler attempt to write to the same session, causing a role ordering conflict.

## Steps to Reproduce

1. Start a conversation with the agent (any model)
2. Ask the agent to do something that triggers multiple sequential tool calls (e.g., searching through files, reading configs, etc.)
3. While the agent is still executing tools (visible via typing indicator), send a new message
4. The new message triggers "Message ordering conflict - please try again"

## Expected Behavior

Inbound messages during tool execution should be queued and processed after the current tool execution completes, rather than causing a conflict. The message queue mode (`steer`, `collect`, etc.) should handle this gracefully.

## Observed Behavior

The conflict error is shown to the user, and the message is lost. The user has to resend after the agent finishes.

## Environment

- OpenClaw version: 2026.2.1
- Model: anthropic/claude-opus-4-5
- Channel: Telegram
- Session: main DM session

## Comments


## Links

- None detected yet
