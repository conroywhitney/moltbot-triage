---
number: 7326
title: "Cron tool API doesn't set state.nextRunAtMs - scheduler ignores new 'at' jobs"
author: xrehpicx
created: 2026-02-02T18:01:37Z
updated: 2026-02-02T18:01:37Z
labels: []
assignees: []
comments_count: 0
reactions_total: 1
url: https://github.com/openclaw/openclaw/issues/7326
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug Description

When adding cron jobs via the **tool API** (e.g., the `cron.add` Gateway tool), the scheduler doesn't pick up new `at` jobs because `state.nextRunAtMs` is never set.

## Reproduction Steps

1. Add a job via the cron tool API:
```json
{
  "name": "Test Reminder",
  "schedule": { "kind": "at", "atMs": <future_timestamp> },
  "sessionTarget": "isolated",
  "wakeMode": "now",
  "payload": {
    "kind": "agentTurn",
    "message": "Test message",
    "deliver": true,
    "channel": "telegram",
    "to": "<chat_id>"
  }
}
```

2. Check `cron status` - `nextWakeAtMs` remains at the previous value (e.g., next recurring job), not the newly added `at` job

3. The job never fires automatically

## Expected Behavior

- `state.nextRunAtMs` should be set when adding a job
- `nextWakeAtMs` should be recalculated to the earliest due job

## Workaround

Using the **CLI** works correctly:
```bash
openclaw cron add --name "Reminder" --at "5m" --session isolated --message "text" --deliver --channel telegram --to <id> --wake now
```

The CLI sets `state.nextRunAtMs` and the scheduler picks it up immediately.

## Comparison

| Method | `state.nextRunAtMs` set? | Scheduler recalculates? |
|--------|---------------------------|------------------------|
| CLI (`openclaw cron add`) | ✅ Yes | ✅ Yes |
| Tool API (`cron.add`) | ❌ No | ❌ No |

## Environment

- Version: 2026.2.1 (65a0431)
- OS: Linux (Ubuntu)

## Impact

Agents using the cron tool cannot reliably schedule reminders. The tool API is the primary way agents create reminders, so this effectively breaks reminder functionality for all AI agents.

## Comments


## Links

- None detected yet
