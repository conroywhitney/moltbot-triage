---
number: 7374
title: "Improved compaction summarization with task preservation"
author: joetomasone
created: 2026-02-02T19:13:36Z
updated: 2026-02-02T19:13:36Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7374
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

# Improved compaction summarization with task preservation

## Problem

When compaction occurs, the summary often loses critical context:

1. **"Summary unavailable due to context limits"** - Complete failure to summarize
2. **Active tasks forgotten** - Summary captures conclusions but not in-progress work
3. **Recent user requests lost** - The last few messages before compaction are most important but often truncated

## Proposed Solution

### 1. Force-include recent messages

Always include the last N user messages in the post-compaction context, regardless of summary length:

```yaml
agents:
  clawd:
    compaction:
      preserveLastUserMessages: 5  # Always keep last 5 user messages
      preserveLastAssistantMessages: 3
```

### 2. Task-aware summarization prompt

Modify the summarization prompt to explicitly extract and preserve:
- Currently active tasks (in progress, not completed)
- Pending user requests
- Blockers or waiting-on items
- Recent decisions that affect ongoing work

Example prompt addition:
```
When summarizing, ALWAYS extract and include:
1. Any tasks that are IN PROGRESS (not completed)
2. The last 3 user requests and their status
3. Any commitments made (reminders, follow-ups promised)
```

### 3. Structured summary format

Instead of free-form text, use a structured format:

```markdown
## Active Tasks
- [Task 1]: status, last action

## Recent Requests  
- [Request 1]: status
- [Request 2]: status

## Context
[Free-form summary of relevant background]
```

### 4. Inject workspace state

Automatically inject contents of `memory/active_work.json` (or similar) into the post-compaction context if the file exists.

## Why This Matters

Agents that forget what they're working on mid-task are frustrating to use. The user has to repeat themselves, and work gets lost. This is especially bad for:
- Long-running tasks
- Multi-step workflows
- Tasks that require external follow-up

## Labels
enhancement, agents, summarization

## Comments


## Links

- None detected yet
