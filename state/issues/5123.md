---
number: 5123
title: "[Bug]: ReDoS vulnerability in session filter regex allows denial of service"
author: coygeek
created: 2026-01-31T02:56:50Z
updated: 2026-02-02T03:07:29Z
labels: ["bug"]
assignees: []
comments_count: 3
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5123
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description


## Summary

**Severity:** P0/Critical (Score: 100/150)
**CWE:** [CWE-1333](https://cwe.mitre.org/data/definitions/1333.html) - Inefficient Regular Expression Complexity
**OWASP:** [A05:2021](https://owasp.org/Top10/A05_2021-Security_Misconfiguration/) - Security Misconfiguration
**File:** `src/infra/exec-approval-forwarder.ts:70-77`

The session filter accepts arbitrary regex patterns from configuration and executes them without complexity validation, enabling **ReDoS (Regular Expression Denial of Service)** attacks. A pattern like `(a+)+$` matched against input `"aaaaaaaaaaaaaaaaaaaaaaaaaaaa!"` causes exponential backtracking—each additional 'a' doubles processing time, quickly reaching seconds, then minutes, then hours.

**Why this is critical:** This is in the exec-approval system—security-critical infrastructure that gates command execution. A single malicious regex pattern freezes the entire Node.js event loop, blocking ALL requests (not just approval-related ones). Unlike network DoS requiring sustained traffic, ReDoS needs just one bad config value to completely disable the system. The pattern persists in config, meaning the DoS survives restarts.

## Triage Assessment

| Factor | Value | Score |
|--------|-------|-------|
| **Reachability** | Config-dependent (requires config write access) | 5/40 |
| **Impact** | Denial of Service (complete system hang) | 20/50 |
| **Exploitability** | Single malicious pattern | 30/30 |
| **Verification** | file:line ✓, code ✓, attack steps ✓ | 30/30 |
| **Category Modifier** | Smoking Gun (arbitrary regex execution) | +15 |
| **Total** | — | **100/150** |

## Steps to reproduce
1. Configure `sessionFilter` with a malicious regex pattern like `["(a+)+$"]`
2. Trigger exec approval matching against a string like `"aaaaaaaaaaaaaaaaaaaaaaaaaaaa!"`
3. Observe the Node.js process hanging due to exponential backtracking

## Expected behavior
Session filter patterns should be validated for complexity, or use literal string matching instead of arbitrary regex.

## Actual behavioris that the 
The regex is compiled and executed without any complexity checks or timeout protection, allowing catastrophic backtracking.

### Affected code location:
**File** (`src/infra/exec-approval-forwarder.ts:70-77`):
```typescript
function matchSessionFilter(sessionKey: string, patterns: string[]): boolean {
  return patterns.some((pattern) => {
    try {
      return sessionKey.includes(pattern) || new RegExp(pattern).test(sessionKey);
    } catch {
      return sessionKey.includes(pattern);
    }
  });
}
```

**Also affected** (`src/discord/monitor/exec-approvals.ts:221-227`):
Similar pattern matching logic with same vulnerability.

## Environment
- Version: latest (main branch)
- OS: Any
- Install method: Any

## Logs or screenshots
N/A - issue is in code logic

## Impact
- **Denial of Service**: A single malicious regex pattern can hang the entire gateway
- **Security**: The exec-approvals system is security-critical infrastructure
- **Scope**: Configuration may be accessible to semi-trusted parties

## Recommended fix
1. Validate regex complexity before compilation (reject patterns with nested quantifiers like `(a+)+`)
2. Use a regex safety library like `safe-regex` to detect dangerous patterns
3. Consider using literal string matching for session filters instead of arbitrary regex
4. Alternatively, wrap regex matching with a timeout

## Comments

### @coygeek (2026-02-01)

## CVSS Assessment

| Metric | Value |
|--------|-------|
| **Score** | 4.4 / 10.0 |
| **Severity** | Medium |
| **Vector** | CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H |

> [CVSS v3.1 Calculator](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H)


### @coygeek (2026-02-02)

Closing as duplicate - `src/infra/exec-approval-forwarder.ts` ReDoS is explicitly covered in #6027 (ReDoS via User-Controllable Regular Expression Patterns).

### @coygeek (2026-02-02)

Reopening - this is the original filing. Later duplicates will be closed instead.


## Links

- None detected yet
