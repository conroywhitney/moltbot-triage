---
number: 4159
title: "[Feature]: Include token usage data in chat final events"
author: luccast
created: 2026-01-29T19:45:56Z
updated: 2026-01-30T02:04:05Z
labels: ["enhancement"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4159
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

### Summary

The clawdbot gateway WebSocket API does not include token usage information in chat final events. External monitoring tools that consume these events cannot display API token costs or usage metrics without this data.

### Proposed solution

Include a usage object in the chat event payload when state: "final":

```
  {
    "type": "event",
    "event": "chat",
    "payload": {
      "runId": "...",
      "sessionKey": "...",
      "state": "final",
      "message": { ... },
      "usage": {
        "inputTokens": 1250,
        "outputTokens": 89
      }
    }
  }
```

The ChatEvent type already defines usage as optional, so this is backwards compatible. If the Claude API response includes usage data, forward it through to the event payload.

### Alternatives considered

- Client-side estimation: Estimate tokens from content length (~4 chars/token), but this is inaccurate and doesn't account for input tokens
- Separate API endpoint: Query usage after the fact, but this adds latency and complexity for real-time monitoring

### Additional context

Building a real-time monitoring dashboard Crabwalk (https://github.com/luccast/crabwalk) that displays agent activity. Duration metrics work via lifecycle events, but token usage would help operators monitor costs and identify expensive requests.

## Comments


## Links

- None detected yet
