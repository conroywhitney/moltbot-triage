---
number: 1797
title: "[Bug]: GitHub Copilot Enterprise accounts fail with HTTP 421 Misdirected Request"
author: at10ti0n
created: 2026-01-25T12:40:23Z
updated: 2026-01-28T23:33:34Z
labels: ["bug"]
assignees: []
comments_count: 4
reactions_total: 1
url: https://github.com/openclaw/openclaw/issues/1797
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

GitHub Copilot Enterprise accounts fail with HTTP 421 Misdirected Request because buildCopilotModelDefinition() doesn't include required IDE headers (Editor-Version, Editor-Plugin-Version, etc.) in the model definition.

## Steps to reproduce

1. Authenticate Clawdbot with GitHub Copilot Business/Enterprise using clawdbot models auth login-github-copilot
2. Set a GitHub Copilot model as default: clawdbot models set github-copilot/gpt-4o
3. Make any API request (e.g., trigger a cron job or send a message)
4. Observe the error: 421 Misdirected Request
Expected behavior

GitHub Copilot Enterprise should work just like personal/individual accounts, returning successful responses.

## Actual behavior

All Copilot API calls fail with:

421 Misdirected Request

Direct API test confirms:

```

# Without headers ‚Üí 421 error
# With Editor-Version header ‚Üí ‚úÖ Success

```


### Environment

‚Ä¢ Clawdbot version: 2026.1.23-1
‚Ä¢ OS: Linux 6.1.0-30-amd64 (Debian)
‚Ä¢ Install method: pnpm global
‚Ä¢ Dependency: pi-ai v0.49.3
‚Ä¢ GitHub Plan: Copilot Enterprise

### Logs

Clawdbot gateway logs:

```
System: [2026-01-25 14:00:01 GMT+2] Cron: 421 Misdirected Request
System: [2026-01-25 14:02:17 GMT+2] Cron: 421 Misdirected Request
System: [2026-01-25 14:07:19 GMT+2] Cron: 421 Misdirected Request
System: [2026-01-25 14:12:20 GMT+2] Cron: 421 Misdirected Request
System: [2026-01-25 14:17:22 GMT+2] Cron: 421 Misdirected Request
System: [2026-01-25 14:22:23 GMT+2] Cron: 421 Misdirected Request

```


## Root cause analysis:

‚Ä¢ pi-ai's models.generated.ts includes headers: ‚úÖ
‚Ä¢ Clawdbot's buildCopilotModelDefinition() omits headers: ‚ùå

## Fix

Add required IDE headers to src/providers/github-copilot-models.ts:

```
export function buildCopilotModelDefinition(modelId) {
    const id = modelId.trim();
    if (!id)
        throw new Error("Model id required");
    return {
        id,
        name: id,
        api: "openai-responses",
        reasoning: false,
        input: ["text", "image"],
        cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 },
        contextWindow: DEFAULT_CONTEXT_WINDOW,
        maxTokens: DEFAULT_MAX_TOKENS,
        // Required for GitHub Copilot Enterprise
        headers: {
            "User-Agent": "GitHubCopilotChat/0.35.0",
            "Editor-Version": "vscode/1.107.0",
            "Editor-Plugin-Version": "copilot-chat/0.35.0",
            "Copilot-Integration-Id": "vscode-chat",
        },
    };
}

```

## References

‚Ä¢ pi-ai source: packages/ai/src/models.generated.ts
‚Ä¢ OAuth headers: packages/ai/src/utils/oauth/github-copilot.ts
‚Ä¢ Official SDK: https://github.com/github/copilot-sdk

## Comments

### @at10ti0n (2026-01-25)

## Testing

### Before Fix
```bash
# Replace with your token
export TOKEN="ghu_..."

curl -X POST "https://api.enterprise.githubcopilot.com/chat/completions" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"model":"gpt-4o","messages":[{"role":"user","content":"Hi"}]}'
# Result: 421 Misdirected Request
```

### After Fix

```bash
# Same curl command, but with headers
curl -X POST "https://api.enterprise.githubcopilot.com/chat/completions" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -H "User-Agent: GitHubCopilotChat/0.35.0" \
  -H "Editor-Version: vscode/1.107.0" \
  -H "Editor-Plugin-Version: copilot-chat/0.35.0" \
  -H "Copilot-Integration-Id: vscode-chat" \
  -d '{"model":"gpt-4o","messages":[{"role":"user","content":"Hi"}]}'
# Result: ‚úÖ Success - "Hello! How can I assist you today?"

```


### @at10ti0n (2026-01-25)

Or maybe the long term fix now is the migration to copilot sdk https://github.com/clawdbot/clawdbot/issues/1579

### @at10ti0n (2026-01-27)

This could be allocated to the cloud agent of GitHub Copilot for fixing üòÖ

### @htekdev (2026-01-28)

I also created a pr for this https://github.com/moltbot/moltbot/pull/3624


## Links

- None detected yet
