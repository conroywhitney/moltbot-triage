---
number: 6711
title: "Feature request: gateway:shutdown and gateway:pre-restart hook events"
author: buildzerobob
created: 2026-02-02T00:02:50Z
updated: 2026-02-03T03:49:35Z
labels: ["enhancement"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6711
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

Add lifecycle hook events for gateway shutdown/restart to enable pre-shutdown automations like notifying users.

## Use Case

When running a multi-user BobNet setup with multiple agents (bob, olivia, jarvis, etc.), it's useful to broadcast a notification to all connected users before the gateway restarts, e.g.:

> ðŸ”„ BobNet is restarting. Back in ~30 seconds.

Currently there's no hook event for this. The `gateway:boot` event exists (boot-md hook), but no corresponding shutdown event.

## Proposed Events

- `gateway:shutdown` â€” fires when gateway is stopping (SIGTERM, /stop, etc.)
- `gateway:pre-restart` â€” fires specifically before a restart (optional, could be same as shutdown)

## Current Workaround

Wrapper script that broadcasts before calling `openclaw gateway restart`:

```bash
#!/bin/bash
openclaw message broadcast "ðŸ”„ BobNet restarting..." --targets "$TARGETS"
sleep 2
openclaw gateway restart
```

## Additional Context

The hooks system already supports `command:*` events and has planned events like `session:start` and `session:end`. This would be a natural addition for gateway lifecycle.

---

Submitted via BobNet agent on behalf of @jameswberry

## Comments

### @buildzerobob (2026-02-03)

**Additional request: expose `activeTurns` count in session status**

For graceful restart coordination, we need to know if any sessions have in-flight turns before shutting down. Current session data shows `updatedAt` but this reflects message arrival, not processing completion.

Proposed addition to `sessions.list` or `status` response:
```json
{
  "activeTurns": 2,
  "sessions": [
    { "key": "agent:bob:main", "processing": true, "turnStartedAt": 1234567890 },
    ...
  ]
}
```

**Use case:** `bobnet restart --graceful` wants to:
1. Check `activeTurns`
2. Wait for it to reach 0 (or timeout)
3. Broadcast warning
4. Restart

Without this, we can only use heuristics based on `age` which can't distinguish "finished 5s ago" from "still processing at 5s".


## Links

- None detected yet
