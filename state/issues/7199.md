---
number: 7199
title: "[Bug]: Cron Scheduler Skips Run After Gateway Restart"
author: roelven
created: 2026-02-02T14:54:36Z
updated: 2026-02-02T14:54:36Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7199
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

# Bug Report: Cron Scheduler Skips Run After Gateway Restart

**Date:** 2026-02-02
**Clawdbot Version:** 2026.1.24-3
**Platform:** macOS 15 / Darwin 24.6.0 (Apple Silicon M3 iMac)
**Node Version:** v25.5.0

## Summary

When the Clawdbot gateway restarts shortly before a scheduled cron job is due to run, the cron scheduler miscalculates the `nextRunAtMs` timestamp and skips the imminent run, jumping to the next occurrence instead.

## Steps to Reproduce

1. Create a daily cron job (e.g., `0 7 * * *` @ Europe/Berlin)
2. Wait for gateway restart approximately 1 hour before scheduled run (e.g., restart at 06:00 for 07:00 job)
3. Observe that `nextWakeAtMs` is recalculated to skip the imminent run

## Actual Behavior

- **Job created:** Feb 1, 2026 at 10:09:27 CET
- **Expected next run:** Feb 2, 2026 at 07:00 CET (timestamp: `1770012000000`)
- **Gateway restart:** Feb 2, 2026 at 06:00:03 CET
- **Next wake after restart:** Feb 3, 2026 at 07:00 CET (timestamp: `1770098400000`)

The scheduler **skipped** the Feb 2 07:00 run entirely.

## Expected Behavior

After gateway restart, the cron scheduler should:
- Detect that a run is imminent (within next hour)
- Either preserve the original `nextRunAtMs` or recalculate to the correct upcoming time
- Not skip the imminent run

## Impact

- Scheduled tasks fail to run when gateway restarts near execution time
- Manual intervention required to force job execution
- Reliability impact for automated workflows

## Logs

### Before restart (from jobs.json):
```json
{
  "state": {
    "nextRunAtMs": 1770012000000  // Feb 2, 07:00 CET
  }
}
```

### After gateway restart (from log file at 06:00:03 CET):
```json
{
  "enabled": true,
  "jobs": 1,
  "nextWakeAtMs": 1770098400000  // Feb 3, 07:00 CET — WRONG!
}
```

### Log snippet:
```
{"module":"cron","storePath":"/Users/roelvanderven/.clawdbot/cron/jobs.json"},{"enabled":true,"jobs":1,"nextWakeAtMs":1770098400000},"cron: started"
```

## Workaround

None — job must be manually triggered via `clawdbot cron run <job-id>` with corrected `nextRunAtMs` timestamp, but this is also blocked by scheduler validation ("not-due" check).

## Related Components

- Cron scheduler service (`/opt/homebrew/lib/node_modules/clawdbot/dist/cron/service/ops.js`)
- Job state management (`~/.clawdbot/cron/jobs.json`)

## Suggested Fix

When gateway restarts and cron service initializes:
1. Load existing jobs from `jobs.json`
2. For each job, calculate the next occurrence of its cron schedule **from current time**
3. If calculated time is earlier than stored `nextRunAtMs` but still in the future, use the stored value
4. If stored `nextRunAtMs` is in the past, recalculate from current time
5. Never skip an imminent future run

Alternatively, preserve existing `nextRunAtMs` during initialization and only recalculate when:
- A job actually runs (advance to next occurrence)
- Job schedule is modified
- Gateway was down for an extended period (e.g., >24 hours)

## Comments


## Links

- None detected yet
