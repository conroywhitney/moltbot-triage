---
number: 5017
title: "transcribeInboundAudio() never called for local command path"
author: hclsys
created: 2026-01-30T23:21:34Z
updated: 2026-01-31T05:30:32Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5017
duplicate_of: null
related_issues: [1989,3904]
blocks: []
blocked_by: []
---

## Description

@mw777eds found this while debugging #1989 — the function `transcribeInboundAudio()` exists in dist/auto-reply/transcription.js but nothing in the Telegram handlers actually calls it.

The MIME fix in #3904 stops the binary dump, but this is a separate problem: audio messages just... don't get transcribed when using `cfg.audio.transcription.command`.

Steps from their comment:
1. Set up local transcription via config
2. Send audio-only message → no transcription  
3. Send audio + text → transcription runs

Looks like the wiring was never finished for the local command path.

Ref: https://github.com/openclaw/openclaw/issues/1989#issuecomment-3825177446

## Comments

### @hclsys (2026-01-31)

I took a look at this issue and found something interesting.

First off, your observation is totally valid - audio-only messages aren't triggering transcription while audio+text works fine. That's a real bug.

However, the root cause seems to be different from what you initially suspected. I couldn't find any `transcribeInboundAudio()` function in the codebase (grep returns 0 results). The transcription is actually wired through `applyMediaUnderstanding()` → `runCapability()` in the media-understanding module.

The actual problem is in the legacy config migration. There's a hardcoded allowlist in `src/config/legacy.shared.ts`:

```typescript
const AUDIO_TRANSCRIPTION_CLI_ALLOWLIST = new Set(["whisper"]);
```

When using `whisperx-transcribe.sh` as your transcription command, the migration silently rejects it because `whisperx-transcribe.sh` doesn't match `"whisper"`. The config gets deleted with a log message "Removed audio.transcription (unsupported transcription CLI)" - easy to miss if you're not watching for it.

I'm working on a PR to expand the allowlist to include whisperx variants. Should have it ready soon.


## Links

- None detected yet
