---
number: 3890
title: "[Feature] Add cleanup option for webhook hook mappings"
author: tmchow
created: 2026-01-29T09:24:25Z
updated: 2026-01-29T09:27:18Z
labels: []
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/3890
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Problem

Webhook hook mappings (e.g., Gmail Pub/Sub) create a new session per event via `sessionKey` templating:

```json
{
  "sessionKey": "hook:gmail:{{messages[0].id}}",
  ...
}
```

These sessions accumulate forever with no built-in cleanup mechanism. Over time this leads to:
- Hundreds/thousands of orphaned session entries in `sessions.json`
- Orphaned transcript `.jsonl` files consuming disk space
- In my case: 358 sessions / 44MB before manual cleanup

## Proposed Solution

Add a `cleanup` option to webhook mappings, similar to what `sessions_spawn` already supports:

```json
{
  "match": { "path": "gmail" },
  "action": "agent",
  "sessionKey": "hook:gmail:{{messages[0].id}}",
  "cleanup": "delete",  // <-- new option
  ...
}
```

Options could mirror `sessions_spawn`:
- `"delete"` — remove session + transcript after completion
- `"keep"` — current behavior (default for backwards compat)

## Current Workaround

I'm running a cron job that periodically cleans up `*:hook:*` sessions older than 5 minutes:

```bash
jq 'with_entries(select(
  (.key | contains(":hook:") | not) or 
  (($now - (.value.updatedAt // 0)) <= $maxAge)
))' sessions.json
```

This works but is hacky and requires external maintenance.

## Context

- Webhook hooks are typically fire-and-forget (email triage, notifications, etc.)
- Session history has no value after the single turn completes
- The `sessions_spawn` precedent shows this pattern is already understood

## Comments

### @aryankumar06 (2026-01-29)

i have read this assign this to me



## Links

- None detected yet
