---
number: 3824
title: "Azure AI Foundry (ms-foundry) provider returns empty responses"
author: byoungjo-act3d
created: 2026-01-29T06:55:54Z
updated: 2026-01-31T02:35:42Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 1
url: https://github.com/openclaw/openclaw/issues/3824
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

When using the `ms-foundry` provider with Azure AI Foundry's Anthropic Messages API endpoint, Clawdbot completes agent runs immediately (~250-300ms) with no tool calls and no visible output to the user.

## Configuration

```json
{
  "models": {
    "providers": {
      "ms-foundry": {
        "baseUrl": "https://my-resource.services.ai.azure.com/anthropic/v1",
        "apiKey": "[REDACTED]",
        "api": "anthropic-messages",
        "models": [
          {
            "id": "claude-opus-4-5",
            "name": "MS Foundry Claude Opus 4.5",
            "reasoning": true,
            "input": ["text", "image"],
            "contextWindow": 200000,
            "maxTokens": 8192
          }
        ]
      }
    }
  },
  "agents": {
    "defaults": {
      "model": {
        "primary": "ms-foundry/claude-opus-4-5"
      }
    }
  }
}
```

## Symptoms

- Agent run completes in ~250-300ms (too fast for actual API call)
- No tool calls executed
- No visible output to user
- No errors logged in gateway logs
- Direct curl test to same endpoint works perfectly

## Log Evidence

```
{"subsystem":"agent/embedded"} embedded run start: provider=ms-foundry model=claude-opus-4-5
{"subsystem":"agent/embedded"} embedded run agent start: runId=6dcda670-f337-48d8-9b16-da19ce7ceb80
{"subsystem":"agent/embedded"} embedded run agent end: runId=6dcda670-f337-48d8-9b16-da19ce7ceb80
{"subsystem":"agent/embedded"} embedded run done: durationMs=272 aborted=false
```

Note: No tool calls between start and end.

## Direct API Test (Works)

```bash
curl -X POST 'https://my-resource.services.ai.azure.com/anthropic/v1/messages' \
  -H 'Content-Type: application/json' \
  -H 'x-api-key: [REDACTED]' \
  -H 'anthropic-version: 2023-06-01' \
  -d '{
    "model": "claude-opus-4-5",
    "max_tokens": 100,
    "messages": [{"role": "user", "content": "test"}]
  }'
```

**Response:** Valid JSON with proper message content.

## Environment

- **Clawdbot Version:** 2026.1.24-3
- **Node Version:** v22.22.0
- **OS:** Linux (WSL2)
- **Gateway Log:** `/tmp/clawdbot/clawdbot-2026-01-29.log`

## Workaround

Using `github-copilot/claude-sonnet-4.5` works correctly. The issue appears specific to Azure AI Foundry's Anthropic proxy when used with Clawdbot's `anthropic-messages` API handler.

## Expected Behavior

Agent should make actual API call to Azure endpoint, receive response, execute tool calls, and return output to user â€” same behavior as github-copilot provider.

## Hypothesis

The `anthropic-messages` API implementation may not be handling Azure's specific response format or headers correctly, causing the response to be silently dropped or parsed as empty.

## Comments


## Links

- None detected yet
