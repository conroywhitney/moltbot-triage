---
number: 4725
title: "Agent nodes tool skips exec approval flow for system.run"
author: rmorse
created: 2026-01-30T15:30:14Z
updated: 2026-01-31T02:29:02Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4725
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug

When an agent invokes `system.run` via the nodes tool (`createNodesTool` in `src/agents/tools/nodes-tool.ts`), the command is sent directly to the node without going through the exec approval flow. If the node requires approval (`SYSTEM_RUN_DENIED: approval required`), the error propagates unhandled and the command fails.

The CLI path (`nodes run`) already handles this correctly by requesting approval via `exec.approval.request` and retrying with `approved: true` + `approvalDecision`, but the agent tool path does not.

## Expected behavior

The nodes tool should:

1. Attempt `node.invoke` with `system.run` without approval flags
2. If the node responds with `SYSTEM_RUN_DENIED: approval required`, create a pending approval request on the gateway via `exec.approval.request`
3. Wait for the user to approve/deny via the UI (with a 120s timeout)
4. If approved, retry `node.invoke` with `approved: true` and the approval decision
5. If denied or timed out, throw a clear error

## Actual behavior

The nodes tool sends `system.run` without approval flags and does not catch or handle the `SYSTEM_RUN_DENIED` error, so commands that require approval always fail from agent context.

## Comments


## Links

- None detected yet
