---
number: 6921
title: "[nextcloud-talk] Outbound message/reaction signatures computed over JSON body instead of parameter value"
author: vrijsinghani
created: 2026-02-02T06:11:09Z
updated: 2026-02-02T06:11:09Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6921
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description


## Description

Outbound bot messages and reactions fail with `401 Unauthorized` because the HMAC signature is computed over the JSON request body instead of just the parameter value.

## Root Cause

Nextcloud Talk's `BotController.php` validates signatures like this:

```php
// For messages:
$bot = $this->getBotFromHeaders($token, $message);  // passes message TEXT

// For reactions:
$bot = $this->getBotFromHeaders($token, $reaction);  // passes reaction TEXT
The signature is validated as HMAC-SHA256(random + parameterValue, secret).

OpenClaw signs the full JSON body instead:

send.ts ~line 96 (messages):

const { random, signature } = generateNextcloudTalkSignature({
    body: bodyStr,  // ‚ùå Signs: {"message":"Hello"}
    secret,
});
send.ts ~line 165 (reactions):

const body = JSON.stringify({ reaction });
const { random, signature } = generateNextcloudTalkSignature({
    body,  // ‚ùå Signs: {"reaction":"üëç"}
    secret,
});
Fix
For messages:

- const { random, signature } = generateNextcloudTalkSignature({
-     body: bodyStr,
-     secret,
- });
+ const { random, signature } = generateNextcloudTalkSignature({
+     body: message,
+     secret,
+ });
For reactions:

- const body = JSON.stringify({ reaction });
+ const jsonBody = JSON.stringify({ reaction });
  const { random, signature } = generateNextcloudTalkSignature({
-     body,
+     body: reaction,
      secret,
  });
+ // Then use jsonBody in the fetch body
Tested
Manual curl with correct signature (signing just the message text) returns HTTP 201 and message appears in room.

Environment
OpenClaw: 2026.1.30
Nextcloud: 32.0.4.1
Nextcloud Talk: 22.0.8

## Comments


## Links

- None detected yet
