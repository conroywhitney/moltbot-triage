---
number: 4160
title: "Feature proposal: web4-governance extension for audit trails and policy-based tool gating"
author: dp-web4
created: 2026-01-29T19:45:57Z
updated: 2026-01-29T19:45:57Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4160
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Overview

I'd like to contribute a **web4-governance extension** that adds cryptographic audit trails and policy-based pre-action gating to moltbot agent sessions. This is a self-contained extension (~1000 lines) that leverages moltbot's plugin hooks without modifying core code.

*Note: "web4" = trust-native internet infrastructure for the AI agent era (cryptographic provenance, verifiable
  accountability). Generic descriptor, not a trademark claim.*

## What it does

**R6 Audit Chain:**

- R6 = Rules + Role + Request + Reference + Resource → Result (structured audit record format)
- Records every tool call with cryptographic provenance (SHA-256 hash-linked chain)
- Captures: tool name, parameters, category, result, duration, errors
- Tamper-evident: each record links to previous via content hash
- Persistent: stored in `~/.moltbot/extensions/web4-governance/`

**Policy Engine:**

- Pre-action gating: allow/deny/warn decisions before tools execute
- Rule-based: match on tool name, category, target patterns, rate limits
- Dry-run mode: log violations without blocking (for testing)
- Built-in presets: safety, restrictive, permissive

**Policy Entities (trust network):**

- Policies as first-class participants with hash-tracked identity
- Witnessing chain: sessions witness policies, policies witness decisions
- Immutable: changing policy = new entity with new hash

**CLI Commands:**

- `moltbot audit summary/verify/last/query/report` - inspect audit trails
- `moltbot policy status/rules/test/presets/entities` - manage policies

## Why this matters

**Use cases:**

- **Compliance**: Auditable trail of agent actions for regulated environments
- **Safety**: Policy gates to prevent dangerous operations
- **Development**: Debug/replay agent behavior from audit logs
- **Trust**: Cryptographic proof of what the agent actually did

## Implementation approach

**Self-contained extension:**

- Lives entirely in `extensions/web4-governance/`
- No core moltbot modifications (except one test lint fix)
- Uses existing plugin SDK (`before_tool_call`, `after_tool_call` hooks)
- Optional: users opt-in via config

**Clean integration:**

```json
{
  "extensions": {
    "web4-governance": {
      "auditLevel": "standard",
      "policy": { "preset": "safety" }
    }
  }
}
```

## Code structure

```
extensions/web4-governance/
├── index.ts              # Plugin entry point
├── package.json          # Extension metadata
├── README.md            # Documentation
├── ARCHITECTURE.md      # Design principles
└── src/
    ├── r6.ts            # R6 audit record format
    ├── audit.ts         # Hash-linked chain
    ├── policy.ts        # Policy engine
    ├── policy-entity.ts # Policy as trust participant
    ├── presets.ts       # Built-in policies
    ├── rate-limiter.ts  # Rate limiting
    └── *.test.ts        # Unit tests
```

## Prior art

This work builds on the **before_tool_call/after_tool_call hooks** that were added to moltbot's plugin system. The extension demonstrates how those hooks enable powerful observability without touching core code.

## Questions for maintainers

1. **Interest level**: Is this type of extension useful for the moltbot ecosystem?
2. **Approach**: Does the plugin-based approach seem clean, or would you prefer different integration?
3. **Scope**: Should I split this into multiple PRs (basic audit → policy engine → policy entities)?
4. **Naming**: Is `web4-governance` appropriate, or prefer something like `audit-policy`?

## Next steps

If this aligns with moltbot's goals, I'm happy to:

- Submit PR(s) following your preferred approach
- Add documentation
- Provide examples/demos
- Break into smaller incremental PRs if preferred

I have working code in my fork: https://github.com/dp-web4/moltbot/tree/web4-governance-complete

Thanks for considering this contribution!

## Comments


## Links

- None detected yet
