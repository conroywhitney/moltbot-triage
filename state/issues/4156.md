---
number: 4156
title: "WhatsApp TTS sends MP3 instead of Opus"
author: lucasmpramos
created: 2026-01-29T19:42:47Z
updated: 2026-01-29T19:42:47Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4156
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Problem

WhatsApp voice notes are sent as MP3, but WhatsApp's native audio format is OGG/Opus. Some Android devices fail to play MP3 voice notes correctly.

## Current Behavior

In ⁠ dist/tts/tts.js ⁠, ⁠ resolveOutputFormat() ⁠ only returns Opus for Telegram:

⁠ javascript
function resolveOutputFormat(channelId) {
    if (channelId === "telegram")
        return TELEGRAM_OUTPUT;  // opus
    return DEFAULT_OUTPUT;       // mp3
}
 ⁠

Additionally, ⁠ resolveChannelId() ⁠ uses a plugin registry lookup that can return ⁠ null ⁠ when called from the TTS tool context, even when a valid channel string is passed.

## Expected Behavior

WhatsApp should use Opus format like Telegram, since both platforms natively support OGG/Opus for voice messages.

## Suggested Fix

⁠ javascript
function resolveOutputFormat(channelId) {
    if (channelId === "telegram" || channelId === "whatsapp")
        return TELEGRAM_OUTPUT;
    return DEFAULT_OUTPUT;
}

function resolveChannelId(channel) {
    if (!channel) return null;
    const lower = String(channel).toLowerCase().trim();
    if (lower === "whatsapp" || lower === "telegram") return lower;
    return normalizeChannelId(channel);
}
 ⁠

## Environment

•⁠  ⁠Clawdbot version: 2026.1.24-3
•⁠  ⁠Platform: WhatsApp via Baileys
•⁠  ⁠TTS provider: ElevenLabs (but affects all providers)

## References

•⁠  ⁠WhatsApp uses Opus codec: https://developers.facebook.com/docs/whatsapp/api/media
•⁠  ⁠Opus is the standard for voice messages on WhatsApp, Telegram, Discord, etc.

## Comments


## Links

- None detected yet
