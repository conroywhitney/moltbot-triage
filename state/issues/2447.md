---
number: 2447
title: "[Feature]: Add config option to disable external CLI credential sync"
author: mmto-io
created: 2026-01-26T23:37:50Z
updated: 2026-01-28T06:01:42Z
labels: ["enhancement"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/2447
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Problem

When using environment variables for API keys (e.g., `${ANTHROPIC_API_KEY}` in config),
clawdbot still auto-syncs credentials from Claude Code CLI to `auth-profiles.json` on
every startup.

For users implementing "zero secrets at rest" (all credentials in external secret
managers like 1Password, HashiCorp Vault, etc.), this creates an unwanted copy of
credentials on disk that cannot be disabled.

## Current Behavior

`syncExternalCliCredentials()` runs unconditionally in `store.js:158-163`:
```javascript
const synced = syncExternalCliCredentials(asStore);
if (synced) {
    saveJsonFile(authPath, asStore);
}
```

## Requested Feature

Add a config option to disable external CLI sync:

```json
{
  "auth": {
    "syncExternalCli": false
  }
}
```

When `false`:
- Skip `syncExternalCliCredentials()` entirely
- Do not read from `~/.claude/.credentials.json` or Keychain
- Users who want this behavior can still use env vars or direct API keys

## Use Case

Security-conscious deployments where:
- All secrets managed externally (1Password, Vault, etc.)
- Secrets injected as env vars at runtime
- No plaintext credentials should exist on disk
- Defense in depth: even if file perms are 0600, prefer no secrets at all

## Comments

### @mmto-io (2026-01-27)

## Workaround: Environment Variable Patch

While waiting for the `auth.syncExternalCli` config option, here's a working workaround using an environment variable check.

### Patch

In `dist/agents/auth-profiles/external-cli-sync.js`, modify `syncExternalCliCredentials()`:

```javascript
export function syncExternalCliCredentials(store, options) {
    let mutated = false;
    const now = Date.now();
    // PATCH: Skip Claude CLI sync if env var is set
    const skipClaudeSync = process.env.CLAWDBOT_SKIP_CLAUDE_CLI_SYNC === "1";
    // Sync from Claude Code CLI
    const existingClaude = store.profiles[CLAUDE_CLI_PROFILE_ID];
    const shouldSyncClaude = \!skipClaudeSync && (\!existingClaude ||
        existingClaude.provider \!== "anthropic" ||
        existingClaude.type === "token" ||
        \!isExternalProfileFresh(existingClaude, now));
    // ... rest unchanged
```

### Usage

Add to your startup script:
```bash
export CLAWDBOT_SKIP_CLAUDE_CLI_SYNC="1"
```

### Use Case

Running Claude Code (personal) and Clawdbot (separate agent) on the same machine, each with their own Claude account. The sync was causing Clawdbot to hijack the Claude Code OAuth credentials instead of using its own API key from `${ANTHROPIC_API_KEY}`.

This patch disables the sync, allowing each to maintain separate auth.

---

Would be happy to submit a PR if this approach (env var or config option) is acceptable.


## Links

- None detected yet
