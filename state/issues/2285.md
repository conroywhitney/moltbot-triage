---
number: 2285
title: "Local CDP health check / timeout for managed browser"
author: blusskin
created: 2026-01-26T16:46:53Z
updated: 2026-01-29T00:04:21Z
labels: ["bug"]
assignees: []
comments_count: 2
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/2285
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Problem

When using the managed `clawd` browser profile, Chrome can lose its CDP debugging port (`--remote-debugging-port=18800`) while the main process stays alive. This creates a "zombie Chrome" state where:

1. Chrome process is running (PID exists, status shows it alive)
2. CDP port is unresponsive (curl to `/json/version` hangs indefinitely)
3. `clawdbot browser status` shows `running: false`, `cdpReady: false`
4. Browser tool calls hang forever waiting for CDP connection

## Current Behavior

- `browser.remoteCdpTimeoutMs` only applies to **non-loopback** (remote) CDP connections
- Local CDP connections have no timeout â€” they wait indefinitely
- The browser control server blocks on `/tabs/open` and similar endpoints when Chrome's CDP is dead
- No automatic health check or watchdog exists for local managed browsers

## Expected Behavior

1. Local CDP connections should have a configurable timeout (e.g., `browser.localCdpTimeoutMs`)
2. Optionally: periodic health check that detects zombie Chrome and auto-restarts
3. At minimum: fail fast with a clear error instead of hanging forever

## Reproduction

1. Start the clawd managed browser: `clawdbot browser --browser-profile clawd start`
2. Wait for Chrome to become a zombie (happens intermittently, possibly related to macOS sleep/wake)
3. Try any browser operation: `clawdbot browser --browser-profile clawd tabs`
4. Observe infinite hang

## Workaround

Kill the zombie Chrome manually:
```bash
pkill -f "remote-debugging-port=18800"
```

Then retry â€” Clawdbot spawns a fresh instance.

## Environment

- macOS 15.7.3
- Clawdbot (npm)
- Chrome (system default)
- CDP port 18800

## Suggested Implementation

Add a health check before browser operations that:
1. Attempts to connect to CDP with a short timeout (e.g., 3s)
2. If unresponsive, kills the stale Chrome process
3. Restarts the browser automatically

Or expose `browser.localCdpTimeoutMs` config so users can control the timeout.

## Comments

### @ryanshrott (2026-01-26)

I also experience hanging/stuck behavior when using browser 

### @GavinRiver (2026-01-29)

## Workaround: External Chromium with CDP URL

I encountered this issue running Moltbot in Docker with **host network mode**. The browser control service showed "ready" but browser tool calls timed out after 15 seconds.

### Root Cause
In host network mode, the local CDP connection seems to hang indefinitely when Chromium doesn't start properly or responds slowly.

### Solution
Instead of relying on Moltbot's managed browser, I configured an **external Chromium instance** with explicit CDP URL:

#### 1. Create startup script (`~/.clawdbot/start-with-browser.sh`)
```bash
#!/bin/bash
# Start Chromium first
chromium \
  --headless \
  --no-sandbox \
  --disable-gpu \
  --disable-dev-shm-usage \
  --remote-debugging-address=0.0.0.0 \
  --remote-debugging-port=9222 \
  --user-data-dir=/tmp/chromium-profile \
  about:blank &

# Wait for Chromium to initialize
sleep 2

# Start Moltbot gateway
exec node dist/index.js gateway --bind loopback --port 18789
```

#### 2. Add `cdpUrl` to `moltbot.json`
```json
{
  "browser": {
    "enabled": true,
    "executablePath": "/usr/bin/chromium",
    "noSandbox": true,
    "headless": true,
    "cdpUrl": "http://127.0.0.1:9222"
  }
}
```

#### 3. Update `docker-compose.override.yml`
```yaml
services:
  moltbot-gateway:
    network_mode: host
    command: ["/bin/bash", "/home/node/.clawdbot/start-with-browser.sh"]
```

### Result
- Chromium starts reliably on port 9222
- CDP responds immediately (`curl http://127.0.0.1:9222/json/version` works)
- Browser tools work without timeout
- Survives container restarts

### Environment
- Docker with host network mode
- Debian 12 (bookworm) based container
- Chromium 144.0.7559.96

Hope this helps others facing similar issues! ðŸŽ‰


## Links

- None detected yet
