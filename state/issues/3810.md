---
number: 3810
title: "Feature Request: Add `retries` option under `agents.defaults.model`"
author: XWeaponX7
created: 2026-01-29T06:32:42Z
updated: 2026-01-29T06:32:42Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/3810
duplicate_of: null
related_issues: [3615]
blocks: []
blocked_by: []
---

## Description

## Problem

When the primary model fails (e.g., OAuth token expiration, transient API errors, rate limits), Clawdbot immediately falls through to the fallback model. There's no retry mechanism at the model level — a single transient failure means the user gets a completely different (often weaker) model response.

This is especially painful with OAuth-based providers like Anthropic, where occasional token refresh races or brief API hiccups can cause unnecessary fallback to a much less capable model.

## Proposed Solution

Add a `retries` parameter under `agents.defaults.model`:

```json
{
  "agents": {
    "defaults": {
      "model": {
        "primary": "anthropic/claude-opus-4-5",
        "fallbacks": ["minimax-cn/MiniMax-M2.1"],
        "retries": 3
      }
    }
  }
}
```

**Behavior:**
- Before falling through to `fallbacks`, retry the current model up to `retries` times
- Apply exponential backoff between retries (similar to existing `channels.telegram.retry` pattern)
- Default: `0` (current behavior, no retries)
- Optional extended config for fine-grained control:

```json
"retries": {
  "attempts": 3,
  "minDelayMs": 1000,
  "maxDelayMs": 10000,
  "jitter": 0.2,
  "retryOn": ["timeout", "rate_limit", "server_error"]
}
```

## Why This Makes Sense

1. **Consistency exists elsewhere** — `channels.telegram.retry` already has this exact pattern (`attempts`, `minDelayMs`, `maxDelayMs`, `jitter`). Applying the same to model calls is a natural extension.
2. **OAuth is fragile** — Token refresh races between Clawdbot and Claude CLI (see #3615) cause intermittent failures that would resolve on retry.
3. **Transient errors are common** — API rate limits, brief outages, and network blips are all retryable.
4. **Fallback ≠ Retry** — Falling back to a weaker model is a much bigger impact than waiting 2 seconds and retrying the same model.

## Alternatives Considered

- **Manual heartbeat-based token monitoring** — Works but reactive, not proactive
- **Multiple auth profiles for the same provider** — Doesn't solve transient API errors
- **External retry wrapper** — Adds complexity outside Clawdbot's control

## Environment

- Clawdbot: 2026.1.24-3
- Primary: `anthropic/claude-opus-4-5` (OAuth)
- Fallback: `minimax-cn/MiniMax-M2.1` (API key)

## Comments


## Links

- None detected yet
