---
number: 7001
title: "[Bug]: Voice-call WebSocket media stream endpoint lacks authentication"
author: coygeek
created: 2026-02-02T08:45:27Z
updated: 2026-02-02T09:08:40Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7001
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## CVSS Assessment

| Metric | Value |
|--------|-------|
| **Score** | 9.1 / 10.0 |
| **Severity** | Critical |
| **Vector** | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N |

> [CVSS v3.1 Calculator](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N)


## Summary

The voice-call extension's WebSocket media stream endpoint (`/voice/stream`) accepts connections without any authentication, origin validation, or session binding. While HTTP webhook requests are properly authenticated via Twilio/Plivo signature verification, WebSocket upgrade requests bypass this security entirely, allowing unauthenticated attackers to intercept call transcripts and inject audio into active calls.

## Affected Code

**File:** `extensions/voice-call/src/webhook.ts:161-170`
```typescript
// Handle WebSocket upgrades for media streams
if (this.mediaStreamHandler) {
  this.server.on("upgrade", (request, socket, head) => {
    const url = new URL(request.url || "/", `http://${request.headers.host}`);

    if (url.pathname === streamPath) {
      console.log("[voice-call] WebSocket upgrade for media stream");
      this.mediaStreamHandler?.handleUpgrade(request, socket, head);
    } else {
      socket.destroy();
    }
  });
}
```

**File:** `extensions/voice-call/src/media-stream.ts:74-83`
```typescript
handleUpgrade(request: IncomingMessage, socket: Duplex, head: Buffer): void {
  if (!this.wss) {
    this.wss = new WebSocketServer({ noServer: true });
    this.wss.on("connection", (ws, req) => this.handleConnection(ws, req));
  }

  this.wss.handleUpgrade(request, socket, head, (ws) => {
    this.wss?.emit("connection", ws, request);
  });
}
```

## Attack Surface

**How is this reached?**
- [x] Network (HTTP/WebSocket endpoint, API call)
- [ ] Adjacent Network (same LAN, requires network proximity)
- [ ] Local (local file, CLI argument, environment variable)
- [ ] Physical (requires physical access to machine)

**Authentication required?**
- [x] None (unauthenticated/public access)
- [ ] Low (any authenticated user)
- [ ] High (admin/privileged user only)

**Entry point:** WebSocket upgrade request to `/voice/stream` (or configured `streaming.streamPath`)

## Exploit Conditions

**Complexity:**
- [x] Low (no special conditions, works reliably)
- [ ] High (requires race condition, specific config, or timing)

**User interaction:**
- [x] None (automatic, no victim action needed)
- [ ] Required (victim must click, visit, or perform action)

**Prerequisites:**
- Voice-call extension enabled with `streaming.enabled: true`
- Attacker must know or guess the WebSocket endpoint URL (predictable default: `/voice/stream`)
- Active voice call in progress (for interception/injection)

## Impact Assessment

**Scope:**
- [x] Unchanged (impact limited to vulnerable component)
- [ ] Changed (can affect other components, escape sandbox)

| Impact Type | Level | Description |
|-------------|-------|-------------|
| Confidentiality | High | Attacker can receive real-time transcripts of all voice calls, exposing sensitive conversation content |
| Integrity | High | Attacker can inject arbitrary audio into active calls via the bidirectional WebSocket, potentially impersonating parties or manipulating conversations |
| Availability | None | No direct availability impact |

## Steps to Reproduce

1. Configure voice-call extension with streaming enabled:
   ```yaml
   plugins:
     entries:
       voice-call:
         config:
           enabled: true
           streaming:
             enabled: true
             streamPath: "/voice/stream"
   ```

2. Start the voice-call webhook server (e.g., via ngrok tunnel or public endpoint)

3. Initiate a voice call through the system

4. From any network location, connect to the WebSocket endpoint:
   ```javascript
   const ws = new WebSocket('wss://your-public-endpoint/voice/stream');
   ws.onmessage = (event) => {
     const data = JSON.parse(event.data);
     if (data.event === 'media') {
       // Receive raw call audio
       console.log('Intercepted audio chunk:', data.media.payload);
     }
   };
   // Inject audio by sending media events
   ws.send(JSON.stringify({
     event: 'media',
     streamSid: 'known-or-guessed-sid',
     media: { payload: '<base64-audio>' }
   }));
   ```

5. Observe that the connection is accepted without any authentication challenge

## Recommended Fix

Add authentication to the WebSocket upgrade handler. Options include:

1. **Session binding**: Require a cryptographically signed token in the WebSocket URL or first message that ties the connection to a specific call session:
   ```typescript
   this.server.on("upgrade", (request, socket, head) => {
     const url = new URL(request.url || "/", `http://${request.headers.host}`);

     if (url.pathname === streamPath) {
       // Verify session token
       const token = url.searchParams.get('token');
       if (!this.validateStreamToken(token)) {
         socket.write('HTTP/1.1 401 Unauthorized\r\n\r\n');
         socket.destroy();
         return;
       }
       this.mediaStreamHandler?.handleUpgrade(request, socket, head);
     }
   });
   ```

2. **Origin validation**: Restrict connections to trusted origins (Twilio/Plivo IP ranges) when the endpoint is publicly exposed

3. **Provider-specific validation**: For Twilio, validate that the WebSocket connection comes from Twilio's infrastructure by checking the `start` message contains valid `accountSid` matching configuration

## References

- **CWE:** [CWE-306](https://cwe.mitre.org/data/definitions/306.html) - Missing Authentication for Critical Function

## Comments


## Links

- None detected yet
