---
number: 6877
title: "[Bug] Pre-compaction memory flush prompt causes agents to overwrite existing memory files"
author: EmberCF
created: 2026-02-02T04:34:07Z
updated: 2026-02-02T04:34:07Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6877
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

The default pre-compaction memory flush prompt instructs agents to "Store durable memories now" but doesn't specify to **append** to existing files. This causes agents to overwrite memory files with only the current session's content, losing earlier entries.

## Reproduction

1. Agent writes to `memory/2026-02-02.md` during session
2. Session continues, more context builds up
3. Pre-compaction flush triggers with prompt:
   > "Pre-compaction memory flush. Store durable memories now (use memory/YYYY-MM-DD.md; create memory/ if needed)."
4. Agent interprets "store memories" as "write current memories to file"
5. Agent uses `write` tool to create file content — **overwrites** existing file
6. Earlier content from same day is lost

## Evidence

Git history shows `memory/2026-02-02.md` being completely replaced:
```
5995c00 Daily log: Twitter engagement launched, content-screener progress
225696f Daily memory: X article guide published, security principles, bio update
```

The diff shows the entire "Published Today", "Key Lessons Learned", "Workflow Updates" sections were lost and replaced with different content.

## Root Cause

The prompt doesn't instruct agents to:
1. **Read the existing file first** before writing
2. **Append** new content rather than overwrite
3. Or **use a unique filename** per flush (e.g., `memory/2026-02-02-1530.md`)

## Proposed Fix

Update `DEFAULT_MEMORY_FLUSH_PROMPT` in `memory-flush.js`:

```javascript
export const DEFAULT_MEMORY_FLUSH_PROMPT = [
    "Pre-compaction memory flush.",
    "Store durable memories now (use memory/YYYY-MM-DD.md; create memory/ if needed).",
    "IMPORTANT: If the file already exists, READ it first and APPEND new content — do not overwrite existing entries.",
    `If nothing to store, reply with ${SILENT_REPLY_TOKEN}.`,
].join(" ");
```

Or alternatively, use timestamped filenames:
```javascript
"Use memory/YYYY-MM-DD-HHMM.md for each flush to avoid overwrites."
```

## Environment
- OpenClaw version: 2026.1.24-3
- Model: github-copilot/claude-opus-4.5
- OS: Linux (CachyOS)

## Workaround

Agents can add to their AGENTS.md:
```
When doing memory flushes, always READ the existing file first and APPEND new content.
```

## Comments


## Links

- None detected yet
