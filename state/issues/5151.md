---
number: 5151
title: "Telegram voice messages: ogg binary injected as text/plain into agent context"
author: Holipori
created: 2026-01-31T04:00:34Z
updated: 2026-02-02T09:53:54Z
labels: ["bug"]
assignees: []
comments_count: 4
reactions_total: 2
url: https://github.com/openclaw/openclaw/issues/5151
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug Description

When a Telegram voice message (`.ogg` file) is received, the raw binary content of the audio file is injected into the agent context as a `<file>` block with `mime="text/plain"`. This causes thousands of garbage characters to consume tokens unnecessarily.

## Steps to Reproduce

1. Send a voice message via Telegram to the bot
2. Observe the agent context — the message includes a `<file name="file_N---...ogg" mime="text/plain">` block containing raw binary audio data interpreted as text

## Expected Behavior

Audio files (`.ogg`, `.mp3`, etc.) should either:
- **Not** be injected as `<file>` text blocks (since they are binary, not text)
- Be excluded from text extraction when their actual MIME type is `audio/*`
- Only provide the transcription text (if `tools.media.audio` is configured)

## Actual Behavior

The `.ogg` file is treated as `text/plain` and its binary content is dumped into the context, producing thousands of garbled characters like:

```
<file name="file_4---...ogg" mime="text/plain"> 杏卧Ȁ 晌쉦 蜗䙞ጁ灏獵效摡āĸ뮀 ... </file>
```

This wastes significant tokens on every voice message.

## Environment

- OpenClaw version: 2026.1.29
- Channel: Telegram
- Audio transcription: Configured via `tools.media.audio` with Whisper API (transcription works correctly)
- The transcription text appears correctly, but the raw binary is *also* injected

## Workaround

None currently. The binary content is always injected regardless of audio transcription configuration.

## Comments

### @Holipori (2026-01-31)

The expected behavior should be clearer:

The transcription should **not** be converted to pure plain text. Instead, it should include a **marker** indicating the text was transcribed from a voice message. For example:

```
[voice_transcript]: Hello, can you check the weather today?
```

or using XML-style tags:

```
<voice_transcript>Hello, can you check the weather today?</voice_transcript>
```

This is important because:
1. The agent can adjust for potential transcription errors
2. The agent knows the input tone is conversational/spoken (not carefully typed)
3. It preserves the semantic distinction between typed text and voice input

The key point: **drop the raw binary, keep the transcription, but mark it as voice-originated.**

### @bjgrosse (2026-01-31)

Yep, seeing the same thing. Would love to see this fixed. 

### @kesslerio (2026-01-31)

Hit this today on Telegram voice messages. Configured `tools.media.audio` with a local Whisper CLI — transcription works fine when I invoke the skill manually, but the pipeline never triggers automatically. The raw OGG binary ends up in context as garbage text instead.

Agree with the suggestion to mark transcribed text distinctly (`[voice_transcript]` or similar) — helps the model know it's dealing with spoken input.

### @jorgermp (2026-02-02)

### Production confirmation + additional outbound voice issue

**Environment:** OpenClaw 2026.1.30 (stable), Telegram channel, Claude Opus 4.5, Whisper API transcription

#### Inbound (confirming this issue)

We can confirm this issue in production. When receiving Telegram voice messages, the raw OGG/Opus binary is injected as `text/plain` into the agent context alongside the (correct) transcription. This causes:

- **Hundreds to thousands of wasted tokens** per voice message
- **Degraded agent responses** — the model sometimes references or gets confused by the binary garbage
- **Context window pollution** — after a few voice messages, useful conversation history gets pushed out

The transcription itself works perfectly. The binary blob is completely redundant and harmful.

Strongly support the `stripAfterTranscript` proposal from #4197 — ideally this should be the **default behavior**, not opt-in. There is no scenario where raw OGG bytes are useful to an LLM when a transcript is already available.

#### Outbound: `asVoice: true` doesn't produce native Telegram voice notes

We also discovered a related **outbound** issue: when the agent sends audio via the `message` tool with `asVoice: true`, Telegram receives it as a **file attachment** instead of a **native voice note bubble** if the audio format is not OGG/Opus.

The built-in TTS generates WebM files. Telegram's Bot API requires OGG with Opus codec for `sendVoice` to produce native voice bubbles. OpenClaw does not auto-convert, so `asVoice: true` silently falls back to `sendDocument`.

**Workaround:** Convert to OGG/Opus before sending:
```bash
ffmpeg -i input.webm -c:a libopus -b:a 64k output.ogg
```
Then send with `asVoice: true` + the `.ogg` file — this produces a proper native voice note.

**Suggestion:** OpenClaw could auto-convert audio to OGG/Opus when `asVoice: true` is used on the Telegram channel, similar to how image formats are handled.


## Links

- None detected yet
