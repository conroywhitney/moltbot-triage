---
number: 2678
title: "Webchat: markdown horizontal rules (---) render as literal dashes"
author: ludwiczakpawel
created: 2026-01-27T08:44:50Z
updated: 2026-01-28T05:59:36Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/2678
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

In the webchat UI, markdown horizontal rules (`---`) are displayed as literal three dashes instead of rendering as an `<hr>` element.

## Expected Behavior

`---` on its own line (with blank lines around it) should render as a horizontal rule / visual divider.

## Current Behavior

The three dashes appear as plain text: `---`

## Analysis

Looking at the source (`ui/src/ui/markdown.ts`):
- `marked` is configured with `gfm: true, breaks: true` — `marked.parse('---')` correctly outputs `<hr>`
- `hr` is in the `allowedTags` array for DOMPurify
- CSS exists: `.chat-text :where(hr) { border: 0; border-top: 1px solid var(--border); ... }`

So the pipeline should work end-to-end. Possible causes:
1. Something in message preprocessing or streaming that interferes with the parsing
2. A context-dependent `marked` issue where surrounding content prevents `---` from being recognized as a thematic break

## Reproduction

Send a message from the agent that includes `---` as a divider between sections. The webchat renders it as literal text.

## Comments

### @JoeyYu23 (2026-01-27)

## Analysis

I investigated this issue and confirmed that the markdown pipeline works correctly in isolation:

```javascript
// All tests pass ✓
marked.parse('---')                          // → <hr>
marked.parse('Section 1\n\n---\n\nSection 2') // → <p>Section 1</p><hr><p>Section 2</p>
```

The configuration in `ui/src/ui/markdown.ts` is correct:
- `marked` options: `gfm: true, breaks: true, mangle: false`
- `hr` is in `allowedTags` for DOMPurify
- CSS exists for `.chat-text :where(hr)`

### Possible root causes

1. **Streaming state issue**: During streaming, partial content like `text\n--` (incomplete `---`) renders as `<p>--</p>`. When the full `---` arrives, it should re-render correctly, but caching might interfere.

2. **Message content format**: If the message doesn't have proper blank lines around `---`, it could be interpreted as a setext-style heading:
   ```
   text\n---   → <h2>text</h2>  (not hr!)
   text\n\n---  → <p>text</p><hr>  (correct)
   ```

3. **Specific message structure**: The issue might only occur with certain message structures or during specific streaming states.

### Request for more info

Could you provide:
1. The exact message content that fails (raw, with newlines visible)
2. Whether it fails during streaming or after message completes
3. Browser DevTools inspection: what HTML is actually in the DOM for the failed `---`?

### Added test case

I added a test case in `ui/src/ui/markdown.test.ts` to ensure `---` renders as `<hr>`:

```typescript
it("renders horizontal rules (---) as hr elements", () => {
  const html = toSanitizedMarkdownHtml("Section 1\n\n---\n\nSection 2");
  expect(html).toContain("<hr>");
});
```

Happy to continue investigating with more reproduction details!


## Links

- None detected yet
