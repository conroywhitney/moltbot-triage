---
number: 3447
title: "[Bug] voice-call: OpenAI Realtime STT uses outdated API format"
author: dtalas
created: 2026-01-28T16:29:40Z
updated: 2026-01-28T16:30:43Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/3447
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug Description

The OpenAI Realtime STT provider in the voice-call extension uses an outdated API structure that doesn't produce transcriptions.

## Current Behavior

- TTS works correctly (audio plays to caller)
- STT receives audio and detects speech (logs show `input_audio_buffer.speech_started`, `speech_stopped`, `committed`)
- No transcription is produced (no `conversation.item.input_audio_transcription.completed` events)
- WebSocket closes without transcript

## Root Cause

The `stt-openai-realtime.ts` sends the session update in an outdated format:

```javascript
// Current (broken)
{
  type: "transcription_session.update",
  session: {
    input_audio_format: "g711_ulaw",
    input_audio_transcription: { model: "gpt-4o-transcribe" },
    turn_detection: { ... }
  }
}
```

The OpenAI Realtime API now expects:

```javascript
// Expected (per https://platform.openai.com/docs/guides/realtime-transcription)
{
  type: "session.update",
  session: {
    audio: {
      input: {
        format: { type: "audio/pcmu" },  // Note: audio/pcmu for Î¼-law
        transcription: { model: "gpt-4o-transcribe" },
        turn_detection: { ... }
      }
    }
  }
}
```

## Key Differences

1. Event type: `session.update` not `transcription_session.update`
2. Nested structure: `session.audio.input` instead of flat `session`
3. Format type: `audio/pcmu` not `g711_ulaw`
4. Transcription config: `transcription: { model }` not `input_audio_transcription: { model }`

## Environment

- Clawdbot version: 2026.1.24-3
- Provider: Twilio with streaming enabled
- STT Model: gpt-4o-transcribe

## References

- [OpenAI Realtime Transcription Guide](https://platform.openai.com/docs/guides/realtime-transcription)
- File: `extensions/voice-call/src/providers/stt-openai-realtime.ts`

## Comments


## Links

- None detected yet
