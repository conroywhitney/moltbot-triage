---
number: 6153
title: "[Bug]: Session memory indexing never triggers despite correct config (experimental.sessionMemory + sources)"
author: carles-abarca
created: 2026-02-01T10:06:22Z
updated: 2026-02-01T20:59:07Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6153
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

Session transcripts are never indexed for memory search despite having the correct configuration. The log message `sync: indexing session files` never appears, only `sync: indexing memory files`.

## Configuration

```json
{
  "agents": {
    "defaults": {
      "memorySearch": {
        "enabled": true,
        "sources": ["memory", "sessions"],
        "experimental": {
          "sessionMemory": true
        },
        "provider": "local",
        "fallback": "none"
      }
    }
  }
}
```

## Expected Behavior

- Sessions should be indexed when `experimental.sessionMemory: true` AND `sources` includes `"sessions"`
- Log should show `[memory] sync: indexing session files`
- `memory_search` results should include `source: "sessions"`

## Actual Behavior

- Only memory files are indexed
- Log only shows `[memory] sync: indexing memory files`
- SQLite index shows 0 session files: `SELECT COUNT(*) FROM files WHERE source='sessions'` returns 0
- All `memory_search` results have `source: "memory"`

## Investigation

The issue appears to be in `dist/agents/memory-search.js`:

```javascript
// Line 21-27
function normalizeSources(sources, sessionMemoryEnabled) {
    const normalized = new Set();
    const input = sources?.length ? sources : DEFAULT_SOURCES;
    for (const source of input) {
        if (source === "memory")
            normalized.add("memory");
        if (source === "sessions" && sessionMemoryEnabled)  // <-- requires BOTH conditions
            normalized.add("sessions");
    }
    ...
}

// Line 45 - sessionMemory defaults to false
const sessionMemory = overrides?.experimental?.sessionMemory ?? defaults?.experimental?.sessionMemory ?? false;

// Line 76
const sources = normalizeSources(overrides?.sources ?? defaults?.sources, sessionMemory);
```

The config specifies both conditions correctly, but `sessionMemoryEnabled` appears to not be propagating from the config to the `normalizeSources` call.

## Reproduction Steps

1. Set config with `memorySearch.sources: ["memory", "sessions"]`
2. Set `memorySearch.experimental.sessionMemory: true`
3. Set `memorySearch.provider: "local"` (using embeddinggemma-300M)
4. Delete `~/.clawdbot/memory/main.sqlite` to force fresh index
5. Restart gateway
6. Run `memory_search` to trigger sync
7. Check logs - only shows `indexing memory files`, never `indexing session files`
8. Query SQLite: `SELECT source, COUNT(*) FROM files GROUP BY source` shows only `memory`

## Environment

- **Version:** 2026.1.24-3
- **OS:** Linux Mint 22.3 (Ubuntu-based), kernel 6.8.0-90-generic (x64)
- **Node:** v22.22.0
- **Provider:** local (embeddinggemma-300M-GGUF)
- **Session files:** 29 files, 60MB total in `~/.clawdbot/agents/main/sessions/`

## Workaround

None found. Even deleting the entire SQLite index and restarting does not trigger session indexing.

## Logs

```
[memory] sync: indexing memory files
[memory] embeddings: batch start
[memory] embeddings: batch start
...
# "indexing session files" never appears
```

## Comments


## Links

- None detected yet
