---
number: 5713
title: "Telegram Bot Not Routing DM Messages to Agent"
author: likesjx
created: 2026-01-31T21:47:36Z
updated: 2026-02-02T00:18:06Z
labels: ["bug"]
assignees: []
comments_count: 2
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5713
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

# Telegram Bot Not Routing DM Messages to Agent

## Summary
Telegram bot receives updates successfully via long-polling but does not route direct messages to the agent session. Messages are received by the gateway but never trigger agent runs or responses.

## Environment
- **OpenClaw Version:** 2026.1.30 (also tested on 2026.1.29)
- **Platform:** macOS (Darwin 25.3.0 arm64)
- **Node Version:** v23.11.0
- **Installation Method:** npm global install
- **Gateway Mode:** local (bind: loopback, port: 18789)

## Configuration
```json
{
  "channels": {
    "telegram": {
      "enabled": true,
      "dmPolicy": "pairing",  // Also tested with "allowlist"
      "botToken": "REDACTED",
      "allowFrom": [7898847424],
      "groupPolicy": "allowlist",
      "streamMode": "partial"
    }
  }
}
```

## Steps to Reproduce
1. Create fresh Telegram bot via @BotFather (no webhook configured)
2. Configure OpenClaw with bot token and `dmPolicy: "allowlist"` or `dmPolicy: "pairing"`
3. Add user ID to `allowFrom` array
4. Start gateway
5. Send `/start` command to bot on Telegram

## Expected Behavior
- Bot should respond to `/start` command
- With `dmPolicy: "pairing"` → should send pairing prompt
- With `dmPolicy: "allowlist"` → should accept message and route to agent

## Actual Behavior
- Bot receives Telegram updates (confirmed in logs)
- Updates are logged but never dispatched to agent
- No response sent to user
- Messages appear to route to `webchat` channel instead of `telegram`

## Evidence from Logs

### Update Received Successfully
```
2026-01-31T21:46:15.757Z [telegram] update: {"update_id":207120995,"message":{"message_id":17,"from":{"id":7898847424,"is_bot":false,"first_name":"Jared","last_name":"Likes","language_code":"en"},"chat":{"id":7898847424,"first_name":"Jared","last_name":"Likes","type":"private"},"date":1769895975,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
```

### Message Queued to Wrong Channel
```
2026-01-31T21:46:27.011Z [diagnostic] message queued: sessionId=unknown sessionKey=agent:main:main source=dispatch queueDepth=1 sessionState=idle
2026-01-31T21:46:27.045Z [agent/embedded] embedded run start: runId=e9427179-b9ac-4a1a-8afe-3cdf842fd5af sessionId=5d9efbac-840e-458d-b8bc-b1de2f78f81b provider=github-copilot model=claude-sonnet-4.5 thinking=low messageChannel=webchat
```

**Note:** `messageChannel=webchat` instead of `messageChannel=telegram`

### No Telegram Channel Routing
```bash
# grep -E "messageChannel=telegram" gateway.log
(no results)
```

## Timeline
- **21:46:15** - Telegram update received (update_id 207120995)
- **21:46:27** - Message queued (11 second delay)
- **21:46:27** - Agent run starts with `messageChannel=webchat`
- **Never** - No response sent to Telegram

## Additional Context
- Webhook info shows no webhook configured (`url: ""`)
- Bot connects successfully on startup: `[telegram] [default] starting provider (@PortableJaneBot)`
- Multiple `/start` attempts with both `dmPolicy: "pairing"` and `dmPolicy: "allowlist"` fail identically
- Gateway is running in local mode (not VPS/remote)
- This is a fresh bot token (not migrated from another installation)

## Suspected Root Cause
The Telegram plugin appears to be:
1. Successfully receiving updates via long-polling
2. Logging updates but not creating proper message dispatch
3. Possibly hitting a silent policy rejection or routing bug
4. Defaulting to `webchat` channel instead of `telegram` channel

## Workaround Attempts
- ✗ Switched from `allowlist` to `pairing` dmPolicy
- ✗ Reset bot token via BotFather
- ✗ Removed `groupPolicy: "allowlist"`
- ✗ Updated to version 2026.1.30
- ✗ Full gateway restart

None resolved the issue.

## Request
Please investigate the Telegram channel plugin's message routing logic, particularly:
- How `dmPolicy` enforcement works
- Why updates are received but not dispatched as `telegram` channel messages
- Why `messageChannel=webchat` is being set for Telegram updates

Happy to provide additional logs or testing!

## Comments

### @TheDreamer01 (2026-01-31)

same problem

### @ItamarCoh3n (2026-01-31)

@likesjx

⚠️ **SECURITY WARNING**: Your actual Telegram bot token for @PortableJaneBot is exposed in this issue!

1. Open Telegram and message @BotFather
2. Send `/mybots` → Select PortableJaneBot
3. Go to "API Token" → "Revoke current token"
4. Generate a new token
5. Update your OpenClaw config with the new token
6. Edit this comment to replace the real token with a placeholder

Anyone with this token can control your bot and potentially access your data.


## Links

- None detected yet
