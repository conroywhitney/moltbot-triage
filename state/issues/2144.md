---
number: 2144
title: "Sub-agent model override fails: auth profiles not resolved for non-Anthropic providers"
author: solomon-artilect
created: 2026-01-26T08:43:16Z
updated: 2026-02-01T19:45:12Z
labels: ["bug"]
assignees: []
comments_count: 3
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/2144
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary
When using `sessions_spawn` with a `model` override pointing to OpenAI or OpenRouter models, the sub-agent fails to resolve API keys from `auth-profiles.json` and falls back to the default Anthropic model.

## Steps to reproduce
1. Configure auth profiles with OpenAI and OpenRouter keys in `~/.clawdbot/agents/main/agent/auth-profiles.json`
2. Confirm keys are present and `lastGood` entries exist
3. Spawn a sub-agent with model override:
```javascript
sessions_spawn({
  task: "Say hello",
  model: "openrouter/google/gemini-2.5-flash", // or "openai/gpt-4o-mini"
  label: "test"
})
```
4. Sub-agent fails with "No API key found for provider X" and falls back to Anthropic/Opus

## Expected behavior
Sub-agent should resolve the API key from auth-profiles.json and run on the specified model.

## Actual behavior
- `modelApplied: true` is returned in spawn response
- Logs show: `No API key found for provider "openrouter"` (or "openai")
- Sub-agent falls back to default Anthropic model
- Main session CAN use these providers (e.g., memory search works with OpenAI embeddings)

## Auth profile format (working for main session)
```json
{
  "openai:main": {
    "type": "api_key",
    "provider": "openai",
    "apiKey": "sk-..."
  },
  "openrouter:main": {
    "type": "api_key", 
    "provider": "openrouter",
    "apiKey": "sk-or-..."
  }
}
```

## Environment
- Clawdbot: 2026.1.24-3
- OS: macOS 15.6.1 (arm64)
- Node: 25.4.0

## Workaround
Use Anthropic models (Sonnet) for sub-agents, which share the working auth profile.

## Comments

### @mirajchokshi (2026-01-30)

Hey — I filed #3145 two days ago which was marked as a duplicate of this. Noticed this was closed for inactivity around the same time. Just wanted to flag that there's still active interest in this bug. Happy to provide more details or help test a fix if it gets reopened.

### @tenor0 (2026-02-01)

Still hitting this on `2026.1.24-3` (Ubuntu ARM64, Node 22). Our issue #2489 was marked as a duplicate of this one.

Same behavior — `sessions_spawn` with `model` override returns `modelApplied: true` but the sub-agent silently falls back to the default Anthropic model. Traced it to what looks like the `allowedModelKeys` validation in `agent.js` (~L209-220) rejecting non-Anthropic providers even when they're configured and working for the main session.

With #3145 also duped here, that's at least 3 independent reports. Would appreciate a reopen — happy to help test a fix.

### @sebslight (2026-02-01)

Reopened


## Links

- None detected yet
