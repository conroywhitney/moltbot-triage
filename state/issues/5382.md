---
number: 5382
title: "Audio files being included as text/plain file blocks after transcription"
author: Sefy-Tofan
created: 2026-01-31T12:24:11Z
updated: 2026-02-02T00:19:17Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5382
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug Description

After Deepgram successfully transcribes a voice message (OGG file), the raw binary audio file is ALSO being included in the message context as a `<file>` block with `mime="text/plain"`. This dumps thousands of tokens of binary garbage into the context window.

## Expected Behavior

After audio transcription succeeds, the raw audio file should NOT be included as a file block. Only the transcript should be added to the context.

## Actual Behavior

The transcript is added correctly, BUT the raw OGG binary is also included as:
```
<file name="file_4---uuid.ogg" mime="text/plain">
[garbled binary data ~50k+ tokens]
</file>
```

## Root Cause Analysis

In `src/media-understanding/apply.ts`, the `extractFileBlocks` function has a check at lines 246-248:
```typescript
if (!forcedTextMimeResolved && kind === "audio" && !textLike) {
  continue;  // Skip audio files
}
```

This check should skip audio files from being extracted as file blocks. However, something is causing the check to fail, allowing the audio file to be processed as a text file.

Possible causes:
1. `kind !== "audio"` â€” attachment MIME type might not be set correctly
2. `textLike` is returning true for some OGG files (unlikely based on testing)
3. `forcedTextMimeResolved` is set unexpectedly

## Evidence

- Voice files ARE being downloaded correctly with `.ogg` extension
- Deepgram transcription works (tested directly via curl)
- File's printable character ratio is ~0.325 (well below 0.85 threshold for `textLike`)
- `isAudioFileName` correctly identifies `.ogg` files

## Impact

This bug causes context window exhaustion when users send voice messages, triggering unnecessary compaction and potentially losing conversation history.

## Environment

- Channel: Telegram
- Audio provider: Deepgram nova-3
- Moltbot version: dev (main branch)

## Comments


## Links

- None detected yet
