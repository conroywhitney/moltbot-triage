---
number: 3457
title: "SessionManager persistence quirk: user messages not persisted in .jsonl files"
author: calibro23
created: 2026-01-28T16:42:55Z
updated: 2026-01-31T02:38:06Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/3457
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

The `@mariozechner/pi-coding-agent` SessionManager has a persistence quirk where user messages are not being properly persisted to session .jsonl files.

## Observed Behavior

- Session file contains **23 assistant messages** but **0 user messages**
- The `prepareSessionManagerForRun` workaround exists in Clawdbot but doesn't seem to be working correctly

## Root Cause (from code comments)

```
pi-coding-agent SessionManager persistence quirk:
- If the file exists but has no assistant message, SessionManager marks itself `flushed=true` and will never persist the initial user message.
```

## Workaround

Using `/new` to create a fresh session resolves the issue.

## Expected Behavior

User messages should be persisted alongside assistant messages in the session .jsonl files.

## Environment

- Clawdbot via WhatsApp channel
- pi-coding-agent library

## Comments


## Links

- None detected yet
