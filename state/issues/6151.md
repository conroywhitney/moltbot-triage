---
number: 6151
title: "[Bug]: memory-lancedb plugin missing npm dependencies in Docker image"
author: jkoopmann
created: 2026-02-01T10:05:27Z
updated: 2026-02-01T10:05:27Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6151
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

The bundled `memory-lancedb` plugin fails to load because `@lancedb/lancedb` and `openai` npm packages are not installed in the official Docker image. Manual installation is not a viable workaround as packages are stored in the container layer and don't survive updates.

## Environment

- **OpenClaw Version:** 2026.1.30
- **Docker Image:** openclaw/openclaw (official)
- **Node.js:** v22.22.0
- **Host:** Unraid

## Steps to Reproduce

1. Fresh OpenClaw installation via Docker
2. Set `plugins.slots.memory = "memory-lancedb"` with valid config:
```json
{
  "plugins": {
    "slots": { "memory": "memory-lancedb" },
    "entries": {
      "memory-lancedb": {
        "enabled": true,
        "config": {
          "embedding": { "apiKey": "sk-xxx", "model": "text-embedding-3-small" },
          "dbPath": "/root/.openclaw/memory/lancedb",
          "autoCapture": true,
          "autoRecall": true
        }
      }
    }
  }
}
```
3. Restart gateway
4. Try to use memory tools â†’ `Tool memory_recall not found`

## Root Cause

Plugin imports `@lancedb/lancedb` and `openai` but these are missing from the Docker image:

```bash
$ node -e "require('@lancedb/lancedb')"
Error: Cannot find module '@lancedb/lancedb'

$ ls /app/node_modules/@lancedb/
ls: cannot access '/app/node_modules/@lancedb/': No such file or directory
```

## Why Manual Installation Is NOT a Viable Workaround

Running `pnpm add -w @lancedb/lancedb openai` installs packages to:
- `/app/node_modules/@lancedb/lancedb`
- `/app/node_modules/openai/`
- `/app/pnpm-lock.yaml` (modified)

**These paths are inside the container layer and will be wiped on any Docker update/rebuild.**

There is no clean way for users to persist this without mapping the entire `/app` directory (which would break updates). The dependencies must be bundled in the Docker image.

## Current Workaround

Use `memory-core` plugin instead (works out of the box):

```json
{ "plugins": { "slots": { "memory": "memory-core" } } }
```

Note: `memory-core` provides `memory_search` and `memory_get` but lacks `autoCapture` and `autoRecall` features.

## Suggested Fix

### Option A: Bundle dependencies in Docker image (recommended)

```dockerfile
RUN pnpm add @lancedb/lancedb openai
```

### Option B: Graceful error handling

Add clear error message when dependencies are missing instead of silent failure.

### Option C: Document as optional

Mark `memory-lancedb` as requiring manual setup with clear installation docs.

## Additional Note

Even after manual install + gateway restart, tools still didn't register. May indicate secondary issue with plugin lifecycle/tool registration.

## Files Referenced

- `/app/extensions/memory-lancedb/index.ts`
- `/app/extensions/memory-lancedb/openclaw.plugin.json`

## Comments


## Links

- None detected yet
