---
number: 5856
title: "Chrome extension relay missing CORS headers for chrome-extension:// origins"
author: savroff
created: 2026-02-01T02:08:20Z
updated: 2026-02-02T00:17:26Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5856
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

The browser extension relay server (`extension-relay.js`) does not return CORS headers for `chrome-extension://` origins, causing the extension's preflight `fetch()` check to fail.

## Steps to Reproduce

1. Configure OpenClaw with a browser profile using the Chrome extension relay
2. Load the extension in Chrome
3. Extension attempts to connect via `fetch(\`${httpBase}/\`, { method: "HEAD", ... })`
4. Browser blocks the request due to missing `Access-Control-Allow-Origin` header

## Expected Behavior

The relay server should return CORS headers for `chrome-extension://` origins:
- `Access-Control-Allow-Origin: chrome-extension://<extension-id>`
- `Access-Control-Allow-Methods: GET, HEAD, PUT, OPTIONS`
- `Access-Control-Allow-Headers: Content-Type`

## Root Cause

In `dist/browser/extension-relay.js`, the HTTP server handlers (especially the `HEAD /` endpoint used for connection testing) don't set any CORS headers:

```javascript
if (req.method === "HEAD" && path === "/") {
    res.writeHead(200);
    res.end();
    return;
}
```

## Suggested Fix

Add CORS header handling at the start of the request handler:

```javascript
const origin = req.headers.origin || "";
const corsHeaders = {};
if (origin.startsWith("chrome-extension://")) {
    corsHeaders["Access-Control-Allow-Origin"] = origin;
    corsHeaders["Access-Control-Allow-Methods"] = "GET, HEAD, PUT, OPTIONS";
    corsHeaders["Access-Control-Allow-Headers"] = "Content-Type";
}

// Handle OPTIONS preflight
if (req.method === "OPTIONS") {
    res.writeHead(204, corsHeaders);
    res.end();
    return;
}
```

Then include `corsHeaders` in all relevant `res.writeHead()` calls.

## Environment

- OpenClaw version: 2026.1.30
- Extension ID: `hgbmgodgmoepcniaoidlifjekhjkkckl`
- macOS, Chrome

## Comments


## Links

- None detected yet
