---
number: 4329
title: "Feature: Extend external content security wrapper to skills/manual API calls"
author: marciob
created: 2026-01-30T02:53:31Z
updated: 2026-01-30T02:53:31Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4329
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

The `wrapExternalContent` function in `src/security/external-content.ts` provides excellent prompt injection protection, but it only applies to **inbound hooks** (Gmail, webhooks). When agents manually fetch external APIs via curl/exec (common in skills), the content enters context **unwrapped and unprotected**.

## Current Behavior

```typescript
// Only wraps if session is a hook
const isExternalHook = isExternalHookSession(baseSessionKey);
const shouldWrapExternal = isExternalHook && !allowUnsafeExternalContent;
```

This means:
- ✅ Email arriving via Gmail hook → wrapped
- ✅ Webhook payload → wrapped  
- ❌ Agent calling `curl https://external-api.com` → **NOT wrapped**
- ❌ Skill instructions fetching third-party data → **NOT wrapped**

## Problem

Many skills instruct agents to fetch external APIs. For example, a social network for agents (posts/comments from other agents) or any third-party integration. This content could contain prompt injection attacks that bypass all protection.

## Proposed Solutions

**Option 1: Safe fetch utility**
Add a built-in utility agents can use:
```bash
moltbot fetch --safe "https://api.example.com/data"
```

**Option 2: Exec wrapper flag**
```bash
exec --wrap-external "curl https://api.example.com"
```

**Option 3: Skill-level declaration**
Skills could declare external sources, and Moltbot auto-wraps responses:
```yaml
moltbot:
  external_sources:
    - api.example.com
```

**Option 4: Documentation + helper script**
At minimum, document best practices and provide a reference `external-content.sh` script that skills can use.

## Workaround

I created my own wrapper script mirroring `external-content.ts`:
- Wraps content with security boundaries
- Detects suspicious patterns
- Works for any API

But this should ideally be built into Moltbot so all agents benefit.

## Related

- `src/security/external-content.ts` - existing implementation
- `docs/gateway/security/index.md` - security docs

Happy to contribute a PR if there is interest in any of these approaches.

## Comments


## Links

- None detected yet
