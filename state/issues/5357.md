---
number: 5357
title: "safeguard compaction fails to recover when context significantly exceeds model limit (>20% over)"
author: sgwannabe
created: 2026-01-31T11:42:36Z
updated: 2026-02-02T00:19:23Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5357
duplicate_of: null
related_issues: [2656,3643]
blocks: []
blocked_by: []
---

## Description

## Problem
When a session's context significantly exceeds the model's token limit, the `safeguard` compaction mode fails to recover and falls back to "Summary unavailable", leaving the session in a broken state.

## My Case
- **Model:** kimi-code/kimi-for-coding (limit: 262,144 tokens)
- **Request:** 321,052 tokens (22% over limit)
- **Config:** `compaction.mode: "safeguard"` already enabled
- **Result:** Auto-compaction triggered but returned "Summary unavailable" instead of actually compacting

## Expected Behavior
When context exceeds the limit, safeguard mode should aggressively compact history to get back under the limit, or at minimum provide a working fallback.

## Actual Behavior
The compaction attempt fails silently (returns "Summary unavailable"), and subsequent requests continue to fail with the same token limit error. The user has to manually run `/compact` or `/new` to recover.

## Related Issues
- #3643 - compaction-safeguard.js summarization always fails
- #2656 - Compaction silently falls back to empty summary

This appears to be a specific edge case where the context is so far over the limit that safeguard cannot recover.

## Suggestion
Consider adding an "emergency" compaction mode that:
1. Detects when context is >20% over limit
2. Aggressively truncates older messages (not just summarizes)
3. Or forces a session reset with a warning

## Comments

### @sebslight (2026-02-01)

OpenClaw Maintainer Triage // Issue Closure

Hi — this is a joint maintainer effort to keep the repo moving. We’re currently seeing ~30 new issues per hour, and we can’t review every future request without slowing down critical stabilization work. This issue is unlikely to be considered in the near term, so we’re closing it to keep the pipeline moving while we focus on stability.

We’re very sorry this is happening, but we won’t be able to look at the comments on this issue.

Want to make your request stand out? Submit a PR and report to #pr-thunderdome-dangerzone on Discord — READ THE TOPIC. Give us a clear briefing: what it fixes, who it helps, and why it’s worth shipping.

Thanks for understanding and for contributing.

![](https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExeXFramtnZWo1ZWM4YmYzcG1zcXE1NWV1eTl3MDZodnk4aWhvM2tqbCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/RWUqVYucDBD4A/giphy.gif)



## Links

- None detected yet
