---
number: 7115
title: "[Bug]:  Subagent fails with Google Antigravity provider when thinking=\"off\""
author: moosl
created: 2026-02-02T12:08:01Z
updated: 2026-02-02T12:08:01Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7115
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

Subagents fail to execute when using the `google-antigravity` provider, even when `thinking="off"` is explicitly set via `sessions_spawn`. The error occurs due to Google Cloud Code Assist API validation requiring a `signature` field in thinking blocks.

## Environment

- **OpenClaw Version**: 2026.1.30
- **Platform**: macOS (Darwin 24.6.0 arm64)
- **Node Version**: v24.12.0
- **Provider**: google-antigravity (Cloud Code Assist)
- **Model**: claude-sonnet-4-5

## Steps to Reproduce

1. Configure OpenClaw with `google-antigravity` as the primary provider
2. Attempt to spawn a subagent with thinking disabled:
   ```javascript
   sessions_spawn({
     task: "Execute some task",
     thinking: "off"
   })
   ```
3. Observe the subagent fails immediately with API error

## Expected Behavior

When `thinking="off"` is specified, the subagent should:
- Not include thinking blocks in API requests
- Execute successfully without thinking-related validation errors

## Actual Behavior

The subagent fails with:
```
Cloud Code Assist API error (400): {
  "type": "error",
  "error": {
    "type": "invalid_request_error",
    "message": "messages.1.content.0.thinking.signature: Field required"
  }
}
```

## Root Cause

Located in `/dist/agents/pi-embedded-runner/utils.js`:

```javascript
export function mapThinkingLevel(level) {
    // pi-agent-core supports "xhigh"; OpenClaw enables it for specific models.
    if (!level) {
        return "off";
    }
    return level;
}
```

**Problem**: When `thinking="off"`, the function returns the string `"off"`, which still causes thinking blocks to be sent to the API, but without the required `signature` field that Google Antigravity expects.

## Proposed Fix

Change `mapThinkingLevel` to return `undefined` when thinking is disabled:

```javascript
export function mapThinkingLevel(level) {
    // pi-agent-core supports "xhigh"; OpenClaw enables it for specific models.
    if (!level || level === "off") {
        return undefined;  // Don't send thinking parameter at all
    }
    return level;
}
```

This prevents thinking blocks from being included in the API request entirely when disabled.

## Workaround

Users can temporarily patch the file manually:

1. Backup original: `sudo cp /usr/local/lib/node_modules/openclaw/dist/agents/pi-embedded-runner/utils.js{,.backup}`
2. Edit the file and change line 3-4 as shown in the proposed fix
3. Restart gateway: `openclaw gateway restart`

⚠️ **Note**: This workaround will be overwritten on `openclaw update`

## Additional Context

- Main session works fine with the same provider/model
- Issue only affects subagents spawned via `sessions_spawn`
- Setting `thinking` parameter to any value ("off", "minimal", "low", etc.) produces the same error
- Error occurs during session creation, before any actual agent work begins

## Logs

Subagent session transcript shows:

```json
{
  "role": "assistant",
  "content": [
    {
      "type": "thinking",
      "thinking": "..."
    }
  ],
  "stopReason": "error",
  "errorMessage": "Cloud Code Assist API error (400): {\"type\":\"error\",\"error\":{\"type\":\"invalid_request_error\",\"message\":\"messages.1.content.0.thinking.signature: Field required\"}}"
}
```

## Impact

- Subagents are completely broken for Google Antigravity users
- Affects all `sessions_spawn` calls regardless of thinking setting
- No viable workaround except switching providers for subagents

## Affected Files

- `src/agents/pi-embedded-runner/utils.ts` (source)
- `dist/agents/pi-embedded-runner/utils.js` (compiled)
- `dist/agents/pi-embedded-runner/run/attempt.js` (calls mapThinkingLevel)
- `dist/agents/pi-embedded-runner/compact.js` (calls mapThinkingLevel)

---

**Priority**: High - Feature completely broken for a major provider
**Labels**: bug, google-antigravity, subagents, thinking

## Comments


## Links

- None detected yet
