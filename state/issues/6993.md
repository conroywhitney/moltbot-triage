---
number: 6993
title: "[Bug]: Bug Fix: API Fallback Blocked by Strict Allowlist"
author: NexusOne23
created: 2026-02-02T08:29:46Z
updated: 2026-02-02T08:29:46Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6993
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

Bug Fix: API Fallback Blocked by Strict Allowlist
Description
This PR fixes an issue where OpenClaw fails to switch to fallback models (e.g., Gemini) when the primary model (Anthropic) hits a rate limit or error.

By default, the agents.defaults.models configuration section acts as a strict allowlist. If a user defines models in this section (e.g., to set aliases), any model not listed there is implicitly blocked from being used as a candidate, even if explicitly configured as a fallback.

This results in a situation where the primary model fails (e.g., 429 Rate Limit), but instead of trying the configured fallbacks, the agent throws an error because the fallback candidates were filtered out during model selection.

Issue Reproduction
Configure 
openclaw.json
 with a primary model (e.g., anthropic/claude-opus-4-5) and fallback models (e.g., google/gemini-3-pro).
Define agents.defaults.models to set an alias for the primary model only:
"agents": {
  "defaults": {
    "models": {
      "anthropic/claude-opus-4-5": { "alias": "opus" }
    }
  }
}
Trigger a rate limit or force a failure on the primary model.
Result: The agent fails immediately with "All models failed (1)" instead of attempting the fallback, because google/gemini-3-pro was stripped from the candidate list.
The Fix
Explicitly add the fallback models to the agents.defaults.models allowlist configuration. This ensures they are authorized candidates during the fallback resolution process.

Configuration Change (
openclaw.json
 or Default Config)
"models": {
   "anthropic/claude-opus-4-5": {
     "alias": "opus"
-  }
+  },
+  "google/gemini-3-pro": {
+    "alias": "gemini-pro"
+  },
+  "google/gemini-3-flash": {
+    "alias": "gemini-flash"
+  }
 }
Logs / Verification
Before Fix:

Embedded agent failed before reply: All models failed (1): anthropic/claude-opus-4-5: Provider anthropic is in cooldown
(Note: Candidate count is 1, meaning fallbacks were ignored)

After Fix: The system correctly identifies the fallback candidates and attempts to execute them when the primary model is in cooldown.

## Comments


## Links

- None detected yet
