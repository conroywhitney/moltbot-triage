---
number: 7483
title: "False positive context overflow detection on normal response text"
author: elliottway
created: 2026-02-02T21:47:01Z
updated: 2026-02-02T21:47:01Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7483
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug Description

`sanitizeUserFacingText()` in `errors.js` applies error-detection logic to **successful assistant responses**, not just actual error payloads. This causes false positives when the assistant *mentions* phrases like "context overflow" or "prompt is too long" in normal conversation.

## Steps to Reproduce

1. Send a message to the assistant asking about context limits
2. Assistant responds with text containing "context overflow" (explaining the concept)
3. OpenClaw's `sanitizeUserFacingText` detects the phrase and **rewrites the entire response** to the generic error message:
   > "Context overflow: prompt too large for the model. Try again with less input or a larger-context model."

## Expected Behavior

Normal assistant responses should pass through unchanged. Error detection should only apply to actual error payloads (messages with `stopReason: "error"` or `errorMessage` set).

## Actual Behavior

Any response containing trigger phrases gets rewritten to the error message, even when the model successfully responded.

## Affected Code

```javascript
// agents/pi-embedded-helpers/errors.js - sanitizeUserFacingText()

// This check should NOT run on successful responses:
if (isContextOverflowError(trimmed)) {
    return ("Context overflow: prompt too large for the model. " +
        "Try again with less input or a larger-context model.");
}
```

## Suggested Fix

Option 1: Remove the `isContextOverflowError` check from `sanitizeUserFacingText` entirely (real errors are already caught by `formatAssistantErrorText`).
  
Option 2: Add a parameter to `sanitizeUserFacingText` indicating whether the text is from an error context, and only apply error transformations when true.

## Workaround

Comment out the `isContextOverflowError` block in `sanitizeUserFacingText`:
```javascript
// if (isContextOverflowError(trimmed)) {
//     return ("Context overflow: prompt too large for the model. " +
//         "Try again with less input or a larger-context model.");
// }
```

## Environment

- OpenClaw version: 2026.2.1
- OS: macOS (arm64)
- Model: google-antigravity/claude-opus-4-5-thinking

## Comments


## Links

- None detected yet
