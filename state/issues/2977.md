---
number: 2977
title: "codex-cli backend responses never received, messages disappear"
author: vulcan2018
created: 2026-01-27T21:46:19Z
updated: 2026-01-28T15:24:42Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/2977
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

# Bug: codex-cli backend responses never received, messages disappear

## Summary

When using `codex-cli` as the primary model provider, chat messages disappear after being sent. The `cli exec` is logged but no completion/response is ever received. The WebSocket connection eventually times out (code 1006) and the message vanishes from the UI.

## Environment

- **Clawdbot version:** 2026.1.24-3
- **OS:** Ubuntu/WSL2 (Linux 6.6.87.2-microsoft-standard-WSL2)
- **Node:** v22.22.0 (via nvm)
- **codex-cli version:** 0.91.0
- **Install method:** npm global

## Configuration

```json
{
  "agents": {
    "defaults": {
      "model": {
        "primary": "codex-cli/gpt-5.1-codex-max"
      },
      "cliBackends": {
        "codex-cli": {
          "command": "codex",
          "args": ["exec", "--json", "--full-auto"],
          "resumeArgs": ["exec", "resume", "{sessionId}"],
          "output": "jsonl"
        }
      }
    }
  }
}
```

## Steps to Reproduce

1. Configure clawdbot with `codex-cli/gpt-5.1-codex-max` as primary model
2. Authenticate codex via `codex auth login`
3. Verify auth is synced (check `auth-profiles.json` shows valid `openai-codex:codex-cli`)
4. Open webchat at `http://127.0.0.1:18789/`
5. Send any message (e.g., "hello")
6. Observe message appears briefly then disappears after ~1-2 minutes

## Expected Behavior

- Message is sent to codex-cli
- Response is received and displayed in chat
- Conversation persists

## Actual Behavior

- Message is sent, `cli exec` is logged
- **No completion event is ever logged**
- WebSocket disconnects with code 1006 after timeout
- Message disappears from chat history

## Log Evidence

```
21:34:42 cli exec: provider=codex-cli model=gpt-5.1-codex-max promptChars=63
21:34:55 chat.history 191ms  (UI polling)
21:35:15 chat.history 1395ms (UI polling)
21:35:26 chat.history 370ms  (UI polling)
21:35:31 webchat disconnected code=1006 reason=n/a
```

Note: There is NO `cli completed`, `cli response`, or similar event between `cli exec` and the disconnect.

## Verification: codex-cli Works Standalone

Running the same command manually works perfectly:

```bash
$ echo "say hello" | codex exec --json --full-auto
Reading prompt from stdin...
{"type":"thread.started","thread_id":"019c0163-472c-7fe1-9b24-3be36c4d94af"}
{"type":"turn.started"}
{"type":"item.completed","item":{"id":"item_0","type":"reasoning","text":"**Saying hello**\n\nHi there!"}}
{"type":"item.completed","item":{"id":"item_1","type":"agent_message","text":"Hello!"}}
{"type":"turn.completed","usage":{"input_tokens":7937,"cached_input_tokens":6912,"output_tokens":82}}
```

This confirms the codex CLI itself works and authentication is valid.

## Root Cause Hypothesis

The issue appears to be in how clawdbot spawns and reads from the codex-cli process. Possible causes:

1. **stdout buffering issue** - output may not be flushed/received properly
2. **JSONL parsing issue** - the response format may not match what clawdbot expects
3. **Process spawn issue on WSL/Linux** - pipe handling differences
4. **Missing stdin closure** - codex waits for EOF on stdin

## Workaround

Switch to `anthropic/claude-sonnet-4-5` as the primary model (which uses different backend).

## Related

- The `anthropic:claude-cli` backend works correctly with the same setup
- Issue may be specific to the `codex-cli` cliBackend integration

## Additional Context

- OAuth token was initially expired, causing similar symptoms
- After re-authentication (`codex auth login`), token is valid but issue persists
- Auth profile shows: `"expires": "2026-01-27T22:30:13.276Z"` (valid at time of testing)

## Comments

### @vulcan2018 (2026-01-28)

Has anyone successfully used codex (via cli in wsl) as main language for moltbot? Claude thinks it's a moltbot bug...


## Links

- None detected yet
