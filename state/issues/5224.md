---
number: 5224
title: "[Bug]: Compaction produces 'Summary unavailable' instead of actual summary"
author: conrader
created: 2026-01-31T06:53:30Z
updated: 2026-02-02T00:19:55Z
labels: ["bug"]
assignees: []
comments_count: 4
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5224
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

When auto-compaction triggers, the context summary is not generated. Instead, the model receives:

```
The conversation history before this point was compacted into the following summary:
Summary unavailable due to context limits. Older messages were truncated.
```

This defeats the purpose of compaction - the model loses all context from before compaction.

## Steps to reproduce

1. Have a long conversation that fills the context window (~150K tokens with claude-opus-4-5)
2. Continue chatting until auto-compaction triggers
3. Check what context the model receives after compaction

## Expected behavior

The model should receive an actual summary of the compacted conversation, preserving key context, decisions, and ongoing topics.

## Actual behavior

Model receives "Summary unavailable due to context limits" - effectively a complete memory wipe.

## Workaround

Configured `agents.defaults.compaction.memoryFlush` to force pre-compaction memory writes, but this only helps if the model writes to files - it does not fix the missing summary.

## Environment

- Clawdbot version: 2026.1.24-2
- OS: macOS (Darwin 25.2.0 arm64)
- Model: anthropic/claude-opus-4-5
- contextTokens: 150000

## Suggestion

When compaction cannot generate a summary, at minimum include the last 5-10 messages from the session JSONL file so the model has recent context.

## Comments

### @conrader (2026-01-31)

## Additional suggestion: Session file as fallback

When compaction summary generation fails ("Summary unavailable"), Clawdbot should **fall back to reading the session JSONL file** and include the last N messages (e.g., 10-20) in the context.

The session file already contains the full conversation history:
```
~/.clawdbot/agents/{agent}/sessions/{session-id}.jsonl
```

**Proposed fallback logic:**
```
if (compactionSummary === "unavailable") {
  // Read last 10-20 messages from session JSONL
  // Include them in context instead of empty summary
}
```

This ensures the model never loses ALL context - at minimum it has recent messages to work with.

### @conrader (2026-01-31)

## Clarification: Simple fallback rule

**If summary unavailable → include last 10 messages before compaction**

That is the entire fallback logic needed. No complex summary generation, just:

```javascript
if (compactionSummary === "unavailable" || !compactionSummary) {
  // Read last 10 messages from session JSONL
  // Insert them as context instead of empty summary
}
```

The session file already has everything. Just use it as fallback.

### @Glucksberg (2026-01-31)

Submitted a fix in #5380 based on @conrader's suggestion.

When compaction summarization fails, the fallback now includes the last 10 messages:

```
Summary unavailable due to context limits. Older messages were truncated.

## Recent Messages (fallback context)
**User**: Hey, can you help me with...

**Assistant**: Of course! I see you want to...
```

This ensures the model never loses ALL context — at minimum it has the most recent exchanges to work with.

### @kyro-agent (2026-02-01)

Adding another data point from today (2026-02-01 ~23:10 UTC):

**Symptoms:** Compaction triggered, received exact same 'Summary unavailable due to context limits' message. Complete context loss mid-conversation about X402 implementation.

**Environment:**
- Model: anthropic/claude-opus-4-5
- Runtime: agent=main | channel=telegram
- OpenClaw version: current (running on Ubuntu VPS)

**Impact:** Agent lost all context about ongoing technical discussion. User had to explain what was being discussed.

**Observation:** This seems to be happening consistently when context fills up. The compaction triggers but summary generation silently fails.

Would support any fix that at minimum preserves recent messages when summary generation fails.


## Links

- None detected yet
