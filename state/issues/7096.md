---
number: 7096
title: "[Feature]: Skill Binary Persistence in Docker Containers"
author: ga-it
created: 2026-02-02T11:35:19Z
updated: 2026-02-02T11:35:19Z
labels: ["enhancement"]
assignees: []
comments_count: 0
reactions_total: 1
url: https://github.com/openclaw/openclaw/issues/7096
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Problem Statement

With nearly daily updates to OpenClaw Docker images, skill-related binaries need to be reinstalled every time the Docker image is rebuilt. This creates significant overhead and friction for users running OpenClaw in containerized environments, particularly those using sandboxed agent execution.

## Current Behavior

1. Skills define binary requirements via `metadata.openclaw.requires.bins` in their `SKILL.md` frontmatter
2. When agents run in sandbox mode (`agents.defaults.sandbox.mode: "non-main"` or `"all"`), binaries must exist inside the container
3. Binary installation happens via `agents.defaults.sandbox.docker.setupCommand` which runs once after container creation
4. Package installations via `setupCommand` require:
   - Network egress
   - Writable root filesystem
   - Root user privileges in the sandbox
5. Every Docker image rebuild forces complete reinstallation of all skill binaries

**Example from current documentation:**
```json
{
  "agents": {
    "defaults": {
      "sandbox": {
        "docker": {
          "setupCommand": "apt-get update && apt-get install -y git curl jq"
        }
      }
    }
  }
}
```

## Impact

- **Time overhead**: Minutes of setup time on every image rebuild for package installations
- **Network dependency**: Requires reliable internet connectivity for each installation
- **Resource waste**: Repeated downloads of the same packages across rebuilds
- **Deployment friction**: Complicates CI/CD pipelines and production deployments
- **User experience**: Poor experience for users with frequent updates (daily release cycle)

## Proposed Solution

### Option 1: Standardized Binary Directory with Volume Mount (Recommended)

Mandate that skill binaries install to a predictable, persistent directory that can be volume-mounted across container rebuilds.

**Implementation:**
1. Define standard installation paths:
   - `/opt/openclaw/bin` - for skill binaries
   - `/opt/openclaw/lib` - for skill libraries
   - `/opt/openclaw/share` - for skill data/config
   
2. Modify skill installation logic to:
   - Install to `/opt/openclaw/*` paths by default
   - Add `/opt/openclaw/bin` to PATH in container environment
   - Document skill authors to target these paths

3. Update Docker Compose / setup scripts to volume mount:
   ```yaml
   volumes:
     - openclaw-skill-binaries:/opt/openclaw
   ```

4. Modify `setupCommand` behavior to:
   - Check if binaries already exist in `/opt/openclaw/bin` before installation
   - Skip installation if binaries are present and valid
   - Provide `--force-reinstall` flag for updates

**Benefits:**
- Binaries persist across image rebuilds
- Zero reinstallation time after initial setup
- Works with Docker volumes (named or bind mounts)
- Predictable paths simplify debugging
- Compatible with existing skill system

### Option 2: Pre-built Skill Binary Images

Create separate Docker images with pre-installed skill binaries that can be layered or copied.

**Implementation:**
- Maintain `openclaw/skills-{category}` images with common binary sets
- Use multi-stage builds to copy binaries from skill images
- Skills declare required skill images in metadata

**Benefits:**
- Fastest container startup time
- No network dependency at runtime
- Cached in Docker registry

**Drawbacks:**
- More complex image management
- Increased storage requirements
- Tighter coupling between skill versions and images

### Option 3: Custom Image Building with Caching

Improve the existing flow with better caching but keep binaries in the main image.

**Implementation:**
- Optimize Dockerfile layer ordering to maximize cache hits
- Use BuildKit cache mounts for package managers
- Pre-install common skill binaries in base image

**Benefits:**
- Simpler than separate volumes
- Still benefits from Docker layer caching

**Drawbacks:**
- Still requires some rebuild time
- Doesn't fully solve the persistence problem

## Recommended Implementation Path

**Phase 1: Immediate (Standardized Paths)**
1. Document standard installation paths (`/opt/openclaw/*`)
2. Update skill installation examples to use these paths
3. Modify `setupCommand` to check for existing binaries

**Phase 2: Core Integration (Volume Mount Support)**
1. Update `docker-setup.sh` to create and mount skill binary volume
2. Modify skill loader to verify binaries in persistent location
3. Add `openclaw doctor` checks for skill binary consistency

**Phase 3: Enhanced Experience (Smart Caching)**
1. Implement binary version tracking
2. Add skill binary update mechanism
3. Support optional pre-built skill binary images

## Example Configuration

**After implementation:**
```json
{
  "agents": {
    "defaults": {
      "sandbox": {
        "docker": {
          "setupCommand": "openclaw-install-skill-deps",
          "volumes": {
            "openclaw-skill-binaries": "/opt/openclaw"
          }
        }
      }
    }
  }
}
```

**Docker Compose example:**
```yaml
services:
  openclaw-gateway:
    volumes:
      - ~/.openclaw:/home/node/.openclaw
      - ~/.openclaw/workspace:/home/node/.openclaw/workspace
      - openclaw-skill-binaries:/opt/openclaw  # Persistent skill binaries

volumes:
  openclaw-skill-binaries:
```

## Alternative Considerations

**User Home Directory:** Could use `~/.openclaw/skill-binaries` but this has permission complexity in containers

**System Paths:** Could use `/usr/local/bin` but this pollutes system paths and makes cleanup harder

**Skill-Specific Paths:** Could use `/opt/openclaw/skills/{skill-name}/bin` for complete isolation

## Breaking Changes

- Existing skills using custom installation paths would need migration guide
- `setupCommand` behavior change requires documentation update
- Docker Compose configuration adds new volume requirement

## Backward Compatibility

Maintain backward compatibility by:
1. Keep existing `setupCommand` working as-is
2. Add new `persistentBinaries: true` flag to opt into new behavior
3. Deprecate old approach over 2-3 release cycles

## Related Issues

- Performance degradation on daily updates
- Network failures during skill installation
- Inconsistent skill binary versions across containers

## Success Metrics

- Reduce skill installation time from ~3-5 minutes to <10 seconds on rebuild
- Eliminate network dependency for skill binaries in steady-state
- Improve user satisfaction with Docker deployment experience

## Additional Context

OpenClaw's architecture already supports sophisticated Docker sandboxing with:
- Per-session or per-agent isolated containers
- Read-only root filesystem option
- Comprehensive security controls

This proposal extends that sophistication to skill binary management, treating them as persistent application state rather than ephemeral container state.

---

**Current OpenClaw Docker Documentation References:**
- [Docker Installation Guide](https://docs.openclaw.ai/install/docker)
- [Sandbox Configuration](https://docs.openclaw.ai/gateway/configuration)
- [Skills Documentation](https://docs.openclaw.ai/tools/skills)

## Comments


## Links

- None detected yet
