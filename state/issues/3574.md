---
number: 3574
title: "[Bug] Hook sessions accumulate indefinitely, causing OOM on low-memory VPS"
author: delonsp
created: 2026-01-28T21:19:51Z
updated: 2026-01-28T21:19:51Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/3574
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

Hook sessions (`agent:main:hook:*`) created by webhook-triggered agent turns are never garbage-collected. They accumulate in `sessions.json` indefinitely, consuming RAM proportionally.

## Environment

- **Version:** 2026.1.24-3
- **OS:** Ubuntu 24.04, 4 GB RAM, 1 GB swap
- **Channels:** WhatsApp + Telegram (moderate traffic — patient messages)

## Impact

After only **3 days** of normal operation:

| Metric | Value |
|--------|-------|
| Total sessions | 573 |
| Useful sessions | 1 (`agent:main:main`) |
| `sessions.json` size | 11 MB |
| RAM consumed | ~800 MB just for session storage |
| Swap | 100% full (1 GB) |
| Result | Dashboard freezes, requires constant reload |

## Reproduction

1. Configure a webhook channel (WhatsApp via n8n, for example)
2. Receive moderate message traffic over a few days
3. Run `clawdbot sessions` — observe hundreds of `hook:` sessions
4. Check `sessions.json` file size — grows unbounded
5. Dashboard becomes unresponsive due to memory pressure

## Root Cause

Each incoming webhook message creates an isolated `hook:<uuid>` session. These sessions complete processing but are never removed from the session store. The entire `sessions.json` file appears to be loaded into memory by the gateway process.

## Workaround

Manual cleanup script that removes hook sessions older than 2 hours:

```python
import json, time
from pathlib import Path

path = Path.home() / ".clawdbot/agents/main/sessions/sessions.json"
with open(path) as f:
    data = json.load(f)

cutoff = (time.time() - 7200) * 1000
keep = {k: v for k, v in data.items()
        if k == "agent:main:main"
        or (isinstance(v, dict) and v.get("updatedAtMs", 0) > cutoff)}

with open(path, "w") as f:
    json.dump(keep, f)
```

Running this via cron every 6 hours keeps memory stable.

## Suggestion

Add a built-in session TTL / garbage collection mechanism, for example:

- `sessions.hookTtlMinutes: 120` — auto-expire completed hook sessions after N minutes
- Or a `clawdbot sessions prune --older-than 2h` CLI command
- Or automatic GC on gateway startup / periodic interval

This would prevent unbounded memory growth on long-running instances, especially on VPS with limited RAM (2-4 GB).

## Comments


## Links

- None detected yet
