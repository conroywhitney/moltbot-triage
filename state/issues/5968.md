---
number: 5968
title: "Memory subsystem FD leak: git objects not closed after embedding"
author: n8k99
created: 2026-02-01T04:41:37Z
updated: 2026-02-02T00:17:05Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5968
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug Report

**Environment:**
- clawdbot version: 2026.1.24-3
- macOS (arm64)

**Symptoms:**
- spawn EBADF errors when running shell commands (exec/browser)
- FD count accumulates in gateway process
- Process reaches ~10K FDs before failing (macOS limit ~10,240)

**Root Cause:**
The memory/embedding subsystem opens git object files in /Volumes/Elements/clawd_memory/.git/objects/ to generate embeddings but never closes the file descriptors afterward. This causes a gradual FD leak that eventually exhausts the system limit.

**Reproduction:**
1. Run clawdbot with a large git vault (e.g., clawd_memory with many commits)
2. Let memory indexer run for a few hours
3. Watch FD count climb via `lsof -p <gateway-pid> | wc -l`
4. Eventually spawn() fails with EBADF

**Impact:**
- Blocks all exec operations (shell commands, CLI tools)
- Blocks browser automation
- Requires gateway restart to recover

**Fix Needed:**
The memory indexer (in dist/memory/ module) should close file descriptors after reading git objects. Likely issue: fs.open() or fs.createReadStream() without corresponding .close() or .destroy() calls.

**Workaround:**
Restart the gateway process when FD count exceeds ~5000 to prevent hitting system limit.

## Comments


## Links

- None detected yet
