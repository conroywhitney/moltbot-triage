---
number: 6972
title: "Automatic audio transcription not working despite correct configuration"
author: Moddy14
created: 2026-02-02T07:37:46Z
updated: 2026-02-02T07:37:46Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6972
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

# Automatic audio transcription not working despite correct configuration

## Environment
- **Clawdbot Version:** 2026.1.24-3
- **OS:** Linux (Ubuntu/Debian)
- **Channel:** Telegram
- **Runtime:** Node.js v22.22.0

## Problem Description

Automatic audio transcription via `tools.media.audio` is not working. Voice messages from Telegram appear as `<media:audio>` in the agent prompt instead of being automatically transcribed.

Manual transcription using the `openai-whisper-api` skill works perfectly.

## Configuration

All required settings are present:

```json
{
  "tools": {
    "media": {
      "audio": {
        "enabled": true,
        "scope": {
          "default": "allow"
        },
        "maxBytes": 26214400,
        "timeoutSeconds": 60,
        "language": "de",
        "providerOptions": {
          "openai": {
            "apiKey": "sk-svcacct-..."
          }
        },
        "models": [
          {
            "provider": "openai",
            "model": "whisper-1",
            "capabilities": ["audio"],
            "type": "provider"
          }
        ]
      }
    }
  },
  "channels": {
    "telegram": {
      "enabled": true,
      "dmPolicy": "pairing",
      "groupPolicy": "allowlist",
      "streamMode": "partial"
    }
  }
}
```

## Steps to Reproduce

1. Configure `tools.media.audio` with:
   - `enabled: true`
   - `scope.default: "allow"`
   - OpenAI model with API key in `providerOptions.openai.apiKey`
2. Restart gateway (tried both `SIGUSR1` and full `systemctl restart`)
3. Send voice message via Telegram
4. **Expected:** Agent receives transcribed text
5. **Actual:** Agent receives `<media:audio>` placeholder

## Debugging Attempts

### What we tried:
1. ✅ Enabled `tools.media.audio`
2. ✅ Added `scope: { default: "allow" }`
3. ✅ Defined OpenAI Whisper-1 model
4. ✅ Added API key via `providerOptions.openai.apiKey`
5. ✅ Multiple gateway restarts (SIGUSR1)
6. ✅ Full service restart (`systemctl restart clawdbot`)
7. ✅ Verified config is saved correctly on disk
8. ✅ Checked no logs show audio processing attempts

### Observations:
- Config file is correct after each change
- Gateway restarts successfully (no errors in logs)
- No audio processing appears in logs
- Manual transcription via skill works instantly
- The media pipeline does not seem to intercept audio attachments

## Workaround

Manual transcription using the bundled skill works perfectly:

```bash
bash /usr/lib/node_modules/clawdbot/skills/openai-whisper-api/scripts/transcribe.sh \
  /path/to/audio.ogg --language de
```

The agent can call this when it sees `<media:audio>`, but automatic integration would be preferred.

## Expected Behavior

When `tools.media.audio` is enabled with correct scope and API key, audio attachments should be automatically transcribed before being shown to the agent, similar to how image understanding works with `tools.media.image`.

## Additional Context

- The OpenAI API key is valid (works in skills and other tools)
- Telegram voice messages are `.ogg` files with Opus codec
- File sizes are well under the 25 MB limit
- The same API key works for `agents.memorySearch.provider: openai`

## Question

Is there a missing step or additional configuration required for `tools.media.audio` to intercept Telegram voice messages? Or is this a bug in the media pipeline initialization?

---

**Config Schema Documentation Request:**

The config schema shows `tools.media.audio` is valid, but there's no clear documentation on:
1. Whether `providerOptions` is the correct place for API keys
2. If audio scope rules differ from image scope rules
3. Whether certain channels need explicit audio support configuration
4. Debug flags to trace why audio processing doesn't trigger

Any guidance would be appreciated!

## Comments


## Links

- None detected yet
