---
number: 3218
title: "[Bug]: `memory_search` tool ignores `memorySearch.provider = \\"local\\"` setting"
author: blackrat
created: 2026-01-28T08:17:33Z
updated: 2026-01-28T08:17:33Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/3218
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

The `memory_search` agent tool always checks for OpenAI/Google API keys and fails with "No API key found" even when `agents.defaults.memorySearch.provider` is set to `"local"`.

The CLI (`moltbot memory search`) works correctly with local embeddings.

## Version Info
- Moltbot 2026.1.26 (3fe4b25)
- macOS 15.7.3 (arm64), Node 24.6.0

## Steps to Reproduce

1. Configure local memory search:
   ```json
   {
     "agents": {
       "defaults": {
         "memorySearch": {
           "provider": "local",
           "fallback": "none"
         }
       }
     }
   }
Run moltbot memory index — succeeds, downloads local model

CLI works: moltbot memory search "test" — returns results ✓

Agent tool fails:

{
  "results": [],
  "disabled": true,
  "error": "No API key found for provider \"openai\"..."
}

## Expected Behavior
Tool should check configured provider setting before requiring API keys.

## Actual Behavior
Tool checks for API keys (OpenAI, then Google) before consulting provider setting, failing even when local embeddings work.

## Workaround
Use CLI via exec: moltbot memory search "query"

## Comments


## Links

- None detected yet
