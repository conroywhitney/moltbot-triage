---
number: 1881
title: "[Feature]: Slack missing_scope errors are too generic and unhelpful"
author: plgonzalezrx8
created: 2026-01-25T17:46:58Z
updated: 2026-01-28T16:09:52Z
labels: ["enhancement"]
assignees: []
comments_count: 1
reactions_total: 1
url: https://github.com/moltbot/moltbot/issues/1881
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

TOOK ME FOREVER to figure out the issue! But solved it, and I think better error messages might be helpful

## Summary

When a Slack bot token is missing required OAuth scopes (e.g., `im:write` for DM replies), Clawdbot:
- Starts successfully and connects to Slack
- Receives messages without error
- Generates replies that appear in the web UI
- **Silently fails to deliver replies** with only a generic `missing_scope` error in logs

**User impact:** Hours of debugging to discover which scope is missing, with no actionable guidance from error messages or startup validation.

**Real-world example:** User had `im:history` + `chat:write` but was missing `im:write`. Bot could receive DMs but not reply. Error message gave no indication that `im:write` was the missing scope.

## Proposed solution

### 1. Startup Scope Validation (High Priority)
Validate bot token scopes at gateway startup:

**Implementation:**
- Call `auth.test` to verify token validity
- Parse granted scopes from the response
- Compare against required scopes for enabled features
- **Fail fast** if critical scopes are missing

**Example output:**
```
[slack] Validating bot token scopes...
[slack] ✅ Token valid (bot: @MyBot, team: My Workspace)
[slack] ❌ FATAL: Missing required scope: 'im:write' (required for DM replies)
[slack] ❌ FATAL: Missing required scope: 'im:read' (required for DM info)
[slack] ⚠️  WARNING: Missing recommended scope: 'channels:read'
[slack] 
[slack] To fix:
[slack] 1. Go to https://api.slack.com/apps/A12345/oauth
[slack] 2. Add Bot Token Scopes: im:write, im:read
[slack] 3. Click "Reinstall to Workspace"
[slack] 4. Restart Clawdbot gateway
[slack] 
[gateway] Startup failed: Slack missing required scopes
```

**Scope categorization:**
- **Critical** (fail startup): `chat:write`, `im:write`, `im:read`, `users:read`
- **Feature-specific** (warn): `reactions:write`, `pins:write`, `files:write`
- **Conversation-type-specific** (warn based on config): `channels:read`, `groups:read`, `mpim:write`

### 2. Better Runtime Error Messages (High Priority)
When a `missing_scope` error occurs, provide actionable guidance:

**Current:**
```
[slack] block reply failed: Error: An API error occurred: missing_scope
```

**Proposed:**
```
[slack] Reply failed: Missing OAuth scope 'im:write' (required to send DM replies)
[slack] Current scopes: chat:write, im:history, users:read
[slack] Add 'im:write' at https://api.slack.com/apps/A12345/oauth and reinstall the app
```

**Implementation:**
- Parse Slack's API error response to extract the specific missing scope (if available)
- Provide context about what the scope enables
- Include direct link to OAuth settings page
- Remind users to reinstall after adding scopes

### 3. Documentation Improvements (Medium Priority)

**Quick Setup section:**
- Lead with the app manifest (step 1) so users get all scopes from the start
- Add a "Verify Setup" step: "Test by sending the bot a DM"

**Add Troubleshooting section:**
```markdown
### Messages not sending (`missing_scope` error)
**Symptoms:** Bot receives messages but doesn't reply. Logs show `missing_scope`.

**Cause:** Missing required OAuth scopes. Common scenarios:
- DMs not working → missing `im:write` or `im:read`
- Channels not working → missing conversation-type-specific scopes
- Reactions not working → missing `reactions:write`

**Fix:**
1. Check logs for the specific missing scope
2. Go to Slack app OAuth & Permissions page
3. Add the missing Bot Token Scopes
4. **Click "Reinstall to Workspace"** (critical!)
5. Restart Clawdbot gateway

**Common mistake:** Having `im:history` + `chat:write` but missing `im:write`.
Slack requires both `chat:write` AND conversation-type-specific write scopes.
```

## Alternatives considered

### 1. Lazy validation (warn but don't fail)
- **Approach:** Validate scopes at startup but only log warnings, allow startup to proceed
- **Pros:** More permissive, allows partial functionality
- **Cons:** Users may not notice warnings, leading to the same confusion
- **Decision:** Rejected - fail-fast prevents wasted time

### 2. Scope auto-detection based on config
- **Approach:** Only require scopes for enabled conversation types (e.g., skip `im:write` if DMs are disabled)
- **Pros:** More precise validation
- **Cons:** Complex to implement, scope needs may change based on runtime config
- **Decision:** Future enhancement - start with baseline required scopes

### 3. Interactive scope fixer
- **Approach:** Clawdbot generates the exact OAuth URL with missing scopes pre-selected
- **Pros:** Ultimate UX - one-click fix
- **Cons:** Slack doesn't support deep-linking to specific scopes
- **Decision:** Not feasible with current Slack API

### 4. Per-conversation-type graceful degradation
- **Approach:** If `im:write` is missing, disable DM functionality but keep channels working
- **Pros:** Partial functionality better than total failure
- **Cons:** Adds complexity, may mask configuration issues
- **Decision:** Could be a future enhancement, but clear errors are better for initial setup

## Additional context

### Detailed Bug Report
Full technical analysis with logs, timeline, and root cause: [slack-missing-scope-bug-report.md](https://github.com/USER/REPO/files/slack-missing-scope-bug-report.md) _(user will attach file to issue)_

### Error Log Sample
280+ `missing_scope` errors logged over 24 hours (Jan 24-25, 2026):
```
2026-01-25T17:01:26.095Z [slack] block reply failed: Error: An API error occurred: missing_scope
2026-01-25T17:02:58.290Z Delivery failed (slack to user:U0AAVPDSDMJ): Error: An API error occurred: missing_scope
2026-01-25T17:12:01.125Z [slack] final reply failed: Error: An API error occurred: missing_scope
```

### Comparison: Telegram Error Handling
Telegram's approach (as reference for good error messaging):
```
2026-01-25T17:15:07.140Z [telegram] [default] channel exited: Call to 'getMe' failed! (401: Unauthorized)
```
Clear, immediate, actionable - user knows the token is invalid.

### User's Actual Configuration
**Scopes present:**
- `app_mentions:read`, `channels:history`, `chat:write`, `commands`, `emoji:read`, `files:read/write`
- `groups:history`, `im:history`, `mpim:history`, `pins:read/write`, `reactions:read/write`, `users:read`

**Missing (causing failures):**
- `im:write` ❌ (critical for DM replies)
- `im:read` ❌ (critical for DM info)
- `channels:read`, `groups:read`, `mpim:read` ⚠️ (recommended)

### Why This Happens
Slack's permission model is type-scoped: you need conversation-type-specific scopes for each feature.

**Common misconception:**
- "I have `chat:write`, so I can send messages anywhere" ❌
- **Reality:** `chat:write` + `im:write` both required for DM replies ✅

Users often add `im:history` (to receive DMs) and `chat:write` (to send messages) and assume that's sufficient. The generic `missing_scope` error provides no guidance that `im:write` is also needed.

### Environment
- Clawdbot version: 2026.1.23-1
- Platform: macOS (Darwin 24.6.0)
- Node.js: v25.4.0
- Slack mode: Socket mode (bot token + app token)

### References
- [Clawdbot Slack Documentation](https://docs.clawd.bot/channels/slack)
- [Slack Conversations API](https://api.slack.com/docs/conversations-api)
- [Slack OAuth Scopes](https://api.slack.com/scopes)

---

**Impact:** This affects any user who manually configures Slack scopes instead of using the provided manifest. Better validation and error messages would significantly improve the setup experience.

**Workaround:** Add `im:write`, `im:read`, `channels:read`, `groups:read`, `mpim:read` to Bot Token Scopes, reinstall app, restart gateway.

## Comments

### @shiyw (2026-01-28)

For me, the solution is to add those scopes to both Bot Token Scopes and User Token Scopes. 


## Links

- None detected yet
