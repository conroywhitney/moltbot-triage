---
number: 7004
title: "[Bug]: Sandbox Docker containers run as root without USER directive"
author: coygeek
created: 2026-02-02T08:47:23Z
updated: 2026-02-02T09:09:08Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7004
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## CVSS Assessment

| Metric | Value |
|--------|-------|
| **Score** | 9.3 / 10.0 |
| **Severity** | Critical |
| **Vector** | CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H |

> [CVSS v3.1 Calculator](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)


## Summary
The sandbox Docker containers (`Dockerfile.sandbox` and `Dockerfile.sandbox-browser`) run as root by default, lacking the `USER` directive that the main `Dockerfile` properly implements. This increases the attack surface for container escape vulnerabilities and violates the principle of least privilege.

## Affected Code
**File:** `Dockerfile.sandbox:1-17`
```dockerfile
FROM debian:bookworm-slim

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update \
  && apt-get install -y --no-install-recommends \
    bash \
    ca-certificates \
    curl \
    git \
    jq \
    python3 \
    ripgrep \
  && rm -rf /var/lib/apt/lists/*

CMD ["sleep", "infinity"]
# Missing: USER directive
```

**File:** `Dockerfile.sandbox-browser:1-29`
```dockerfile
FROM debian:bookworm-slim
# ... package installation ...
EXPOSE 9222 5900 6080
CMD ["openclaw-sandbox-browser"]
# Missing: USER directive
```

**Contrast with main Dockerfile:** `Dockerfile:34-37`
```dockerfile
# Security hardening: Run as non-root user
# The node:22-bookworm image includes a 'node' user (uid 1000)
# This reduces the attack surface by preventing container escape via root privileges
USER node
```

## Attack Surface

**How is this reached?**
- [ ] Network (HTTP/WebSocket endpoint, API call)
- [ ] Adjacent Network (same LAN, requires network proximity)
- [x] Local (local file, CLI argument, environment variable)
- [ ] Physical (requires physical access to machine)

**Authentication required?**
- [x] None (unauthenticated/public access)
- [ ] Low (any authenticated user)
- [ ] High (admin/privileged user only)

**Entry point:** Container runtime (Docker/Podman) executing sandbox containers

## Exploit Conditions

**Complexity:**
- [x] Low (no special conditions, works reliably)
- [ ] High (requires race condition, specific config, or timing)

**User interaction:**
- [x] None (automatic, no victim action needed)
- [ ] Required (victim must click, visit, or perform action)

**Prerequisites:** Attacker must have code execution within the sandbox container (which is the intended use case for sandboxes)

## Impact Assessment

**Scope:**
- [ ] Unchanged (impact limited to vulnerable component)
- [x] Changed (can affect other components, escape sandbox)

| Impact Type | Level | Description |
|-------------|-------|-------------|
| Confidentiality | High | Root in container can read sensitive host files if escape occurs |
| Integrity | High | Root can modify host filesystem or other containers |
| Availability | High | Can disrupt host or other containerized services |

## Steps to Reproduce
1. Build and run the sandbox container: `docker build -f Dockerfile.sandbox -t sandbox . && docker run -it sandbox`
2. Verify running as root: `id` returns `uid=0(root) gid=0(root)`
3. Compare with main container: `docker build -t openclaw . && docker run -it openclaw id` returns `uid=1000(node)`

## Recommended Fix
Add a non-root user and USER directive to both sandbox Dockerfiles:

```dockerfile
# For Dockerfile.sandbox
FROM debian:bookworm-slim

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update \
  && apt-get install -y --no-install-recommends \
    bash ca-certificates curl git jq python3 ripgrep \
  && rm -rf /var/lib/apt/lists/* \
  && useradd -m -s /bin/bash sandbox

USER sandbox
WORKDIR /home/sandbox

CMD ["sleep", "infinity"]
```

For `Dockerfile.sandbox-browser`, additional consideration is needed since Chromium with `--no-sandbox` is used (which is required when Chrome can't use its internal sandbox). The container should still run as non-root, and Chrome's `--no-sandbox` flag is acceptable when the outer container provides isolation.

## References
- **CWE:** [CWE-250](https://cwe.mitre.org/data/definitions/250.html) - Execution with Unnecessary Privileges

## Comments


## Links

- None detected yet
