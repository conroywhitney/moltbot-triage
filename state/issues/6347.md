---
number: 6347
title: "WhatsApp group mention detection false-positives from phone number digit fallback"
author: anotb
created: 2026-02-01T15:20:07Z
updated: 2026-02-01T20:58:31Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6347
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug Description

WhatsApp group messages with `requireMention: true` are triggering auto-replies even when the bot is not mentioned. This happens when pasting URLs or messages containing many digits.

## Root Cause

In `src/web/auto-reply/mentions.ts`, the `isBotMentionedFromTargets` function has a fallback check that strips **all non-digit characters** from the message body and checks if the bot's E164 phone number appears as a substring:

```typescript
// Fallback: detect body containing our own number (with or without +, spacing)
if (targets.selfE164) {
  const selfDigits = targets.selfE164.replace(/\D/g, "");
  if (selfDigits) {
    const bodyDigits = bodyClean.replace(/[^\d]/g, "");
    if (bodyDigits.includes(selfDigits)) return true;
    // ...
  }
}
```

When a URL is pasted (e.g. a link with long numeric IDs in the path or query string), all digits from the URL get concatenated after stripping. This creates a long digit string that can coincidentally contain the bot's phone number as a substring, causing a false mention match.

## Compounding Factor

When `isSelfChatMode()` returns `true` (which happens when the bot's own E164 is in the `allowFrom` list — common for personal WhatsApp setups), the explicit @mention JID check is bypassed even when `hasMentions` is true, and the code falls through to the regex + phone number digit check.

## Steps to Reproduce

1. Configure WhatsApp with `groups: { "*": { requireMention: true } }`
2. Set `mentionPatterns` to specific phrases (e.g. `["yo clawd", "@clawd"]`)
3. Paste a URL containing many digits in a WhatsApp group
4. Bot triggers and auto-replies despite no mention pattern being present

## Expected Behavior

With `requireMention: true`, the bot should only respond when:
- Explicitly @mentioned via WhatsApp native mention
- Message body matches one of the configured `mentionPatterns`

The phone number digit fallback should either be removed entirely or made much more restrictive (e.g. require the number to appear as a distinct token with `+` prefix or `@` prefix, not as a substring of concatenated digits).

## Observed Behavior

Bot auto-replies to group messages containing URLs with no mention. Intermittent — depends on which URLs are shared and whether their concatenated digits happen to contain the bot's phone number.

## Environment

- Channel: WhatsApp (personal)
- Config: `groupPolicy: "allowlist"`, `groups: { "*": { requireMention: true } }`
- File: `src/web/auto-reply/mentions.ts` → `isBotMentionedFromTargets()`

## Comments


## Links

- None detected yet
