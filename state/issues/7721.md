---
number: 7721
title: "Streaming error: Unexpected event order, got message_start before receiving \"message_stop\""
author: 13967186047lee-maker
created: 2026-02-03T04:31:42Z
updated: 2026-02-03T04:31:42Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7721
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug Description

When processing streaming events from the model, the gateway encounters an unexpected event order error:

```
Unexpected event order, got message_start before receiving "message_stop"
```

## Steps to Reproduce

1. The exact reproduction steps are unclear
2. This error appears to occur during streaming chat responses
3. May be related to concurrent sessions or rapid successive requests

## Expected Behavior

Streaming events should follow the correct order:
1. `message_start`
2. Content deltas
3. `message_stop`

If `message_stop` has not been received, a new `message_start` should not begin.

## Actual Behavior

The gateway receives `message_start` before receiving `message_stop` for a previous message, causing an upstream error (HTTP 502: upstream_error: Upstream request failed after retries).

## Environment

- OpenClaw version: 2026.2.1
- Platform: Linux (OpenClaw running in gateway mode)
- Error: `HTTP 502: upstream_error: Upstream request failed after retries`

## Impact

- Users experience HTTP 502 errors
- Gateway may require restart to recover
- Disrupts ongoing chat sessions

## Notes

This appears to be a state management issue in the streaming event handler. The gateway should either:
1. Properly track message lifecycle to prevent overlapping streams
2. Gracefully handle out-of-order events
3. Wait for or force-close previous messages before starting new ones

## Comments


## Links

- None detected yet
