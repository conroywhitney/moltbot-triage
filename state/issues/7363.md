---
number: 7363
title: "Matrix media download not working - voice messages and images not downloaded"
author: nicolasmertens
created: 2026-02-02T18:55:41Z
updated: 2026-02-02T19:57:57Z
labels: []
assignees: []
comments_count: 2
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7363
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

# Bug Report: Matrix Media Download Not Working

## Environment
- OpenClaw version: 2026.2.1
- OS: macOS 15.7.3 (arm64)
- Node: v25.3.0
- Matrix plugin: loaded
- Homeserver: Conduit (localhost:8008)

## Problem
Voice messages and images sent via Matrix are not being downloaded. The text content comes through (e.g., "Voice message.ogg" or "Screenshot.png") but the actual media files are not downloaded or made available to the agent.

## Configuration
- `channels.matrix.encryption: true` (but rooms are unencrypted)
- E2EE was enabled, rooms are unencrypted
- Tried with crypto state reset - no change

## Observations
1. Messages show filename (e.g., "Voice message.ogg") but no MediaPath in context
2. No media download errors in logs
3. No `mxc://` URLs or download attempts visible in verbose logs
4. Earlier today (before some point) voice messages WERE being transcribed via Whisper

## Error in Logs
```
TypeError: client.crypto.requestOwnUserVerification is not a function
```
This error appears on startup but may be unrelated since rooms are unencrypted.

## Steps to Reproduce
1. Set up Matrix with Conduit homeserver
2. Enable matrix plugin
3. Send voice message or image from Element client
4. Agent receives text placeholder but no actual media

## Expected Behavior
Media files should be downloaded and made available to the agent at a local path (MediaPath in context).

## Workaround
None found yet. Typing instead of voice messages works as a temporary workaround.

## Comments

### @nicolasmertens (2026-02-02)

Issue resolved after OpenClaw update to 2026.2.1. Media (voice messages and images) now downloading correctly. May have been a transient issue or fixed in the update.

### @nicolasmertens (2026-02-02)

## Root Cause Found

Related to: https://github.com/openclaw/openclaw/issues/3499

The Matrix extension's `downloadContent()` handler expects a raw `Buffer`, but `@vector-im/matrix-bot-sdk` v0.8.0 returns `{data: Buffer, contentType: string}`.

## Fix

**File:** `extensions/matrix/src/matrix/monitor/media.ts` (lines 30-39)

```typescript
// Before (broken):
const buffer = await params.client.downloadContent(params.mxcUrl);
if (buffer.byteLength > params.maxBytes) {
  throw new Error("Matrix media exceeds configured size limit");
}
return { buffer: Buffer.from(buffer) };

// After (fixed):
const response = await params.client.downloadContent(params.mxcUrl);
// Handle both old Buffer format and new {data, contentType} format
const buffer = Buffer.isBuffer(response) ? response : response.data;
const headerType = !Buffer.isBuffer(response) && response.contentType 
  ? response.contentType : undefined;
if (buffer.byteLength > params.maxBytes) {
  throw new Error("Matrix media exceeds configured size limit");
}
return { buffer: Buffer.from(buffer), headerType };
```

This fix handles both the old Buffer format and the new object format from matrix-bot-sdk v0.8.0.

## Verified Working
- Voice messages ✅
- Images ✅  
- Text ✅


## Links

- None detected yet
