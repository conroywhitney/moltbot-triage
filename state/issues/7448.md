---
number: 7448
title: "Nostr plugin: subscribeMany double-wraps filter array → relays reject with 'bad req'"
author: al-munazzim
created: 2026-02-02T21:06:02Z
updated: 2026-02-02T21:06:02Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7448
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

The `@openclaw/nostr` plugin (v2026.2.1) cannot receive Nostr DMs because `SimplePool.subscribeMany` in `nostr-tools` double-wraps the filter array, causing all relays to reject the subscription with `NOTICE: ERROR: bad req: provided filter is not an object`.

## Root Cause

In `nostr-bus.ts` line 491:
```ts
const sub = pool.subscribeMany(relays, [{ kinds: [4], "#p": [pk], since }], {
```

`SimplePool.subscribeMany(relays, filter, params)` treats the second arg as a single value per relay. Inside `subscribeMap`, it does `grouped.get(url).push(filter)` — so `[{...}]` gets pushed into another array → `[[{...}]]`. The relay then receives `["REQ", subId, [{...}]]` where the filter is an array instead of an object.

## Proof

```js
// BROKEN - subscribeMany with array-wrapped filter
pool.subscribeMany(relays, [{ kinds: [4], "#p": [pk], since }], opts)
// → sends ["REQ", subId, [filter]]  ← array, relay rejects

// WORKS - subscribe with unwrapped filter  
pool.subscribe(relays, { kinds: [4], "#p": [pk], since }, opts)
// → sends ["REQ", subId, filter]  ← object, relay accepts

// WORKS - raw WebSocket
ws.send(JSON.stringify(["REQ", "sub1", { kinds: [4], "#p": [pk], since }]))
// → all 3 DMs received
```

Tested on nostr-tools 2.20.0 and 2.22.1 — same behavior on both.

## Fix

Change `nostr-bus.ts:491` from `pool.subscribeMany(relays, [filter], ...)` to `pool.subscribe(relays, filter, ...)`.

## Environment

- OpenClaw: 2026.2.1
- nostr-tools: 2.22.1 (also repro on 2.20.0)
- Relays tested: relay.damus.io, relay.primal.net, nos.lol
- OS: Ubuntu 24.04 on LNVPS (1 vCPU, 942MB RAM)

## Comments


## Links

- None detected yet
