---
number: 4184
title: "Deprecation warning: punycode module"
author: csegeb
created: 2026-01-29T20:42:50Z
updated: 2026-02-01T13:42:26Z
labels: []
assignees: []
comments_count: 1
reactions_total: 2
url: https://github.com/openclaw/openclaw/issues/4184
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description




## Issue

Node.js deprecation warning appears in gateway logs:


DeprecationWarning: The punycode module is deprecated. Please use a userland alternative instead.


**Environment:**
- Moltbot version: 2026.1.24-3
- Node.js: v22.22.0 / v25.5.0
- OS: Linux 6.17.0-8-generic (x64)

**Impact:**
Warning appears in logs but doesn't affect functionality. Can be suppressed with `NODE_OPTIONS=--no-deprecation` but should be fixed upstream by updating dependencies that use the deprecated `punycode` module.

**Suggested fix:**
Identify and update the dependency chain that still relies on Node's built-in `punycode` module. Consider using `punycode.js` or similar userland alternatives.

**Workaround (applied):**
Add to systemd service:

Environment="NODE_OPTIONS=--no-deprecation

## Comments

### @A-Beata (2026-02-01)

## Root Cause Found

The warning comes from the `grammy` → `node-fetch@2.7.0` → `whatwg-url@5.0.0` → `tr46@0.0.3` dependency chain.

Both `whatwg-url/lib/url-state-machine.js` and `tr46/index.js` use:
```js
require("punycode")  // deprecated Node.js built-in
```

## Proper Fix (npm overrides)

Add to `package.json`:
```json
"overrides": {
  "whatwg-url": "^14.0.0"
}
```

This forces the newer `whatwg-url` which uses the userland `punycode.js` package instead.

Reference: [node-fetch/node-fetch#1794](https://github.com/node-fetch/node-fetch/issues/1794)

## Manual Patch (for users)

Until the override is added, users can patch the installed files:

```bash
# Patch whatwg-url
sed -i.bak 's/require("punycode")/require("punycode.js")/' \
  /opt/homebrew/lib/node_modules/openclaw/node_modules/whatwg-url/lib/url-state-machine.js

# Patch tr46
sed -i.bak 's/require("punycode")/require("punycode.js")/' \
  /opt/homebrew/lib/node_modules/openclaw/node_modules/tr46/index.js
```

This works because `punycode.js` (the userland package) is already installed in openclaw's node_modules.

**Note:** Patch is lost on `npm install -g openclaw` updates.


## Links

- None detected yet
