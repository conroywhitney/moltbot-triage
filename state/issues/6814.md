---
number: 6814
title: "Gateway recovers stale cron jobs from orphaned .tmp files after restart"
author: zire
created: 2026-02-02T02:51:41Z
updated: 2026-02-02T02:57:00Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6814
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

The gateway's cron scheduler continues to run jobs that have been deleted because it recovers from orphaned `.tmp` files instead of using the authoritative `jobs.json`.

## Steps to Reproduce

1. Create a cron job via the gateway
2. Delete the job (jobs.json becomes `{"version": 1, "jobs": []}`)
3. Restart the gateway (`launchctl stop/start`)
4. The deleted job continues to run

## Expected Behavior

After restart, the gateway should load from `jobs.json` which shows no jobs, and no scheduled tasks should run.

## Actual Behavior

The gateway recovers the deleted job from orphaned `.tmp` files in `~/.clawdbot/cron/` and continues executing it.

## Root Cause Analysis

The atomic write pattern creates `.tmp` files like `jobs.json.40705.af341ee67e131.tmp` before renaming to `jobs.json`. These tmp files accumulate and are never cleaned up.

On restart, the gateway appears to have recovery logic that prefers recent `.tmp` files over an empty/minimal `jobs.json`, treating them as crash recovery state.

## Workaround

Manually delete the `.tmp` files:
```bash
rm ~/.clawdbot/cron/jobs.json.*.tmp
launchctl stop com.clawdbot.gateway && launchctl start com.clawdbot.gateway
```

## Suggested Fix

Either:
1. Clean up `.tmp` files after successful atomic write to `jobs.json`
2. Don't prefer `.tmp` files over a valid (even if empty) `jobs.json`
3. Add a timestamp check - only recover from `.tmp` if it's newer than `jobs.json`

## Environment

- clawdbot version: 2026.1.24-3
- macOS 26.2
- Running as launchd service

## Comments


## Links

- None detected yet
