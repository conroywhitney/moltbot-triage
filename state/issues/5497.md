---
number: 5497
title: "Orphaned tool_result after mid-stream assistant error causes permanent session breakage"
author: brezgis
created: 2026-01-31T15:19:27Z
updated: 2026-02-02T00:18:56Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 1
url: https://github.com/openclaw/openclaw/issues/5497
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

### Summary
When an assistant message errors mid-stream during a tool_use call (e.g., web_fetch timing out), the transcript repair logic can produce an orphaned tool_result block with no matching tool_use in the preceding assistant message. This causes every subsequent API request to fail with a 400 error, permanently breaking the session until manual JSONL surgery is performed.

### Environment
Clawdbot version: 2026.1.24-3
Provider: Anthropic (claude-opus-4-5)
Channel: Discord
OS: Ubuntu Linux (Hetzner VPS)

### Steps to Reproduce
Agent calls web_fetch (or any tool) during a response
The API call errors mid-stream (stopReason: "error")
The assistant message with the tool_use block is partially persisted to the session JSONL
Clawdbot's transcript repair injects a synthetic tool_result for the errored call
On next turn, the Anthropic API sees the tool_result referencing toolu_XXXX but the corresponding tool_use block is missing from the assistant message (because it was only partially written)
API returns 400: unexpected tool_use_id found in tool_result blocks
Every subsequent message hits the same 400 — the session is permanently broken

### Expected Behavior
The transcript hygiene / sanitization logic should:
Detect orphaned tool_result blocks (tool_result with no matching tool_use in the preceding assistant message)
Either remove the orphaned tool_result, or inject a synthetic tool_use to match it
Prevent the session from entering an unrecoverable state

### Actual Behavior
The session enters a permanent error loop. The only recovery is manual truncation of the session JSONL file.

### Workaround
Locate the session file at ~/.clawdbot/agents/main/sessions/<session-id>.jsonl, find the line number of the broken entry, and truncate:

cp session.jsonl session.jsonl.bak
head -n <last-good-line> session.jsonl.bak > session.jsonl


### Notes
The transcript hygiene docs indicate that Anthropic provider policy includes "tool result pairing repair and synthetic tool results" — but this appears to only handle the case of missing tool_results (tool_use without a result), not the reverse case of missing tool_use (orphaned tool_result). The reverse case should be covered too.

_This issue was written collaboratively with my Clawdbot agent (Claude). The bug was encountered and manually debugged by a human; the writeup was drafted by the agent based on the diagnosis._

## Comments

### @sebslight (2026-02-01)

OpenClaw Maintainer Triage // Issue Closure

Hi — this is a joint maintainer effort to keep the repo moving. We’re currently seeing ~30 new issues per hour, and we can’t review every future request without slowing down critical stabilization work. This issue is unlikely to be considered in the near term, so we’re closing it to keep the pipeline moving while we focus on stability.

We’re very sorry this is happening, but we won’t be able to look at the comments on this issue.

Want to make your request stand out? Submit a PR and report to #pr-thunderdome-dangerzone on Discord — READ THE TOPIC. Give us a clear briefing: what it fixes, who it helps, and why it’s worth shipping.

Thanks for understanding and for contributing.

![](https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExeXFramtnZWo1ZWM4YmYzcG1zcXE1NWV1eTl3MDZodnk4aWhvM2tqbCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/RWUqVYucDBD4A/giphy.gif)



## Links

- None detected yet
