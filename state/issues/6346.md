---
number: 6346
title: "[Bug]: Sandbox skill <location> in system prompt uses host path instead of sandbox path"
author: kikemarti-eu
created: 2026-02-01T15:19:45Z
updated: 2026-02-02T21:47:06Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 3
url: https://github.com/openclaw/openclaw/issues/6346
duplicate_of: null
related_issues: [2432]
blocks: []
blocked_by: []
---

## Description

## Description

When sandbox is active, the `<location>` tag in `<available_skills>` contains the **host** path to SKILL.md instead of a path within the sandbox root. The LLM's `read()` call fails with "Path escapes sandbox root".

Skills are correctly copied to the sandbox workspace via `syncSkillsToWorkspace()`, but the system prompt still references the original host path.

## Steps to Reproduce

1. Configure sandbox: `mode: "all"`, `scope: "agent"`
2. Create a custom skill in `~/.openclaw/skills/my-skill/`
3. Start a session and trigger the skill
4. LLM attempts `read("/home/user/.openclaw/skills/my-skill/SKILL.md")` → rejected

## Root Cause

The skill prompt snapshot is built **before** sandbox context resolution, using the host workspace dir. When the agent run later resolves the sandbox, the cached snapshot takes priority over freshly-loaded sandbox entries.

1. **`src/auto-reply/reply/session-updates.ts:152`** — `buildWorkspaceSkillSnapshot(workspaceDir)` called with host path from `resolveAgentWorkspaceDir()`. Cached in session store.

2. **`src/agents/pi-embedded-runner/run/attempt.ts:161-189`** — Sandbox resolved, `effectiveWorkspace` correctly points to sandbox dir. Skills re-loaded from sandbox. But `resolveSkillsPromptForRun` receives both the snapshot (host paths) and the entries (sandbox paths).

3. **`src/agents/skills/workspace.ts:264-266`** — Snapshot always wins:
   ```typescript
   if (snapshotPrompt) {
     return snapshotPrompt;  // host paths returned, sandbox entries ignored
   }
   ```

The v2026.1.10 change ("mirror skills into sandbox workspaces") addressed the **filesystem** side but the **prompt** side (`<location>` rewriting) was not completed.

## Suggested Fix

In `attempt.ts`, when sandbox is active and `effectiveWorkspace !== resolvedWorkspace`, rebuild the snapshot from the sandbox workspace:

```typescript
const effectiveSnapshot = sandbox?.enabled && effectiveWorkspace !== resolvedWorkspace
  ? buildWorkspaceSkillSnapshot(effectiveWorkspace, { config: params.config })
  : params.skillsSnapshot;
```

Alternatively, change `resolveSkillsPromptForRun` to prefer `entries` over `skillsSnapshot` when both are provided.

## Related

- #2432 — shares root cause (host-side path validation rejects paths before container sees them). That issue covers general bind mount access; this one is specifically about `<location>` in `<available_skills>` never being rewritten for the sandbox.

## Comments

### @ovflowd (2026-02-02)

+1 can confirm, had to make a temporary override/fix via a system prompt override.


## Links

- None detected yet
