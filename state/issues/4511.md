---
number: 4511
title: "Skills watcher causes EMFILE/EBADF with many skills - needs optimization"
author: ch-en-hyphen
created: 2026-01-30T08:36:32Z
updated: 2026-01-31T02:30:28Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 1
url: https://github.com/openclaw/openclaw/issues/4511
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Problem

When the workspace has many skills (700+), the skills watcher exhausts file descriptors, causing:

1. `EMFILE: too many open files, watch` errors flooding the logs
2. Subsequently, `exec` tool fails with `spawn EBADF` (bad file descriptor)
3. **Restarting gateway or even rebooting does not recover** until ulimit is raised AND skills count is reduced

## Reproduction

1. Install 700+ skills in the workspace skills directory
2. Start gateway with default macOS ulimit (256)
3. Skills watcher attempts to watch all skill directories/files
4. fd limit exhausted â†’ exec tool broken

## Log Evidence

```
{"1":"skills watcher error (/Users/xxx/clawd): Error: EMFILE: too many open files, watch"...}
// repeated hundreds of times
{"0":"[tools] exec failed: spawn EBADF"...}
```

## Current Workaround

1. Raise ulimit: `ulimit -n 65536` (or higher)
2. Reduce skills count
3. Restart gateway in the same shell with raised ulimit

## Suggested Optimizations

1. **Lazy watching**: Only watch skills that are actually loaded/used in the session, not all 700+
2. **Debounced/batched watching**: Use a single watcher at the skills root with recursive flag, instead of individual watchers per skill
3. **Graceful degradation**: If EMFILE is encountered, disable watching and log a warning instead of breaking exec
4. **Config option**: Add `skills.watch: false` or `skills.watchDepth: 1` config to disable/limit watching
5. **Document fd requirements**: Note in docs that large skill collections need higher ulimit

## Environment

- Clawdbot: 2026.1.24-3
- Node: v25.2.1
- OS: macOS Darwin 25.2.0 (arm64)
- Skills count: 700+
- Default ulimit: 256

## Comments


## Links

- None detected yet
