---
number: 6986
title: "Bonjour mDNS name conflicts spiral after unclean shutdown"
author: powerpig99
created: 2026-02-02T08:08:50Z
updated: 2026-02-03T04:42:29Z
labels: []
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6986
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

After an unclean gateway shutdown (e.g. shutdown timeout), stale mDNS records are not deregistered from the local network. On the next startup, the gateway encounters a name conflict and increments a numeric suffix. This repeats continuously, creating a runaway conflict storm.

## Observed Behavior

- The error log accumulated **115,000+ bonjour conflict messages** over ~8 days
- The suffix incremented from (2) all the way to (999)
- The watchdog repeatedly detects the service stuck in `probing` state and attempts re-advertisement, which triggers more conflicts
- Each gateway restart resets the counter but the cycle begins again

### Sample log entries

```
[bonjour] gateway name conflict resolved; newName="Jing's Mac mini M1 (OpenClaw) (67)"
[bonjour] gateway hostname conflict resolved; newHostname="openclaw-(67)"
[bonjour] watchdog detected non-announced service; attempting re-advertise (gateway fqdn=... state=probing)
```

### Trigger

The conflict storm starts after an unclean shutdown. The log shows:

```
[gateway] shutdown timed out; exiting without full cleanup
```

After this, the stale mDNS record remains on the network, and subsequent startups conflict with it.

## Expected Behavior

- On startup, the gateway should detect and clean up stale mDNS records from previous instances before registering its own
- The shutdown timeout should be long enough for mDNS deregistration, or mDNS cleanup should be prioritized early in the shutdown sequence
- There should be a cap on the conflict suffix with a clear warning, rather than silently incrementing to 999

## Impact

- **Log pollution**: 46MB+ of bonjour noise in the error log, making real errors hard to find
- **Unreliable discovery**: The gateway's mDNS name keeps changing, breaking clients that rely on it
- **Resource waste**: Continuous conflict resolution consumes CPU and network bandwidth

## Environment

- openclaw v2026.1.30
- macOS 26.2.0 (Darwin 25.2.0), Mac mini M1
- Gateway mode: local, port 18789

## Suggested Fixes

1. Prioritize mDNS deregistration at the start of the shutdown sequence (before other cleanup that may time out)
2. On startup, attempt to flush/deregister stale records from previous instances
3. Add a conflict suffix cap with a warning log when reached
4. Consider using a PID file or lock to detect stale records from crashed instances

## Comments

### @ymzhang10 (2026-02-03)

## Workaround: Disable mDNS

If you are running in `gateway.bind: "loopback"` mode (localhost only) and don't need LAN discovery, you can completely disable mDNS to avoid this issue:

```json
{
  "discovery": {
    "mdns": {
      "mode": "off"
    }
  }
}
```

Or via CLI:
```bash
openclaw config set discovery.mdns.mode off
```

### Why this works

The conflict occurs because both the Gateway and Desktop App try to register the same Bonjour service name. When the previous instance's mDNS record wasn't properly deregistered (due to unclean shutdown), the new instance encounters a conflict and increments the suffix `(2)`, `(3)`, etc.

Setting `discovery.mdns.mode: "off"` prevents mDNS registration entirely, which:
1. Eliminates the name conflict warnings
2. Stops the watchdog re-advertise loop
3. Cleans up the logs

### Trade-off

- This disables LAN discovery, so other devices on your network won't be able to discover the gateway via mDNS
- For `gateway.bind: "loopback"` configurations, this is a non-issue since the gateway isn't accessible from LAN anyway
- Desktop App â†” Gateway communication via `localhost:18789` continues to work normally

### Environment

- openclaw 2026.2.1
- macOS 26.2 (Darwin 25.2.0), MacBook Pro M3 Pro
- Gateway mode: local, bind: loopback


## Links

- None detected yet
