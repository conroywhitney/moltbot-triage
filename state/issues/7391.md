---
number: 7391
title: "[Bug]: Nextcloud Talk plugin - incorrect HMAC signature computation"
author: Mr-Hubiverse
created: 2026-02-02T19:33:37Z
updated: 2026-02-02T19:33:37Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7391
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

Description
The Nextcloud Talk plugin computes HMAC signatures incorrectly when sending messages/reactions back to Nextcloud, causing 401 Unauthorized errors.

Root Cause
In extensions/nextcloud-talk/src/send.ts, the signature is computed over the JSON body instead of the message/reaction string.

Current code (line 92-95):

typescript
const bodyStr = JSON.stringify(body);
 
const { random, signature } = generateNextcloudTalkSignature({
  body: bodyStr,  // ❌ Signs the JSON: {"message":"hello"}
  secret,
});
Nextcloud expects the signature over just the message string (see ChecksumVerificationService.php):

php
$hash = hash_hmac('sha256', $random . $data, $secret);
// where $data is the message parameter, not the JSON body
Fix
For sendMessageNextcloudTalk (line 93):

typescript
const { random, signature } = generateNextcloudTalkSignature({
  body: message,  // ✅ Sign the message string
  secret,
});
For sendReactionNextcloudTalk (line 183):

typescript
const { random, signature } = generateNextcloudTalkSignature({
  body: reaction,  // ✅ Sign the reaction string
  secret,
});
The body in the fetch request should remain as the JSON (bodyStr / body).

Steps to Reproduce
Configure Nextcloud Talk channel with valid bot secret
Send a message to a room where the bot is enabled
Bot receives webhook, processes, attempts to reply
Reply fails with 401 Unauthorized
Workaround
Mount a patched send.ts over the original in the container.

## Comments


## Links

- None detected yet
