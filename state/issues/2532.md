---
number: 2532
title: "[Bug]: `spawn EBADF` error on all exec tool calls**"
author: nucreature
created: 2026-01-27T03:03:40Z
updated: 2026-01-29T10:02:38Z
labels: ["bug"]
assignees: []
comments_count: 3
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/2532
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

---

**Bug: `spawn EBADF` error on all exec tool calls**

**Environment:**
- macOS 15.6.0 (arm64) — Mac mini
- Clawdbot 2026.1.24-3
- Tested on Node v25.4.0 and v22.x (same issue on both)
- exec config: `security: "full"`, `ask: "off"`

**Problem:**
The exec tool fails with `spawn EBADF` on every command. Browser tool works fine (can start Chrome, navigate, etc.), but any exec call fails immediately.

**Error from gateway logs (verbose mode):**
```
[exec] spawn failed (spawn EBADF syscall=spawn errno=-9); retrying with no-detach.
tools: exec failed stack: Error: spawn EBADF
    at ChildProcess.spawn (node:internal/child_process:420:11)
    at spawn (node:child_process:796:9)
    at spawnAndWaitForSpawn (file:///...clawdbot/dist/process/spawn-utils.js:28:19)
    at spawnWithFallback (file:///...clawdbot/dist/process/spawn-utils.js:78:33)
    at runExecProcess (file:///...clawdbot/dist/agents/bash-tools.exec.js:284:36)
```

**What I've tried (none fixed it):**
- Machine reboot
- Gateway restart (`pkill -f clawdbot-gateway && clawdbot gateway start`)
- npm update/reinstall (`npm uninstall -g clawdbot && npm install -g clawdbot`)
- Downgrading from Node 25 to Node 22 LTS
- Clearing `/tmp/clawdbot-*`

**Key observation:**
Node itself spawns fine:
```bash
node -e "require('child_process').execSync('echo hello', {stdio:'inherit'})"
# Output: hello
```

So the issue is specific to how Clawdbot's `spawn-utils.js` calls spawn, not a system-level problem.

---

## Comments

### @AbhishekkSaini (2026-01-27)

**FIX PUSHED!** 

**Commit:** `fix(spawn): safe spawn options prevent EBADF on macOS 15.6`
**Files:** `src/process/spawn-utils.ts`
**Changes:**
```diff
+ detached: false
+ windowsHide: true


### @kylehowells (2026-01-29)

Check how many files are in your workspace, especially the skills directory. I had a python venv in there adding 40k files causing it to fail because the file watcher used up all the file descriptors.
PR to fix my specific issue causing the `spawn EBADF` I had: https://github.com/moltbot/moltbot/pull/3845

### @AbhishekkSaini (2026-01-29)

Hi Kyle,
Thanks for the insight. That makes sense — I’ll check the workspace file count, especially the skills directory, and remove any unnecessary environments (like venvs or large dependency folders).
I’ll also take a look at PR #3845. Appreciate you pointing this out.


## Links

- None detected yet
