---
number: 5255
title: "[Bug]: Arbitrary file read via browser file upload API lacks path validation"
author: coygeek
created: 2026-01-31T07:48:24Z
updated: 2026-02-02T00:19:51Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5255
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description


## Summary

**Severity:** P0/Critical (Score: 105/150)
**CWE:** [CWE-22](https://cwe.mitre.org/data/definitions/22.html) - Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')
**OWASP:** [A01:2021](https://owasp.org/Top10/A01_2021-Broken_Access_Control/) - Broken Access Control
**File:** `src/browser/pw-tools-core.interactions.ts:492-519`

The `setInputFilesViaPlaywright` function accepts user-controlled file paths and passes them directly to Playwright without validation, allowing arbitrary file reads from the server filesystem.

**Why this is critical:** Any process with access to the browser control API can read arbitrary files readable by the OpenClaw process, including SSH keys, credentials, and application secrets.

## Triage Assessment

| Factor | Value | Score |
|--------|-------|-------|
| **Reachability** | HTTP request to browser control endpoint `/act` | 25/40 |
| **Impact** | Arbitrary file read → credential theft, lateral movement | 40/50 |
| **Exploitability** | Single request with crafted path array | 25/30 |
| **Verification** | file:line ✓, code ✓, attack steps ✓ | 15/30 |
| **Total** | — | **105/150** |

## Steps to reproduce

1. Access the browser control API endpoint `/act` with `kind: "set-input-files"`
2. Provide a path array containing sensitive files: `["/etc/passwd", "~/.ssh/id_rsa"]`
3. The files are read and attached to file input elements without validation

## Expected behavior

File paths should be validated against an allowlist or restricted to a sandbox directory. Path traversal sequences (`../`) and absolute paths outside the sandbox should be rejected.

## Actual behavior

No validation is performed. User-supplied paths are passed directly to `locator.setInputFiles(opts.paths)`.

### Affected code location:
**File** (`src/browser/pw-tools-core.interactions.ts:492-519`):
```typescript
export async function setInputFilesViaPlaywright(opts: {
  cdpUrl: string;
  targetId?: string;
  inputRef?: string;
  element?: string;
  paths: string[];  // User-controlled paths with no validation
}): Promise<void> {
  const page = await getPageForTargetId(opts);
  ensurePageState(page);
  restoreRoleRefsForTarget({ cdpUrl: opts.cdpUrl, targetId: opts.targetId, page });
  if (!opts.paths.length) throw new Error("paths are required");
  // ... no path validation ...
  const locator = inputRef ? refLocator(page, inputRef) : page.locator(element).first();
  await locator.setInputFiles(opts.paths);  // Arbitrary file read
}
```

## Environment

- Version: latest (main branch)
- OS: Any
- Install method: Any

## Logs or screenshots

N/A - issue is in code logic

## Impact

- **Confidentiality breach**: Attacker can read arbitrary files readable by the process (credentials, SSH keys, application secrets)
- **Lateral movement**: Exposed credentials enable further compromise of connected systems
- **Data exfiltration**: Sensitive application data can be extracted via file input elements

## Recommended fix

1. **Validate paths against allowlist**: Restrict to specific directories (e.g., `/tmp`, user uploads folder)
2. **Normalize and reject traversal**: Use `path.resolve()` and verify result stays within sandbox
3. **Block absolute paths**: Require relative paths rooted in allowed directories
4. **Consider user confirmation**: Prompt for explicit consent before accessing local files

## Comments

### @coygeek (2026-02-01)

## CVSS Assessment

| Metric | Value |
|--------|-------|
| **Score** | 7.5 / 10.0 |
| **Severity** | High |
| **Vector** | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N |

> [CVSS v3.1 Calculator](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N)



## Links

- None detected yet
