---
number: 2672
title: "PWA background causes WebSocket disconnection (1005) and event sequence gaps"
author: kks0488
created: 2026-01-27T08:35:10Z
updated: 2026-01-28T05:59:40Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/2672
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description
When using the webchat UI as a PWA and switching away from the app briefly (e.g., checking another app), the WebSocket connection dies with close code 1005 (No Status Received). Upon returning to the app, there's a large event sequence gap.

## Steps to Reproduce
1. Open Clawdbot webchat as PWA (Add to Home Screen)
2. Use the chat normally
3. Switch to another app for 30+ seconds
4. Return to the PWA
5. See error: `event gap detected (expected seq X, got Y)`

## Actual Behavior
- WebSocket dies with code 1005 when backgrounded
- Large event gaps (e.g., expected 115, got 310 = 195 missed events)
- User must manually refresh to get back in sync

## Expected Behavior
- Connection should gracefully handle visibility changes
- On `visibilitychange` to hidden: pause heartbeat, prepare for reconnect
- On `visibilitychange` to visible: immediately attempt reconnect if needed
- Ideally: replay missed events or at least refresh state on reconnect

## Environment
- Clawdbot version: 2026.1.24-3
- Browser: Chrome (PWA mode)
- OS: Linux

## Suggested Fix
Add `visibilitychange` event listener in webchat frontend:
```javascript
document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'visible') {
    // Attempt immediate reconnect if disconnected
    // Or refresh critical state (messages, sessions)
  }
});
```

## Comments


## Links

- None detected yet
