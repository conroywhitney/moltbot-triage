---
number: 4482
title: "Bug: generate_image.py uses deprecated google-genai SDK API (api_endpoint)"
author: xrf9268-hue
created: 2026-01-30T08:17:01Z
updated: 2026-01-30T08:17:01Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4482
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

The `generate_image.py` script in `skills/nano-banana-pro/scripts/` uses a deprecated parameter `api_endpoint` in the `google-genai` SDK, which causes image generation to fail with newer SDK versions.

## Current Behavior

When attempting to generate images, the following error occurs:

```
pydantic_core._pydantic_core.ValidationError: 1 validation error for HttpOptions
api_endpoint
  Extra inputs are not permitted [type=extra_forbidden, input_value='https://example.com/v1beta', input_type=str]
    For further information visit https://errors.pydantic.dev/2.12/v/extra_forbidden
```

## Root Cause

In `generate_image.py`, the client is initialized with:

```python
client = genai.Client(api_key=api_key, http_options={'api_endpoint': base_url})
```

However, the newer version of `google-genai` SDK has changed the `HttpOptions` schema:
- `api_endpoint` is no longer a valid parameter
- Should use `base_url` instead, and requires `vertexai=True`

## Expected Behavior

Image generation should work with custom LLM proxy endpoints.

## Proposed Fix

Update the client initialization to use the new SDK API:

```python
# Option 1: Use base_url with vertexai mode
client = genai.Client(
    vertexai=True,
    http_options={
        'base_url': base_url,
        'headers': {'Authorization': f'Bearer {api_key}'},
    },
)

# Option 2: Pin google-genai to a compatible version in requirements
# google-genai<1.0.0  # or whatever version still supports api_endpoint
```

## Environment

- Moltbot version: 2026.1.27-beta.1
- Affected file: `skills/nano-banana-pro/scripts/generate_image.py`
- google-genai SDK: latest (breaking change)

## Related

This issue is independent of the LLM proxy implementation. Even with a fully functional proxy, the SDK initialization fails before any network request is made.

## Comments


## Links

- None detected yet
