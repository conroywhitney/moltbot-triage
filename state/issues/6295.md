---
number: 6295
title: "sessions_spawn model override not applied to sub-agents"
author: richydeeee
created: 2026-02-01T14:01:40Z
updated: 2026-02-02T18:45:05Z
labels: ["bug"]
assignees: []
comments_count: 2
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6295
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug Description

The `model` parameter in `sessions_spawn` and the `agents.defaults.subagents.model` config setting are not being applied to spawned sub-agents. Sub-agents always inherit the main agent's model regardless of configuration.

## Steps to Reproduce

1. Configure sub-agent default model in `clawdbot.json`:
```json
{
  "agents": {
    "defaults": {
      "subagents": {
        "model": {
          "primary": "openai-codex/gpt-4o",
          "fallbacks": ["openai/gpt-4o"]
        }
      }
    }
  }
}
```

2. Spawn a sub-agent with explicit model override:
```
sessions_spawn(task="Test task", model="openai/gpt-4o")
```

3. Tool returns `{ "modelApplied": true }`

4. Check the session transcript:
```json
{"type":"model_change","provider":"anthropic","modelId":"claude-opus-4-5"}
```

## Expected Behavior

Sub-agent should run on the specified model (`openai/gpt-4o` or `openai-codex/gpt-4o`).

## Actual Behavior

Sub-agent runs on the main agent's model (`anthropic/claude-opus-4-5`) despite:
- Config setting `agents.defaults.subagents.model`
- Explicit `model` parameter in `sessions_spawn`
- Tool returning `modelApplied: true`

## Environment

- Clawdbot version: 2026.1.24-3
- OS: macOS (Darwin 25.2.0 arm64)
- Main agent model: anthropic/claude-opus-4-5
- Attempted sub-agent models: openai-codex/gpt-4o, openai/gpt-4o

## Additional Context

Gateway logs show config is being detected and applied:
```
[reload] config change applied (dynamic reads: agents.defaults.subagents.model)
```

But the actual model used in sub-agent sessions is always the main agent's model.

## Comments

### @Arlandw (2026-02-02)

We're experiencing the same issue with a custom vLLM provider (local GPT-OSS 120B via Spark).

Related: #6671

**Our setup:**
- Main agent: `anthropic/claude-opus-4-5`
- Attempted sub-agent model: `spark//models/gpt-oss-120b` (vLLM endpoint)
- Config: `agents.defaults.subagents.model` set correctly
- Explicit `model` param in `sessions_spawn()` also ignored

Same behavior: `modelApplied: true` in response but sub-agent actually runs on main model.

This affects both OpenAI-compatible providers (your case) and custom vLLM providers (our case), suggesting the bug is in the model routing logic rather than provider-specific.

### @Decayuki (2026-02-02)

## Confirmed on 2026.1.30

Experiencing the exact same issue on OpenClaw 2026.1.30 (macOS arm64).

**Use case:** Trying to use Haiku for procedural sub-agent workflows (NotebookLLM automation) to reduce costs 12Ã— vs Sonnet.

**Configurations tested (all failed):**

1. String format:
```json
{
  "agents": {
    "defaults": {
      "subagents": {
        "model": "anthropic/claude-haiku-4"
      }
    }
  }
}
```

2. Object format:
```json
{
  "agents": {
    "defaults": {
      "subagents": {
        "model": {
          "primary": "anthropic/claude-haiku-4"
        }
      }
    }
  }
}
```

3. Per-agent config:
```json
{
  "agents": {
    "list": [
      {
        "id": "main",
        "subagents": {
          "model": {
            "primary": "anthropic/claude-haiku-4"
          }
        }
      }
    ]
  }
}
```

4. Explicit model in `sessions_spawn`:
```javascript
sessions_spawn(task="...", model="anthropic/claude-haiku-4")
sessions_spawn(task="...", model="haiku")  // via alias
```

**Result in all cases:**
- Warning: `"model not allowed: anthropic/claude-haiku-4"`
- `modelApplied: false`
- Sub-agent uses `anthropic/claude-sonnet-4-5` (main agent model)

**Note:** Haiku IS in `agents.defaults.models` allowlist with alias configured.

**Impact:** Cannot optimize costs by using cheaper models for procedural sub-agent tasks. This blocks a key use case for sub-agents (parallel work with cost-appropriate models).


## Links

- None detected yet
