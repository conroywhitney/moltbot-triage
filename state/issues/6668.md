---
number: 6668
title: "feat: Add Google Gemini embedding support to LanceDB memory plugin"
author: Hua688
created: 2026-02-01T22:57:40Z
updated: 2026-02-02T00:16:05Z
labels: ["enhancement"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6668
duplicate_of: null
related_issues: [5929]
blocks: []
blocked_by: []
---

## Description

## Summary

Add multi-provider embedding support to the LanceDB memory plugin, enabling users to choose between OpenAI and Google Gemini embeddings.

## Motivation

Currently, the memory plugin only supports OpenAI embeddings. Users who prefer Google Gemini (or those with Google API access) have no alternative. Adding multi-provider support increases flexibility and reduces vendor lock-in.

## Features

- **Multi-provider embeddings**: Switch between OpenAI and Google Gemini
- **Auto-detection**: Automatically detects provider based on model name
- **Vector dimension support**: Correctly handles dimension differences (OpenAI: 1536/3072, Gemini: 768)
- **Docker optimization**: Multi-stage build reduces image size from ~1.2GB to ~870MB
- **Migration guide**: Comprehensive documentation for switching providers

## Configuration

### OpenAI (existing, still works)
```json
{
  "memory": {
    "embedding": {
      "provider": "openai",
      "model": "text-embedding-3-small",
      "apiKey": "${OPENAI_API_KEY}"
    }
  }
}
```

### Google Gemini (new)
```json
{
  "memory": {
    "embedding": {
      "provider": "google",
      "model": "gemini-embedding-001",
      "apiKey": "${GOOGLE_API_KEY}"
    }
  }
}
```

## Migration & Data Compatibility

⚠️ **IMPORTANT**: Vector dimensions are incompatible between providers. When switching providers, users MUST delete their existing database:

1. Backup current database (optional but recommended)
2. Delete database: `rm -rf ~/.openclaw/memory/lancedb`
3. Update configuration and restart

See `docs/plugins/memory-lancedb-migration.md` for detailed instructions.

## Implementation Details

- Extends `Embeddings` class to support multiple providers
- Uses REST API for Google Gemini (no SDK dependency needed)
- Dynamic OpenAI loading for ESM compatibility
- Strict response validation and error handling
- Full test coverage

## Related PR

#5929 - Implementation and code review fixes

## Comments


## Links

- None detected yet
