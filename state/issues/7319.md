---
number: 7319
title: "[memory] Gemini embedding config uses incorrect model name + batch API fails silently"
author: tylervovan
created: 2026-02-02T17:56:32Z
updated: 2026-02-02T17:56:32Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7319
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

When configuring Gemini embeddings for memory search, `openclaw memory index` hangs indefinitely due to two compounding issues:

1. **Incorrect model name in docs/examples**: The documented model `gemini-embedding-001` does not exist. The correct models are `text-embedding-004` or `embedding-001`.

2. **Batch API fails silently**: When using a model that does not support `asyncBatchEmbedContent`, the batch jobs return `UNKNOWN` status indefinitely instead of failing with a clear error. This causes the indexing to hang with no indication of what went wrong.

## Steps to Reproduce

1. Configure Gemini embeddings in `openclaw.json`:
```json
"agents": {
  "defaults": {
    "memorySearch": {
      "provider": "gemini",
      "model": "gemini-embedding-001"  // This model does not exist
    }
  }
}
```

2. Run `openclaw memory index`

3. Observe: stuck at `0/17 files Â· 0 chunks` with batch status polling `UNKNOWN`

## Expected Behavior

- Clear error message if configured model does not exist
- Timeout or fallback if batch API returns `UNKNOWN` status repeatedly
- Documentation should reference correct model names

## Actual Behavior

- Silent hang with no actionable error
- Verbose logs show `UNKNOWN` batch status but no explanation
- User must manually test API to discover the issue

## Workaround

Two config changes required:

```json
"memorySearch": {
  "provider": "gemini",
  "model": "text-embedding-004",  // Correct model name
  "remote": {
    "batch": {
      "enabled": false  // Disable batch API
    }
  }
}
```

## Suggested Fixes

1. Update docs to reference correct Gemini model names (`text-embedding-004`, `embedding-001`)
2. Add model validation at startup that warns if model does not exist
3. Improve batch status handling: timeout after N `UNKNOWN` responses, or detect "API unavailable" vs "pending"
4. Consider auto-fallback to non-batch mode after batch API failures

## Environment

- OpenClaw: 2026.2.1
- OS: Linux 6.17.0-12-generic (x64)
- Provider: Gemini (text-embedding-004)

## Related

- User incident report with full timeline available

## Comments


## Links

- None detected yet
