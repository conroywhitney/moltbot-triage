---
number: 4708
title: "Android app v2026.1.29-dev: 'closed before connect' loop - never completes WS handshake"
author: cortexuvula
created: 2026-01-30T15:06:09Z
updated: 2026-01-30T15:06:09Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4708
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Environment
- **Gateway:** v2026.1.29 (from source, git @ da71eaebd)
- **Android app:** v2026.1.29-dev on Google Pixel 9 Pro Fold (Android)
- **Gateway OS:** Linux 6.14.0-37-generic (x64), Node 22.22.0
- **Gateway bind:** LAN (0.0.0.0:18789)
- **Auth mode:** token (also tested with auth mode 'none' — same result)

## Problem
The Android app discovers the gateway via mDNS correctly (shows 'cortex-home' at 192.168.1.171:18789). However, tapping **Connect** never completes the handshake.

Gateway logs show a repeating pattern of TWO WebSocket connections opening every ~7 seconds, both immediately closing:

```
[ws] closed before connect conn=... remote=192.168.1.75 host=192.168.1.171:18789 ua=okhttp/5.3.2 code=1000 reason=bye
[ws] closed before connect conn=... remote=192.168.1.75 host=192.168.1.171:18789 ua=okhttp/5.3.2 code=1000 reason=bye
```

The connections last ~30-40ms. The gateway sends `connect.challenge` with a nonce, but the app closes before responding.

## What we tried
1. ✅ Gateway reachable on LAN (HTTP 200 on http://192.168.1.171:18789/)
2. ✅ WS works from server side (`ws://192.168.1.171:18789` — gets `connect.challenge` properly)
3. ❌ Disabled TLS requirement in app settings — no change
4. ❌ Disabled gateway auth (`mode: none`) — no change
5. ❌ Cleared app data (`adb shell pm clear ai.openclaw.android`) — no change
6. ❌ Force-stopped and relaunched app — no change
7. ❌ Tried both discovered gateway Connect and Manual Gateway Connect — same result
8. ✅ Disabled old `clawdbot-gateway` systemd service (was in auto-restart loop)
9. ✅ UFW port 18789 open
10. ✅ `allowInsecureAuth: true` set in controlUi config

## App behavior
- App shows 'Gateway error: Not initialized' in settings
- Discovery works: finds cortex-home at 192.168.1.171:18789
- ADB logcat shows no errors from the app — just okhttp socket connections
- The dual-connection pattern (two WS connections per cycle) suggests a probe + connect attempt, but both close immediately

## Expected
App should complete the WS handshake, send the `connect` message with auth, and trigger a device pairing request.

## Gateway config (relevant)
```json
{
  "gateway": {
    "bind": "lan",
    "auth": { "mode": "token" },
    "controlUi": { "allowInsecureAuth": true }
  }
}
```

## Comments


## Links

- None detected yet
