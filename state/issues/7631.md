---
number: 7631
title: "[Bug]:"
author: kuman62
created: 2026-02-03T02:17:29Z
updated: 2026-02-03T02:19:58Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7631
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

On Windows, `openclaw plugins install` fails with `Error: spawn EINVAL` when installing plugins from npm.
The failure happens during the plugin installation step where OpenClaw spawns `npm` (or `npm.cmd`) as a child process.

This appears to be a Windows-specific issue related to how `child_process.spawn` is used for `.cmd` executables.

---

## Steps to reproduce

1. Use Windows 10/11.
2. Install Node.js **v22.x LTS**.
3. Install OpenClaw globally:

   ```bash
   npm install -g openclaw
   ```
4. Run the following command in a normal working directory (not `System32`):

   ```bash
   openclaw plugins install @m1heng-clawd/feishu
   ```

---

## Expected behavior

The plugin should be downloaded and installed successfully via npm, and then appear in:

```bash
openclaw plugins list
```

---

## Actual behavior

The command fails immediately with the following error:

```text
Downloading @m1heng-clawd/feishuâ€¦
[openclaw] Failed to start CLI: Error: spawn EINVAL
    at ChildProcess.spawn (node:internal/child_process:420:11)
    at spawn (node:child_process:787:9)
    at runCommandWithTimeout (.../openclaw/dist/process/exec.js:83:19)
    at installPluginFromNpmSpec (.../openclaw/dist/plugins/install.js:306:23)
```

The error occurs before npm actually runs.

---

## Environment

* Clawdbot version: `OpenClaw 2026.2.1`
* OS: Windows 11 x64
* Install method (pnpm/npx/docker/etc): `npm install -g openclaw`
* Node.js version: `v22.22.0 LTS`

---

## Logs or screenshots

Relevant stack trace:

```text
Error: spawn EINVAL
    at ChildProcess.spawn (node:internal/child_process:420:11)
    at spawn (node:child_process:787:9)
    at runCommandWithTimeout (openclaw/dist/process/exec.js:83:19)
```

### Additional technical notes

From inspecting `dist/process/exec.js`, OpenClaw currently spawns npm like this on Windows:

```js
spawn("npm.cmd", args, {
  stdio,
  cwd,
  env,
});
```

On Windows, spawning `.cmd` files with `shell: false` can cause `EINVAL`.
A possible fix would be to enable `shell: true` on Windows only, for example:

```js
const isWindows = process.platform === "win32";

spawn(command, args, {
  stdio,
  cwd,
  env,
  shell: isWindows,
});
```

This approach is commonly used by other cross-platform CLIs to ensure compatibility with Windows command wrappers.

## Comments

### @kuman62 (2026-02-03)

### Suggested fix (code example)

The issue seems to be caused by spawning `.cmd` executables on Windows without enabling `shell` mode.

**Current implementation (problematic on Windows):**

```js
const child = spawn(resolveCommand(argv[0]), argv.slice(1), {
  stdio,
  cwd,
  env: resolvedEnv,
  windowsVerbatimArguments,
});
```

On Windows, `resolveCommand(argv[0])` may resolve to `npm.cmd`.
Spawning `.cmd` files with `shell: false` can result in `spawn EINVAL`.

---

**Proposed change (Windows-compatible):**

```js
const isWindows = process.platform === "win32";

const child = spawn(resolveCommand(argv[0]), argv.slice(1), {
  stdio,
  cwd,
  env: resolvedEnv,
  shell: isWindows,
  windowsVerbatimArguments: isWindows ? false : windowsVerbatimArguments,
});
```

This ensures that on Windows, `.cmd` commands (such as `npm.cmd`, `pnpm.cmd`) are executed via the system shell, while keeping the existing behavior unchanged on macOS and Linux.

---

### Rationale

* Windows command-line tools like `npm`, `pnpm`, and `yarn` are implemented as `.cmd` wrappers.
* Node.js `child_process.spawn` requires `shell: true` to reliably execute `.cmd` files.
* This pattern is widely used by other cross-platform CLIs (e.g. execa, zx, cross-env).
* The change is minimal, Windows-only, and does not affect POSIX platforms.




## Links

- None detected yet
