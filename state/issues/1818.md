---
number: 1818
title: "[Bug]: Onboarding wizard does not install Systemd service on Ubuntu 22.04"
author: chepurko
created: 2026-01-25T13:59:10Z
updated: 2026-02-02T17:22:16Z
labels: ["bug"]
assignees: []
comments_count: 16
reactions_total: 15
url: https://github.com/openclaw/openclaw/issues/1818
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary
The onboarding wizard does not install a Systemd service in Ubuntu. During the Systemd step, it prints: Systemd user services are unavailable. Skipping lingering checks and service install.

This is because the **isSystemdUserServiceAvailable** function is throwing this error:

`Failed to connect to bus: $DBUS_SESSION_BUS_ADDRESS and $XDG_RUNTIME_DIR not defined (consider using --machine=<user>@.host --user to connect to bus of other user)`

## Steps to reproduce
Just run the onboarding wizard on Ubuntu 22.04.

## Expected behavior
Systemd is obviously installed on my OS.

## Actual behavior
`Gateway service check failed: Error: systemctl --user unavailable: Failed to connect to bus: $DBUS_SESSION_BUS_ADDRESS and $XDG_RUNTIME_DIR not defined (consider using --machine=<user>@.host --user to connect to bus of other user)`

## Environment
- Clawdbot version: 2026.1.23-1
- OS: Ubuntu 22.04
- Install method (pnpm/npx/docker/etc): npm

## Logs or screenshots
`Gateway service check failed: Error: systemctl --user unavailable: Failed to connect to bus: $DBUS_SESSION_BUS_ADDRESS and $XDG_RUNTIME_DIR not defined (consider using --machine=<user>@.host --user to connect to bus of other user)`

## Comments

### @davetroy (2026-01-25)

Experiencing the same issue on Ubuntu 24.04 and clawdbot 2026.1.24-3.

### @UVvirus (2026-01-26)

### âœ… Solution

This resolved the issue for me.

1. SSH into your **EC2 instance**
2. Start the Clawdbot gateway manually:
   ```bash
   clawdbot gateway run
3. (Optional) To keep the bot running after disconnecting, run it inside a screen session:
    ```bash
    screen -R clawdbot
    clawdbot gateway run


### @davetroy (2026-01-26)

Thanks, yes, that's a functional workaround, but it doesn't fix the underlying issue of not being manageable with `systemd`. Would like to see that resolved as well.

### @chepurko (2026-01-26)

I've also made a workaround by creating my own Systemd unit file:

```
[Unit]
Description=Clawdbot Gateway (name: chep, v1)
After=network-online.target
Wants=network-online.target

[Service]
User=user
WorkingDirectory=/home/userclawd
ExecStart=/home/usernpm-global/bin/clawdbot gateway --port 18789
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

So my gateway is running, but this doesn't fix the issue with the install script, and also the various `clawdbot gateway` commands don't work because they don't see any systemd service. (don't know how to make it see my systemd unit).

### @avatsaev (2026-01-26)

Experiencing the same issue on Ubuntu 24 server LXC container 

### @schniggie (2026-01-26)

Same issue on Debian 13

### @live9369 (2026-01-27)

I've also resolved this problem with installing user session support:
```bash
sudo apt install -y dbus-user-session
```
Enable lingering for the user:
```bash
sudo loginctl enable-linger ubuntu
```
Finally, verify that the user systemd instance is running:
```bash
systemctl --user status
```


### @growthringsadvisory (2026-01-28)

I've submitted a fix for this in PR #3527.

The issue is that the CLI only checks for systemd user services (`systemctl --user`), but on VPS/server installs, the gateway often runs as a system service (`/etc/systemd/system/`).

The fix adds detection and management for system services:
- Status commands now check both user and system service locations
- Service management (stop/restart) tries user first, falls back to system with sudo
- Should resolve the "systemd not installed" false negative

Would love feedback on the approach!

### @GabrielDrapor (2026-01-31)

For others who just want to restart the gateway, simply find the process and kill it. It will restart automatically.

### @ChuJiani (2026-01-31)

@chepurko You likely encountered this error because you switched user with `su - userclawd` or `sudo -iu userclawd`?

**Reason**

`su` and `sudo` do not create a full user session (they don't register with `systemd-logind`), so the environment variables required for `systemctl --user` are missing.

**Solution**

To fix this,  try using `machinectl` instead:

```bash
sudo machinectl shell userclawd@.host
# Now this should work:
systemctl --user status
```

If you can `ssh` into userclawd user, it works too:

```bash
ssh userclawd@localhost
systemctl --user status
```

**Notes**

Don't forget to enable lingering for the user if you want the user services to start with system, or you need the services to persist after logout, just as @live9369 shows:

```bash
sudo loginctl enable-linger userclawd
```

---

**Workaround (Manual)**

If you must use `su`, you can manually export the missing variable (assuming the socket exists via lingering):

```bash
sudo -iu userclawd
export XDG_RUNTIME_DIR="/run/user/$(id -u)"
systemctl --user status
```

### @prodevuk (2026-01-31)

I am still experiencing a similar issue.

### @jero-at-github (2026-01-31)

Still having the same issue using the `docker-setup.sh` script and Ubuntu 24.04 in VPS.
Latest openclaw repo version from just today.

### @github0null (2026-02-01)

Same problem,  my solution:

1. Run

```
sudo apt install -y dbus-user-session
sudo loginctl enable-linger <your user name>
mkdir -p ~/.config/systemd/user
```

2. Add this code in your `~/.profile`
  ```
if [ -z "$XDG_RUNTIME_DIR" ]; then
    export XDG_RUNTIME_DIR="/run/user/$(id -u)"
    if [ ! -d "$XDG_RUNTIME_DIR" ]; then
        mkdir -p "$XDG_RUNTIME_DIR"
        chmod 0700 "$XDG_RUNTIME_DIR"
    fi
fi

if [ -z "$DBUS_SESSION_BUS_ADDRESS" ]; then
    export DBUS_SESSION_BUS_ADDRESS="unix:path=${XDG_RUNTIME_DIR}/bus"
fi
  ```

3. Logout and then login (or run `source ~/.profile`)

4. Run `openclaw gateway install` and `systemctl --user start openclaw-gateway.service`

All Done.



### @jero-at-github (2026-02-01)

> Same problem, my solution:
> 
> 1. Run
> 
> ```
> sudo apt install -y dbus-user-session
> sudo loginctl enable-linger <your user name>
> mkdir -p ~/.config/systemd/user
> ```
> 
> 2. Add this code in your `~/.profile`
> 
> ```
> if [ -z "$XDG_RUNTIME_DIR" ]; then
>   export XDG_RUNTIME_DIR="/run/user/$(id -u)"
>   if [ ! -d "$XDG_RUNTIME_DIR" ]; then
>       mkdir -p "$XDG_RUNTIME_DIR"
>       chmod 0700 "$XDG_RUNTIME_DIR"
>   fi
> fi
> 
> if [ -z "$DBUS_SESSION_BUS_ADDRESS" ]; then
>   export DBUS_SESSION_BUS_ADDRESS="unix:path=${XDG_RUNTIME_DIR}/bus"
> fi
> ```
> 
> 3. Logout and then login (or run `source ~/.profile`)
> 4. Run `openclaw gateway install` and `systemctl --user start openclaw-gateway.service`
> 
> All Done.

In the host machine or in the Docker image? (I am using the docker-setup.sh script)

### @chepurko (2026-02-01)

> Same problem, my solution:
> 
>     1. Run
> 
> 
> ```
> sudo apt install -y dbus-user-session
> sudo loginctl enable-linger <your user name>
> mkdir -p ~/.config/systemd/user
> ```
> 
>     2. Add this code in your `~/.profile`
> 
> 
> ```
> if [ -z "$XDG_RUNTIME_DIR" ]; then
>   export XDG_RUNTIME_DIR="/run/user/$(id -u)"
>   if [ ! -d "$XDG_RUNTIME_DIR" ]; then
>       mkdir -p "$XDG_RUNTIME_DIR"
>       chmod 0700 "$XDG_RUNTIME_DIR"
>   fi
> fi
> 
> if [ -z "$DBUS_SESSION_BUS_ADDRESS" ]; then
>   export DBUS_SESSION_BUS_ADDRESS="unix:path=${XDG_RUNTIME_DIR}/bus"
> fi
> ```
> 
>     3. Logout and then login (or run `source ~/.profile`)
> 
>     4. Run `openclaw gateway install` and `systemctl --user start openclaw-gateway.service`
> 
> 
> All Done.

Sounds good. I'm just not sure why this can't just be a normal `system` service instead of a `user` service.

### @samholmes (2026-02-02)

```
Gateway service check failed: Error: systemctl --user unavailable: Failed to connect to bus: No medium found
```

This is what I see when I try to setup the gateway on Ubuntu 24:

```
$ cat /etc/os-release
PRETTY_NAME="Ubuntu 24.04.3 LTS"
NAME="Ubuntu"
VERSION_ID="24.04"
VERSION="24.04.3 LTS (Noble Numbat)"
VERSION_CODENAME=noble
ID=ubuntu
ID_LIKE=debian
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
UBUNTU_CODENAME=noble
LOGO=ubuntu-logo
```

The reason is likely because I've installed and ran `openclaw` using `bun` under a non-sudo user:

```
$ which openclaw
/home/<non-sudo-user>/.bun/bin/openclaw
```

The way I solved this is that I created a `openclaw.service` file in `/etc/systemd/system/`:

```
[Unit]
Description=OpenClaw daemon (runs as <non-sudo-user>)
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
User=<non-sudo-user>
Group=<non-sudo-user>
WorkingDirectory=/home/<non-sudo-user>

# Use absolute path so we don't depend on shell init files
ExecStart=/home/<non-sudo-user>/.bun/bin/openclaw gateway run

Restart=always
RestartSec=3

# Optional: match <non-sudo-user>'s PATH in case OpenClaw shells out to node/bun/npm, etc.
Environment=PATH=/home/<non-sudo-user>/.local/bin:/home/<non-sudo-user>/.npm-global/bin:/home/<non-sudo-user>/.bun/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

# Good hygiene (optional)
NoNewPrivileges=true
PrivateTmp=true

[Install]
WantedBy=multi-user.target
```

I can then do `sudo systemctl daemon-reload` and `sudo systemctl start openclaw`, etc.

My question to others is whether it's a good idea from a capability standpoint to run openclaw as a non-sudo user? It seems more secure this way, but will I cap my bot at the knees (arthropod knees) doing it this way?


## Links

- None detected yet
