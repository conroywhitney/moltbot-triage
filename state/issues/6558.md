---
number: 6558
title: "WhatsApp groupPolicy \"allowlist\" blocks all group messages unless groupAllowFrom is explicitly set"
author: giannisanni
created: 2026-02-01T19:58:08Z
updated: 2026-02-01T20:57:50Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6558
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug

When `channels.whatsapp.groupPolicy` is set to `"allowlist"` and specific groups are configured in `channels.whatsapp.groups`, **all group messages are still blocked** unless `groupAllowFrom` is also explicitly populated.

## Root Cause

Two independent group filtering layers exist but do not compose correctly:

### Layer 1: Sender allowlist (`web/inbound/access-control.js`)
When `groupPolicy: "allowlist"`:
```js
if (!groupAllowFrom || groupAllowFrom.length === 0) {
    logVerbose("Blocked group message (groupPolicy: allowlist, no groupAllowFrom)");
    return { allowed: false, ... };
}
```
This blocks **all** group messages if `groupAllowFrom` is empty, regardless of whether the group is in the configured `groups` list.

`groupAllowFrom` falls back to `configuredAllowFrom`:
```js
const groupAllowFrom = account.groupAllowFrom ??
    (configuredAllowFrom && configuredAllowFrom.length > 0 ? configuredAllowFrom : undefined);
```
But `configuredAllowFrom` does NOT include pairing store entries (`storeAllowFrom`). So users paired via `dmPolicy: "pairing"` (the default) cannot trigger the bot in groups under allowlist mode.

### Layer 2: Group JID filter (`web/auto-reply/monitor/group-gating.js`)
Uses `channels.whatsapp.groups` config to restrict which group JIDs are allowed. This is never reached when layer 1 blocks the message.

## Expected Behavior

One of the following:
1. `groupPolicy: "allowlist"` + configured `groups` should be sufficient â€” if the group JID is in the allowlist, the sender check should pass (or be skipped), since the group itself is authorized.
2. At minimum, `groupAllowFrom` should fall back to the combined allowFrom (including pairing store) so paired users can interact in groups.

## Current Workaround

Set `groupPolicy: "open"` and rely on the `groups` config to restrict which groups the bot responds in. This works because layer 2 (group-gating) handles group filtering independently.

## Config Example

```json
{
  "channels": {
    "whatsapp": {
      "groupPolicy": "allowlist",
      "groups": {
        "31640053449-1633552575@g.us": { "requireMention": false }
      }
    }
  }
}
```

With this config, all group messages are blocked because `groupAllowFrom` is empty. The user has to either:
- Set `groupPolicy: "open"` (loses sender restriction)
- Manually add every allowed phone number to `groupAllowFrom` (defeats the purpose of pairing)

## Semantic Confusion

`groupPolicy: "allowlist"` sounds like it controls *which groups* are allowed, but it actually controls *which senders* are allowed in groups. The *which groups* filtering is handled separately by the `groups` config. This naming is confusing.

## Comments


## Links

- None detected yet
