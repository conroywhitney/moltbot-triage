---
number: 6190
title: "[Bug]: Session Log growing and bot hanging up"
author: cloudsolutiongmbh
created: 2026-02-01T11:21:34Z
updated: 2026-02-01T11:41:49Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 1
url: https://github.com/openclaw/openclaw/issues/6190
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

Telegram bot sessions grow to 2-3MB within hours of usage (from 35 user messages), causing repeated context overflow errors and making the bot
unresponsive. Sessions hit 208,467 tokens (exceeding the 200k model limit), auto-compaction fails, and every subsequent message fails silently.

Root Cause

The gateway tool returns massive JSON responses (396KB+ per call) containing the entire clawdbot configuration schema. These get stored in the
session .jsonl files and are never pruned, causing exponential growth.

Evidence from session analysis:

Session with only 35 Telegram messages from user:
-rw-r--r-- 1 root root 2.9M Jan 21 16:04 2ec866df-d056-43d8-89e8-c4b54091fd43.jsonl

1,175 lines total, with a single line being 396KB:
$ awk 'length > 100000' session.jsonl
Line 10: 396,263 characters (gateway tool result with full config schema)

Error in logs:
Auto-compaction failed: Context overflow: Summarization failed: 400
{"message":"prompt is too long: 208467 tokens > 200000 maximum"}

Steps to Reproduce

Configure clawdbot with Telegram bot
Send ~35 messages to the bot over a few hours
Bot accesses configuration via gateway tool (happens automatically)
Session file grows to 2-3MB
Bot stops responding with context overflow errors
Expected Behavior

Session files should remain manageable (< 100KB for typical usage)
Large tool results should be automatically pruned
Auto-compaction should prevent context overflow
Bot should remain responsive indefinitely
Actual Behavior

Session files grow to 2-3MB rapidly
Single gateway tool results contain 396KB of schema data
Auto-compaction fails: "prompt is too long: 208467 tokens > 200000 maximum"
Bot becomes unresponsive
No error message shown to user (fails silently on Telegram)
Impact

Critical: Bot becomes completely unresponsive within hours
Users see no error messages (messages just don't get responses)
Only fix is manual session file deletion
Memory system preserved, but conversation context lost
Analysis

Multiple bloated sessions found:
2ec866df-d056-43d8-89e8-c4b54091fd43.jsonl - 2.9M (current, 35 messages)
9c4c69f8-3ef5-4fe6-a3b1-38f216f0f1f8.jsonl - 1.8M
ec00829b-ae59-4ff4-afb1-2f221e8d145d.jsonl - 1.1M
98bf3166-580a-4997-8357-943a508c8df8.jsonl - 980K
e9d6169b-b937-46d9-bd40-5ec02c8d98a4.jsonl - 808K

Gateway tool result sample (line 10, 396KB):
{
"type": "message",
"message": {
"role": "toolResult",
"toolName": "gateway",
"content": [{
"text": "{\n "ok": true,\n "result": {\n "schema": { /* 396KB of full clawdbot config JSON schema */ }\n }\n}"
}]
}
}

Workaround

Manual intervention required:

Move corrupted session to backup
mv /root/.clawdbot/agents/main/sessions/SESSION_ID.jsonl SESSION_ID.jsonl.overflow-backup

Bot creates fresh session on next message
Configuration Attempted

Attempted to enable contextPruning per documentation, but configuration keys not recognized in 2026.1.14-1:

{
"agents": {
"defaults": {
"contextPruning": {
"mode": "adaptive",
"softTrimRatio": 0.3,
"hardClearRatio": 0.5,
"minPrunableToolChars": 50000
}
}
}
}

Error: agents.defaults.contextPruning.mode: Invalid input

Documentation states adaptive pruning was made default in 2026.1.9, but appears non-functional in 2026.1.14-1.

Suggested Fixes

Immediate: Limit gateway tool result sizes in session storage (truncate schema responses)
Short-term: Ensure contextPruning defaults are actually enabled and working
Long-term: Don't store massive schemas in session context (reference instead)
UX: Show error message to user when context overflow occurs (don't fail silently)
Logs

2026-01-21T15:40:22.997Z error agent/embedded Auto-compaction failed (unhandled):
Context overflow: Summarization failed: 400
{"type":"error","error":{"type":"invalid_request_error",
"message":"prompt is too long: 208467 tokens > 200000 maximum"},
"request_id":"req_011CXLmwexL6AtQNFHFWmnp6"}

Additional Context

Long-term memory system (separate SQLite) unaffected and working correctly
Issue affects all sessions eventually with moderate usage
Multiple large sessions across different time periods (spanning 9+ days)
Heartbeat messages also contribute to growth but are not primary cause
Sources:

https://docs.clawd.bot/gateway/configuration
https://github.com/clawdbot/clawdbot/releases

## Comments

### @abmccull (2026-02-01)

## Technical Analysis from FORGE Agent

### Root Cause Confirmed
The `config.schema` action in `gateway-tool.js` (line ~95) returns the **entire 396KB JSON schema** without any truncation:

```javascript
if (action === "config.schema") {
    const result = await callGatewayTool("config.schema", gatewayOpts, {});
    return jsonResult({ ok: true, result });  // â† Full schema returned
}
```

### Recommended Fix (gateway-tool.js)

Replace the config.schema handler:

```javascript
if (action === "config.schema") {
    const result = await callGatewayTool("config.schema", gatewayOpts, {});
    const schemaStr = JSON.stringify(result);
    // Return metadata only - full schema is too large for session storage
    return jsonResult({ 
        ok: true, 
        message: "Schema available but not returned (400KB would bloat session). Use config.get for actual config values.",
        schemaSize: schemaStr.length,
        topLevelKeys: result?.properties ? Object.keys(result.properties).slice(0, 20) : []
    });
}
```

### Additional Safeguards Needed

1. **Global tool response limit** in session serialization:
```javascript
const MAX_TOOL_RESULT_SIZE = 50_000;
if (toolResultStr.length > MAX_TOOL_RESULT_SIZE) {
    toolResult = { truncated: true, originalSize: toolResultStr.length };
}
```

2. **Session pruning** for messages > 100KB when compaction runs

### Priority
This is affecting production users RIGHT NOW. The fix is straightforward - just don't return the full schema.


## Links

- None detected yet
