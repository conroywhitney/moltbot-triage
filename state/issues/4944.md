---
number: 4944
title: "fix(discord): execApprovals handler missing gateway token"
author: webmastertorch
created: 2026-01-30T21:41:00Z
updated: 2026-01-31T02:26:46Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4944
duplicate_of: null
related_issues: [1621]
blocks: []
blocked_by: []
---

## Description

## Bug Description

The `DiscordExecApprovalHandler` in `src/discord/monitor/exec-approvals.ts` creates a `GatewayClient` without passing the `token` parameter, causing authentication failures when connecting to the gateway.

## Error Message

```
discord exec approvals: connect error: unauthorized: gateway token missing (provide gateway auth token)
gateway connect failed: Error: unauthorized: gateway token missing (provide gateway auth token)
```

## Root Cause

In the original implementation (commit 483fba41b, PR #1621), the `GatewayClient` was created without the `token` parameter:

```typescript
this.gatewayClient = new GatewayClient({
  url: this.opts.gatewayUrl ?? "ws://127.0.0.1:18789",
  // missing: token
  clientName: GATEWAY_CLIENT_NAMES.GATEWAY_CLIENT,
  clientDisplayName: "Discord Exec Approvals",
  mode: GATEWAY_CLIENT_MODES.BACKEND,
  scopes: ["operator.approvals"],
  ...
});
```

## Proposed Fix

1. Add `gatewayToken?: string` to `DiscordExecApprovalHandlerOpts`
2. Pass `token: this.opts.gatewayToken` when creating `GatewayClient`
3. In `provider.ts`, resolve gateway token from config (supporting both local and remote modes) and pass it to the handler

Happy to submit a PR if needed.

## Comments


## Links

- None detected yet
