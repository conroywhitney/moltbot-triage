---
number: 3660
title: "[Bug]: iMessage group messages reply to sender DM instead of group chat"
author: willowyoo
created: 2026-01-29T00:54:22Z
updated: 2026-01-29T00:54:22Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/3660
duplicate_of: null
related_issues: [2529]
blocks: []
blocked_by: []
---

## Description

## Description

When a message is received in an iMessage group chat, the bot processes and responds correctly, but the reply is sent to the sender's private DM instead of the group chat.

## Environment

- **Clawdbot version**: 2026.1.24-3
- **OS**: macOS (Darwin 25.2.0)
- **imsg version**: 0.4.0

## Configuration

```json
{
  "channels": {
    "imessage": {
      "enabled": true,
      "dmPolicy": "allowlist",
      "allowFrom": ["..."],
      "groupPolicy": "allowlist",
      "groupAllowFrom": ["..."],
      "groups": {
        "chat8531511243112567": {
          "requireMention": false
        }
      }
    }
  }
}
```

## Steps to Reproduce

1. Configure iMessage channel with `groupPolicy: "allowlist"`
2. Add a group chat to `groups` configuration
3. Send a message in the group chat from an allowed sender
4. Bot processes the message and generates a response
5. **Expected**: Reply is sent to the group chat
6. **Actual**: Reply is sent to the sender's private DM

## Logs

```
[agent/embedded] embedded run start: runId=... sessionId=... messageChannel=imessage
[gateway/channels/imessage] imessage: delivered reply to imessage:+8615340845990
```

The log shows the reply is delivered to `imessage:+8615340845990` (the sender's phone number) instead of the group chat identifier `chat8531511243112567`.

## Workaround Tested

Manually sending to the group via `imsg` CLI works correctly:

```bash
/opt/homebrew/bin/imsg send --chat-id 3211 --text "test" 
# Result: sent (message appears in group)
```

This confirms the issue is in clawdbot's reply routing logic, not in the imsg CLI.

## Related Issues

This appears related to #2529 (WhatsApp DM vs group routing), where the agent lacks explicit `reply_to` metadata to determine the correct reply destination.

## Suggested Fix

When processing an incoming message from a group chat, preserve the `chat_id` or `chat_identifier` and use it as the reply target instead of the sender's phone number.

---

ðŸ¦ž Filed via Claude Code

## Comments


## Links

- None detected yet
