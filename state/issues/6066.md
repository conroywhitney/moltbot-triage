---
number: 6066
title: "One-shot 'at' cron jobs with wakeMode=now loop infinitely when heartbeat is skipped"
author: chrisaldworth
created: 2026-02-01T07:28:06Z
updated: 2026-02-01T20:59:21Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6066
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug

One-shot `at` schedule cron jobs with `wakeMode: "now"` and `deleteAfterRun: true` enter an infinite retry loop when `runHeartbeatOnce()` returns `{status: "skipped"}` (e.g. because HEARTBEAT.md is empty).

## Steps to reproduce

1. Create a one-shot cron job:
   - `schedule.kind: "at"` (time in the near future)
   - `sessionTarget: "main"`
   - `payload.kind: "systemEvent"`
   - `wakeMode: "now"`
   - `deleteAfterRun: true`
2. Have an empty (or comments-only) HEARTBEAT.md
3. Wait for the job to fire

## What happens

1. Job fires → `enqueueSystemEvent(text)` pushes reminder into session queue
2. `runHeartbeatOnce()` returns `{status: "skipped", reason: "empty-heartbeat-file"}`
3. `finish("skipped", ...)` is called
4. `shouldDelete` is `false` because status is not `"ok"` (`timer.js` line 69)
5. `computeJobNextRunAtMs()` returns the original past `atMs` (only clears on `lastStatus === "ok"`)
6. Job is immediately due again → goto step 1

Each iteration enqueues another copy of the systemEvent text, flooding the session with duplicates.

## Expected behaviour

The systemEvent is already enqueued before the heartbeat runs. A skipped heartbeat should not prevent the job from completing — `finish("ok")` should be called (or at minimum the job should be disabled/deleted to prevent infinite retry).

## Workaround

Use `wakeMode: "next-heartbeat"` instead of `"now"` for one-shot systemEvent reminders. That path calls `finish("ok")` immediately without attempting a heartbeat.

## Relevant code

- `dist/cron/service/timer.js` — `executeJob()` lines ~120-160 (main + wakeMode=now path)
- `dist/cron/service/jobs.js` — `computeJobNextRunAtMs()` (returns past `atMs` when status ≠ ok)

## Comments


## Links

- None detected yet
