---
number: 5295
title: "[Bug]:  Clawdbot Discord integration fails intermittently with authentication cooldown errors, even with valid credentials."
author: Jalane520520520
created: 2026-01-31T09:00:38Z
updated: 2026-01-31T09:00:38Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 1
url: https://github.com/openclaw/openclaw/issues/5295
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

  Summary                                                                    
                                                                             
  Clawdbot Discord bot gets stuck in persistent authentication cooldowns even
   with valid Claude OAuth credentials. The bot fails with "No available auth
   profile for anthropic (all in cooldown or unavailable)" errors and won't  
  respond to Discord messages.                                               
                                                                             
  Root causes identified:                                                    
  1. OAuth token from claude setup-token spans two lines, but only first line
   gets pasted during setup                                                  
  2. Corrupted Discord session state triggers format errors that count toward
   cooldown                                                                  
  3. Context overflow from long conversations (compaction mode "safeguard" is
   too conservative)                                                         
  4. Auto-syncing of unwanted credentials from ~/.codex/auth.json            
                                                                             
  Steps to reproduce                                                         
                                                                             
  1. Run clawdbot configure and select "Anthropic token (paste setup-token)" 
  2. Run claude setup-token and copy the OAuth token (token displays as two  
  lines)                                                                     
  3. Paste the token into clawdbot prompt - only first line gets captured due
   to terminal behavior                                                      
  4. Complete setup and start gateway with clawdbot gateway                  
  5. Send message in Discord channel                                         
  6. Bot responds with: ⚠️ Agent failed before reply: All models failed (3): 
  anthropic/claude-sonnet-4-5: No available auth profile for anthropic (all  
  in cooldown or unavailable). (rate_limit)                                  
  7. Run clawdbot doctor - shows "anthropic:omni: cooldown (24m)"            
  8. Even after cooldown expires, error repeats due to corrupted session     
  state                                                                      
                                                                             
  Additional trigger: Long Discord conversations or pasting error messages   
  causes context overflow, incrementing error count and retriggering         
  cooldown.                                                                  
                                                                             
  Expected behavior                                                          
                                                                             
  1. The clawdbot configure wizard should detect multi-line tokens and prompt
   user to paste both lines, or auto-combine them                            
  2. OAuth token validation should happen immediately with clear error:      
  "Token incomplete - expected ~140 characters, got 80"                      
  3. Session corruption should trigger automatic session reset, not cooldown 
  4. Context overflow should trigger automatic compaction, not count as      
  authentication failure                                                     
  5. Bot should respond consistently in Discord without authentication       
  cooldown errors                                                            
                                                                             
  Workaround that fixes the issue:                                           
  1. Stop gateway                                                          
  clawdbot gateway stop                                                      
                                                                             
  2. Edit ~/.clawdbot/agents/main/agent/auth-profiles.json                 
   Ensure token has BOTH lines combined (no line break)                     
                                                                             
  3. Clear sessions and cooldowns                                          
  echo '{}' > ~/.clawdbot/agents/main/sessions/sessions.json                 
  In auth-profiles.json, set: "usageStats": {}                             
                                                                             
  4. Change compaction mode in ~/.clawdbot/clawdbot.json                   
  "compaction": { "mode": "auto" }                                         
                                                                             
  5. Restart                                                               
  clawdbot gateway                                                           
                                                                             
  Environment:                                                               
  - OS: macOS 14.6.0                                                         
  - Clawdbot: 2026.1.24-0                                                    
  - Auth method: Claude Code CLI OAuth token                                 
                                                                             
  ---  

## Comments


## Links

- None detected yet
