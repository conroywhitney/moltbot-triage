---
number: 2878
title: "[Bug] normalizeMediaSource() fails on Windows: file:// replace produces invalid path"
author: henrybottter
created: 2026-01-27T17:07:45Z
updated: 2026-01-28T05:58:07Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/2878
duplicate_of: null
related_issues: [2829]
blocks: []
blocked_by: []
---

## Description

## Description

`normalizeMediaSource()` in `dist/media/parse.js:7` uses a naive `file://` string replace:

```js
export function normalizeMediaSource(src) {
    return src.startsWith("file://") ? src.replace("file://", "") : src;
}
```

On Windows, this produces `/C:/Users/...` (with leading slash) instead of `C:/Users/...`, causing file-not-found errors.

## Same pattern as #2829

This is the exact same bug pattern as the session-memory hook (#2829), where `import.meta.url.replace("file://", "")` was used instead of `new URL(...).pathname` with drive-letter normalization.

## Expected fix

```js
export function normalizeMediaSource(src) {
    if (!src.startsWith("file://")) return src;
    const parsed = new URL(src);
    return parsed.pathname.replace(/^\/([A-Z]:)/i, '$1');
}
```

## Environment
- Windows 10 (10.0.19045)
- Clawdbot 2026.1.24-3
- Node v24.13.0

## Comments


## Links

- None detected yet
