---
number: 5758
title: "WhatsApp outbound replies lost when gateway restarts during in-flight agent run"
author: J00MZ
created: 2026-01-31T23:08:07Z
updated: 2026-02-02T00:17:52Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5758
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

Pending WhatsApp outbound replies are dropped when a gateway restart (SIGUSR1 via `config.patch` / `config.apply`) occurs while an agent run is still in progress. The reply is generated and visible in webchat/dashboard but never delivered to WhatsApp because the WA connection is torn down before the outbound message is sent.

## Steps to Reproduce

1. Send a message to the agent via WhatsApp
2. While the agent is processing (e.g., making tool calls), trigger a `config.patch` that causes a gateway restart
3. The agent finishes generating its reply after the restart begins
4. The reply appears in the webchat dashboard but is never delivered to WhatsApp

## Expected Behavior

Either:
- The gateway should **drain in-flight agent runs** before restarting (graceful shutdown), OR
- Pending outbound messages should be **queued/persisted** and retried after the WhatsApp connection is re-established post-restart

## Actual Behavior

The WhatsApp connection is closed during restart, and the outbound reply fails with `Connection Closed`. Three retry attempts all fail, and the message is permanently lost on the WhatsApp surface.

## Log Evidence

```
22:57:04 - Inbound WhatsApp message received (<ID>)
22:57:04 - Ack reaction ðŸ«¡ sent successfully
22:57:04 - Agent run starts (runId 59a56e11...)
22:57:11 - config.patch tool call triggers SIGUSR1 restart (2s delay)
22:57:13 - Gateway restart begins, WA connection starts closing
22:58:38 - AbortError: This operation was aborted
22:59:04 - "Failed sending web auto-reply to +<NUMBER>: Connection Closed"
22:59:06 - Same failure (retry 2)
22:59:07 - Same failure (retry 3)
```

The reply text was successfully generated and delivered to the webchat surface, but the WhatsApp outbound permanently failed.

## Environment

- OpenClaw v2026.1.30 (beta)
- WhatsApp channel (personal, Baileys)
- macOS (arm64)
- Node v25.5.0

## Notes

This is particularly problematic because agents themselves can trigger `config.patch` via tool calls (e.g., adjusting model fallback chains), creating a self-inflicted message loss scenario. The agent has no way to know the restart will kill its own reply delivery.

## Comments


## Links

- None detected yet
