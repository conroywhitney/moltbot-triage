---
number: 6855
title: "[Bug]: Gateway crashes on undici TLS setSession null reference during web_fetch"
author: DeveshParagiri
created: 2026-02-02T03:54:24Z
updated: 2026-02-02T03:54:24Z
labels: []
assignees: []
comments_count: 0
reactions_total: 1
url: https://github.com/openclaw/openclaw/issues/6855
duplicate_of: null
related_issues: [3815,4425]
blocks: []
blocked_by: []
---

## Description

## Environment
- OpenClaw version: 2026.1.29 (a5b4d22)
- OS: Amazon Linux 2023 (x86_64)
- Node: v22.22.0
- Install method: npm global

## Description

The gateway process crashes with an uncaught `TypeError` when `web_fetch` encounters a TLS connection issue. The error originates from undici's TLS session handling where `setSession` is called on a null reference.

This is similar to #4425 and #3815 but a different undici code path (TLS session reuse, not a generic fetch failure).

## Steps to Reproduce

1. Agent calls `web_fetch` on `https://ai.google.dev/gemini-api/docs/image-generation`
2. TLS handshake triggers the null reference in undici's client connection handler
3. Gateway crashes entirely

## Error Log

```
03:42:52 [agent/embedded] embedded run tool start: runId=f7891e7c tool=web_fetch toolCallId=toolu_01VJuq7DXxMDv5f8Qv7LTLSo
03:42:53 [openclaw] Uncaught exception: TypeError: Cannot read properties of null (reading 'setSession')
    at TLSSocket.setSession (node:_tls_wrap:1132:16)
    at Object.connect (node:_tls_wrap:1826:13)
    at Client.connect (/usr/lib/node_modules/openclaw/node_modules/undici/lib/core/connect.js:70:20)
    at connect (/usr/lib/node_modules/openclaw/node_modules/undici/lib/dispatcher/client.js:444:21)
    at _resume (/usr/lib/node_modules/openclaw/node_modules/undici/lib/dispatcher/client.js:619:7)
    at resume (/usr/lib/node_modules/openclaw/node_modules/undici/lib/dispatcher/client.js:553:3)
    at Client.<computed> (/usr/lib/node_modules/openclaw/node_modules/undici/lib/dispatcher/client.js:277:31)
    at TLSSocket.onHttpSocketClose (/usr/lib/node_modules/openclaw/node_modules/undici/lib/dispatcher/client-h1.js:937:18)
    at TLSSocket.emit (node:events:531:35)
    at node:net:346:12
```

## Expected Behavior

`web_fetch` should catch all undici/TLS errors and return a graceful error result to the agent, not crash the gateway process. A single failed HTTP request should never take down the entire gateway.

## Suggested Fix

Wrap the undici fetch call in web_fetch with a try/catch that handles TLS-level errors, or add a global `uncaughtException` handler that gracefully recovers from transient network errors instead of exiting.

## Comments


## Links

- None detected yet
