---
number: 3898
title: "web_search fails with 'fetch failed' despite correct proxy configuration"
author: cbxhpy
created: 2026-01-29T09:46:54Z
updated: 2026-01-29T10:21:04Z
labels: []
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/3898
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

# web_search tool fails with "fetch failed" despite correct proxy configuration

## Environment

- **OS**: macOS (Darwin 25.0.0, arm64)
- **Clawdbot Version**: 2026.1.24-3
- **Node Version**: v22.22.0
- **Gateway Mode**: local (bind: loopback, port: 18789)

## Problem Description

The `web_search` tool consistently fails with error "fetch failed" even though:
1. The Brave Search API key is correctly configured
2. The proxy server at `http://127.0.0.1:7890` is running and working
3. Direct curl requests through the proxy succeed

## Current Configuration

```json
{
  "tools": {
    "web": {
      "search": {
        "apiKey": "BSAeNXOlZZi1_EpnYQojxX9xCnermto"
      }
    }
  },
  "channels": {
    "telegram": {
      "proxy": "http://127.0.0.1:7890"
    }
  },
  "env": {
    "HTTP_PROXY": "http://127.0.0.1:7890",
    "HTTPS_PROXY": "http://127.0.0.1:7890"
  }
}
```

## Troubleshooting Attempts

| Method | Status |
|--------|--------|
| API Key configured | ✅ Correct |
| Telegram proxy configured | ✅ Correct |
| Gateway env variables (HTTP_PROXY/HTTPS_PROXY) | ✅ Configured |
| Gateway restarted | ✅ Multiple times |
| npm package update | ✅ Latest version (2026.1.24-3) |
| curl through proxy to Brave API | ✅ Succeeds |

## Successful Test with curl

```bash
curl -s "https://api.search.brave.com/res/v1/web/search?q=test" \
  -H "X-Subscription-Token: BSAeNXOlZZi1_EpnYQojxX9xCnermto" \
  -H "Accept: application/json" \
  --proxy http://127.0.0.1:7890
```

This command successfully returns search results from Brave API.

## Expected Behavior

The `web_search` tool should successfully execute search queries using the Brave Search API through the configured proxy.

## Actual Behavior

```
web_search({"count": 2, "query": "人工智能"})
```

Returns:
```json
{
  "status": "error",
  "error": "fetch failed"
}
```

## Steps to Reproduce

1. Configure Clawdbot with Brave Search API key
2. Configure proxy in `channels.telegram.proxy` and `env` variables
3. Call `web_search` tool with any query
4. Observe "fetch failed" error

## Additional Context

- The proxy server at `http://127.0.0.1:7890` is working correctly
- Telegram channel uses the same proxy and functions normally
- Direct API calls via curl succeed
- The issue persists across multiple Gateway restarts
- No detailed error messages provided by the tool (generic "fetch failed")

## Possible Root Causes

1. web_search tool implementation not respecting Gateway env variables
2. Tool requires different proxy configuration format (e.g., socks5 instead of http)
3. Bug in web_search tool's network request handling

## Workarounds

Currently using alternative methods:
- `web_fetch` - requires explicit URL
- `browser` tool - requires Chrome extension setup
- `browser-cdp` CLI tool - works but is external to Clawdbot

## Request

Either:
1. Fix the web_search tool to respect proxy configuration
2. Provide clear documentation on how to configure proxy for web_search
3. Improve error messages to include actual error details (connection timeout, DNS error, etc.)

## Comments

### @openmind-why (2026-01-29)

Me too.You need proxy 


## Links

- None detected yet
