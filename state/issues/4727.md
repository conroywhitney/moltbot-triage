---
number: 4727
title: "[Feature]: HashiCorp Vault Integration for Secret Management"
author: arbgjr
created: 2026-01-30T15:32:08Z
updated: 2026-01-30T16:11:27Z
labels: []
assignees: []
comments_count: 2
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4727
duplicate_of: null
related_issues: [899,2320,2341,2447,3002]
blocks: []
blocked_by: []
---

## Description

## Summary

Add support for storing and retrieving secrets from HashiCorp Vault instead of local files (`~/.claude/.credentials.json`, keychain, etc.).

## Motivation

### Current State
OpenClaw currently stores credentials in:
- Local JSON files (`~/.claude/.credentials.json`, `~/.qwen/oauth_creds.json`)
- System keychain (macOS/Linux)
- Environment variables

### Problems with Current Approach
- âŒ Secrets scattered across multiple locations
- âŒ No centralized secret rotation
- âŒ Limited audit logging
- âŒ Difficult to manage in multi-user/team environments
- âŒ No encryption at rest (files are just JSON)

### Benefits of Vault Integration
- âœ… **Centralized secret management** - Single source of truth
- âœ… **Better security** - Vault's encryption and access policies
- âœ… **Secret rotation** - Automated credential rotation
- âœ… **Audit logging** - Track who accessed which secrets
- âœ… **Team support** - Multiple users can share secrets safely
- âœ… **Already available** - Many users already run Vault in their infrastructure

## Proposed Implementation

### Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OpenClaw   â”‚
â”‚  Gateway    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Request credentials
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Credential Provider    â”‚
â”‚  (with Vault support)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚         â”‚
       â”‚         â””â”€â†’ Fallback to local files
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HashiCorp   â”‚
â”‚  Vault       â”‚
â”‚  (HTTP API)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Technical Details

1. **New Module**: `src/infra/vault-client.ts`
   - VaultClient class for HTTP API communication
   - Support for KV v2 secrets engine
   - Read/write/list/delete operations

2. **Configuration** (via env vars or `moltbot.json`):
   ```json
   {
     "credentials": {
       "provider": "vault",  // or "local" (default)
       "vault": {
         "addr": "http://localhost:8200",
         "token": "<vault-token>",
         "namespace": "openclaw"
       }
     }
   }
   ```

3. **Environment Variables**:
   - `VAULT_ADDR` - Vault server address
   - `VAULT_TOKEN` - Authentication token
   - `VAULT_NAMESPACE` - Optional namespace

4. **Secret Structure in Vault**:
   ```
   openclaw/credentials/anthropic    â†’ OAuth tokens
   openclaw/credentials/telegram     â†’ Bot token
   openclaw/credentials/discord      â†’ Bot token
   openclaw/config/encryption        â†’ Master keys
   ```

5. **Backward Compatibility**:
   - Default to local file storage if Vault not configured
   - Migration tool: `openclaw vault migrate` to move secrets to Vault
   - Support both providers simultaneously (Vault â†’ fallback to local)

## Related Issues

- #899 (secret scanning/redaction - complements this)
- #2320 (extract hardcoded secrets to .env)
- #2447 (credential sync configuration)
- #3002 (file permissions for sensitive files)
- #2341 (running gateway as isolated user)

## Current Status

**We will implement this as an extension first** (`extensions/vault-integration`) to:
- Validate the approach
- Get community feedback
- Avoid blocking on core approval
- Allow faster iteration

Once proven stable, we can discuss merging into core or keeping as an optional extension.

## Implementation Checklist

- [ ] Create `extensions/vault-integration` package
- [ ] Implement VaultClient with KV v2 support
- [ ] Add credential provider interface
- [ ] Wire up to existing credential loading logic
- [ ] Add configuration schema
- [ ] Write tests (unit + integration)
- [ ] Add documentation
- [ ] Create migration guide
- [ ] Test with real Vault instance

## Questions for Maintainers

1. **Architecture**: Do you prefer this as a core feature or extension?
2. **Scope**: Should we also support other secret managers (AWS Secrets Manager, Azure Key Vault)?
3. **Dependencies**: OK to add `node-fetch` or use built-in `fetch`?
4. **Breaking changes**: Any concerns with the proposed credential provider interface?

---

Looking forward to your feedback! ğŸ”

---

**Note**: This will be implemented initially as an extension in `extensions/vault-integration` for faster iteration and validation. We can discuss core integration after proving the concept.

## Comments

### @thewilloftheshadow (2026-01-30)

Don't ping the maintainers for review, it just makes you look needy and obnoxious. 

### @arbgjr (2026-01-30)

Dude, my wife always says the same thing, and my mom used to say it too... I'm starting to think it's true! But I'm just an anxious guy... sorry... ;)


## Links

- None detected yet
