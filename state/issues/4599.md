---
number: 4599
title: "Sub-agent runs silently die on TypeError: fetch failed — no retry, no cleanup"
author: MottaSec
created: 2026-01-30T11:05:08Z
updated: 2026-01-31T02:29:41Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4599
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

Sub-agent (embedded) runs silently fail when the Anthropic API connection drops with `TypeError: fetch failed`. The run hangs forever — no retry, no error callback to the parent session, no cleanup. The parent session has no way to know the sub-agent died.

## Steps to Reproduce

1. Spawn a sub-agent via `sessions_spawn`
2. Wait for an intermittent API connection drop (`TypeError: fetch failed`)
3. Observe that the sub-agent run never completes

## Observed Behavior

Gateway logs show:
`
10:05:11 embedded run start: runId=f57f7f52 model=claude-sonnet-4-20250514
10:05:11 embedded run prompt start: runId=f57f7f52
10:05:11 embedded run agent start: runId=f57f7f52
10:07:11 Unhandled promise rejection: TypeError: fetch failed
`

**No `embedded run agent end` or `embedded run done` log entry ever appears.** The sub-agent session shows 0 tokens and no messages. The parent session receives no notification of failure.

The `TypeError: fetch failed` pattern repeats every ~10 minutes throughout multi-hour sessions, suggesting intermittent network/API instability:
`
09:07, 09:14, 09:30, 09:40, 09:51, 10:02, 10:07, 10:08, 10:13, 10:24, 10:34
`

## Expected Behavior

1. **Retry** — On transient fetch failures, the embedded runner should retry the API call (with exponential backoff, e.g., 3 attempts)
2. **Timeout** — If retries are exhausted, the run should be marked as failed with an error state
3. **Notification** — The parent session should be notified that the sub-agent run failed, so it can take corrective action (retry, reassign, alert the user)
4. **Cleanup** — The sub-agent session should be marked as failed/completed rather than hanging indefinitely with 0 tokens

## Impact

This makes autonomous multi-task workflows unreliable. When a user assigns multiple tasks to be worked sequentially via sub-agents, a single fetch failure silently kills the entire pipeline. The main session (if it survives context compaction) has no way to detect or recover from the failure.

## Environment

- Clawdbot version: `2026.1.24-3`
- Provider: Anthropic (claude-sonnet-4-20250514 for sub-agent, claude-opus-4-5 for main)
- OS: Windows 10 (x64)
- Node: v24.13.0

## Comments


## Links

- None detected yet
