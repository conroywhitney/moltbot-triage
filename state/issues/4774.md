---
number: 4774
title: "[macOS] Bonjour/mDNS announcement fails with EAFNOSUPPORT on loopback and en0 interfaces"
author: KayIter
created: 2026-01-30T17:07:51Z
updated: 2026-01-30T17:22:16Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4774
duplicate_of: null
related_issues: [4279,4632]
blocks: []
blocked_by: []
---

## Description

# [macOS] Bonjour/mDNS announcement fails with EAFNOSUPPORT on loopback and en0 interfaces

## Bug Report

### Environment
- **OpenClaw Version**: 2026.1.29
- **OS**: macOS 15.x (arm64)
- **Node.js**: v24.13.0
- **Install Method**: npm/installer

### Bug Description

OpenClaw gateway continuously fails to broadcast Bonjour/mDNS announcements, producing `EAFNOSUPPORT` errors every 1-2 minutes. The error occurs on both `lo0` (loopback) and `en0` (wired/wireless) interfaces.

### Error Logs

```
[Mac mini (OpenClaw)._openclaw-gw._tcp.local.] Failed to send announcement requests:
- Failed to send packet on interface lo0: send EAFNOSUPPORT 224.0.0.251:5353
- Failed to send packet on interface en0: send EAFNOSUPPORT 224.0.0.251:5353 true
```

```
2026-01-30T15:07:34.635Z [clawdbot] Unhandled promise rejection: Error: Announcement failed as of socket errors!
    at /usr/local/lib/node_modules/openclaw/node_modules/@homebridge/ciao/src/responder/Announcer.ts:158:29
```

### Steps to Reproduce

1. Install OpenClaw with LaunchAgent (default setup)
2. Start the gateway
3. Observe `~/.openclaw/logs/gateway.err.log`
4. Errors repeat every 1-2 minutes

### Expected Behavior

- mDNS broadcast should work on macOS or fail gracefully without spamming logs
- Configuration option to disable Bonjour should prevent the library from initializing

### Actual Behavior

- EAFNOSUPPORT errors flood logs continuously
- `CLAWDBOT_DISABLE_BONJOUR=1` environment variable is not respected
- `discovery.bonjour.enabled: false` config does not prevent errors

### Workarounds Tried

#### 1. Config File
```json
"discovery": {
  "wideArea": { "enabled": false },
  "bonjour": { "enabled": false }
}
```
- ❌ Does not prevent errors

#### 2. Environment Variable
```bash
CLAWDBOT_DISABLE_BONJOUR=1
```
- ❌ Does not prevent errors (may need `OPENCLAW_DISABLE_BONJOUR` instead?)

### Related Issues

- #4279 - Windows Bonjour/ciao causes terminal window flashing (similar root cause: @homebridge/ciao library)
- #4632 - Gateway crash causes LaunchAgent exponential throttling (related to error handling)

### Root Cause

The `@homebridge/ciao` library attempts to broadcast to mDNS multicast address `224.0.0.251:5353` using a method that produces `EAFNOSUPPORT` on macOS. This appears to be a compatibility issue between:

- Node.js version (v24.13.0+ on arm64)
- macOS network stack changes
- The ciao library's socket initialization

### Suggested Fixes

#### Option 1: Graceful Error Handling
Catch and suppress `EAFNOSUPPORT` errors in the mDNS announcement layer, log only once on startup.

#### Option 2: Complete Disable Support
Ensure `CLAWDBOT_DISABLE_BONJOUR` (and potentially `OPENCLAW_DISABLE_BONJOUR`) fully prevents the ciao library from initializing.

#### Option 3: Fallback Network Interface Detection
Skip interfaces that don't support multicast (EAFNOSUPPORT) instead of failing all announcements.

#### Option 4: Update/Replace @homebridge/ciao
Consider updating to a newer version of ciao that handles macOS network quirks, or implement mDNS directly.

### Additional Context

- Error persists across OpenClaw v2026.1.24-3 → v2026.1.29
- Service name changed: `Clawdbot` → `OpenClaw`
- Config path changed: `~/.clawdbot/` → `~/.openclaw/`
- The @homebridge/ciao library is designed for HomeBridge but may have assumptions about network behavior that don't align with OpenClaw's use case

---

**Labels**: `bug`, `macOS`, `mDNS`, `priority: medium`

## Comments


## Links

- None detected yet
