---
number: 6867
title: "[Bug]: Slack invalid_auth during reconnection causes gateway crash (unhandled rejection)"
author: chrishutchins
created: 2026-02-02T04:21:23Z
updated: 2026-02-02T04:21:23Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6867
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description
The gateway crashes with an unhandled promise rejection when Slack returns `invalid_auth` during a socket mode reconnection attempt.

## Steps to Reproduce
1. Configure Slack with valid bot + app tokens (socket mode)
2. Gateway runs normally, Slack connects
3. Slack temporarily rejects auth (transient API issue, token rotation, etc.)
4. Socket mode client attempts reconnection, calls `apps.connections.open`
5. `apps.connections.open` returns `invalid_auth`
6. @slack/socket-mode classifies this as `UnrecoverableSocketModeStartError` and throws
7. Error escapes as unhandled promise rejection
8. `installUnhandledRejectionHandler()` in `dist/infra/unhandled-rejections.js` calls `process.exit(1)`
9. Gateway crashes and enters crash loop (each restart hits the same transient error)

## Expected Behavior
- Slack channel should be marked as failed/disconnected
- Gateway should continue running (WhatsApp, Telegram, etc. unaffected)
- Slack should retry after a backoff period
- At minimum, a single channel auth failure should not crash the entire gateway

## Actual Behavior
- `process.exit(1)` kills the entire gateway
- All channels go down (WhatsApp, etc.)
- If running as a service with auto-restart, enters a crash loop (~10s per cycle)
- In our case: ~20 minutes of crash loop before Slack auth resolved itself

## Root Cause Analysis
`server-channels.js` properly wraps `startAccount()` in `.catch()`, so the initial `app.start()` failure is handled. However, Bolt's internal socket mode reconnection fires `apps.connections.open` from a callback outside that promise chain. No `app.error()` handler is registered on the Bolt App instance (`dist/slack/monitor/provider.js`), so the error becomes an unhandled rejection.

## Suggested Fix
Register a Bolt error handler in the Slack provider:
```javascript
app.error(async (error) => {
  runtime.error?.(`slack error: ${error.message}`);
  // Don't rethrow - let the provider handle reconnection
});
```

And/or register an unhandled rejection handler via `registerUnhandledRejectionHandler()` that catches Slack API errors specifically without exiting.

## Environment
- Clawdbot: 2026.1.24-3
- @slack/bolt: 4.6.0
- Node: v22.22.0
- macOS (Darwin 23.1.0)

## Logs
```
[clawdbot] Unhandled promise rejection: Error: An API error occurred: invalid_auth
    at platformErrorFromResult (@slack/web-api/src/errors.ts:119:5)
    at WebClient.<anonymous> (@slack/web-api/src/WebClient.ts:406:36)
```

Gateway log shows 15+ crash/restart cycles in 3 minutes before manual intervention.

## Comments


## Links

- None detected yet
