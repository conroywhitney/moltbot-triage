---
number: 5120
title: "[Bug]: Webhook authentication token accepted via query parameters"
author: coygeek
created: 2026-01-31T02:51:30Z
updated: 2026-02-02T00:20:30Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5120
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description


## Summary

**Severity:** P0/Critical (Score: 105/150)
**CWE:** [CWE-598](https://cwe.mitre.org/data/definitions/598.html) - Use of GET Request Method With Sensitive Query Strings
**OWASP:** [A07:2021](https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/) - Identification and Authentication Failures
**File:** `src/gateway/hooks.ts:49-64`

The webhook endpoint accepts authentication tokens via URL query parameters (`?token=xxx`), causing **credential leakage through multiple channels**. URLs are logged by web servers, cached by browsers, stored in HTTP Referer headers, and recorded by proxies/CDNs. This violates OWASP guidelines that sensitive data must never appear in URLs.

**Why this is critical:** Even though the token is "deprecated with a warning," it still works—meaning attackers can craft URLs that leak tokens when clicked. Anyone with access to server logs, proxy logs, browser history, or analytics data can harvest valid authentication tokens. Unlike password theft requiring active interception, token-in-URL leakage happens passively through normal infrastructure logging.

## Triage Assessment

| Factor | Value | Score |
|--------|-------|-------|
| **Reachability** | Public webhook endpoint (any internet user) | 40/40 |
| **Impact** | Authentication bypass (stolen tokens) | 35/50 |
| **Exploitability** | Single crafted URL | 30/30 |
| **Verification** | file:line ✓, code ✓, attack steps ✓ | 0/30 |
| **Total** | — | **105/150** |

## Steps to reproduce
1. Configure a webhook with a token
2. Call the webhook with token in URL: `https://gateway/hooks/test?token=secret123`
3. Check server access logs - token is visible in URL
4. Token also appears in:
   - Browser history (if accessed via browser for testing)
   - HTTP Referer headers when following links from the response
   - Proxy/CDN logs
   - Browser extensions that inspect URLs

## Expected behavior
Tokens in query parameters should be rejected entirely, not just deprecated with a warning.

## Actual behavior
Query parameter tokens are accepted and processed:

### Affected code location:

**Hook Token Extraction** (`src/gateway/hooks.ts:49-63`):
```typescript
export function extractHookToken(req: IncomingMessage, url: URL): HookTokenResult {
  // ... header checks ...
  const queryToken = url.searchParams.get("token");
  if (queryToken) return { token: queryToken.trim(), fromQuery: true };
  return { token: undefined, fromQuery: false };
}
```

A warning is logged, but the token is still accepted.

## Environment
- Clawdbot version: latest (main branch)
- OS: Any
- Install method: Any

## Logs or screenshots
N/A - issue is architectural

## Impact
- **Credential leakage**: Tokens exposed in multiple logging/caching layers
- **Token theft**: Attackers with access to logs can steal tokens
- **Compliance violation**: OWASP guideline violation (sensitive data in URLs)
- **Audit trail pollution**: Tokens in logs make rotation difficult

## Recommended fix
1. Remove query parameter token support entirely (not just deprecate)
2. Return 400 error when token is provided in query string:
```typescript
if (queryToken) {
  return { ok: false, error: 'Token in query parameter not allowed. Use Authorization header.' };
}
```
3. Update documentation to require header-based authentication
4. Add migration guide for users still using query parameter tokens

## Comments

### @coygeek (2026-02-01)

## CVSS Assessment

| Metric | Value |
|--------|-------|
| **Score** | 8.2 / 10.0 |
| **Severity** | High |
| **Vector** | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:L/A:N |

> [CVSS v3.1 Calculator](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:L/A:N)



## Links

- None detected yet
