---
number: 2697
title: "[Bug]: Claude Code CLI OAuth auth fails - mode/type mismatch between config files"
author: shawnclybor
created: 2026-01-27T09:28:44Z
updated: 2026-01-28T21:49:31Z
labels: ["bug"]
assignees: []
comments_count: 5
reactions_total: 5
url: https://github.com/moltbot/moltbot/issues/2697
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary
Clawdbot fails to authenticate with Claude Max subscription via Claude Code CLI OAuth. Returns 401 "Invalid bearer token" despite successful `claude login`.

## Steps to reproduce
1. Run `clawdbot configure`, select Model â†’ Anthropic â†’ "Anthropic token (Claude Code CLI)"
2. Complete the wizard (Keychain prompt, etc.)
3. Restart gateway and send a message
4. Get 401 error

## Expected behavior
Clawdbot uses Claude Code OAuth credentials to authenticate with Anthropic API.

## Actual behavior
401 "Invalid bearer token" or "No API key found for provider anthropic" errors.

## Root cause
Mismatch between config files:
- `~/.clawdbot/clawdbot.json` has profile `anthropic:anthropic_api` with `mode: "token"` (should be `oauth`)
- `~/.clawdbot/agents/main/agent/auth-profiles.json` has profile `anthropic:claude-cli` with `type: "oauth"` but `lastGood` points to wrong profile

The wizard sets `mode: "token"` but Claude CLI stores OAuth credentials. Profile names also don't match between files.

## Workaround
1. `clawdbot config set auth.profiles.anthropic:anthropic_api.mode "oauth"`
2. Update auth-profiles.json to use matching profile name `anthropic:anthropic_api` with `type: "oauth"`
3. Restart gateway

## Environment
- Clawdbot version: 2026.1.24-3
- OS: macOS
- Install method: npm (global)

## Logs or screenshots
```
HTTP 401 authentication_error: Invalid bearer token (request_id: req_xxxxx)
```

## Comments

### @youngqqcn (2026-01-27)

same issue with `MiniMax` provider

### @rivenme (2026-01-27)

same here, been fighting this issue for hours. The fix doesn't work.

clawdbot config set auth.profiles.anthropic:anthropic_api.mode "oauth"

ðŸ¦ž Clawdbot 2026.1.24-3 (885167d) â€” I'm the assistant your terminal demanded, not the one your sleep schedule requested.

Error: Config validation failed: auth.profiles.anthropic:anthropic_api.provider: Invalid input: expected string, received undefined

### @sadilek (2026-01-27)

The following worked for me as a workaround:

In `.clawdbot/clawdbot.json`:
```
  "auth": {
    "profiles": {
      "anthropic:default": {
        "provider": "anthropic",
        "mode": "oauth"
      }
    }
  },
```

In `.clawdbot/agents/main/agent/auth-profiles.json`, there was a profile named `anthropic:default` with just one token value, which I deleted. There was another profile `anthropic:oauth` with `access` and `refresh` tokens, which I renamed to `anthropic:default` to match `.clawdbot/clawdbot.json`.

Then `clawdbot gateway restart`.

### @deniial00 (2026-01-27)

All other workarounds above have not worked. **Installing Claude Code on the same host and running `clawdbot models auth setup-token --provider anthropic` has worked for me.**

Here the config - `claude-cli` was generated by running the setup-token within clawdbot and `default` with pasting token (using `clawdbot models auth paste-token --provider anthropic`) as well as using the onboarding wizard

```json
{
"profiles": {
    "anthropic:claude-cli": {
      "type": "oauth",
      "provider": "anthropic",
      "access": "sk-ant-",
      "refresh": "sk-ant-",
      "expires": 1769578873629
    },
    "anthropic:default": {
      "type": "token",
      "provider": "anthropic",
      "token": "sk-ant-oat01-"
    }
  },
}
```

Version: `2026.1.24-3`

### @robertherbaugh (2026-01-27)

I had the same issue; I used the following as a work around to finally get in:
1. run `claude setup-token` to get an auth token
2. run `clawdbot models auth add`
3. Go through the steps, selecting yes to it expiring, pasting the token
4. run `clawdbot gateway restart`
5. run `clawdbot tui` to initialize the agent!

Hope this helps someone else so they don't spent an hour and half looking for a solution! :)


## Links

- None detected yet
