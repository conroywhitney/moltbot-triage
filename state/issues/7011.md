---
number: 7011
title: "Add systemPrompt support for WhatsApp channel configuration"
author: Morrowind-Xie
created: 2026-02-02T09:00:10Z
updated: 2026-02-02T09:00:10Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7011
duplicate_of: null
related_issues: [7010]
blocks: []
blocked_by: []
---

## Description

# [Feature]: Add `systemPrompt` support for WhatsApp channel configuration

## Summary

Currently, Discord, Slack, and Telegram channels support per-channel `systemPrompt` configuration to customize AI behavior for specific channels. However, WhatsApp (and other channels like Signal, iMessage) lack this feature, limiting the ability to provide channel-specific instructions to the AI.

This becomes particularly important when trying to control AI behavior regarding the `message` tool usage, which can cause reply synchronization issues between WhatsApp and other interfaces (TUI/Web).

## Proposed solution

Add `systemPrompt?: string` field to `WhatsAppConfig` and `WhatsAppAccountConfig` types, similar to how it's implemented in Discord/Slack/Telegram:

### Configuration example

```json
{
  "channels": {
    "whatsapp": {
      "dmPolicy": "allowlist",
      "selfChatMode": true,
      "allowFrom": ["+1234567890"],  // Your phone number
      "systemPrompt": "When replying to user messages, always respond directly with text content. Do NOT use the 'message' tool unless explicitly asked to send a message to a different contact or channel. This ensures replies appear in all interfaces (WhatsApp, TUI, Web)."
    }
  }
}
```

### Implementation areas

1. **Type definitions**: `src/config/types.whatsapp.ts`
   ```typescript
   export type WhatsAppConfig = {
     // ... existing fields ...
     /** Optional system prompt snippet for WhatsApp messages. */
     systemPrompt?: string;
   };
   
   export type WhatsAppAccountConfig = {
     // ... existing fields ...
     /** Optional system prompt snippet for this WhatsApp account. */
     systemPrompt?: string;
   };
   ```

2. **Zod schema**: `src/config/zod-schema.providers-core.ts` (or relevant schema file)
   ```typescript
   export const WhatsAppConfigSchema = z.object({
     // ... existing fields ...
     systemPrompt: z.string().optional(),
   });
   ```

3. **Runtime integration**: Pass `systemPrompt` to the agent context when processing WhatsApp messages, similar to how Discord/Slack/Telegram handle it.

## Use cases

### 1. Control message tool usage
Instruct the AI to avoid using the `message` tool for direct replies, preventing reply synchronization issues:
```json
{
  "systemPrompt": "For normal conversations, respond with direct text replies instead of using the message tool."
}
```

### 2. Channel-specific formatting
Apply WhatsApp-specific formatting rules:
```json
{
  "systemPrompt": "Format replies for WhatsApp: use emojis sparingly, keep messages concise (under 500 chars), and use WhatsApp-style formatting (*bold*, _italic_, ~strike~)."
}
```

### 3. Language preferences
Set language preferences per channel:
```json
{
  "systemPrompt": "Reply in Simplified Chinese (简体中文) for WhatsApp conversations."
}
```

### 4. Persona customization
Different tone for different channels:
```json
{
  "systemPrompt": "Use a casual, friendly tone for WhatsApp messages. Prefer short responses and use emojis when appropriate."
}
```

## Alternatives considered

### Alternative 1: Global agent systemPrompt
**Rejected**: `agents.defaults.systemPrompt` is not a valid configuration key in OpenClaw, and even if it were, it would apply globally to all channels rather than just WhatsApp.

### Alternative 2: Using tools.deny
**Insufficient**: While `tools.deny: ["message"]` can block specific tools, it:
- Doesn't provide positive instructions to the AI
- Results in errors when the AI attempts to use denied tools
- Is a blunt instrument compared to nuanced system prompts

### Alternative 3: Per-DM configuration
**Insufficient**: WhatsApp's `dms` config allows per-contact overrides, but lacks `systemPrompt` support and doesn't cover the general case.

## Additional context

### Current systemPrompt implementations

**Discord** (`src/config/types.discord.ts:40`):
```typescript
export type DiscordGuildChannelEntry = {
  // ... other fields ...
  /** Optional system prompt snippet for this channel. */
  systemPrompt?: string;
};
```

**Slack** (`src/config/types.slack.ts:44`):
```typescript
export type SlackChannelEntry = {
  // ... other fields ...
  /** Optional system prompt for this channel. */
  systemPrompt?: string;
};
```

**Telegram** (`src/config/zod-schema.providers-core.ts:43`):
```typescript
export const TelegramTopicSchema = z.object({
  // ... other fields ...
  systemPrompt: z.string().optional(),
});
```

### Channels lacking systemPrompt support
- WhatsApp
- Signal
- iMessage
- SMS (if applicable)

Implementing this feature for WhatsApp would set a precedent for adding it to other channels as well, improving consistency across the codebase.

## Benefits

1. **Consistency**: Aligns WhatsApp with Discord/Slack/Telegram feature parity
2. **Flexibility**: Allows per-channel AI behavior customization
3. **Problem-solving**: Provides a clean solution to the message tool sync issue
4. **User control**: Gives users fine-grained control over AI behavior per channel
5. **Extensibility**: Makes it easier to add channel-specific behaviors in the future

## Related issues

- The message tool synchronization issue (TUI/Web showing `NO_REPLY` when WhatsApp receives replies)
- Lack of per-channel configuration options for WhatsApp compared to other messaging platforms

---

**Implementation priority**: Medium-High
- High value for multi-channel users
- Relatively straightforward to implement (pattern already exists in other channels)
- Solves a concrete user pain point

---

## Related issues

- #7010 - WhatsApp replies show in WhatsApp but display NO_REPLY in TUI/Web

This feature request addresses the root cause of the issue reported above.

## Comments


## Links

- None detected yet
