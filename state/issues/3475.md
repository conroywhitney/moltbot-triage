---
number: 3475
title: "[Bug]: Kimi/Moonshot OpenAI-compatible models fail silently (direct API works, Clawdbot hangs)"
author: yukiodinson-coder
created: 2026-01-28T17:13:03Z
updated: 2026-01-29T08:59:51Z
labels: ["bug"]
assignees: []
comments_count: 4
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/3475
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

<pre><code class="language-markdown">## Summary
Kimi models (both `moonshot` and `kimi-code` providers) configured as OpenAI-compatible endpoints fail silently in Clawdbot. Direct API calls via curl work perfectly, but Clawdbot never receives/processes responses.

## Environment
- Clawdbot version: 2026.1.24-3
- OS: Ubuntu Linux
- Channel: Telegram

## Providers configured
```json
"moonshot": {
  "baseUrl": "https://api.moonshot.ai/v1",
  "api": "openai-completions"
}
"kimi-code": {
  "baseUrl": "https://api.kimi.com/coding/v1", 
  "api": "openai-completions"
}
</code></pre>
<h2>Models tested</h2>
<ul>
<li><code>moonshot/kimi-k2.5</code></li>
<li><code>moonshot/kimi-k2-0905-preview</code></li>
<li><code>kimi-code/kimi-for-coding</code></li>
<li><code>kimi-code/kimi-k2.5-thinking</code></li>
</ul>
<h2>Behavior</h2>

Test | Result
-- | --
Direct curl to API | ‚úÖ Works, returns response
Subagent spawn | ‚ùå Hangs forever (startedAt set, never completes)
Main session | ‚ùå Fails silently, falls back to next model


<h2>Reproduction</h2>
<ol>
<li>Configure moonshot or kimi-code provider with valid API key</li>
<li>Spawn subagent with <code>model: "moonshot/kimi-k2.5"</code></li>
<li>Subagent shows <code>totalTokens: 0</code>, empty messages array, never completes</li>
</ol>
<h2>Direct API test (works)</h2>
<pre><code class="language-bash">curl -X POST "https://api.moonshot.ai/v1/chat/completions" \
  -H "Authorization: Bearer $API_KEY" \
  -d '{"model": "kimi-k2.5", "messages": [{"role": "user", "content": "Hi"}]}'
# Returns valid response with reasoning_content + content
</code></pre>
<h2>Notes</h2>
<ul>
<li>API responses include <code>reasoning_content</code> field (chain-of-thought) ‚Äî may need special handling</li>
<li>Both providers exhibit identical behavior</li>
<li>Auth profiles verified correct, API keys work via curl</li>
</ul>

Also here is the logs from the gateway:
 8:06:30 PM
error
[clawdbot] Unhandled promise rejection: Error: Unhandled API in mapOptionsForApi: undefined
    at mapOptionsForApi (file:///home/yuki/.npm-global/lib/node_modules/clawdbot/node_modules/@mariozechner/pi-ai/src/stream.ts:471:10)
    at streamSimple (file:///home/yuki/.npm-global/lib/node_modules/clawdbot/node_modules/@mariozechner/pi-ai/src/stream.ts:218:26)
    at streamAssistantResponse (file:///home/yuki/.npm-global/lib/node_modules/clawdbot/node_modules/@mariozechner/pi-agent-core/src/agent-loop.ts:233:25)
    at runLoop (file:///home/yuki/.npm-global/lib/node_modules/clawdbot/node_modules/@mariozechner/pi-agent-core/src/agent-loop.ts:141:20)
    at file:///home/yuki/.npm-global/lib/node_modules/clawdbot/node_modules/@mariozechner/pi-agent-core/src/agent-loop.ts:51:3

## Comments

### @antymijaljevic (2026-01-28)

Tried to setup Kimi 2.5 model via Openrouter provider. Getting "not whitelisted" even config is valid.

### @eliotgevers (2026-01-28)

I tried to setup kimi k2.5 with openrouter and it fails. It is also not visible under the /models list

### @stewartcelani (2026-01-28)

Every way I try the gateway crashes due to "mapOptiosnForApi" receiving undefined.

One attempt I got the Kimi Code to at least reject me because I wasn't using approved client but I've tried a few different ways now. ü§∑‚Äç‚ôÇÔ∏è

### @varoudis (2026-01-29)

running kimi2.5 with sglang:dev (as per official instruction) I does "work", but I get reasoning token in normal chat and I get error with simple tool calling. 


## Links

- None detected yet
