---
number: 3020
title: "[Bug]: NIP 04 Considered Harmful"
author: staab
created: 2026-01-27T23:03:28Z
updated: 2026-01-27T23:03:28Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/3020
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary
NIP 04 (nostr DMs) are insecure. Use [NIP 17](https://github.com/nostr-protocol/nips/blob/master/17.md) instead.

## Details

NIP 04 has the following issues:

- It leaks lots of metadata
- It allows anyone to link conversation partners
- Plain-text recovery of encrypted DMs by chaining CBC malleability with link previews.

NIP 17 solves this by using ephemeral keys to send messages, obscuring the sender, as well as padding the payload, randomizing timestamps, and supporting deniability by stripping signatures from the inner payload. It also improves on deliverability and metadata hiding by allowing users to specify special purpose DM inbox relays.

## References

- https://i.blackhat.com/BH-USA-25/Presentations/USA-25-Kimura-Not-Sealed-Practical-Attacks-on-Nostr.pdf
- https://crypto-sec-n.github.io/

I am a core nostr developer and helped with getting NIP 17 written and audited.

## Comments


## Links

- None detected yet
