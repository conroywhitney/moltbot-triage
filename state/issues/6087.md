---
number: 6087
title: "Browser webchat client missing tick/keepalive monitoring - silent disconnections"
author: jlmalone
created: 2026-02-01T08:20:08Z
updated: 2026-02-02T06:38:59Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6087
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug Description

The browser WebSocket client in the webchat dashboard is missing tick/keepalive monitoring that the Node.js client has. This causes silent disconnections that manifest as the agent appearing to "hang" indefinitely.

## Expected Behavior

When the WebSocket connection silently disconnects (due to tab backgrounding, network changes, or mobile sleep), the client should detect this and reconnect automatically.

## Actual Behavior

The browser client:
- Continues to think it's connected
- Misses all incoming messages
- Shows agent as "thinking" forever
- User has to manually refresh to see actual responses

## Root Cause

**Node.js client (`gateway/client.js`)** monitors for `tick` events and closes/reconnects if 2x the tick interval passes without receiving one:
```javascript
startTickWatch() {
    this.tickTimer = setInterval(() => {
        if (gap > this.tickIntervalMs * 2) {
            this.ws?.close(4000, "tick timeout");
        }
    }, interval);
}
```

**Browser client** has NO tick handling - it only relies on `onclose`/`onerror` events which may not fire reliably on silent disconnects.

## Additional Issues

1. **No `visibilitychange` handler** - No detection of tab being backgrounded/foregrounded
2. **Gap detection doesn't recover** - Only shows error message, no resync
3. **No proactive health checks** - Only reacts to `onclose`/`onerror` events

## Reproduction Steps

1. Open webchat dashboard
2. Send a message that triggers a long-running agent task
3. Switch browser tabs or put device to sleep for 60+ seconds
4. Return to webchat tab
5. Agent appears to be "thinking" forever
6. Refresh page to see the actual response

## Suggested Fix

1. **Add tick monitoring to browser client:**
   - Track `lastTick` timestamp
   - Update on receiving `tick` events  
   - Check periodically and close connection if stale

2. **Add visibility handler:**
   - Listen for `visibilitychange`
   - On becoming visible, verify connection health
   - Trigger reconnect if connection is stale

3. **Add history resync on reconnect:**
   - Fetch recent messages to catch anything missed
   - Already partially implemented via `chat.history` RPC

## Workarounds

- Keep webchat tab in foreground during long operations
- Refresh page if agent appears stuck
- Check Debug tab for "event gap detected" errors
- Use CLI or mobile app for critical interactions

## Environment

- Clawdbot version: Latest (Jan 2026)
- Browser: Chrome/Safari (all browsers affected)
- Platform: macOS

## Severity

**High** - Significantly impacts user experience and makes webchat unreliable for anything beyond quick interactions.

## Comments

### @moonsbe (2026-02-02)

Adding a +1 here â€” this is a frequent pain point. The 'event gap detected' error appears regularly during normal use (not just image uploads), requiring manual refresh each time.

The Node.js client's tick monitoring approach seems solid. Would be great to see this ported to the browser client. Happy to test a fix if needed.


## Links

- None detected yet
