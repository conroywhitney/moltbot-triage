---
number: 2634
title: "[Bug] Japanese IME: Premature sending and recognition failure in macOS App"
author: kantaro4123
created: 2026-01-27T07:34:25Z
updated: 2026-01-28T05:59:56Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/2634
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description
There is a critical issue with Japanese text input (IME) in the macOS Companion app's WebChat interface.

1. **Premature Sending**: When a user presses `Enter` to confirm a Japanese character conversion, the app treats it as a \"Send\" command and transmits the message immediately (often in Romaji/unconverted form).
2. **Recognition Failure on Empty Input**: Japanese input is not recognized if typed into an empty message field. It only starts working if an alphanumeric character is typed first.

## Suggested Fix
In `apps/shared/ClawdbotKit/Sources/ClawdbotChatUI/ChatComposer.swift`, the `ChatComposerNSTextView` should check if there is \"marked text\" (unconfirmed IME text) before triggering the send action.

```swift
override func keyDown(with event: NSEvent) {
    let isReturn = event.keyCode == 36
    if isReturn {
        // Guard: Don't send if user is still converting Japanese text
        if self.hasMarkedText() {
            super.keyDown(with: event)
            return
        }

        if event.modifierFlags.contains(.shift) {
            super.insertNewline(nil)
            return
        }
        self.onSend?()
        return
    }
    super.keyDown(with: event)
}
```

## Environment
- OS: macOS (Sequoia/Tahoe)
- App Version: 2026.1.23 (7750)

## Comments


## Links

- None detected yet
