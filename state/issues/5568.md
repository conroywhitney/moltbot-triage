---
number: 5568
title: "Audio attachments incorrectly included as text/plain files in media understanding"
author: openclaw-quenio
created: 2026-01-31T17:19:21Z
updated: 2026-02-02T18:44:49Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 1
url: https://github.com/openclaw/openclaw/issues/5568
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug Description

When an inbound audio message (e.g., Telegram voice note) is processed, the audio file is incorrectly included as a `<file>` block with `mime="text/plain"` in the agent context. This causes raw Ogg/Opus bytes to appear as garbled text (often looking like Chinese characters).

## Root Cause

In `media-understanding/apply.js`, the `extractFileBlocks` function has a bug in how it handles audio files:

```javascript
const textLike = Boolean(utf16Charset) || looksLikeUtf8Text(bufferResult?.buffer);
if (!forcedTextMimeResolved && kind === "audio" && !textLike) {
    continue; // Only skips audio if NOT text-like
}
// ...
const textHint = ... ?? (textLike ? "text/plain" : undefined);
const mimeType = textHint ?? normalizeMimeType(rawMime); // text/plain overrides audio MIME!
```

The issue:
1. Some audio files have byte patterns that pass the `looksLikeUtf8Text` check (>85% "printable" chars)
2. When this happens, `textLike` becomes `true`
3. The audio file is NOT skipped (the `continue` only triggers when `!textLike`)
4. `textHint` is set to `"text/plain"`, which overrides the correct `audio/ogg` MIME type
5. The raw audio bytes get included in a `<file>` block as text

## Expected Behavior

Audio files should NEVER be included in `extractFileBlocks`. They are already handled separately by audio transcription.

## Suggested Fix

Change the condition to always skip audio files, regardless of text-likeness:

```javascript
// Always skip audio - it's handled by audio transcription, not file extraction
if (!forcedTextMimeResolved && kind === "audio") {
    continue;
}
```

## Environment

- OpenClaw version: 2026.1.29
- Channel: Telegram
- Audio format: Ogg Opus voice notes

## Comments

### @RayBB (2026-02-02)

Should be fixed by this:
https://github.com/openclaw/openclaw/issues/6081


## Links

- None detected yet
