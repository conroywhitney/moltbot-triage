---
number: 2692
title: "[Security] WhatsApp accountId path traversal in resolveDefaultAuthDir"
author: robbyczgw-cla
created: 2026-01-27T09:23:18Z
updated: 2026-01-28T05:59:30Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/2692
duplicate_of: null
related_issues: [2580]
blocks: []
blocked_by: []
---

## Description

## Summary

`resolveDefaultAuthDir()` in `src/web/accounts.ts` uses the `accountId` parameter directly in `path.join()` without sanitization, allowing potential path traversal attacks.

## Vulnerable Code

```typescript
// src/web/accounts.ts line 88-90
function resolveDefaultAuthDir(accountId: string): string {
  return path.join(resolveOAuthDir(), "whatsapp", accountId);
  // ^^^ accountId used directly without sanitization
}
```

## Attack Vector

A malicious config with `accountId: "../../../etc"` could escape the intended directory structure. While this is config-level input (not user input), it's risky for:
- Multi-user deployments
- Shared configs
- Plugin systems that might pass untrusted account IDs

## Recommended Fix

Sanitize `accountId` similar to how Telegram does it in `src/telegram/update-offset-store.ts`:

```typescript
function normalizeAccountId(accountId: string): string {
  const trimmed = accountId.trim();
  if (!trimmed) return "default";
  return trimmed.replace(/[^a-z0-9._-]+/gi, "_");
}

function resolveDefaultAuthDir(accountId: string): string {
  return path.join(resolveOAuthDir(), "whatsapp", normalizeAccountId(accountId));
}
```

## Severity

Low-Medium: Config-level input, but defense-in-depth principle suggests sanitization.

## Related

- Similar pattern already used in `src/telegram/update-offset-store.ts:15-18`
- PR #2580 covers path traversal in media, but not this location

## Comments


## Links

- None detected yet
