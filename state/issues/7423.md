---
number: 7423
title: "Bug: Webchat UI doesn't render responses until user action"
author: spud6007
created: 2026-02-02T20:10:52Z
updated: 2026-02-02T21:00:04Z
labels: []
assignees: []
comments_count: 3
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7423
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Version
2026.2.1 (also reproduced on 2026.1.30)

## Steps to reproduce
1. Open Control UI webchat at `http://127.0.0.1:18789/chat?session=agent:main:main`
2. Send a message to the assistant
3. Assistant icon appears but response text is blank
4. Send another message OR click refresh icon → previous response finally appears

## Expected behavior
Response renders immediately when received from the server.

## Actual behavior
Response only renders after additional user interaction (sending another message or clicking the refresh chat data icon).

## Environment
- **OS:** macOS (Apple Silicon Mac mini)
- **Browser:** Chrome (latest)
- **Gateway config:** bound to LAN (0.0.0.0:18789)
- **Access:** Local (http://127.0.0.1:18789)

## Diagnostics
- Gateway logs show `res ✓ chat.send` completing successfully (server side is fine)
- Manual WebSocket test in console works:
  ```javascript
  new WebSocket('ws://127.0.0.1:18789/').onopen = () => console.log('WS OK')
  // Prints "WS OK" - connection works
  ```
- Console shows transient "WebSocket connection to 'ws://127.0.0.1:18789/' failed" errors but connection recovers
- Frequent disconnects in gateway log (code 1006) every few minutes, but reconnects automatically

## Hypothesis
WebSocket messages are being received but not triggering a UI re-render. Likely a state management issue in the React/Vue frontend where incoming message events don't update the component state properly.

## Comments

### @spud6007 (2026-02-02)

**Update:** Tested reverting `session.dmScope` from `per-channel-peer` back to `main` — issue persists. Not related to that config change.

### @spud6007 (2026-02-02)

## Diagnostic Findings

Did some debugging with WebSocket inspection in DevTools:

### What we confirmed:
1. **WebSocket connection is working** — messages are being received
2. **`agent` events arriving** — streaming content (`stream: "assistant"`, `data: {...}`, sequential `seq` numbers)
3. **`chat` events arriving** — state signals (`state: "final"`) with correct `sessionKey` and `runId`
4. **`chat.history` responses arriving** — full message array present in payload

### Conclusion:
**All data reaches the browser successfully.** The issue is in the Lit frontend reactivity — state updates from WebSocket events are not triggering component re-renders.

### Suspected cause:
Looking at the minified bundle, `agent` events are handled by a function (minified as `Cd`) that updates state properties. The Lit element has reactive properties decorated with `@state()` (`chatStream`, `chatMessages`, etc.), but something prevents the change detection:

- Possibly mutating objects/arrays in place rather than replacing them
- Or updates happening outside the Lit reactive update cycle
- Or a timing issue with microtask scheduling

### Reproduction:
- Send message via webchat
- Assistant icon appears, response area stays blank
- Incoming WS frames show all expected events
- User interaction (send another message, click refresh) triggers render of previous response

Browser: Chrome (latest), macOS ARM64

### @spud6007 (2026-02-02)

## Root Cause Identified

**The bug started after updating to 2026.2.1** (installed today Feb 2 at ~14:42 local time).

The changelog for 2026.2.1 includes:
> Web UI: refine chat layout + extend session active duration.

This UI change is the likely culprit. The render bug was not present before the update.

Previous config change (`session.dmScope`) was ruled out — reverting it did not fix the issue.


## Links

- None detected yet
