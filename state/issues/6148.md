---
number: 6148
title: "Gateway crashes on AbortError during graceful shutdown"
author: david-sosoka-ai
created: 2026-02-01T10:03:52Z
updated: 2026-02-02T12:13:56Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6148
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

When SIGTERM/SIGUSR1 is received, pending fetch operations are aborted. The AbortError isn't caught by the unhandled rejection handler and causes exit(1) instead of a graceful exit(0).

**Version:** v2026.1.24-3

## Evidence

```
[gateway] received SIGTERM; shutting down
Unhandled promise rejection: AbortError: This operation was aborted
Main process exited, code=exited, status=1/FAILURE
```

The gateway should exit cleanly with code 0 during graceful shutdown, not crash with code 1.

## Proposed Fix

Register an AbortError handler during shutdown:

```javascript
registerUnhandledRejectionHandler((reason) => {
    if (reason?.name === 'AbortError') {
        logDebug('Ignoring AbortError during shutdown');
        return true;
    }
    return false;
});
```

This allows graceful shutdown to complete without treating aborted operations as fatal errors.

## Comments

### @hclsys (2026-02-02)

This issue appears to share the same root cause as #4632 - the `gateway-daemon.ts` is missing `installUnhandledRejectionHandler()`.

PR #7117 (fix for #4632) adds `installUnhandledRejectionHandler()` to `gateway-daemon.ts`, which automatically handles AbortError:

```typescript
// From src/infra/unhandled-rejections.ts lines 149-154:
if (isAbortError(reason)) {
  console.warn("[openclaw] Suppressed AbortError:", formatUncaughtError(reason));
  return;  // ‚Üê Does NOT exit(1)
}
```

Once PR #7117 is merged, AbortError during graceful shutdown will be suppressed instead of causing exit(1).

**Verification**: The `isAbortError()` function checks for both `name === "AbortError"` and the `"This operation was aborted"` message pattern, which matches the error in this issue's stacktrace.


## Links

- None detected yet
