---
number: 7598
title: "[Feature]: Session History Backup Layer"
author: Joyride79
created: 2026-02-03T00:56:11Z
updated: 2026-02-03T02:07:42Z
labels: ["enhancement"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7598
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

Problem:
Conversation histories are compacted to stay within token limits. This leads to valuable information being lost permanently, resulting in:

• Information loss in important projects
• Need to re-request previously provided information
• Lack of traceability in long-running sessions
Proposal: Hybrid Approach

Layer 1: Local Session Backup (new)

• Location: ~/.openclaw/sessions/<session-id>/history.jsonl
• Format: JSONL (one message per line)
• Content: Complete messages (role, content, timestamp, metadata)
• Persistence: Lossless, unlimited (or with configurable retention)
Layer 2: Context Management (existing)

• For API requests: Compressed version as before
• Only last N messages + summary for context window
• No changes to existing behavior
Layer 3: Extended Memory Search (optional)

• memory_search additionally searches session backups
• Parameters: include_sessions: true/false
• Time-based filters: after: "2024-01-01", session: "session-id"
Configuration (openclaw.json):

{
  "sessions": {
    "backup": {
      "enabled": true,
      "format": "jsonl",
      "path": "~/.openclaw/sessions",
      "retention_days": 365,
      "exclude_patterns": ["heartbeat*", "system:*"]
    }
  }
}

Implementation Sketch:

1. Session Logger Hook

// In Gateway Message Handler
async function handleMessage(msg: Message) {
  // Existing logic
  await sessionManager.addToContext(msg);
  
  // NEW: Local backup
  if (config.sessions.backup.enabled) {
    await sessionBackup.append(msg.sessionKey, msg);
  }
}

2. JSONL Writer

class SessionBackup {
  async append(sessionKey: string, msg: Message) {
    const path = this.getPath(sessionKey);
    const line = JSON.stringify({
      role: msg.role,
      content: msg.content,
      timestamp: msg.timestamp,
      metadata: msg.metadata
    }) + '\n';
    
    await fs.appendFile(path, line);
  }
}

3. Retention Cleanup (Cron)

// Daily: Delete old sessions
async function cleanupOldSessions() {
  const cutoff = Date.now() - (config.retention_days * 86400000);
  // ... cleanup logic
}

Benefits:

1. Transparency: Full session history available at any time
2. Debugging: Complete conversation flow can be analyzed when issues occur
3. Compliance: For projects with documentation requirements
4. Zero Breaking Changes: Existing compaction remains unchanged
5. Performance: JSONL append is extremely fast, no overhead
6. Storage: Text compresses well, 1000 messages ≈ 1-2 MB
Use Cases:

• Long-term projects
• Debugging agent behavior
• Audit trails for business-critical decisions
• Training data for fine-tuning
• Export for external analysis tools
Alternative: Opt-In per Session

If not desired globally, it could be configurable per session:

// In session.json metadata
{
  "sessionKey": "agent:main:main",
  "backup": {
    "enabled": true,
    "full_history": true
  }
}

Priority: Medium-High

This feature would make OpenClaw significantly more robust for longer, complex projects without compromising simplicity for casual use cases.

## Comments

### @varmab (2026-02-03)

++ for Long term memory storage into local /remote DB would be great so can recover if any issues with hardware in future.


## Links

- None detected yet
