---
number: 4689
title: "[Bug]: exec host defaults to 'sandbox' even when sandbox.mode is 'off', causing rogue gateway spawns"
author: selcukcift
created: 2026-01-30T14:26:25Z
updated: 2026-01-30T14:26:25Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4689
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

When `agents.defaults.sandbox.mode` is set to `"off"`, the `tools.exec.host` setting **still defaults to `"sandbox"`** instead of respecting the disabled sandbox mode. This causes Docker containers to spawn with their own clawdbot instances, leading to port conflicts and session desync.

## Steps to Reproduce

1. Configure gateway with sandbox mode disabled:
```json
{
  "agents": {
    "defaults": {
      "sandbox": { "mode": "off" }
    }
  }
}
```
2. Do NOT explicitly set `tools.exec.host`
3. Run any exec command from the agent
4. Observe Docker container spawning despite sandbox being "off"

## Expected Behavior

When `sandbox.mode: "off"`, exec commands should default to `host: "gateway"` (or at minimum, warn at startup about the contradictory configuration).

## Actual Behavior

Exec defaults to `host: "sandbox"` regardless of the sandbox.mode setting, causing:

1. Docker containers spawn with isolated environments
2. Containers run their own clawdbot instances (from mounted home dir)
3. **Multiple gateways fight over port 18789**
4. WhatsApp/Telegram sessions connect to rogue gateway → messages lost
5. Dashboard connects to real gateway → shows different session state
6. Complete desync between channels and dashboard

## Root Cause

In `bash-tools.exec.js`:
```javascript
const configuredHost = defaults?.host ?? "sandbox";  // Always defaults to sandbox
```

The default doesn't consider whether sandbox mode is actually enabled.

## Proposed Fix

**Option 1:** Change the default based on sandbox mode:
```javascript
const configuredHost = defaults?.host ?? (sandboxDisabled ? "gateway" : "sandbox");
```

**Option 2:** Add startup validation that warns/errors if `tools.exec.host` is `"sandbox"` but `agents.defaults.sandbox.mode` is `"off"`.

## Workaround

Explicitly set exec host in config:
```json
{
  "tools.exec": { "host": "gateway" }
}
```

## Environment

- Clawdbot version: latest
- OS: Linux (Fedora)
- Channels affected: WhatsApp, webchat dashboard

## Impact

**High** — This silently breaks multi-channel setups. Users who disable sandbox mode expect exec to run on the gateway host, not spawn competing Docker instances. The symptom (session desync) is hard to diagnose without deep knowledge of the architecture.

## Comments


## Links

- None detected yet
