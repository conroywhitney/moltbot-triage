---
number: 5481
title: "Session becomes permanently stuck after content filtering truncates a tool call"
author: liuwenyong1985
created: 2026-01-31T14:49:24Z
updated: 2026-02-02T00:18:59Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 2
url: https://github.com/openclaw/openclaw/issues/5481
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

When the Anthropic API blocks an assistant output mid-stream due to content filtering (`Output blocked by content filtering policy`), the session history becomes permanently corrupted. Every subsequent user message triggers the same error repeatedly until the user manually resets with `/new`.

## Steps to Reproduce

1. Send a message that causes the assistant to make a long `write` tool call (e.g., writing a multi-thousand-character Markdown file with classical Chinese text)
2. The Anthropic API blocks the output: `Output blocked by content filtering policy`
3. The tool call is truncated — the `tool_use` block exists but the corresponding `tool_result` is missing or synthetic
4. OpenClaw inserts a synthetic error result: `"[openclaw] missing tool result in session history; inserted synthetic error result for transcript repair."`
5. After this, **every subsequent message** fails with:
   ```
   LLM request rejected: messages.N.content.M: unexpected tool_use_id found in tool_result blocks: toolu_XXXXX. Each tool_result block must have a corresponding tool_use block in the previous message.
   ```
6. The session is permanently stuck. Only `/new` or `/reset` recovers it.

## Expected Behavior

- After a content filtering error truncates a tool call, the session should auto-recover gracefully
- Options: automatically strip the orphaned tool_use/tool_result pair, or auto-reset the session, or at minimum inform the user to run `/new`

## Actual Behavior

- The synthetic repair does not correctly fix the tool_use/tool_result pairing
- The session is permanently broken with no automatic recovery
- The error message is raw API jargon sent directly to the user in Telegram, which is confusing

## Environment

- OpenClaw (latest, auto-updated 2026-01-31)
- Model: `anthropic/claude-opus-4-5`
- Channel: Telegram
- Trigger: Writing a long Markdown file containing classical Chinese literature (醉翁亭記 lecture notes)

## Suggestion

1. When a content filtering error truncates a tool call, strip both the orphaned `tool_use` and the synthetic `tool_result` from the session history before the next API call
2. Alternatively, detect the "unexpected tool_use_id" error and auto-recover by pruning the broken message pair
3. Show a user-friendly message instead of raw API errors on messaging surfaces

## Comments

### @sebslight (2026-02-01)

OpenClaw Maintainer Triage // Issue Closure

Hi — this is a joint maintainer effort to keep the repo moving. We’re currently seeing ~30 new issues per hour, and we can’t review every future request without slowing down critical stabilization work. This issue is unlikely to be considered in the near term, so we’re closing it to keep the pipeline moving while we focus on stability.

We’re very sorry this is happening, but we won’t be able to look at the comments on this issue.

Want to make your request stand out? Submit a PR and report to #pr-thunderdome-dangerzone on Discord — READ THE TOPIC. Give us a clear briefing: what it fixes, who it helps, and why it’s worth shipping.

Thanks for understanding and for contributing.

![](https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExeXFramtnZWo1ZWM4YmYzcG1zcXE1NWV1eTl3MDZodnk4aWhvM2tqbCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/RWUqVYucDBD4A/giphy.gif)



## Links

- None detected yet
