---
number: 2707
title: "Webchat message truncation due to delta dropping"
author: zonadevlab
created: 2026-01-27T09:48:48Z
updated: 2026-01-28T05:59:24Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/2707
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Problem

Messages in webchat are intermittently truncated mid-sentence. The user sees incomplete text.

## Root Cause

1. **Delta rate limiting** (`server-chat.js:66-71`) drops updates arriving <150ms apart
2. **Slow consumer dropping** (`server-broadcast.js:35-50`) skips messages when WebSocket buffer exceeds 1.5MB
3. **Final message uses incomplete buffer** (`server-chat.js:85-86`) - the final payload only contains deltas that survived transmission

## Why Intermittent

- Short/fast responses complete within buffer limits
- Longer responses + slow client = buffer fills → deltas dropped → truncation

## Suggested Fix

**Priority 1:** Track the complete message server-side and send full text in the final payload, independent of delta accumulation.

**Priority 2:** Coalesce rate-limited deltas instead of dropping them.

**Priority 3:** Consider backpressure (pause AI stream when buffer full) instead of dropping content.

## Files

- `dist/gateway/server-chat.js` lines 66-71, 81, 85-86
- `dist/gateway/server-broadcast.js` lines 35-50
- `dist/gateway/server-constants.js` (MAX_BUFFERED_BYTES)

## Comments


## Links

- None detected yet
