---
number: 4950
title: "[Bug]: Arbitrary JavaScript execution via browser evaluate endpoint when enabled"
author: coygeek
created: 2026-01-30T21:46:09Z
updated: 2026-02-01T23:25:18Z
labels: ["bug"]
assignees: []
comments_count: 2
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/4950
duplicate_of: null
related_issues: [4949]
blocks: []
blocked_by: []
---

## Description

## Summary

**Severity:** P0/Critical (Score: 130/150)
**CWE:** [CWE-94](https://cwe.mitre.org/data/definitions/94.html) - Improper Control of Generation of Code ('Code Injection')
**OWASP:** [A03:2021](https://owasp.org/Top10/A03_2021-Injection/) - Injection
**File:** `src/browser/pw-tools-core.interactions.ts:227-257`

When `evaluateEnabled=true`, the browser control server accepts arbitrary JavaScript via the `/act` endpoint and executes it directly via `eval()` in the browser context with no sanitization, sandboxing, or scope restriction.

**Why this is critical:** This is arbitrary code execution in the browser context. While gated by a config flag, once enabled there are zero controls—any JavaScript can read cookies, access localStorage, manipulate the DOM, make fetch requests with the page's credentials, or exfiltrate data. Combined with DNS rebinding (#4949), this becomes remotely exploitable. The `eval()` pattern is the textbook example of dangerous code injection.

## Triage Assessment

| Factor | Value | Score |
|--------|-------|-------|
| **Reachability** | Config-dependent (requires evaluateEnabled) | 25/40 |
| **Impact** | Arbitrary code execution in browser | 50/50 |
| **Exploitability** | Single POST request | 30/30 |
| **Verification** | file:line ✓, code ✓, attack steps ✓ | 25/30 |
| **Total** | — | **130/150** |

## Steps to reproduce
1. Configure with `evaluateEnabled: true`
2. POST to `/act` with body: `{kind: "evaluate", fn: "document.cookie"}`
3. Observe arbitrary JavaScript execution in the browser context

## Expected behavior
Even when evaluate is enabled, there should be:
- Sandboxing or scope restrictions
- Input validation against known-safe patterns
- Audit logging of evaluated code
- Rate limiting

## Actual behavior
The `fnText` parameter is passed directly to `eval()` with no restrictions:

### Affected code location:

**Evaluate Implementation** (`src/browser/pw-tools-core.interactions.ts:227-257`):
```typescript
const browserEvaluator = new Function(
  "fnBody",
  `
  "use strict";
  try {
    var candidate = eval("(" + fnBody + ")");
    return typeof candidate === "function" ? candidate() : candidate;
  } catch (err) {
    // ...
  }
`
);
```

## Environment
- Version: latest (main branch)
- OS: Any
- Install method: Any

## Impact
- **Session hijacking**: Read cookies, localStorage, sessionStorage
- **Credential theft**: Capture form inputs, access saved passwords
- **Data exfiltration**: Read page content, make authenticated requests
- **Malware delivery**: Inject scripts, redirect users
- **Lateral movement**: Access internal network resources via browser

## Recommended fix
1. Remove evaluate functionality entirely, or
2. Implement a strict allowlist of safe operations:
```typescript
const ALLOWED_EVALUATIONS = {
  'getInnerText': (selector: string) => document.querySelector(selector)?.innerText,
  'getValue': (selector: string) => (document.querySelector(selector) as HTMLInputElement)?.value,
  // ... other specific, safe operations
};

// Reject arbitrary code, only allow predefined operations
if (!ALLOWED_EVALUATIONS[operation]) {
  throw new Error(`Unsupported evaluation: ${operation}`);
}
```

## Comments

### @coygeek (2026-02-01)

## Severity Clarification: CVSS 9.9 Critical — Vulnerable by Default

I want to highlight a critical aspect that may have been underweighted in the original triage: **the vulnerable configuration is the default**.

```typescript
// src/browser/constants.ts:2
export const DEFAULT_BROWSER_EVALUATE_ENABLED = true;

// src/hooks/config.ts:9
"browser.evaluateEnabled": true,
```

### CVSS v3.1 Reassessment

The original report scored Reachability at 25/40 because it "requires evaluateEnabled." But since `true` is the default, every installation is vulnerable out of the box. Here's the proper CVSS breakdown:

| Metric | Value | Rationale |
|--------|-------|-----------|
| Attack Vector | **Network (N)** | Reachable via gateway API |
| Attack Complexity | **Low (L)** | Single POST, no race conditions |
| Privileges Required | **Low (L)** | Any authenticated client |
| User Interaction | **None (N)** | Fully automated |
| Scope | **Changed (C)** | Can exfiltrate to external domains |
| Confidentiality | **High (H)** | Read cookies, localStorage, credentials |
| Integrity | **High (H)** | Modify DOM, submit forms as user |
| Availability | **Low (L)** | Can crash tabs |

**Vector:** `CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:L`  
**Score:** [**9.9 / 10.0 (Critical)**](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:L)

### Why This Matters

The config flag isn't a security control — it's a feature toggle that happens to be on. If gateway credentials are ever compromised (phishing, token leak, insider threat), the attacker immediately gets arbitrary JavaScript execution in all browser tabs. No additional steps required.

### Recommended Action

Flip the default to secure-by-default:

```diff
- export const DEFAULT_BROWSER_EVALUATE_ENABLED = true;
+ export const DEFAULT_BROWSER_EVALUATE_ENABLED = false;
```

Users who need eval can opt in explicitly. Everyone else gets protection without lifting a finger.

### @coygeek (2026-02-01)

**Tracking fix**

Closing #5257 as duplicate — consolidated here.

Keeping this issue open until PR #3926 merges.

**Summary of findings:**
| Item | Focus | CVSS |
|------|-------|------|
| #4950 (this) | The `eval()` vulnerability | 9.9 Critical |
| #5257 (dup) | Default-enabled config | 10.0 Critical |
| PR #3926 | Fix: default to `false` | — |


## Links

- None detected yet
