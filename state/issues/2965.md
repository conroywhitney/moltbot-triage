---
number: 2965
title: "Cron jobs should be resilient to main session context compaction"
author: Wei-EVA
created: 2026-01-27T21:28:56Z
updated: 2026-01-28T05:57:21Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/2965
duplicate_of: null
related_issues: [919,2415,2654]
blocks: []
blocked_by: []
---

## Description

### Problem

When the main agent session undergoes context compaction (hitting token limits), cron jobs can produce degraded or nonsensical output that gets delivered to end users.

### Affected paths

**1. `sessionTarget: "main"` jobs (e.g. heartbeats)**
- These run inside the main session. After compaction, the summary may be degraded (`"Summary unavailable due to context limits"`), causing the agent to lose awareness of the cron task's intent.
- The cron payload text is injected as a system event, but the agent lacks context to execute it properly.

**2. `sessionTarget: "isolated"` jobs with `postToMain`**
- The isolated session itself starts fresh (new `sessionId`, clean transcript âœ…).
- However, `finish()` in `timer.ts` unconditionally posts results back via `enqueueSystemEvent()`, which feeds into a potentially degraded main session.

**3. `deliver: true` has no quality gate**
- Isolated jobs with explicit delivery send agent output directly to the target channel regardless of output quality.
- If the agent produces garbage (e.g. confused by compaction state, empty summary, or error text), it still gets delivered.

### Expected behavior

- Cron jobs should not produce degraded output due to main session compaction state.
- `sessionTarget: "main"` jobs should carry enough self-contained context to survive compaction.
- `deliver: true` should have an optional quality/sanity check before sending.

### Reproduction

1. Run a long, tool-intensive session until context compaction triggers
2. After compaction (especially with degraded summary), observe cron job behavior
3. `sessionTarget: "main"` jobs lose task awareness
4. `deliver: true` isolated jobs may send degraded output to channels

### Related

- #2654 (cron error message leaking to chat)
- #919 (API error JSON leaking to Telegram)
- #2415 (tool ENOENT error leaking)

## Comments

### @ProMadGenius (2026-01-28)

Try with this skill I made, did the trick for cronjob https://clawdhub.com/ProMadGenius/ez-cronjob 


## Links

- None detected yet
