---
number: 2276
title: "[Bug]: Mac Companion App causes high CPU when connecting to gateway"
author: LiliandVova
created: 2026-01-26T16:26:26Z
updated: 2026-01-28T06:03:07Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/2276
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Clawdbot version
2026.1.16-2

## Operating system
macOS 26.2 (25C56)

## Hardware
MacBook Pro 14" M3 Max, 64GB RAM

## Installation method
App Bundle + LaunchAgent

---

## Description

When the Mac Companion App connects to the gateway, CPU usage spikes to 80-110% for the gateway process and 50-70% for the app. Without the app running, the gateway operates normally at ~0-2% CPU.

### Initial symptom (now fixed locally)

The gateway error log showed a continuous loop of:
```
[skills-remote] remote bin probe error (<node-id>): Error: bridge connection closed
```

This was caused by the `refreshRemoteNodeBins` function being called repeatedly on each reconnection attempt, with no backoff between failures.

**Local fix applied:** Added rate limiting with exponential backoff to `src/infra/skills-remote.ts` to prevent rapid probe retries. This eliminated the error spam.

### Remaining issue

Even after the probe fix, the CPU remains high when the app is connected. The gateway error log is now empty, but CPU usage persists at 80%+ for the gateway and 50%+ for the app.

Quitting the Companion App immediately brings CPU to 0%.

## Steps to reproduce

1. Gateway running via LaunchAgent (CPU at ~0-2%)
2. Open Clawdbot.app
3. Within 10-15 seconds, CPU spikes to 80%+ for `clawdbot-gateway` and 50%+ for the app
4. Quit the app â†’ CPU returns to 0%

## Expected behavior

App connects to gateway without excessive CPU usage.

## Workaround

Quit the Companion App. Gateway alone handles all channels (WhatsApp, Telegram) and Claude Code sessions correctly at ~0% CPU.

## Suggested fix for the probe issue

In `src/infra/skills-remote.ts`, add rate limiting to prevent rapid probe retries:

```typescript
const probeFailures = new Map<string, { count: number; lastAttempt: number }>();
const PROBE_BACKOFF_BASE_MS = 5_000;
const PROBE_BACKOFF_MAX_MS = 300_000;

function shouldSkipProbe(nodeId: string): boolean {
  const failure = probeFailures.get(nodeId);
  if (!failure) return false;
  const backoffMs = Math.min(PROBE_BACKOFF_BASE_MS * Math.pow(2, failure.count - 1), PROBE_BACKOFF_MAX_MS);
  const elapsed = Date.now() - failure.lastAttempt;
  return elapsed < backoffMs;
}

// Call shouldSkipProbe at the start of refreshRemoteNodeBins
// Call recordProbeFailure on failure, clearProbeFailure on success
```

This fixes the probe loop but doesn't address the underlying CPU usage when the app connects.

## Comments


## Links

- None detected yet
