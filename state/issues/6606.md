---
number: 6606
title: "[Bug]: Telegram webhook binds to 0.0.0.0 with optional secret token"
author: coygeek
created: 2026-02-01T21:31:07Z
updated: 2026-02-02T00:16:34Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6606
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## CVSS Assessment

| Metric | Value |
|--------|-------|
| **Score** | 7.5 / 10.0 |
| **Severity** | High |
| **Vector** | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N |

> [CVSS v3.1 Calculator](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N)


## Summary

The Telegram webhook server defaults to binding on `0.0.0.0` (all network interfaces) and the secret token is optional. When started without a secret, any attacker on the network can send forged Telegram update payloads, potentially hijacking bot sessions and triggering unauthorized actions.

## Affected Code

**File:** `src/telegram/webhook.ts:26,36`

```typescript
export async function startTelegramWebhook(opts: {
  // ...
  secret?: string;  // OPTIONAL - can be undefined
  // ...
}) {
  const host = opts.host ?? "0.0.0.0";  // Default to all interfaces
  // ...
  const handler = webhookCallback(bot, "http", {
    secretToken: opts.secret,  // Passed directly, may be undefined
  });
  // ...
  await new Promise<void>((resolve) => server.listen(port, host, resolve));
}
```

When `opts.secret` is undefined, the grammY `webhookCallback` doesn't validate the `X-Telegram-Bot-Api-Secret-Token` header, accepting any request as legitimate.

## Attack Surface

**How is this reached?**
- [x] Network (HTTP/WebSocket endpoint, API call)
- [ ] Adjacent Network (same LAN, requires network proximity)
- [ ] Local (local file, CLI argument, environment variable)
- [ ] Physical (requires physical access to machine)

**Authentication required?**
- [x] None (unauthenticated/public access)
- [ ] Low (any authenticated user)
- [ ] High (admin/privileged user only)

**Entry point:** HTTP POST to the webhook endpoint path.

## Exploit Conditions

**Complexity:**
- [x] Low (no special conditions, works reliably)
- [ ] High (requires race condition, specific config, or timing)

**User interaction:**
- [x] None (automatic, no victim action needed)
- [ ] Required (victim must click, visit, or perform action)

**Prerequisites:**
- Telegram webhook must be running without a secret token configured
- Attacker must know or guess the webhook URL (often predictable)

## Impact Assessment

**Scope:**
- [x] Unchanged (impact limited to vulnerable component)
- [ ] Changed (can affect other components, escape sandbox)

**What can an attacker do?**

| Impact Type | Level | Description |
|-------------|-------|-------------|
| Confidentiality | None | No direct data exposure |
| Integrity | High | Can inject arbitrary "messages" to trigger bot actions, execute commands |
| Availability | None | No direct service disruption |

**Attack scenario:**
1. Attacker discovers webhook endpoint (e.g., `http://target:8080/webhook`)
2. Sends crafted Telegram Update JSON mimicking a message from any user
3. Bot processes the fake message and executes commands
4. Attacker can impersonate admins, trigger privileged bot commands, or manipulate bot state

## Steps to Reproduce

1. Start Telegram webhook without configuring a secret token
2. Send a forged update:
   ```bash
   curl -X POST http://target:8080/webhook \
     -H "Content-Type: application/json" \
     -d '{"update_id":1,"message":{"message_id":1,"chat":{"id":123,"type":"private"},"from":{"id":999,"is_bot":false,"first_name":"Attacker"},"text":"/admin_command"}}'
   ```
3. Observe: Bot processes the forged message as legitimate

## Recommended Fix

1. **Make secret token required** (breaking change but more secure):
   ```typescript
   export async function startTelegramWebhook(opts: {
     secret: string;  // Required, not optional
     // ...
   })
   ```

2. **Or warn loudly and default to localhost when no secret:**
   ```typescript
   if (!opts.secret) {
     console.warn('[SECURITY] Telegram webhook started without secret token!');
     // Force localhost binding when no auth
     const host = "127.0.0.1";
   }
   ```

3. **Validate the secret token header explicitly:**
   ```typescript
   if (opts.secret) {
     const handler = webhookCallback(bot, "http", {
       secretToken: opts.secret,
     });
   } else {
     throw new Error('Telegram webhook requires a secret token for security');
   }
   ```

## References

- **CWE:** [CWE-287](https://cwe.mitre.org/data/definitions/287.html) - Improper Authentication
- **Related:** [Telegram Bot API - Webhook Security](https://core.telegram.org/bots/api#setwebhook) (secret_token parameter)

## Comments


## Links

- None detected yet
