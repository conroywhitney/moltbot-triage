---
number: 5171
title: "[Bug]: pnpm install fails with heap out of memory on large workspace"
author: ryancnelson
created: 2026-01-31T04:38:13Z
updated: 2026-02-02T00:20:05Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5171
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

`pnpm install` fails with "JavaScript heap out of memory" error when installing dependencies for openclaw development, even with 32GB heap allocated via NODE_OPTIONS.

## Environment

- OpenClaw version: 2026.1.29
- OS: Linux (Ubuntu) with 188GB RAM
- pnpm version: 9.15.9 and 10.23.0 (both fail)
- Node.js: v24.4.1
- Install method: Development (git clone)

## Steps to Reproduce

1. Clone openclaw repo
2. Run `pnpm install`
3. Observe OOM error during package linking phase

Tried with:
- `pnpm install` (default heap)
- `NODE_OPTIONS=--max-old-space-size=8192 pnpm install`
- `NODE_OPTIONS=--max-old-space-size=16384 pnpm install`
- `NODE_OPTIONS=--max-old-space-size=32768 pnpm install`

All fail with the same error.

## Workaround

Using `npm install --legacy-peer-deps` succeeds.

## Error Log

```
<--- Last few GCs --->
[pid:0x7f6fc4002000]  6837 ms: Scavenge 397.2 (526.2) -> 397.2 (526.2) MB, pooled: 0 MB, 101.98 / 0.00 ms  (average mu = 0.976, current mu = 0.839) allocation failure; 
[pid:0x7f6fc4002000]  7429 ms: Scavenge 674.8 (803.8) -> 674.8 (803.8) MB, pooled: 0 MB, 52.90 / 0.00 ms  (average mu = 0.976, current mu = 0.839) allocation failure; 

FATAL ERROR: invalid array length Allocation failed - JavaScript heap out of memory
```

## Impact

- Prevents contributors from using pnpm for development
- Forces use of npm which may have different behavior
- May affect CI/CD if using pnpm

## Related

This appears to be a known pnpm issue with large monorepo workspaces:
- https://github.com/pnpm/pnpm/issues/6227
- https://github.com/pnpm/pnpm/issues/8441

## Suggested Fix

Consider documenting npm as the recommended package manager for development, or add a `.npmrc` / documentation note about the pnpm limitation.

## Comments

### @alexlitty (2026-02-01)

+1. If you're running into this while running `docker-setup.sh`, you can update the `Dockerfile` and prefix the second `pnpm build` call.

I prefixed the first one too, but I don't think you need to.

```
# Before: (Look for this line)
RUN OPENCLAW_A2UI_SKIP_MISSING=1 pnpm build
```

```
# After: (Update it to this)
RUN NODE_OPTIONS=--max-old-space-size=16384 OPENCLAW_A2UI_SKIP_MISSING=1 pnpm build
```

(I understand OP isn't using docker I think, just for general awareness)


## Links

- None detected yet
