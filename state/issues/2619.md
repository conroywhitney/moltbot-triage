---
number: 2619
title: "Custom TTS endpoint configuration is difficult - silent validation failures and undocumented workaround"
author: sportsculture
created: 2026-01-27T06:47:06Z
updated: 2026-01-28T06:00:00Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/2619
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Custom TTS endpoint configuration is difficult to set up

### Problem

When trying to use a self-hosted ElevenLabs-compatible TTS server (like Qwen3-TTS, Coqui, or other custom voice models), the configuration is confusing and fails silently.

### Issues Found

1. **ElevenLabs voiceId validation is too strict**
   
   In `tts.js` line 305-306:
   ```javascript
   function isValidVoiceId(voiceId) {
       return /^[a-zA-Z0-9]{10,40}$/.test(voiceId);
   }
   ```
   
   This regex requires 10-40 alphanumeric characters only. Custom voice names like `uncle_fu`, `en-US-Neural`, or `my_voice` fail validation because they contain underscores/hyphens or are too short.

2. **Silent fallback to Edge TTS**
   
   When voiceId validation fails, an error is thrown internally but the system silently falls back to Edge TTS. Users hear a generic voice with no indication why their custom voice wasn't used.

3. **baseUrl config works but voiceId blocks it**
   
   The ElevenLabs `baseUrl` config IS read and used (line 102, 710), but the strict voiceId validation (line 700) throws before the request is made.

4. **OPENAI_TTS_BASE_URL is the only working solution**
   
   The undocumented `OPENAI_TTS_BASE_URL` environment variable (lines 577-584) is the only way to use custom TTS endpoints, because it relaxes model/voice validation.

### Current Workaround

Set environment variable and use OpenAI provider:
```bash
export OPENAI_TTS_BASE_URL=http://your-tts-server:8001/v1
```

```json
{
  "messages": {
    "tts": {
      "provider": "openai",
      "openai": {
        "apiKey": "not-needed",
        "model": "custom-model",
        "voice": "any_voice_name"
      }
    }
  }
}
```

### Suggested Fixes

1. **Relax voiceId validation for custom baseUrl** - When `elevenlabs.baseUrl` is not the default, skip the strict regex validation (similar to how OpenAI validation is relaxed for custom endpoints)

2. **Add logging when TTS fails validation** - Instead of silent fallback, log a warning like "voiceId 'uncle_fu' failed validation, falling back to Edge TTS"

3. **Document OPENAI_TTS_BASE_URL** - Add to docs that this env var enables custom OpenAI-compatible TTS endpoints

4. **Consider ELEVENLABS_TTS_BASE_URL** - Add similar env var support for ElevenLabs provider

### Environment

- Clawdbot version: 2026.1.24
- Node: v25.5.0
- macOS

## Comments


## Links

- None detected yet
