---
number: 2398
title: "[Bug]: Gateway crashes on TrueNAS due to mDNS MTU size error with multiple Docker network interfaces"
author: thepearl
created: 2026-01-26T21:27:34Z
updated: 2026-01-27T13:44:19Z
labels: ["bug"]
assignees: []
comments_count: 4
reactions_total: 1
url: https://github.com/moltbot/moltbot/issues/2398
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary
Gateway crashes on startup due to mDNS MTU size error when running on TrueNAS with multiple Docker network interfaces. The Bonjour/mDNS probe packet exceeds the MTU size (1693>1440 bytes) because it attempts to advertise on all 30+ network interfaces simultaneously.

## Steps to reproduce
1. Install Clawdbot on TrueNAS system with many Docker bridge interfaces (30+ interfaces in this case)
2. Configure gateway with `"bind": "loopback"` in `~/.clawdbot/clawdbot.json`
3. Run `clawdbot gateway --port 18789 --verbose`

## Expected behavior
Gateway should start successfully and listen on the configured port (18789), either by:
- Skipping problematic network interfaces
- Disabling Bonjour/mDNS when too many interfaces are detected
- Providing a config option to disable Bonjour entirely

## Actual behavior
Gateway crashes within seconds of startup with the error:
```
AssertionError [ERR_ASSERTION]: Probe query packet exceeds the mtu size (1693>1440). Can't split probe queries at the moment!
```

The process never successfully binds to port 18789. Even with auto-restart scripts, the gateway crashes before completing initialization.

## Environment
- Clawdbot version: 2026.1.24-3 (885167d)
- OS: TrueNAS (Debian-based)
- Install method: npm global install (`npm install -g clawdbot@latest`)
- Node version: v24.13.0
- Network interfaces: 30+ Docker bridge interfaces (br-*, docker0, etc.) + physical interface (enp0s31f6)

## Logs or screenshots
```
2026-01-26T21:25:10.694Z [clawdbot] Uncaught exception: AssertionError [ERR_ASSERTION]: Probe query packet exceeds the mtu size (1693>1440). Can't split probe queries at the moment!
    at DNSPacket.createDNSQueryPackets (/root/.nvm/versions/node/v24.13.0/lib/node_modules/clawdbot/node_modules/@homebridge/ciao/src/coder/DNSPacket.ts:271:16)
    at MDNSServer.sendQueryBroadcast (/root/.nvm/versions/node/v24.13.0/lib/node_modules/clawdbot/node_modules/@homebridge/ciao/src/MDNSServer.ts:281:31)
    at Prober.sendProbeRequest (/root/.nvm/versions/node/v24.13.0/lib/node_modules/clawdbot/node_modules/@homebridge/ciao/src/responder/Prober.ts:165:17)
    at listOnTimeout (node:internal/timers:605:17)
    at processTimers (node:internal/timers:541:7)
```

The error occurs regardless of:
- Gateway bind mode (loopback vs LAN)
- Short hostname (`HOSTNAME="t"`)
- Which network interfaces are active

## Additional context
The issue appears to be in the `@homebridge/ciao` mDNS library used for Bonjour service discovery. When it tries to probe all network interfaces, the DNS packet size exceeds the MTU limit.

**Suggested fixes:**
1. Add config option to completely disable Bonjour/mDNS
2. Limit Bonjour to only primary network interface
3. Skip interfaces when packet size would exceed MTU
4. Catch this exception gracefully and continue without Bonjour

## Comments

### @Sophist-UK (2026-01-26)

For security purposes, TrueNAS isolates each app on its own Docker network - so if you use a yaml file to create a multi-container TrueNAS "app", all the containers in the ClawdBot app will be located on a specific Docker network separate from all other Docker networks. 

By default, ClawdBot should probably advertise itself only on the networks it can actually see (and maybe on the host network), probing other networks only when specifically instructed to do so.

Alternatively, it could probe each network independently (in parallel?) and then make sense of the multiple responses. 

### @Sophist-UK (2026-01-26)

To recreate the problem you can almost certainly use a virtualised TrueNAS environment, but this will require significant resources in order to create 30+ apps. Boot virtual drive of (say) 8GB, apps drive of (say) 8GB, memory 16GB.

### @thepearl (2026-01-27)

@Sophist-UK Thanks for the explanation! That makes perfect sense.
I was able to work around the issue by running Clawdbot in its own isolated Docker network instead of using --network host. This way it only sees one bridge interface instead of all 30+ TrueNAS app networks, which prevents the mDNS crash.
My working setup:
bashdocker network create clawdbot-net

```
docker run -d \
  --name clawdbot \
  --restart unless-stopped \
  --network clawdbot-net \
  -p 18789:18789 \
  --privileged \
  -v /root/clawdbot-data:/root/.clawdbot \
  -v /root/clawdbot-data/workspace:/root/clawd \
  -v /:/host:rw \
  -v /var/run/docker.sock:/var/run/docker.sock \
  clawdbot-local sh -c "clawdbot gateway --port 18789 --bind lan --verbose"
```
This gives Clawdbot:

- Isolated network (no mDNS crash)
- Full access to TrueNAS filesystem via /host mount
- Docker socket access for container management
- Works perfectly with Discord integration (i only tested it using discord for now)

However, it would still be great if Clawdbot could handle multi-interface environments more gracefully by default. Maybe an option to disable mDNS/Bonjour discovery entirely, or only probe specific interfaces? For TrueNAS users, the discovery feature isn't really needed since we're running it locally anyway.
Thanks for the help!

### @Sophist-UK (2026-01-27)

I was a bit surprised that it saw all the networks, but if you set CB to use the host network that would explain it.


## Links

- None detected yet
