---
number: 7691
title: "Compaction reserveTokens undefined can produce NaN"
author: 1alyx
created: 2026-02-03T03:50:28Z
updated: 2026-02-03T03:50:28Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7691
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Problem
Compaction fails when `preparation.settings.reserveTokens` is undefined because the guard code computes `NaN`, causing summarization to fall back instead of producing real summaries.

## Steps to reproduce
1. Run compaction with `compaction.reserveTokens` unset in config.
2. Trigger compaction safeguard summarization.

## Expected behavior
Compaction should use a sane fallback reserve token value and produce summaries.

## Actual behavior
Reserve tokens become NaN, and summarization fails, returning fallback text.

## Comments


## Links

- None detected yet
