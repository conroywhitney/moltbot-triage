---
number: 6480
title: "openclaw config set` silently fails when gateway is in crash/restart loop"
author: l10sha
created: 2026-02-01T18:05:47Z
updated: 2026-02-01T21:03:51Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6480
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

`openclaw config set gateway.auth.token <value>` reports "Updated" but does not persist to disk when the gateway is in a launchd crash loop. This makes the official troubleshooting path fail silently.

## Environment

- OpenClaw 2026.1.30 (76b5208)
- macOS (Apple Silicon)
- Node 22.22.0

## Steps to Reproduce

1. Upgrade to v2026.1.30 with no `gateway.auth` block configured (or fresh install without running onboard)
2. Gateway enters crash loop (exits immediately every ~11 seconds due to missing token)
3. Run:
   ```bash
   openclaw config set gateway.auth.mode token
   openclaw config set gateway.auth.token "$(openssl rand -hex 32)"
   openclaw gateway restart
   ```
4. Both commands report "Updated gateway.auth.* — Restart the gateway to apply."
5. Check the file: `jq '.gateway.auth' ~/.openclaw/openclaw.json`

**Expected:** Auth block is present with mode and token.  
**Actual:** Auth block is missing. The gateway continues to crash.

## Root Cause (Hypothesis)

Race condition between `config set` writing the file and the gateway's `[reload]` mechanism rewriting it during the restart cycle. Log entries show:

```
[reload] config change requires gateway restart (meta.lastTouchedAt, gateway.auth)
Gateway failed to start: Error: gateway auth mode is token, but no token was configured
```

The reload detects the change but the restart still fails, and the config appears to be overwritten in the process.

## Workaround

Stop the crash loop first, then write directly:

```bash
launchctl stop gui/501/ai.openclaw.gateway
jq '.gateway.auth = {"mode": "token", "token": "<token>"}' ~/.openclaw/openclaw.json > tmp && mv tmp ~/.openclaw/openclaw.json
openclaw gateway install
```

## Suggested Fixes

1. `openclaw config set` should write atomically (temp file + rename) and verify the value persisted
2. If the gateway is in a crash loop, warn the user to stop it first before config changes
3. Consider a migration step for the v2026.1.29 breaking change (removal of auth mode "none") — currently existing installs silently break on upgrade
```

## Comments


## Links

- None detected yet
