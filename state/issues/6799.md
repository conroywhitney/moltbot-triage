---
number: 6799
title: "[Bug]: TUI/webchat /new command bypasses internal hook dispatch (session-memory, command-logger never fire)"
author: hamiltonchua
created: 2026-02-02T02:25:51Z
updated: 2026-02-02T02:57:01Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6799
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Summary

Internal hooks (e.g. `session-memory`, `command-logger`) are never triggered when `/new` is issued from the TUI or webchat. The hooks register correctly at startup but never fire because the TUI's `/new` command bypasses the hook dispatch code path.

## Steps to reproduce

1. Enable the `session-memory` and `command-logger` hooks in config
2. Restart the gateway — hooks show as registered in logs
3. Use the TUI (`openclaw tui`) or webchat and issue `/new` multiple times
4. Check `~/.openclaw/workspace/memory/` for slug-named files (e.g. `2026-02-02-some-topic.md`)
5. Check `~/.openclaw/logs/commands.log`

## Expected behavior

- `session-memory` hook saves a memory file with conversation context on each `/new`
- `command-logger` writes to `commands.log` on each command
- Hook handler logs like `[session-memory] Hook triggered for /new command` appear in gateway logs

## Actual behavior

- No memory files are created (only manually-created `YYYY-MM-DD.md` files exist)
- No `commands.log` file is created
- Zero hook execution traces in gateway logs despite ~20 session rotations
- Hooks register fine at startup (`Registered hook: session-memory -> command:new` appears in logs)

## Root cause

The TUI handles `/new` by calling the `sessions.reset` RPC method directly:

```js
// tui/tui-command-handlers.js:364
await client.resetSession(state.currentSessionKey);
```

Which calls `sessions.reset` on the gateway server:

```js
// gateway/server-methods/sessions.js:130
"sessions.reset": async ({ params, respond }) => {
    // ... resets session store entry ...
    respond(true, { ok: true, key: target.canonicalKey, entry: next }, undefined);
    // ← no triggerInternalHook() call here
};
```

This bypasses `commands-core.js:handleCommands()` which is the only place that calls `triggerInternalHook` for `/new`:

```js
// auto-reply/reply/commands-core.js:49-58
if (resetRequested && params.command.isAuthorizedSender) {
    const hookEvent = createInternalHookEvent("command", commandAction, ...);
    await triggerInternalHook(hookEvent);  // ← only reached via message-based /new
}
```

So hooks only fire when `/new` is sent as a text message through a channel (WhatsApp, Telegram, etc.), never from TUI/webchat.

## Suggested fix

Add `triggerInternalHook` call to the `sessions.reset` RPC handler in `server-methods/sessions.js`, similar to what `commands-core.js` does. The hook event should include `previousSessionEntry` (the entry before reset) so `session-memory` can read the old session transcript.

## Environment

- OpenClaw version: 2026.1.30
- OS: Fedora Linux 42 (x86_64)
- Install method: npm (global)
- Node: v22.22.0

## Comments


## Links

- None detected yet
