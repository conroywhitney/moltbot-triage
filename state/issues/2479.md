---
number: 2479
title: "[Bug] Sandboxed agent returns 'Tool exec not found' despite exec in sandbox tool policy"
author: yhl999
created: 2026-01-27T01:03:58Z
updated: 2026-01-28T06:01:20Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/2479
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

### Environment
- **Clawdbot version:** 2026.1.24-3
- **Node:** v22.22.0
- **OS:** Linux 6.8.0-90-generic (x64)
- **Docker:** Running, custom sandbox image

### Description

A sandboxed agent (`sandbox.mode: "all"`) returns "Tool exec not found" when calling the `exec` tool, despite:
1. `exec` being in `tools.allow`
2. `exec` being in `tools.sandbox.tools.allow`
3. `clawdbot sandbox explain` showing `exec` in the allowed list

### Configuration

```json
{
  "id": "group",
  "sandbox": {
    "mode": "all",
    "workspaceAccess": "ro",
    "docker": {
      "image": "clawdbot-sandbox-lite:latest",
      "network": "bridge"
    }
  },
  "tools": {
    "profile": "coding",
    "allow": ["web_search", "image", "message", "cron", "session_status", "exec"],
    "deny": ["bash", "process", ...],
    "sandbox": {
      "tools": {
        "allow": ["web_search", "image", "message", "cron", "session_status", "exec"],
        "deny": []
      }
    }
  }
}
```

### Diagnostic Output

```
$ clawdbot sandbox explain --agent group

Effective sandbox:
  agentId: group
  sessionKey: agent:group:telegram:g:-5169861041
  mainSessionKey: agent:group:main
  runtime: sandboxed
  mode: all scope: agent perSession: false
  workspaceAccess: ro workspaceRoot: /root/.clawdbot/sandboxes

Sandbox tool policy:
  allow (agent): web_search, image, message, cron, session_status, exec
  deny  (agent): (empty)
```

### Observed Behavior

When the sandboxed agent calls `exec`:

```json
{
  "type": "toolCall",
  "name": "exec",
  "arguments": {
    "command": "curl -s -X POST http://172.17.0.1:18790/call ..."
  }
}
```

The tool result is:

```json
{
  "type": "toolResult",
  "toolName": "exec",
  "content": [{ "type": "text", "text": "Tool exec not found" }],
  "isError": true
}
```

### Expected Behavior

The `exec` tool should be available to the sandboxed agent since it's explicitly in both:
- `tools.allow`
- `tools.sandbox.tools.allow`

And `sandbox explain` confirms it should be allowed.

### Additional Context

- The custom Docker image has `curl` installed and works correctly
- Network connectivity from the sandbox to `172.17.0.1:18790` works (tested manually)
- Setting `sandbox.mode: "off"` allows `exec` to work (confirms sandbox-specific issue)
- The `coding` profile is applied, which includes `group:runtime` (exec, bash, process)
- Warning in logs: `tools.profile (coding) allowlist contains unknown entries (group:memory)` â€” this is unrelated (memory tools not loaded)

### Workaround

Setting `sandbox.mode: "off"` for the agent allows `exec` to work, but loses the security isolation.

### Steps to Reproduce

1. Create an agent with `sandbox.mode: "all"` and `exec` in both tool allow lists
2. Have the agent call the `exec` tool
3. Observe "Tool exec not found" error despite correct config

## Comments


## Links

- None detected yet
