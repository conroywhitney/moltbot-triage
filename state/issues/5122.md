---
number: 5122
title: "[Bug]: readJsonBody() has no read timeout, enabling Slowloris DoS"
author: coygeek
created: 2026-01-31T02:53:54Z
updated: 2026-02-02T00:20:29Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/5122
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description


## Summary

**Severity:** P0/Critical (Score: 100/150)
**CWE:** [CWE-400](https://cwe.mitre.org/data/definitions/400.html) - Uncontrolled Resource Consumption
**OWASP:** [A05:2021](https://owasp.org/Top10/A05_2021-Security_Misconfiguration/) - Security Misconfiguration
**File:** `src/gateway/hooks.ts:66-106`

The `readJsonBody()` function reads HTTP request bodies without a time limit, making the webhook endpoint vulnerable to **Slowloris denial-of-service attacks**. While a size limit (256KB default) prevents memory exhaustion from large payloads, an attacker can bypass this by sending data extremely slowly—1 byte per minute keeps the connection alive indefinitely while never hitting the size limit.

**Why this is critical:** Slowloris attacks are devastatingly effective because they consume server resources (socket connections, memory for buffers, worker threads) with minimal attacker bandwidth. A single attacker with a slow internet connection can exhaust all available server connections, making the service unavailable to legitimate users. Unlike bandwidth-based DDoS attacks, Slowloris requires no botnet—just patience.

## Triage Assessment

| Factor | Value | Score |
|--------|-------|-------|
| **Reachability** | Public webhook endpoint (any internet user) | 40/40 |
| **Impact** | Denial of Service (connection exhaustion) | 20/50 |
| **Exploitability** | Single slow request per connection | 30/30 |
| **Verification** | file:line ✓, code ✓, attack steps ✓ | 10/30 |
| **Total** | — | **100/150** |

## Steps to reproduce
1. Open a connection to a webhook endpoint
2. Send HTTP headers with `Content-Length: 1000`
3. Send 1 byte every 60 seconds
4. Connection stays open, consuming resources
5. Repeat with many connections to exhaust server capacity

## Expected behavior
Body reading should timeout after a reasonable duration (e.g., 30 seconds), returning an error.

## Actual behavior
No time limit on body reading:

### Affected code location:

**Hook Body Reader** (`src/gateway/hooks.ts:66-106`):
```typescript
export async function readJsonBody(
  req: IncomingMessage,
  maxBytes: number,
): Promise<{ ok: true; value: unknown } | { ok: false; error: string }> {
  return await new Promise((resolve) => {
    let done = false;
    let total = 0;
    const chunks: Buffer[] = [];
    req.on("data", (chunk: Buffer) => {
      // Size limit checked - good
      if (total > maxBytes) { /* ... */ }
      chunks.push(chunk);
    });
    req.on("end", () => { /* ... */ });
    req.on("error", (err) => { /* ... */ });
    // <-- No timeout! Slow client hangs forever
  });
}
```

## Environment
- Clawdbot version: latest (main branch)
- OS: Any
- Install method: Any

## Logs or screenshots
N/A - manifests as resource exhaustion

## Impact
- **Connection exhaustion**: Each slow request holds a socket
- **Memory consumption**: Buffers held for slow requests
- **DoS vulnerability**: Gateway hooks are externally accessible
- **Low attack cost**: Attacker needs minimal bandwidth

## Recommended fix
Add read timeout:
```typescript
export async function readJsonBody(
  req: IncomingMessage,
  maxBytes: number,
  timeoutMs = 30000,
): Promise<{ ok: true; value: unknown } | { ok: false; error: string }> {
  return await new Promise((resolve) => {
    const timeout = setTimeout(() => {
      if (!done) {
        done = true;
        req.destroy();
        resolve({ ok: false, error: 'Request body read timeout' });
      }
    }, timeoutMs);

    // ... existing handlers ...

    req.on("end", () => {
      clearTimeout(timeout);
      // ... existing logic ...
    });
  });
}
```

## Comments

### @coygeek (2026-02-01)

## CVSS Assessment

| Metric | Value |
|--------|-------|
| **Score** | 7.5 / 10.0 |
| **Severity** | High |
| **Vector** | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |

> [CVSS v3.1 Calculator](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H)



## Links

- None detected yet
