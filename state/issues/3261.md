---
number: 3261
title: "[Bug]: Env var substitution rewrites config file with plain-text secrets on gateway restart"
author: dreamgoat011
created: 2026-01-28T10:05:31Z
updated: 2026-01-30T01:57:12Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/3261
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

Version: 2026.1.24-3
OS: Linux (Pi 5)
Install: npm global

**Steps to reproduce:**
1. Create config with env var placeholder: `"apiKey": "${NANOGPT_API_KEY}"`
2. Run `clawdbot gateway restart`
3. Check config file - secrets are now written in plain text

**Expected behavior:**
Config file should remain unchanged with `${VAR_NAME}` placeholders. Secrets should only be substituted in memory at runtime.

**Actual behavior:**
Config file is rewritten with actual secret values, exposing them in backups/version control.
**Relevant docs:** https://docs.molt.bot/gateway/configuration#env-var-substitution-in-config

## Comments

### @Gerkinfeltser (2026-01-30)

Adding some additional context that might help prioritize this:

**`doctor` is particularly problematic** — it's marketed as a diagnostic/fix tool, so new users (myself included) run it expecting it to be safe. But it triggers the same config rewrite, silently replacing `${ENV_VAR}` placeholders with expanded secrets. This is a footgun because:

- `clawdbot config get` — safe (read-only)
- `clawdbot doctor` — **dangerous** (rewrites config)
- `clawdbot gateway config.patch` — **dangerous** (rewrites config)
- Wizard/setup flows — **dangerous** (they save what they see)

**New user impact:** This is really frustrating to discover after the fact. You set up config properly with env var placeholders, run `doctor` thinking you're being careful, and now your secrets are in plain text on disk (and potentially in git history/backups).

**Root cause (for whoever picks this up):** Classic round-trip bug — `parse → expand → modify → serialize → write`. The expansion happens at parse time, but the serializer doesn't know the original was a variable reference, so it writes the literal string value.

**Possible fix approaches:**
1. Store original unexpanded config separately and merge at write time
2. Track which values came from env var substitution (e.g., store as `{"__env": "VAR_NAME"}` internally)
3. At minimum: add a prominent warning in docs that `${}` syntax is not round-trip safe

The workaround for now is to avoid `${}` placeholders entirely and use runtime env var overrides instead (like `CLAWDBOT_GATEWAY_TOKEN`), but that's not obvious to new users following the docs.


## Links

- None detected yet
