---
number: 2935
title: "Heartbeat stops firing after context compression"
author: mkoslacz
created: 2026-01-27T19:52:17Z
updated: 2026-01-28T05:57:37Z
labels: ["bug"]
assignees: []
comments_count: 1
reactions_total: 0
url: https://github.com/moltbot/moltbot/issues/2935
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Problem

Heartbeat configured in `agents.defaults.heartbeat` stops firing after context compression occurs.

### Config
```json
"heartbeat": {
  "every": "30m",
  "activeHours": {
    "start": "07:00",
    "end": "23:00",
    "timezone": "Europe/Warsaw"
  },
  "target": "telegram",
  "to": "8029162297"
}
```

### Symptoms
1. Heartbeat works fine initially (`[heartbeat] started` in logs)
2. After context compression (due to token limits), heartbeat stops
3. Logs show: `No session found: telegram:8029162297`
4. No more heartbeat polls until gateway restart

### Expected Behavior
Heartbeat should continue working after context compression by:
1. Creating a new session if the previous one doesn't exist
2. Or maintaining heartbeat polling independent of session state

### Logs
```
2026-01-27T18:53:16.080Z [heartbeat] started
# ... context compression happens ...
2026-01-27T19:18:09.517Z [ws] ⇄ res ✗ sessions.resolve errorMessage=No session found: telegram:8029162297
# ... no more heartbeat polls until manual restart ...
```

### Workaround
Manual gateway restart (`gateway action=restart`) brings heartbeat back.

### Environment
- Clawdbot: 2026.1.24-3
- OS: macOS Darwin 24.6.0
- Channel: Telegram

## Comments

### @mkoslacz (2026-01-27)

## Additional logs

Heartbeat logs show `[heartbeat] started` repeatedly but **no poll is ever sent**:

```
2026-01-27T20:41:01.831Z [heartbeat] started
2026-01-27T20:41:41.554Z [heartbeat] started
2026-01-27T20:42:21.430Z [heartbeat] started
2026-01-27T20:43:01.249Z [heartbeat] started
2026-01-27T20:43:40.882Z [heartbeat] started
2026-01-27T20:44:20.750Z [heartbeat] started
2026-01-27T20:45:00.677Z [heartbeat] started
2026-01-27T20:45:40.137Z [heartbeat] started
```

Note the irregular intervals (~40 seconds) instead of configured `every: "30m"`.

No logs found for:
- Telegram send operations during heartbeat
- Poll message injection
- HEARTBEAT_OK responses

### Config
```json
"heartbeat": {
  "every": "30m",
  "activeHours": {
    "start": "07:00",
    "end": "23:00",
    "timezone": "Europe/Warsaw"
  },
  "target": "telegram",
  "to": "8029162297"
}
```

### Workaround
Using systemd/launchd to send heartbeat poll via Telegram Bot API directly, bypassing the built-in heartbeat scheduler.


## Links

- None detected yet
