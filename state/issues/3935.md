---
number: 3935
title: "Feature: Support gateway.publicUrl for media serving in reverse proxy setups"
author: mkeasling
created: 2026-01-29T11:35:28Z
updated: 2026-01-29T11:35:28Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/3935
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

# Feature Request: Support gateway.publicUrl for media serving in reverse proxy setups

**Repository:** https://github.com/clawdbot/clawdbot/issues/new

## Problem

When accessing the Control UI webchat through a reverse proxy (nginx, etc.), media files referenced with `MEDIA:` paths don't render in the chat interface. The webchat client doesn't know how to resolve these paths to publicly accessible URLs.

## Use Case

Running Clawdbot gateway on a VPS with nginx reverse proxy:
- Gateway bound to loopback (127.0.0.1:18789)
- Nginx proxies `https://domain.com` → `http://127.0.0.1:18789`
- Media files served via nginx location block: `/media/` → `~/.clawdbot/media/`

Screenshots and other media generated by tools like `browser screenshot` show `MEDIA:/path/to/file.png` in the transcript but don't render as images in the webchat.

## Proposed Solution

Add a `gateway.publicUrl` configuration option:

```json5
{
  gateway: {
    publicUrl: "https://domain.com"  // optional, defaults to detecting from request
  }
}
```

When set, the gateway would:
1. Transform `MEDIA:` paths to full URLs when sending to webchat clients
2. Use this base URL for any media references in chat messages
3. Alternatively, inject it as a window variable for the Control UI to handle client-side

## Alternative Implementation

Could also detect the public URL from request headers when behind a reverse proxy:
- Use `X-Forwarded-Host` + `X-Forwarded-Proto` headers
- Automatically construct media URLs without config
- Fall back to `gateway.publicUrl` if headers aren't present

## Current Workaround

Manually construct URLs using the known nginx proxy domain when sharing media with users.

## Additional Context

- Control UI already receives injected config via `window.__CLAWDBOT_*` variables
- Could add `window.__CLAWDBOT_PUBLIC_URL__` or `window.__CLAWDBOT_MEDIA_BASE_URL__`
- Should work seamlessly with existing Tailscale Serve/Funnel setups (auto-detect from headers?)
- This would also benefit users running behind Cloudflare Tunnel, Tailscale Funnel, or any other reverse proxy

**Platform:** VPS (Linux), nginx reverse proxy with OAuth2 proxy authentication

---

**Status:** Ready to submit - just needs gh CLI installed or manual submission via GitHub web UI

## Comments


## Links

- None detected yet
