---
number: 3388
title: "[nextcloud-talk] Signature computed incorrectly - signs JSON body instead of message text"
author: skey07746
created: 2026-01-28T14:48:01Z
updated: 2026-01-28T15:07:32Z
labels: ["bug", "channel: nextcloud-talk"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/3388
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Bug Description

The Nextcloud Talk plugin computes the HMAC signature incorrectly when sending messages and reactions. It signs the JSON body (`{"message":"..."}`) instead of just the message text.

## Expected Behavior

According to [Nextcloud Talk Bot API docs](https://nextcloud-talk.readthedocs.io/en/latest/bots/#sample-bash-script), the signature should be:

```bash
MESSAGE_TO_SIGN="${RANDOM_HEADER}${MESSAGE}"
SIGNATURE=$(echo -n "${MESSAGE_TO_SIGN}" | openssl dgst -sha256 -hmac "${SECRET}" | cut -d' -f2)
```

Where `MESSAGE` is the raw message text, **not** the JSON body.

## Actual Behavior

The plugin in `src/send.ts` computes:

```js
const bodyStr = JSON.stringify(body);  // {"message":"...","replyTo":...}
const { random, signature } = generateNextcloudTalkSignature({
    body: bodyStr,  // ❌ Wrong - this is the JSON body
    secret,
});
```

This causes Nextcloud to log `"No valid Bot entry found"` and return HTTP 401.

## Fix

In `src/send.ts`, change the signature computation to sign just the message text:

```js
const { random, signature } = generateNextcloudTalkSignature({
    body: message,  // ✅ Correct - just the message text
    secret,
});
```

Same fix needed for `sendReactionNextcloudTalk` - sign just `reaction`, not `JSON.stringify({ reaction })`.

## Environment

- Nextcloud: 32.0.1
- Talk app: latest
- Clawdbot nextcloud-talk plugin: 2026.1.24

## Verification

Tested manually with curl using the official sample script format - works correctly when signing just the message text.

## Comments


## Links

- None detected yet
