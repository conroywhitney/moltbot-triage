---
number: 6535
title: "Plugin hooks exist in type system but some are never called in execution flow"
author: ryancnelson
created: 2026-02-01T19:23:18Z
updated: 2026-02-01T21:04:54Z
labels: ["bug"]
assignees: []
comments_count: 2
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/6535
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Issue Description

While exploring the plugin hook system, I noticed that several hooks are defined in the type system and documented as available, but don't appear to have integration points in the actual execution flow.

## Current Hook Status

### ✅ Working (4/12 hooks)

1. **`before_agent_start`** - Called in `src/agents/pi-embedded-runner/run/attempt.ts`
2. **`agent_end`** - Called in `src/agents/pi-embedded-runner/run/attempt.ts` 
3. **`message_received`** - Called in `src/auto-reply/reply/dispatch-from-config.ts`
4. **`tool_result_persist`** - Called in `src/agents/session-tool-result-guard-wrapper.ts`

### ❓ Possibly Missing Integration (8/12 hooks)

5. **`before_tool_call`** - Has types and runner function, but no call sites found
6. **`after_tool_call`** - Has types and runner function, but no call sites found
7. **`message_sending`** - Has types and runner function, but no call sites found
8. **`message_sent`** - Has types and runner function, but no call sites found
9. **`before_compaction`** - Has types and runner function, but no call sites found
10. **`after_compaction`** - Has types and runner function, but no call sites found
11. **`session_start`** - Has types and runner function, but no call sites found
12. **`session_end`** - Has types and runner function, but no call sites found
13. **`gateway_start`** - Has types and runner function, but no call sites found
14. **`gateway_stop`** - Has types and runner function, but no call sites found

## Technical Details

All hooks have complete infrastructure:
- Type definitions in `src/plugins/types.ts` (lines 295-301)
- Runner functions in `src/plugins/hooks.ts`
- Exported in hook runner interface

The missing piece appears to be the actual calls to the runner functions in the execution flow.

## Verification Steps

I searched for hook calls in the codebase:

**Working hooks found:**
```bash
grep -r "\.runBeforeAgentStart\|\.runAgentEnd\|\.runMessageReceived\|\.runToolResultPersist" src/ --include="*.ts"
```
Returns multiple call sites.

**Other hooks not found:**
```bash
grep -r "\.runBeforeToolCall\|\.runAfterToolCall\|\.runMessageSending\|\.runMessageSent\|\.runBeforeCompaction\|\.runAfterCompaction\|\.runSessionStart\|\.runSessionEnd\|\.runGatewayStart\|\.runGatewayStop" src/ --include="*.ts"
```
Returns no results.

## Impact

Plugin developers can register handlers for these hooks, but the handlers may never execute since the runner functions aren't called in the execution flow.

## Possible Solution

The infrastructure exists - it might just need the missing `hookRunner.runXXX()` calls added to the appropriate execution points:

- Tool hooks: Could be added to tool execution handlers
- Message hooks: Could be added to message dispatch flows
- Compaction hooks: Could be added to compaction workflows  
- Session/gateway hooks: Could be added to lifecycle management

Let me know if this analysis is helpful or if I'm missing something about how these hooks are supposed to work!

## Comments

### @ryancnelson (2026-02-01)

ah ha!  
```
The hooks don't exist in pi-mono at all:      
                                                                                
  No hook references found in pi-mono coding-agent                              
                                                                                
  Key Findings:                                                                 
                                                                                
  1. before_tool_call and after_tool_call are OpenClaw-only inventions - they're
   not part of pi-coding-agent                                                  
  2. OpenClaw's plugin system defines these hooks but never wires them up       
  3. This is OpenClaw's own unfinished feature, not a pi author issue   
  ```



### @ryancnelson (2026-02-01)

submitted https://github.com/openclaw/openclaw/pull/6570 to fix the first of these, so my yubikey-approval-hook skill can progress.



## Links

- None detected yet
