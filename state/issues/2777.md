---
number: 2777
title: "[Bug]: message tool sends media to General topic instead of current DM topic in Telegram"
author: Lukavyi
created: 2026-01-27T13:52:46Z
updated: 2026-01-28T05:58:56Z
labels: ["bug"]
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/2777
duplicate_of: null
related_issues: []
blocks: []
blocked_by: []
---

## Description

## Description

When a Telegram bot has **topics enabled in DMs** (`has_topics_enabled: true`), the `message` tool (action=send) sends media and text to the **General topic** instead of the current session topic.

## Root Cause

The `message` tool receives `toolContext.currentThreadTs` from the session context (set via `buildToolContext` in `channels/dock.js`), but this value is **never mapped** to `params.threadId`.

The Telegram plugin action handler (`readTelegramSendParams` in `channels/plugins/actions/telegram.ts`) reads `params.threadId`, which is only set if the caller explicitly passes it. The `toolContext.currentThreadTs` is not injected into `params`.

**Auto-reply works correctly** because it uses a different code path (`sendMessageTelegram` directly with `messageThreadId` from session context).

## Flow

1. Session has `MessageThreadId` (e.g., `994409`)
2. `buildToolContext` maps it to `currentThreadTs: "994409"`
3. `message` tool passes `toolContext` to `runMessageAction`
4. `handleSendAction` reads `params.threadId` → `undefined` (not set from toolContext)
5. `executeSendAction` → `dispatchChannelMessageAction` → Telegram plugin
6. Plugin reads `params.threadId` → `undefined`
7. `sendMessageTelegram` called without `messageThreadId`
8. Message lands in General topic instead of current topic

## Expected

`message` tool should inject `toolContext.currentThreadTs` into `params.threadId` (when not explicitly provided) so that Telegram plugin sends to the correct topic.

## Reproduction

1. Enable topics on a Telegram bot DM
2. Start a conversation in a non-General topic
3. Use the `message` tool to send media (e.g., `message(action=send, target=<chat_id>, media=/path/to/image.jpg)`)
4. Image arrives in General topic, not the current topic

## Environment

- Clawdbot version: 2026.1.24-3
- Telegram Bot API with `has_topics_enabled: true` in DMs
- Grammy library

## Comments


## Links

- None detected yet
