---
number: 7427
title: "Telegram DM Threaded Mode: General topic '#' stuck loading + handler ignores message_thread_id"
author: coolishagent
created: 2026-02-02T20:18:50Z
updated: 2026-02-02T20:18:50Z
labels: []
assignees: []
comments_count: 0
reactions_total: 0
url: https://github.com/openclaw/openclaw/issues/7427
duplicate_of: null
related_issues: [2731,6833]
blocks: []
blocked_by: []
---

## Description

## Summary

Two issues with Telegram DM Threaded Mode (BotFather "Threaded Mode" toggle, Bot API 9.3):

### Bug 1: `bot-handlers.js` ignores DM `message_thread_id`

In `bot-handlers.js`, inbound messages use `resolveTelegramForumThreadId()` which only handles forum groups (`isForum === true`). For DM threaded mode, `isForum` is `false`, so `resolvedThreadId` is always `undefined` — discarding the DM thread ID.

This affects the `conversationKey` (debounce key) at line ~590:
```javascript
const conversationKey = resolvedThreadId != null 
    ? `${chatId}:topic:${resolvedThreadId}` 
    : String(chatId);  // ← DM threads always hit this path
```

**Note:** `bot-message-context.js` already correctly uses `resolveTelegramThreadSpec()` which handles DM threads. The fix is to also use `resolveTelegramThreadSpec` in the handler.

**Proposed fix:**
```javascript
// In bot-handlers.js, replace:
const resolvedThreadId = resolveTelegramForumThreadId({ isForum, messageThreadId });

// With:
const threadSpec = resolveTelegramThreadSpec({ isGroup, isForum, messageThreadId });
const resolvedThreadId = threadSpec.id ?? (isGroup ? resolveTelegramForumThreadId({ isForum, messageThreadId }) : undefined);
```

And add `resolveTelegramThreadSpec` to the import.

### Bug 2: General topic "#" stuck on Loading in DM

When Threaded Mode is enabled, Telegram creates a "#" General topic (thread id 1) in the DM. This topic permanently shows "Loading..." at the top.

Likely causes:
- `buildTelegramThreadParams()` returns `undefined` for thread id 1 when scope is `"forum"`, but DM scope is `"dm"` so it returns `{ message_thread_id: 1 }` — which Telegram may reject silently
- Telegram client may expect an initial response or `sendMessageDraft` in the General topic to resolve the loading state
- Bot replies without proper `message_thread_id` land in a "new chat" area outside the "#" thread

### Environment
- OpenClaw 2026.2.1
- Telegram Windows 6.4.2
- Bot API 9.3 (Threaded Mode enabled via BotFather)

### Steps to reproduce
1. Enable Threaded Mode for bot via @BotFather → Bot Settings
2. Open DM with the bot
3. Observe "#" thread appears with permanent "Loading..." 
4. Send message in "#" thread
5. Bot reply appears in top-level "new chat" instead of "#" thread

### Related
- PR #6833 (enforce thread specs for DM vs forum sends)
- PR #2731 (ignore non-forum group message_thread_id)
- Bot API 9.3 changelog: Topics in private chats

## Comments


## Links

- None detected yet
